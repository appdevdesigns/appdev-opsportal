/*
@license
Webix Gantt v.8.1.1
This software is covered by Webix Commercial License.
Usage without proper license is prohibited.
(c) XB Software Ltd.
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).gantt={})}(this,(function(t){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,i)};function i(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}var r=function(){return(r=Object.assign||function(t){for(var e,i=1,r=arguments.length;i<r;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},n=function(){},o=function(){function t(t,e){this.webixJet=!0,this.webix=t,this._events=[],this._subs={},this._data={},e&&e.params&&t.extend(this._data,e.params)}return t.prototype.getRoot=function(){return this._root},t.prototype.destructor=function(){this._detachEvents(),this._destroySubs(),this._events=this._container=this.app=this._parent=this._root=null},t.prototype.setParam=function(t,e,i){if(this._data[t]!==e&&(this._data[t]=e,this._segment.update(t,e,0),i))return this.show(null)},t.prototype.getParam=function(t,e){var i=this._data[t];if(void 0!==i||!e)return i;var r=this.getParentView();return r?r.getParam(t,e):void 0},t.prototype.getUrl=function(){return this._segment.suburl()},t.prototype.getUrlString=function(){return this._segment.toString()},t.prototype.getParentView=function(){return this._parent},t.prototype.$$=function(t){if("string"==typeof t){var e=this.getRoot();return e.queryView((function(i){return(i.config.id===t||i.config.localId===t)&&i.$scope===e.$scope}),"self")}return t},t.prototype.on=function(t,e,i){var r=t.attachEvent(e,i);return this._events.push({obj:t,id:r}),r},t.prototype.contains=function(t){for(var e in this._subs){var i=this._subs[e].view;if(i===t||i.contains(t))return!0}return!1},t.prototype.getSubView=function(t){var e=this.getSubViewInfo(t);if(e)return e.subview.view},t.prototype.getSubViewInfo=function(t){var e=this._subs[t||"default"];return e?{subview:e,parent:this}:"_top"===t?(this._subs[t]={url:"",id:null,popup:!0},this.getSubViewInfo(t)):this._parent?this._parent.getSubViewInfo(t):null},t.prototype._detachEvents=function(){for(var t=this._events,e=t.length-1;e>=0;e--)t[e].obj.detachEvent(t[e].id)},t.prototype._destroySubs=function(){for(var t in this._subs){var e=this._subs[t].view;e&&e.destructor()}this._subs={}},t.prototype._init_url_data=function(){var t=this._segment.current();this._data={},this.webix.extend(this._data,t.params,!0)},t.prototype._getDefaultSub=function(){if(this._subs.default)return this._subs.default;for(var t in this._subs){var e=this._subs[t];if(!e.branch&&e.view&&"_top"!==t){var i=e.view._getDefaultSub();if(i)return i}}},t.prototype._routed_view=function(){var t=this.getParentView();if(!t)return!0;var e=t._getDefaultSub();return!(!e&&e!==this)&&t._routed_view()},t}();function s(t){"/"===t[0]&&(t=t.substr(1));for(var e=t.split("/"),i=[],r=0;r<e.length;r++){var n=e[r],o={},s=n.indexOf(":");if(-1===s&&(s=n.indexOf("?")),-1!==s)for(var a=0,u=n.substr(s+1).split(/[\:\?\&]/g);a<u.length;a++){var l=u[a].split("=");o[l[0]]=decodeURIComponent(l[1])}i[r]={page:s>-1?n.substr(0,s):n,params:o,isNew:!0}}return i}function a(t){for(var e=[],i=0,r=t;i<r.length;i++){var n=r[i];e.push("/"+n.page);var o=u(n.params);o&&e.push("?"+o)}return e.join("")}function u(t){var e=[];for(var i in t)"object"!=typeof t[i]&&(e.length&&e.push("&"),e.push(i+"="+encodeURIComponent(t[i])));return e.join("")}var l=function(){function t(t,e){this._next=1,this.route="string"==typeof t?{url:s(t),path:t}:t,this.index=e}return t.prototype.current=function(){return this.route.url[this.index]},t.prototype.next=function(){return this.route.url[this.index+this._next]},t.prototype.suburl=function(){return this.route.url.slice(this.index)},t.prototype.shift=function(e){var i=new t(this.route,this.index+this._next);return i.setParams(i.route.url,e,i.index),i},t.prototype.setParams=function(t,e,i){if(e){var r=t[i].params;for(var n in e)r[n]=e[n]}},t.prototype.refresh=function(){for(var t=this.route.url,e=this.index+1;e<t.length;e++)t[e].isNew=!0},t.prototype.toString=function(){var t=a(this.suburl());return t?t.substr(1):""},t.prototype._join=function(t,e){var i=this.route.url;if(null===t)return i;var r=this.route.url,n=!0;if(i=r.slice(0,this.index+(e?this._next:0)),t){i=i.concat(s(t));for(var o=0;o<i.length;o++)r[o]&&(i[o].view=r[o].view),n&&r[o]&&i[o].page===r[o].page?i[o].isNew=!1:i[o].isNew&&(n=!1)}return i},t.prototype.append=function(t){var e=this._join(t,!0);return this.route.path=a(e),this.route.url=e,this.route.path},t.prototype.show=function(t,e,i){var r=this,o=this._join(t.url,i);return this.setParams(o,t.params,this.index+(i?this._next:0)),new Promise((function(t,i){var s=a(o),u={url:o,redirect:s,confirm:Promise.resolve()},l=e?e.app:null;if(l&&!l.callEvent("app:guard",[u.redirect,e,u]))return void i(new n);u.confirm.catch((function(t){return i(t)})).then((function(){if(null!==u.redirect){if(u.redirect!==s)return l.show(u.redirect),void i(new n);r.route.path=s,r.route.url=o,t()}else i(new n)}))}))},t.prototype.size=function(t){this._next=t},t.prototype.split=function(){var e={url:this.route.url.slice(this.index+1),path:""};return e.url.length&&(e.path=a(e.url)),new t(e,0)},t.prototype.update=function(t,e,i){var r=this.route.url[this.index+(i||0)];if(!r)return this.route.url.push({page:"",params:{}}),this.update(t,e,i);""===t?r.page=e:r.params[t]=e,this.route.path=a(this.route.url)},t}(),c=function(t){function e(e,i){var r=t.call(this,e.webix)||this;return r.app=e,r._children=[],r}return i(e,t),e.prototype.ui=function(t,e){var i=(e=e||{}).container||t.container,r=this.app.createView(t);return this._children.push(r),r.render(i,this._segment,this),"object"!=typeof t||t instanceof o?r:r.getRoot()},e.prototype.show=function(t,e){if(e=e||{},"object"==typeof t){for(var i in t)this.setParam(i,t[i]);t=null}else{if("/"===t.substr(0,1))return this.app.show(t,e);if(0===t.indexOf("./")&&(t=t.substr(2)),0===t.indexOf("../")){var r=this.getParentView();return r?r.show(t.substr(3),e):this.app.show("/"+t.substr(3))}var n=this.getSubViewInfo(e.target);if(n){if(n.parent!==this)return n.parent.show(t,e);if(e.target&&"default"!==e.target)return this._renderFrameLock(e.target,n.subview,{url:t,params:e.params})}else if(t)return this.app.show("/"+t,e)}return this._show(this._segment,{url:t,params:e.params},this)},e.prototype._show=function(t,e,i){var r=this;return t.show(e,i,!0).then((function(){return r._init_url_data(),r._urlChange()})).then((function(){t.route.linkRouter&&(r.app.getRouter().set(t.route.path,{silent:!0}),r.app.callEvent("app:route",[t.route.path]))}))},e.prototype.init=function(t,e){},e.prototype.ready=function(t,e){},e.prototype.config=function(){this.app.webix.message("View:Config is not implemented")},e.prototype.urlChange=function(t,e){},e.prototype.destroy=function(){},e.prototype.destructor=function(){this.destroy(),this._destroyKids(),this._root&&(this._root.destructor(),t.prototype.destructor.call(this))},e.prototype.use=function(t,e){t(this.app,this,e)},e.prototype.refresh=function(){this.getUrl();return this.destroy(),this._destroyKids(),this._destroySubs(),this._detachEvents(),this._container.tagName&&this._root.destructor(),this._segment.refresh(),this._render(this._segment)},e.prototype.render=function(t,e,i){var r=this;"string"==typeof e&&(e=new l(e,0)),this._segment=e,this._parent=i,this._init_url_data();var n="string"==typeof(t=t||document.body)?this.webix.toNode(t):t;return this._container!==n?(this._container=n,this._render(e)):this._urlChange().then((function(){return r.getRoot()}))},e.prototype._render=function(t){var e=this,i=this.config();return i.then?i.then((function(i){return e._render_final(i,t)})):this._render_final(i,t)},e.prototype._render_final=function(t,e){var i,r=this,n=null,o=null,s=!1;if(this._container.tagName?o=this._container:(n=this._container).popup?(o=document.body,s=!0):o=this.webix.$$(n.id),!this.app||!o)return Promise.reject(null);var a=this._segment.current(),u={ui:{}};this.app.copyConfig(t,u.ui,this._subs),this.app.callEvent("app:render",[this,e,u]),u.ui.$scope=this,!n&&a.isNew&&a.view&&a.view.destructor();try{if(n&&!s){var l=o,c=l.getParentView();c&&"multiview"===c.name&&!u.ui.id&&(u.ui.id=l.config.id)}this._root=this.app.webix.ui(u.ui,o);var h=this._root;s&&h.setPosition&&!h.isVisible()&&h.show(),n&&(n.view&&n.view!==this&&n.view!==this.app&&n.view.destructor(),n.id=this._root.config.id,this.getParentView()||!this.app.app?n.view=this:n.view=this.app),a.isNew&&(a.view=this,a.isNew=!1),i=Promise.resolve(this._init(this._root,e)).then((function(){return r._urlChange().then((function(){return r._initUrl=null,r.ready(r._root,e.suburl())}))}))}catch(t){i=Promise.reject(t)}return i.catch((function(t){return r._initError(r,t)}))},e.prototype._init=function(t,e){return this.init(t,e.suburl())},e.prototype._urlChange=function(){var t=this;this.app.callEvent("app:urlchange",[this,this._segment]);var e=[];for(var i in this._subs){var r=this._subs[i],n=this._renderFrameLock(i,r,null);n&&e.push(n)}return Promise.all(e).then((function(){return t.urlChange(t._root,t._segment.suburl())}))},e.prototype._renderFrameLock=function(t,e,i){if(!e.lock){var r=this._renderFrame(t,e,i);r&&(e.lock=r.then((function(){return e.lock=null}),(function(){return e.lock=null})))}return e.lock},e.prototype._renderFrame=function(t,e,i){var r=this;if("default"===t){if(this._segment.next()){var n=i?i.params:null;return e.params&&(n=this.webix.extend(n||{},e.params)),this._createSubView(e,this._segment.shift(n))}e.view&&e.popup&&(e.view.destructor(),e.view=null)}if(null!==i&&(e.url=i.url,e.params&&(i.params=this.webix.extend(i.params||{},e.params))),e.route){if(null!==i)return e.route.show(i,e.view).then((function(){return r._createSubView(e,e.route)}));if(e.branch)return}var o=e.view;if(!o&&e.url){if("string"==typeof e.url)return e.route=new l(e.url,0),i&&e.route.setParams(e.route.route.url,i.params,0),e.params&&e.route.setParams(e.route.route.url,e.params,0),this._createSubView(e,e.route);"function"!=typeof e.url||o instanceof e.url||(o=new(this.app._override(e.url))(this.app,"")),o||(o=e.url)}if(o)return o.render(e,e.route||this._segment,this)},e.prototype._initError=function(t,e){return this.app&&this.app.error("app:error:initview",[e,t]),!0},e.prototype._createSubView=function(t,e){var i=this;return this.app.createFromURL(e.current()).then((function(r){return r.render(t,e,i)}))},e.prototype._destroyKids=function(){for(var t=this._children,e=t.length-1;e>=0;e--)t[e]&&t[e].destructor&&t[e].destructor();this._children=[]},e}(o),h=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._ui=i.ui,r}return i(e,t),e.prototype.config=function(){return this._ui},e}(c),p=function(){function t(t,e,i){this.path="",this.app=i}return t.prototype.set=function(t,e){this.path=t;var i=this.app;i.app.getRouter().set(i._segment.append(this.path),{silent:!0})},t.prototype.get=function(){return this.path},t}(),d=!0,f=function(t){function e(e){var i=this,r=(e||{}).webix||window.webix;return e=r.extend({name:"App",version:"1.0",start:"/home"},e,!0),(i=t.call(this,r,e)||this).config=e,i.app=i.config.app,i.ready=Promise.resolve(),i._services={},i.webix.extend(i,i.webix.EventSystem),i}return i(e,t),e.prototype.getUrl=function(){return this._subSegment.suburl()},e.prototype.getUrlString=function(){return this._subSegment.toString()},e.prototype.getService=function(t){var e=this._services[t];return"function"==typeof e&&(e=this._services[t]=e(this)),e},e.prototype.setService=function(t,e){this._services[t]=e},e.prototype.destructor=function(){this.getSubView().destructor(),t.prototype.destructor.call(this)},e.prototype.copyConfig=function(t,e,i){if((t instanceof o||"function"==typeof t&&t.prototype instanceof o)&&(t={$subview:t}),void 0!==t.$subview)return this.addSubView(t,e,i);var r=t instanceof Array;for(var n in e=e||(r?[]:{}),t){var s=t[n];if("function"==typeof s&&s.prototype instanceof o&&(s={$subview:s}),!s||"object"!=typeof s||s instanceof this.webix.DataCollection||s instanceof RegExp||s instanceof Map)e[n]=s;else if(s instanceof Date)e[n]=new Date(s);else{var a=this.copyConfig(s,s instanceof Array?[]:{},i);null!==a&&(r?e.push(a):e[n]=a)}}return e},e.prototype.getRouter=function(){return this.$router},e.prototype.clickHandler=function(t,e){if(t&&(e=e||t.target||t.srcElement)&&e.getAttribute){var i=e.getAttribute("trigger");if(i)return this._forView(e,(function(t){return t.app.trigger(i)})),t.cancelBubble=!0,t.preventDefault();var r=e.getAttribute("route");if(r)return this._forView(e,(function(t){return t.show(r)})),t.cancelBubble=!0,t.preventDefault()}var n=e.parentNode;n&&this.clickHandler(t,n)},e.prototype.getRoot=function(){return this.getSubView().getRoot()},e.prototype.refresh=function(){var t=this;return this._subSegment?this.getSubView().refresh().then((function(e){return t.callEvent("app:route",[t.getUrl()]),e})):Promise.resolve(null)},e.prototype.loadView=function(t){var e=this,i=this.config.views,r=null;if(""===t)return Promise.resolve(this._loadError("",new Error("Webix Jet: Empty url segment")));try{i&&"string"==typeof(r="function"==typeof i?i(t):i[t])&&(t=r,r=null),r||("_hidden"===t?r={hidden:!0}:"_blank"===t?r={}:(t=t.replace(/\./g,"/"),r=this.require("jet-views",t)))}catch(e){r=this._loadError(t,e)}return r.then||(r=Promise.resolve(r)),r=r.then((function(t){return t.__esModule?t.default:t})).catch((function(i){return e._loadError(t,i)}))},e.prototype._forView=function(t,e){var i=this.webix.$$(t);i&&e(i.$scope)},e.prototype._loadViewDynamic=function(t){return null},e.prototype.createFromURL=function(t){var e=this;return t.isNew||!t.view?this.loadView(t.page).then((function(i){return e.createView(i,name,t.params)})):Promise.resolve(t.view)},e.prototype._override=function(t){var e=this.config.override;if(e){for(var i=void 0;t;)i=t,t=e.get(t);return i}return t},e.prototype.createView=function(t,i,r){if("function"==typeof(t=this._override(t))){if(t.prototype instanceof e)return new t({app:this,name:i,params:r,router:p});if(t.prototype instanceof o)return new t(this,{name:i,params:r});t=t(this)}return t instanceof o?t:new h(this,{name:i,ui:t})},e.prototype.show=function(t,e){return t&&this.app&&0==t.indexOf("//")?this.app.show(t.substr(1),e):this.render(this._container,t||this.config.start,e)},e.prototype.trigger=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this.apply(t,e)},e.prototype.apply=function(t,e){this.callEvent(t,e)},e.prototype.action=function(t){return this.webix.bind((function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.apply(t,e)}),this)},e.prototype.on=function(t,e){this.attachEvent(t,e)},e.prototype.use=function(t,e){t(this,null,e)},e.prototype.error=function(t,e){if(this.callEvent(t,e),this.callEvent("app:error",e),this.config.debug)for(var i=0;i<e.length;i++)if(console.error(e[i]),e[i]instanceof Error){var r=e[i].message;0===r.indexOf("Module build failed")?(r=r.replace(/\x1b\[[0-9;]*m/g,""),document.body.innerHTML="<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>"+r+"</pre>"):(r+="<br><br>Check console for more details",this.webix.message({type:"error",text:r,expire:-1}))}},e.prototype.render=function(t,e,i){var r=this;this._container="string"==typeof t?this.webix.toNode(t):t||document.body;var n=null;!this.$router?(d&&"tagName"in this._container&&(this.webix.event(document.body,"click",(function(t){return r.clickHandler(t)})),d=!1),"string"==typeof e&&(e=new l(e,0)),this._subSegment=this._first_start(e),this._subSegment.route.linkRouter=!0):n="string"==typeof e?e:this.app?e.split().route.path||this.config.start:e.toString();var o=i?i.params:this.config.params||null,s=this.getSubView(),a=this._subSegment,u=a.show({url:n,params:o},s).then((function(){return r.createFromURL(a.current())})).then((function(e){return e.render(t,a)})).then((function(t){return r.$router.set(a.route.path,{silent:!0}),r.callEvent("app:route",[r.getUrl()]),t}));return this.ready=this.ready.then((function(){return u})),u},e.prototype.getSubView=function(){if(this._subSegment){var t=this._subSegment.current().view;if(t)return t}return new c(this,{})},e.prototype.require=function(t,e){return null},e.prototype._first_start=function(t){var e=this;this._segment=t;if(this.$router=new this.config.router((function(t){return setTimeout((function(){e.show(t).catch((function(t){if(!(t instanceof n))throw t}))}),1)}),this.config,this),this._container===document.body&&!1!==this.config.animation){var i=this._container;this.webix.html.addCss(i,"webixappstart"),setTimeout((function(){e.webix.html.removeCss(i,"webixappstart"),e.webix.html.addCss(i,"webixapp")}),10)}if(t){if(this.app){var r=t.current().view;t.current().view=this,t.next()?(t.refresh(),t=t.split()):t=new l(this.config.start,0),t.current().view=r}}else{var o=this.$router.get();o||(o=this.config.start,this.$router.set(o,{silent:!0})),t=new l(o,0)}return t},e.prototype._loadError=function(t,e){return this.error("app:error:resolve",[e,t]),{template:" "}},e.prototype.addSubView=function(t,e,i){var r=!0!==t.$subview?t.$subview:null,n=t.name||(r?this.webix.uid():"default");return e.id=t.id||"s"+this.webix.uid(),(i[n]={id:e.id,url:r,branch:t.branch,popup:t.popup,params:t.params}).popup?null:e},e}(o),g=function(){function t(t,e){var i=this;this.config=e||{},this._detectPrefix(),this.cb=t,window.onpopstate=function(){return i.cb(i.get())}}return t.prototype.set=function(t,e){var i=this;if(this.config.routes){var r=t.split("?",2);for(var n in this.config.routes)if(this.config.routes[n]===r[0]){t=n+(r.length>1?"?"+r[1]:"");break}}this.get()!==t&&window.history.pushState(null,null,this.prefix+this.sufix+t),e&&e.silent||setTimeout((function(){return i.cb(t)}),1)},t.prototype.get=function(){var t=this._getRaw().replace(this.prefix,"").replace(this.sufix,"");if(t="/"!==t&&"#"!==t?t:"",this.config.routes){var e=t.split("?",2),i=this.config.routes[e[0]];i&&(t=i+(e.length>1?"?"+e[1]:""))}return t},t.prototype._detectPrefix=function(){var t=this.config.routerPrefix;this.sufix="#"+(void 0===t?"!":t),this.prefix=document.location.href.split("#",2)[0]},t.prototype._getRaw=function(){return document.location.href},t}(),v=!1;function m(t){if(!v&&t){v=!0;var e=window;e.Promise||(e.Promise=t.promise);var i=t.version.split(".");10*i[0]+1*i[1]<53&&(t.ui.freeze=function(e){var i=e();return i&&i.then?i.then((function(e){return t.ui.$freeze=!1,t.ui.resize(),e})):(t.ui.$freeze=!1,t.ui.resize()),i});var r=t.ui.baselayout.prototype.addView,n=t.ui.baselayout.prototype.removeView,o={addView:function(t,e){if(this.$scope&&this.$scope.webixJet&&!t.queryView){var i=this.$scope,n={};t=i.app.copyConfig(t,{},n),r.apply(this,[t,e]);var o=function(t){i._renderFrame(t,n[t],null).then((function(){i._subs[t]=n[t]}))};for(var s in n)o(s);return t.id}return r.apply(this,arguments)},removeView:function(){if(n.apply(this,arguments),this.$scope&&this.$scope.webixJet){var e=this.$scope._subs;for(var i in e){var r=e[i];t.$$(r.id)||(r.view.destructor(),delete e[i])}}}};t.extend(t.ui.layout.prototype,o,!0),t.extend(t.ui.baselayout.prototype,o,!0),t.protoUI({name:"jetapp",$init:function(e){this.$app=new this.app(e);var i=t.uid().toString();e.body={id:i},this.$ready.push((function(){this.callEvent("onInit",[this.$app]),this.$app.render({id:i})}))}},t.ui.proxy,t.EventSystem)}}var w=function(t){function e(e){var i;return e.router=e.router||g,m((i=t.call(this,e)||this).webix),i}return i(e,t),e.prototype.require=function(t,e){return require(t+"/"+e)},e}(f),y=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}i(e,t),e.prototype._detectPrefix=function(){this.prefix="",this.sufix=this.config.routerPrefix||""},e.prototype._getRaw=function(){return document.location.pathname+(document.location.search||"")}}(g),function(){function t(t,e){this.path="",this.cb=t}return t.prototype.set=function(t,e){var i=this;this.path=t,e&&e.silent||setTimeout((function(){return i.cb(t)}),1)},t.prototype.get=function(){return this.path},t}());function _(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function b(t,e,i){for(var r in t)_(t,r)&&e.call(i||t,t[r],r,t)}function x(t){t="Warning: "+t,"undefined"!=typeof console&&console.error(t);try{throw new Error(t)}catch(t){}}var k=String.prototype.replace,S=String.prototype.split,T=function(t){var e=t%10;return 11!==t&&1===e?0:2<=e&&e<=4&&!(t>=12&&t<=14)?1:2},$={arabic:function(t){if(t<3)return t;var e=t%100;return e>=3&&e<=10?3:e>=11?4:5},bosnian_serbian:T,chinese:function(){return 0},croatian:T,french:function(t){return t>1?1:0},german:function(t){return 1!==t?1:0},russian:T,lithuanian:function(t){return t%10==1&&t%100!=11?0:t%10>=2&&t%10<=9&&(t%100<11||t%100>19)?1:2},czech:function(t){return 1===t?0:t>=2&&t<=4?1:2},polish:function(t){if(1===t)return 0;var e=t%10;return 2<=e&&e<=4&&(t%100<10||t%100>=20)?1:2},icelandic:function(t){return t%10!=1||t%100==11?1:0},slovenian:function(t){var e=t%100;return 1===e?0:2===e?1:3===e||4===e?2:3}},C={arabic:["ar"],bosnian_serbian:["bs-Latn-BA","bs-Cyrl-BA","srl-RS","sr-RS"],chinese:["id","id-ID","ja","ko","ko-KR","lo","ms","th","th-TH","zh"],croatian:["hr","hr-HR"],german:["fa","da","de","en","es","fi","el","he","hi-IN","hu","hu-HU","it","nl","no","pt","sv","tr"],french:["fr","tl","pt-br"],russian:["ru","ru-RU"],lithuanian:["lt"],czech:["cs","cs-CZ","sk"],polish:["pl"],icelandic:["is"],slovenian:["sl-SL"]};function D(t){var e,i=(e={},b(C,(function(t,i){b(t,(function(t){e[t]=i}))})),e);return i[t]||i[S.call(t,/-/,1)[0]]||i.en}function P(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var L=/\$/g,I=/%\{(.*?)\}/g;function M(t,e,i,r){if("string"!=typeof t)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==e)return t;var n=t,o=r||I,s="number"==typeof e?{smart_count:e}:e;if(null!=s.smart_count&&n){var a=S.call(n,"||||");n=(a[function(t,e){return $[D(t)](e)}(i||"en",s.smart_count)]||a[0]).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}return n=k.call(n,o,(function(t,e){return _(s,e)&&null!=s[e]?k.call(s[e],L,"$$"):t}))}function E(t){var e=t||{};this.phrases={},this.extend(e.phrases||{}),this.currentLocale=e.locale||"en";var i=e.allowMissing?M:null;this.onMissingKey="function"==typeof e.onMissingKey?e.onMissingKey:i,this.warn=e.warn||x,this.tokenRegex=function(t){var e=t&&t.prefix||"%{",i=t&&t.suffix||"}";if("||||"===e||"||||"===i)throw new RangeError('"||||" token is reserved for pluralization');return new RegExp(P(e)+"(.*?)"+P(i),"g")}(e.interpolation)}E.prototype.locale=function(t){return t&&(this.currentLocale=t),this.currentLocale},E.prototype.extend=function(t,e){b(t,(function(t,i){var r=e?e+"."+i:i;"object"==typeof t?this.extend(t,r):this.phrases[r]=t}),this)},E.prototype.unset=function(t,e){"string"==typeof t?delete this.phrases[t]:b(t,(function(t,i){var r=e?e+"."+i:i;"object"==typeof t?this.unset(t,r):delete this.phrases[r]}),this)},E.prototype.clear=function(){this.phrases={}},E.prototype.replace=function(t){this.clear(),this.extend(t)},E.prototype.t=function(t,e){var i,r,n=null==e?{}:e;if("string"==typeof this.phrases[t])i=this.phrases[t];else if("string"==typeof n._)i=n._;else if(this.onMissingKey){r=(0,this.onMissingKey)(t,n,this.currentLocale,this.tokenRegex)}else this.warn('Missing translation for key: "'+t+'"'),r=t;return"string"==typeof i&&(r=M(i,n,this.currentLocale,this.tokenRegex)),r},E.prototype.has=function(t){return _(this.phrases,t)},E.transformPhrase=function(t,e,i){return M(t,e,i)};var j=E;var F=window.webix;F&&m(F);var U=function(t,e,i){var r=(i=i||{}).storage,n=r?r.get("lang")||"en":i.lang||"en";function o(e,o,s){o.__esModule&&(o=o.default);var u={phrases:o};i.polyglot&&t.webix.extend(u,i.polyglot);var l=a.polyglot=new j(u);if(l.locale(e),a._=t.webix.bind(l.t,l),n=e,r&&r.put("lang",n),i.webix){var c=i.webix[e];c&&t.webix.i18n.setLocale(c)}return s?Promise.resolve():t.refresh()}function s(e,r){if(!1!==i.path){var n=(i.path?i.path+"/":"")+e;o(e,t.require("jet-locales",n),r)}}var a={getLang:function(){return n},setLang:s,setLangData:o,_:null,polyglot:null};t.setService("locale",a),s(n,!0)},R=window;R.Promise||(R.Promise=R.webix.promise);var H=1;function V(t,e,i){Object.defineProperty(e,i,{get:function(){return t[i]},set:function(e){return t[i]=e}})}function B(t,e){e=e||{};var i={},r={},n=function(t,e){var n=H++;return i[n]={mask:t,handler:e},e("*"===t?r:r[t],void 0,t),n},o=[],s=!1,a=function(t,e,r,n){if(s)o.push([t,e,r,n]);else for(var a=Object.keys(i),u=0;u<a.length;u++){var l=i[a[u]];l&&("*"!==l.mask&&l.mask!==t||l.handler(r,e,t,n))}};return Object.defineProperty(r,"$changes",{value:{attachEvent:n,detachEvent:function(t){delete i[t]}},enumerable:!1,configurable:!1}),Object.defineProperty(r,"$observe",{value:n,enumerable:!1,configurable:!1}),Object.defineProperty(r,"$batch",{value:function(t){if("function"!=typeof t){var e=t;t=function(){for(var t in e)r[t]=e[t]}}for(s=!0,t(r),s=!1;o.length;){var i=o.shift();a.apply(this,i)}},enumerable:!1,configurable:!1}),Object.defineProperty(r,"$extend",{value:function(t,i){for(var n in i=i||e,t)if(t.hasOwnProperty(n)){var o=t[n];i.nested&&"object"==typeof o&&o?r[n]=B(o,i):O(r,o,n,a)}},enumerable:!1,configurable:!1}),r.$extend(t,e),r}function O(t,e,i,r){Object.defineProperty(t,i,{get:function(){return e},set:function(t){if(null===e||null===t?e!==t:e.valueOf()!=t.valueOf()){var n=e;e=t,r(i,n,t,null)}},enumerable:!0,configurable:!1})}var A=webix.Date;function N(t,e){return(t=new Date(t)).setHours(0,0,0,0),(e=new Date(e)).setHours(0,0,0,0),Math.round((t.getTime()-e.getTime())/864e5)}function z(t,e){return 24*N(t,e)+(t.getHours()-e.getHours())}var W={};function q(t,e){return Y(e)(t)}function Y(t){var e=W[t];return e||(e=W[t]=webix.Date.dateToStr(t)),e}var K={year:function(t,e){return t.getFullYear()-e.getFullYear()},quarter:function(t,e){return 4*(t.getFullYear()-e.getFullYear())+(Math.floor(t.getMonth()/3)+1)-(Math.floor(e.getMonth()/3)+1)},month:function(t,e){return 12*(t.getFullYear()-e.getFullYear())+(t.getMonth()-e.getMonth())},week:function(t,e){var i=N(t,e)/7;return Math.ceil(Math.abs(i)-(t.getDay()<=e.getDay()?0:1))*Math.sign(i)},day:N,hour:z,minute:function(t,e){return 60*z(t,e)+(t.getMinutes()-e.getMinutes())}};var G={year:["quarter",4],quarter:["month",3],month:["day",function(t){if(!t)return 30;var e=t.getMonth();if(1===e){var i=t.getFullYear();return i%4?28:i%100?29:i%400?28:29}return e%2&&e<7||!(e%2)&&e>7?30:31}],week:["day",7],day:["hour",24],hour:["minute",60]},X={year:function(t,e){return A.add(t,1*e,"year",!0)},quarter:function(t,e){return A.add(t,3*e,"month",!0)},month:function(t,e){return A.add(t,1*e,"month",!0)},week:function(t,e){return A.add(t,1*e,"week",!0)},day:function(t,e){return A.add(t,1*e,"day",!0)},hour:function(t,e){return A.add(t,1*e,"hour",!0)},minute:function(t,e){return A.add(t,1*e,"minute",!0)}};function J(t,e,i,r,n){var o=r?G[t][0]:t,s=i,a=e;if(n&&(s=et(o,i),(a=et(o,e))<e&&(a=tt(o)(a,1))),r){var u=K[o](a,s),l=G[t][1];return u/("number"==typeof l?l:l(i))}return K[o](a,s)}function Z(t){return function(e,i,r,n){return"month"===t&&r?function(t,e,i){if(Q(e,t))return J("month",t,e,!0,i);var r=0;if(e.getDate()>1){var n=new Date(e.getFullYear(),e.getMonth()+1,1);r=J("month",n,e,!0),e=n}var o=0;Q(e,t)||(o=J("month",webix.Date.monthStart(t),e),e=webix.Date.add(e,o,"month",!0));return r+o+J("month",t,e,!0)}(e,i,n):J(t,e,i,r,n)}}function Q(t,e){return webix.Date.equal(webix.Date.monthStart(t),webix.Date.monthStart(e))}function tt(t){return X[t]}function et(t,e){var i;switch(t){case"year":return new Date(e.getFullYear(),0,1);case"quarter":return new Date(e.getFullYear(),3*Math.floor(e.getMonth()/3),1);case"month":return new Date(e.getFullYear(),e.getMonth(),1);case"week":return(i=new Date(e.getFullYear(),e.getMonth(),e.getDate())).setDate(e.getDate()-e.getDay()),i;case"day":return(i=new Date(e.getFullYear(),e.getMonth(),e.getDate())).setHours(0,0,0,0),i;case"hour":return(i=new Date(e.getFullYear(),e.getMonth(),e.getDate())).setHours(e.getHours(),0,0,0),i;default:return new Date(e)}}function it(t,e,i,r,n,o){var s=function(t){var e=new Date;return t.map((function(t){return{item:t,len:tt(t.unit)(e,1)}})).sort((function(t,e){return t.len<e.len?-1:1}))[0].item.unit}(o),a=Z(s),u=et(s,e);t=et(s,t),e=u<e?tt(s)(u,1):u;var l=a(e,t)*r,c=n*o.length;return{rows:o.map((function(i){for(var o=[],u=tt(i.unit),l=i.step||1,c="week"===s&&"week"!==i.unit,h=et(i.unit,t);h<e;){var p=u(h,l);h<t&&(h=t),p>e&&(p=e);var d=h,f=p;c&&(h.getDay()>3&&(d=webix.Date.add(h,1,"week",!0)),p.getDay()>3&&(f=webix.Date.add(p,1,"week",!0)));var g=(a(f,d)||1)*r,v="function"==typeof i.format?i.format(h,p):q(h,i.format),m="";i.css&&(m+="function"==typeof i.css?i.css(h):i.css),o.push({width:g,value:v,css:m,date:h,format:Y(i.format)}),h=p}return{cells:o,add:u,height:n,type:i.unit,step:i.step||1}})),width:l,height:c,cellWidth:r,cellHeight:n,diff:a,start:t,end:e,minUnit:s,precise:i=!!("day"===s?i:0!=i)}}var rt={start:function(t,e){t._auto_scroll_delay=webix.delay(rt.autoScroll,t,[e,webix.html.pos(e)],250)},reset:function(t){t._auto_scroll_delay&&(t._auto_scroll_delay=window.clearTimeout(t._auto_scroll_delay))},autoScroll:function(t,e){var i=-1!==this.direction.indexOf("y"),r=-1!==this.direction.indexOf("x"),n=webix.html.offset(this.from.$view),o=!1;i&&rt.autoYScroll.call(this,e,n,this.senseY)&&(o=!0),r&&rt.autoXScroll.call(this,e,n,this.senseX)&&(o=!0),o&&(!function(t,e){if(webix.DragControl.active){var i=webix.DragControl.getNode();e=webix.copy(e),webix.DragControl.$dragPos(e,t),i.style.top=e.y+webix.DragControl.top+"px",i.style.left=e.x+webix.DragControl.left+"px"}}(t,e),this._auto_scroll_delay=webix.delay(rt.autoScroll,this,[t,e],100))},autoYScroll:function(t,e,i){var r=this.from.getScrollState();return t.y<e.y+i?rt.autoScrollTo.call(this,r.x,r.y-i,"y"):t.y>e.y+e.height-i&&rt.autoScrollTo.call(this,r.x,r.y+i,"y")},autoXScroll:function(t,e,i){var r=this.from.getScrollState();return t.x<e.x+i?rt.autoScrollTo.call(this,r.x-i,r.y,"x"):t.x>e.x+e.width-i&&rt.autoScrollTo.call(this,r.x+i,r.y,"x")},autoScrollTo:function(t,e,i){this.from.scrollTo(t,e),this.from.callEvent("onAfterAutoScroll",[]);var r=this.from.getScrollState();return Math.abs(("x"===i?t:e)-r[i])<1}};function nt(t){if(t.start_date&&t.end_date&&t.start_date.valueOf()>=t.end_date.valueOf()&&(t.end_date=null,t.duration=1),"milestone"==t.type)t.end_date=t.start_date,t.duration=0;else{if(!t.duration){var e=Z("day")(t.end_date,t.start_date,!0);t.duration=e>1?Math.floor(e):parseFloat(e.toFixed(2))}t.end_date||(t.duration<1?t.end_date=tt("hour")(t.start_date,Math.floor(24*t.duration)):t.end_date=tt("day")(t.start_date,t.duration))}}var ot=function(t,e,i,r){var n,o,s,a,u=Math.round(r/2);if(!e||!i)return t.$p="",t;var l,c,h=!1,p=!1;switch(t.type){case 0:p=!0;break;case 1:h=!0,p=!0;break;case 3:h=!0}if(n=h?e.$x:e.$x+e.$w,o=e.$y,s=p?i.$x:i.$x+i.$w,a=i.$y,n!==s||o!==a){var d=function(t,e,i,r,n,o,s){var a=t+20*(n?-1:1),u=i+20*(o?-1:1),l=[t,e,a,e,0,0,0,0,u,r,i,r],c=u-a,h=r-e,p=o===n;p||(u<=t&&o||u>t&&!o)&&(h-=s);p&&o&&a>u||p&&!o&&a<u?(l[4]=l[2]+c,l[5]=l[3],l[6]=l[4],l[7]=l[5]+h):(l[4]=l[2],l[5]=l[3]+h,l[6]=l[4]+c,l[7]=l[5]);return l.join(",")}(n,o+u,s,a+u,h,p,19),f=(l=s,c=a+u,p?l-5+","+(c-3)+","+(l-5)+","+(c+3)+","+l+","+c:l+5+","+(c+3)+","+(l+5)+","+(c-3)+","+l+","+c);t.$p=d+","+f}return t};function st(t){var e=webix.copy(lt);e.view=t,e.master=this,e.Local=this.app.getService("local"),webix.DragControl.addDrag(t.$view,e),webix.DragControl.addDrop(t.$view,e,!0)}function at(t,e){var i=t.getBoundingClientRect(),r=(e-i.left)/i.width,n=webix.env.touch?400:200,o=.2/(i.width>n?i.width/n:1);return r<o?"start":r>1-o?"end":"move"}function ut(t){var e=this.Local.getScales();return t.senseX=Math.round(e.cellWidth*(webix.env.touch?1:.5)),t.senseY=Math.round(e.cellHeight*(webix.env.touch?3:1)),t}var lt={$longTouchLimit:!0,$dragCreate:function(t,e){if(this.master.State.readonly)return!1;var i=this.locateEvent(e);if(i){var r=this.getContext(),n=e.target;if(n.classList.contains("webix_gantt_link"))return r.mode="links",ht[r.mode].$dragCreate.call(this,t,e,i);var o=this.view.getItemNode(i);if(!webix.env.touch&&function(t,e){for(;t!=e;){if(t.classList.contains("webix_gantt_progress_drag"))return!0;t=t.parentNode}return!1}(n,o))return r.mode="progress",ht[r.mode].$dragCreate.call(this,t,e,i);var s=this.view.getScrollState(),a=this.getEventContext(e),u=at(o,a.x);"task"==this.view.getItem(i).type||"start"!=u&&"end"!=u||(u="move");var l=this.Local.getScales(),c=l.cellWidth;if(l.precise){var h=G[l.minUnit][1];c=Math.round(c/("number"==typeof h?h:h()))}webix.extend(r,{id:i,mode:u,node:o,step:c,dx:0,from:this.view,x:a.x,scroll:s,t:parseInt(o.style.top),l:parseInt(o.style.left),w:parseInt(o.style.width)},!0),ht[r.mode].dragScroll&&webix.extend(r,ut.call(this,ht[r.mode].dragScroll));var p=o.cloneNode(!0);return p.className+=" webix_drag_zone webix_gantt_mode_"+u,o.style.visibility="hidden",webix.html.addCss(t,"webix_gantt_in_action",!0),t.style.cursor="move"==u?"move":"ew-resize",t.querySelector(".webix_scroll_cont").appendChild(p),p}return!1},$dragDestroy:function(t,e){var i=this,r=this.getContext();return ht[r.mode].dragScroll&&rt.reset(r),r.mode&&ht[r.mode].$dragDestroy?ht[r.mode].$dragDestroy.call(this,t,e):(r.$waitUpdate?r.$waitUpdate.catch((function(){i.master.Action({action:"update-task-time",id:r.id})})):r.$waitUpdate=this.master.Action({action:"update-task-time",id:r.id}),r.$waitUpdate.finally((function(){r.node.style.visibility="",webix.html.remove(e)})),t.style.cursor="",webix.html.removeCss(t,"webix_gantt_in_action"),!1)},$dragIn:function(t,e,i){var r=this.getContext();return!!r.mode&&(ht[r.mode].dragScroll&&(rt.reset(r),rt.start(r,i)),!ht[r.mode].$dragIn||ht[r.mode].$dragIn.call(this,t,e,i))},$dragPos:function(t){var e=this.getContext();return ht[e.mode].$dragPos.call(this,t)},$dragOut:function(t,e,i,r){var n=this.getContext();return ht[n.mode].$dragOut?ht[n.mode].$dragOut.call(this,t,e,i,r):null},$drop:function(t,e,i){var r=this.getContext();if(!r.mode)return!1;if(ht[r.mode].$drop)return ht[r.mode].$drop.call(this,t,e,i);var n=r.id,o=r.mode,s=r.dx,a=r.step,u=Math.round(s/a);r.$waitUpdate=this.master.Action({action:"update-task-time",mode:o,time:u,id:n})},locateEvent:function(t,e){return webix.env.touch&&e&&(t=document.elementFromPoint(e.x,e.y)),webix.html.locate(t,"webix_l_id")},getEventContext:function(t){if(webix.env.touch){if(t.changedTouches&&(!t.touches||!t.touches[0])){var e=t.changedTouches[0];return{x:e.pageX,y:e.pageY}}return t.time?t:webix.env.mouse.context(t)}return{x:t.clientX,y:t.clientY}},getContext:function(){return webix.DragControl.getContext()},setDragOffset:function(t,e,i){var r=this.getContext(),n=webix.html.pos(i),o=webix.html.offset(t);r.width=o.width,r.height=o.height,r.x_offset=o.x-n.x,r.y_offset=o.y-n.y}},ct={$dragPos:function(t){var e=this.getContext(),i=this.view.getScrollState(),r=webix.DragControl.getNode(),n=e.mode,o=e.l,s=e.t,a=e.w,u=e.x,l=e.id,c=e.scroll,h=e.step,p=e.dx=t.x-u-c.x+i.x;"start"===n?(t.x=Math.min(o+p,o+a-h),r.style.width=Math.max(a-p,h)+"px"):"end"===n&&(t.x=o,r.style.width=Math.max(a+p,h)+"px"),t.y=s,this.master.Action({action:"drag-task",id:l,left:t.x,width:parseInt(r.style.width)})}},ht={links:{dragScroll:{direction:"xy"},$dragCreate:function(t,e,i){var r=this.getContext(),n=e.target,o=this.view.getItemNode(i),s=this.view.getScrollState(),a=webix.html.offset(n),u=n.classList;webix.extend(r,{id:i,from:this.view,node:o,link:n,fromStart:u.contains("webix_gantt_link_left"),start:{x:a.x+a.width/2+s.x,y:a.y+a.height/2+s.y}},!0),ht[r.mode].dragScroll&&webix.extend(r,ut.call(this,ht[r.mode].dragScroll)),n.style.opacity=1,webix.html.addCss(o,"webix_gantt_task_in_action",!0);var l=webix.html.create("div",{visibility:"hidden"});return document.body.appendChild(l),l},$dragDestroy:function(t,e){var i=this.getContext();if(this.master.Action({action:"temp-link"}),i.target){var r=this.view.getItemNode(i.target);webix.html.removeCss(r,"webix_gantt_link_visible")}return i.link.style.opacity="",webix.html.removeCss(i.node,"webix_gantt_task_in_action"),webix.html.remove(e),!1},$dragIn:function(t,e,i){var r=this.getContext(),n=this.getEventContext(i),o=this.locateEvent(i,n);if(!o)return!1;var s=this.view.getItemNode(o);return o!=r.target&&(webix.html.addCss(s,"webix_gantt_link_visible",!0),r.target=o),s},$dragPos:function(t){var e=this.getContext(),i=this.view.getScrollState();e.end={x:t.x+i.x,y:t.y+i.y},this.master.Action({action:"temp-link",start:e.start,end:e.end})},$dragOut:function(t,e,i,r){var n=this.getContext(),o=this.getEventContext(r),s=this.locateEvent(r,o);if(n.target&&s!=n.target){var a=this.view.getItemNode(n.target);webix.html.removeCss(a,"webix_gantt_link_visible"),n.target=null}return null},$drop:function(t,e,i){var r=this.getContext(),n=r.id,o=this.getEventContext(i),s=this.locateEvent(i,o);if(!s||n==s)return!1;var a=this.view.getItemNode(s).getBoundingClientRect(),u=o.x-a.left<a.width/2,l=(r.fromStart?1:0)+(u?0:2);this.master.Action({action:"add-link",source:n,target:s,type:l})}},move:{dragScroll:{direction:"x"},$dragPos:function(t){var e=this.getContext(),i=e.node,r=e.l,n=e.t,o=e.x,s=e.id,a=e.scroll,u=this.view.getScrollState(),l=e.dx=t.x-o-a.x+u.x;t.x=r+l,t.y=n,this.master.Action({action:"drag-task",id:s,left:t.x,width:parseInt(i.style.width)})}},progress:{$dragCreate:function(t,e,i){var r=this.getContext(),n=this.view.getItemNode(i),o=this.view.getItem(i).progress,s=n.querySelector(".webix_gantt_progress"),a=this.getEventContext(e),u=this.view.getScrollState();webix.extend(r,{id:i,node:n,prevProgress:o,progressNode:s,from:this.view,x:a.x,w:parseInt(n.style.width),scroll:u},!0),t.style.cursor="ew-resize",webix.html.addCss(t,"webix_gantt_in_action",!0),webix.html.addCss(n,"webix_gantt_mode_progress",!0);var l=webix.html.create("div",{visibility:"hidden"});return document.body.appendChild(l),l},$dragPos:function(t){var e=this.getContext(),i=e.x,r=e.scroll,n=e.w,o=this.view.getScrollState(),s=t.x-i-r.x+o.x,a=Math.min(Math.max(e.prevProgress+Math.round(100*s/n),0),100);e.progress!=a&&(e.progress=a,ht[e.mode].updateTaskTemplate.call(this,e,a))},$drop:function(){var t=this.getContext(),e=t.id,i=t.progress,r=t.prevProgress;webix.isUndefined(i)||i==r||(t.$waitUpdate=this.master.Action({action:"update-task-progress",progress:i,id:e}))},$dragDestroy:function(t,e){var i=this,r=this.getContext();return r.$waitUpdate?r.$waitUpdate.catch((function(){i.master.Action({action:"update-task-progress",id:r.id})})):r.$waitUpdate=this.master.Action({action:"update-task-progress",id:r.id}),t.style.cursor="",webix.html.removeCss(t,"webix_gantt_in_action"),webix.html.removeCss(r.node,"webix_gantt_mode_progress"),webix.html.remove(e),!1},updateTaskTemplate:function(t,e){var i=t.progressNode;i.style.width=e+"%",i.innerHTML=this.master.DragProgressTemplate(e)}},start:ct,end:ct},pt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;this.State=this.getParam("state",!0);var e=this.app.getService("locale")._;return{view:"abslayout",css:this.State.readonly?" webix_gantt_readonly":"",borderless:!0,cells:[{view:"template",css:"webix_gantt_links",borderless:!0,relative:!0},{view:"list",borderless:!0,type:this.BarsType(e),css:"webix_gantt"+(webix.env.touch?"_touch":"")+"_bars",on:{onItemClick:function(e){t.State.$batch({parent:null,selected:e})}},tooltip:function(i){return t.GetTooltip(i,e)},scroll:"xy",relative:!0}]}},e.prototype.init=function(t){var e=this,i=t.getChildViews(),r=i[0],n=i[1];this.Links=r,this.Bars=n;var o=this.Local=this.app.getService("local"),s=o.getScales(),a=this.TasksData=o.tasks(),u=this.LinksData=o.links().data;n.sync(a),this.RefreshLinks(u),this.HandleScroll(),this.HandleDrag(s),this.HandleSelection(s),this.InitMarkers(),this.HandleHolidays(s),this.on(u,"onStoreUpdated",(function(){return e.RefreshLinks(u)})),this.on(this.app,"onScalesUpdate",(function(t){return e.Resize(t.width)})),this.on(a.data,"onStoreUpdated",(function(t,i,r){e.RefreshLinks(u),"update"!==r&&e.SetSelection()})),t.$view.style.backgroundImage="url("+function(t,e,i){var r=document.createElement("canvas");r.setAttribute("width",t),r.setAttribute("height",e);var n=r.getContext("2d");return n.strokeStyle=i,n.moveTo(0,e),n.lineTo(t,e),n.lineTo(t,0),n.stroke(),r.toDataURL()}(s.cellWidth,s.cellHeight,"contrast"==webix.skin.$name?"#808080":"#ccc")+")",t.$view.style.marginTop="0px",this.Resize(s.width)},e.prototype.BarsTemplate=function(t,e){var i=t.text||e("(no title)");return"milestone"==t.type?"<span>"+i+"</span>":i},e.prototype.BarsType=function(t){var e=this;return{template:function(i){return e.BarsTemplate(i,t)},templateStart:function(t){var i="milestone"==t.type,r=t.$w,n=t.$h,o=0,s="";if(i)r=n=Math.ceil(Math.sqrt(Math.pow(t.$w,2)/2)),o=Math.ceil((t.$w-r)/2);else{var a="task"==t.type?e.DragProgressTemplate(t.progress):"";s='<div class="webix_gantt_progress" style="width:'+t.progress+'%;">'+a+"</div>"}return'<div webix_l_id="'+t.id+'" \n\t\t\t\t\tclass="webix_gantt_task_base webix_gantt_'+t.type+'" \n\t\t\t\t\tstyle="left:'+(t.$x+o)+"px;top:"+(t.$y+o)+"px;width:"+r+"px;height:"+n+'px;" \n\t\t\t\t\tdata-id="'+t.id+'">\n\t\t\t\t\t\t<div class="webix_gantt_link webix_gantt_link_left"></div>\n\t\t\t\t\t\t'+s+'\n\t\t\t\t\t\t<div class="webix_gantt_content">'},templateEnd:function(){return'</div><div class="webix_gantt_link webix_gantt_link_right"></div></div>'}}},e.prototype.DragProgressTemplate=function(t){return'<div class="webix_gantt_progress_drag" style="left:'+t+'%">\n\t\t\t<span class="webix_gantt_progress_percent">'+t+"</span>\n\t\t</div>"},e.prototype.HandleDrag=function(){var t=this;st.call(this,this.Bars),webix.env.touch||(this._mousemove_handler=webix.event(this.Bars.$view,"mousemove",(function(e){return function(t,e){if(!webix.DragControl.active){var i=webix.html.locate(t,"webix_l_id");if(i&&"task"==e.getItem(i).type){var r=e.getItemNode(i),n=at(r,t.clientX);r.style.cursor="move"==n?"pointer":"ew-resize"}}}(e,t.Bars)})))},e.prototype.destroy=function(){if(this._mousemove_handler=webix.eventRemove(this._mousemove_handler),this._scroll_handler=webix.eventRemove(this._scroll_handler),this.Markers&&this.Markers.length)for(var t=0;t<this.Markers.length;t++){var e=this.Markers[t];e.$interval&&(e.$interval=clearInterval(e.$interval))}},e.prototype.GetLinks=function(t){return this.Links.$view.querySelector(".webix_gantt_"+(t?"temp_line":"lines"))},e.prototype.HandleScroll=function(){var t=this;this._scroll_handler=webix.event(this.Bars.$view,"scroll",(function(e){var i=e.target,r=Math.round(i.scrollTop),n=Math.round(i.scrollLeft),o=t.GetLinks(),s=t.GetLinks(!0),a={viewBox:n+" "+r+" "+i.scrollWidth+" "+i.scrollHeight,width:i.scrollWidth,height:i.scrollHeight};for(var u in a)o.setAttribute(u,a[u]),s.setAttribute(u,a[u]);t.holidaysContainer.style.height=i.scrollHeight+"px",t.containerForMarkers&&(t.containerForMarkers.style.height=i.scrollHeight+"px"),t.getRoot().$view.style.backgroundPosition="-"+n+"px -"+r+"px",t.State.$batch({top:r,left:n})})),this.on(this.State.$changes,"top",(function(e){t.Bars.scrollTo(t.State.left,e)}))},e.prototype.HandleSelection=function(t){var e=this;this.selLine=webix.html.create("DIV",{class:"webix_gantt_bar_selection",style:"height:"+t.cellHeight+"px;width:"+t.width+"px"}),this.Bars.$view.insertBefore(this.selLine,this.Bars.$view.firstChild),this.on(this.State.$changes,"selected",(function(){return e.SetSelection()}))},e.prototype.SetSelection=function(){var t=this.State.selected,e=t?this.Bars.getIndexById(t)*this.Local.getScales().cellHeight:-100;this.selLine.style.top=e+"px"},e.prototype.InitMarkers=function(){var t=this,e=this.Markers=this.app.config.markers;e&&e.length&&(this.containerForMarkers=webix.html.create("DIV",{class:"webix_gantt_markers",style:"height:"+this.Bars.$view.scrollHeight+"px"}),this.Bars.$view.insertBefore(this.containerForMarkers,this.Bars.$view.firstChild),this.RenderMarkers(e),this.on(this.app,"onScalesUpdate",(function(){return t.RenderMarkers(t.Markers)})))},e.prototype.RenderMarkers=function(t){for(var e=this,i=[],r=0;r<t.length;r++){var n=t[r];n.now&&(n.start_date=new Date,n.$interval||(n.$interval=setInterval((function(t){e.containerForMarkers.querySelector('[gantt_now="'+t.$interval+'"]').style.left=e.GetMarkerPosition(new Date)+"px"}),3e5,n))),i.push(this.MarkerTemplate(t[r]))}this.containerForMarkers.innerHTML=i.join("")},e.prototype.MarkerTemplate=function(t){var e=t.text?'<span class="webix_gantt_marker_text">'+t.text+"</span>":"";return'<div\n\t\t\tgantt_now="'+t.$interval+'"\n\t\t\tclass="webix_gantt_marker '+(t.css||"")+'"\n\t\t\tstyle="left:'+this.GetMarkerPosition(t.start_date)+'px">'+e+"</div>"},e.prototype.GetMarkerPosition=function(t){var e=this.Local.getScales(),i=e.start,r=e.end,n=e.cellWidth,o=e.diff,s=et(e.minUnit,i);return t<i||t>r?-100:Math.round(o(t,s,!0)*n)},e.prototype.LinksTemplate=function(t,e){var i=this.Bars.$view;return'<svg\n\t\t\tclass="'+e+'"\n\t\t\tviewBox="'+this.State.left+" "+this.State.top+" "+i.scrollWidth+" "+i.scrollHeight+'"\n\t\t\twidth="'+i.scrollWidth+'"\n\t\t\theight="'+i.scrollHeight+'"\n\t\t>'+t+"</svg>"},e.prototype.RefreshLinks=function(t){var e=[];t.order.each((function(i){var r=t.getItem(i);r.$p&&e.push('<polyline data-id="'+i+'" points="'+r.$p+'" />')}));var i=this.LinksTemplate(e.join(""),"webix_gantt_lines")+this.LinksTemplate('<polyline points="" />',"webix_gantt_temp_line");this.Links.setHTML(i)},e.prototype.RefreshTaskLinks=function(t){var e=this;this.LinksData.find((function(e){return e.source==t||e.target==t})).forEach((function(t){var i=e.Links.$view.querySelector('[data-id="'+t.id+'"]');if(i){var r=e.TasksData.getItem(t.source),n=e.TasksData.getItem(t.target);ot(t,r,n,e.Local._taskHeight),i.setAttribute("points",t.$p)}}))},e.prototype.Resize=function(t){var e=this.Bars.$view.querySelector(".webix_scroll_cont");e.style.width=t+"px",e.style.minHeight="1px",this.selLine&&(this.selLine.style.width=t+"px")},e.prototype.Action=function(t){var e=this.app.getService("operations"),i=null;if("update-task-time"===t.action)t.time?i=e.updateTaskTime(t.id,t.mode,t.time):(this.Local.refreshTasks(t.id),this.RefreshTaskLinks(t.id));else if("update-task-progress"===t.action)if(webix.isUndefined(t.progress)){var r=this.TasksData.getItem(t.id);this.Bars.render(t.id,r,"paint")}else i=e.updateTask(t.id,{progress:t.progress});else if("drag-task"===t.action){(r=this.TasksData.getItem(t.id)).$x=parseInt(t.left),r.$w=parseInt(t.width),this.RefreshTaskLinks(t.id)}else if("add-link"===t.action){var n=t.source,o=t.target,s=t.type;i=e.addLink({source:n,target:o,type:s})}else if("temp-link"===t.action){var a=t.start,u=t.end,l=this.GetLinks(!0).firstChild;if(a){var c=function(t,e,i){if(e&&i){var r=i.x-e.x,n=i.y-e.y,o=(r>0?e.x:i.x)-t.left,s=(n>0?e.y:i.y)-t.top,a=(r>0?0:-r)+","+(n>0?0:-n)+","+(r>0?r:0)+","+(n>0?n:0);return{width:Math.abs(r),height:Math.abs(n),left:o,top:s,p:a}}return null}(this.Links.$view.getBoundingClientRect(),a,u),h=c.left,p=c.top,d=c.p,f=[h,p],g=d.split(",").map((function(t,e){return 1*t+f[e%2]})).join(",");l.setAttribute("points",g)}else l.setAttribute("points","")}return i?(this.app.callEvent("backend:operation",[i]),i):webix.promise.resolve()},e.prototype.HandleHolidays=function(t){var e=this;this.holidaysContainer=webix.html.create("DIV",{class:"webix_gantt_bar_holidays",style:"height:"+this.Bars.$view.scrollHeight+"px;"}),this.Bars.$view.insertBefore(this.holidaysContainer,this.Bars.$view.firstChild),this.RenderHolidays(t),this.on(this.app,"onScalesUpdate",(function(t){return e.RenderHolidays(t)}))},e.prototype.RenderHolidays=function(t){if("day"===t.minUnit||"hour"===t.minUnit){var e="",i=webix.Date.copy(t.start),r=webix.Date.dayStart(t.end);t.end-r||(r=webix.Date.add(r,-1,"day",!0));for(var n=t.start.getHours();i<=r;)this.Local.isHoliday(i)&&(e+=this.HolidayTemplate(t,i,n)),i=webix.Date.add(webix.Date.dayStart(i),1,"day",!0),n=webix.Date.equal(i,r)?24-Math.ceil(webix.Date.timePart(t.end)/60/60):0;this.holidaysContainer.innerHTML=e}},e.prototype.HolidayTemplate=function(t,e,i){var r=et(t.minUnit,t.start);return'<div class="webix_gantt_holiday" style="left:'+Math.round(t.diff(e,r)*t.cellWidth)+"px; width:"+("hour"===t.minUnit?24-i:1)*t.cellWidth+'px;"></div>'},e.prototype.GetTooltip=function(t,e){var i=webix.i18n.longDateFormatStr,r=(t.text||e("(no title)"))+"<br>\n\t\t\t<br>"+e("Start date")+": "+i(t.start_date);return"milestone"!=t.type&&(r+="<br>"+e("End date")+": "+i(t.end_date)+"\n\t\t\t<br>"+e("Lasts")+" "+t.duration+" "+(t.duration>1?e("days"):e("day"))),r},e}(c),dt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){return{view:"template",height:20,css:"webix_gantt_scale"}},e.prototype.init=function(){var t=this,e=this.getRoot(),i=this.getParam("state",!0);this.on(i.$changes,"left",(function(t){return e.scrollTo(t,null)})),this.Local=this.app.getService("local");var r=this.Local.getScales();this.RenderScales(r),this.on(this.app,"onScalesUpdate",(function(e){return t.RenderScales(e)}))},e.prototype.RenderScales=function(t){var e=this,i=this.getRoot(),r=t.rows.map((function(i){var r=("hour"===i.type||"day"===i.type)&&1===i.step;return'<div class="webix_gantt_scale_row" style=\'height:'+i.height+"px;width:"+t.width+"px'>"+i.cells.map((function(t){return e.CellTemplate(t,r)})).join("")+"</div>"})).join("");i.config.height=t.height,i.setHTML(r),i.resize()},e.prototype.CellTemplate=function(t,e){return'<div class="webix_gantt_scale_cell '+t.css+(e&&this.Local.isHoliday(t.date)?"webix_gantt_holiday_scale":"")+'" style="width:'+t.width+'px;">'+t.format(t.date)+"</div>"},e}(c),ft=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){return{rows:[dt,pt]}},e.prototype.init=function(){var t=this;this.on(this.app,"bars:toggle",(function(e){e?t.getRoot().show():t.getRoot().hide()}))},e}(c),gt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._;return{rows:[{template:e("Related tasks"),type:"section"},{view:"treetable",css:"webix_gantt_tree webix_gantt_tree_link",header:!1,borderless:!0,localId:"links",autoheight:!0,editable:!0,scroll:!1,scheme:{$group:{by:"ttype"}},columns:[{id:"task",css:"webix_gantt_title",header:e("Task"),fillspace:!0,template:function(t){return t.$group?'<span class="webix_strong">'+e("source"==t.ttype?e("Successors"):e("Predecessors"))+"</span>":t.text||e("(no title)")}},{id:"type",css:"webix_gantt_type",header:e("Link"),width:140,template:function(t,e,i,r){return t.$group?"":r.collection.getItem(i).value+'<span class="webix_icon wxi-menu-down"></span>'},editor:"richselect",options:[{id:"0",value:e("End to start")},{id:"1",value:e("Start to start")},{id:"2",value:e("End to end")},{id:"3",value:e("Start to end")}]},{width:30,css:"webix_gantt_action",template:function(t){return t.$group?"":"<span class='webix_icon wxi-trash'></span>"}}],on:{onBeforeEditStart:function(t){return!this.getItem(t).$group},onBeforeEditStop:function(e,i){if(e.value!=e.old)return t.UpdateLink(i.row,{type:1*e.value}),!1},onAfterLoad:function(){this.openAll()}},onClick:{"wxi-trash":function(i,r){webix.confirm({title:e("Delete link"),text:e("The link will be deleted permanently, are you sure?")}).then((function(){return t.DeleteLink(r)}))}}}]}},e.prototype.init=function(){var t=this;this.State=this.getParam("state",!0),this.Ops=this.app.getService("operations"),this.Links=this.$$("links"),this.on(this.State.$changes,"selected",(function(e){e&&t.FillData(e)}))},e.prototype.FillData=function(t){var e=this.app.getService("local"),i=e.getLinks(t,"target").concat(e.getLinks(t,"source"));this.Links.clearAll(),i.length?(this.Links.parse(i),this.Links.show()):this.getRoot().hide()},e.prototype.UpdateLink=function(t,e){var i=this,r=this.Ops.updateLink(t,e);this.app.callEvent("backend:operation",[r]),r.then((function(){i.Links.blockEvent(),i.Links.editCancel(),i.Links.unblockEvent(),i.Links.updateItem(t,e)}))},e.prototype.DeleteLink=function(t){var e=this,i=this.Ops.removeLink(t);this.app.callEvent("backend:operation",[i]),i.then((function(){e.FillData(e.State.selected)}))},e}(c),vt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;this.Compact=this.getParam("compact",!0);var e=this.app.getService("locale")._,i=webix.skin.$active;return{view:"proxy",body:{margin:0,padding:{bottom:14},rows:[{view:"toolbar",css:"webix_subbar",borderless:!0,padding:{left:i.layoutPadding.form-(i.inputHeight-20)/2,right:i.layoutPadding.form},elements:[{view:"icon",icon:"wxi-close",click:function(){return t.Close()}},{},{view:"button",width:130,css:"webix_primary",value:e("Done"),click:function(){return t.Done()}}]},{view:"form",localId:"form",borderless:!0,autoheight:!1,scroll:!0,elementsConfig:{labelPosition:"top"},elements:[{view:"text",name:"text",label:e("Title")},{view:"richselect",name:"type",label:e("Type"),options:[{id:"task",value:e("Task")},{id:"project",value:e("Project")},{id:"milestone",value:e("Milestone")}],on:{onChange:function(e){return t.ToggleControls(e)}}},{view:"datepicker",name:"start_date",label:e("Start date")},{view:"datepicker",name:"end_date",label:e("End date")},{view:"counter",name:"duration",css:"webix_gantt_form_counter",min:1,max:1e3,label:e("Duration")},{view:"slider",name:"progress",title:webix.template("#value#%"),label:e("Progress")},gt,{view:"textarea",name:"details",label:e("Notes"),height:150}],on:{onChange:function(){t.UpdateTaskTime(),t.Compact||t.UpdateTask()}}}]}}},e.prototype.init=function(){var t=this;this.State=this.getParam("state",!0),this.Ops=this.app.getService("operations"),this.Tasks=this.app.getService("local").tasks(),this.Form=this.$$("form"),this.on(this.State.$changes,"selected",(function(e){e&&t.FillData(e)})),this.on(this.Tasks.data,"onStoreUpdated",(function(e,i,r){"update"==r&&e==t.State.selected&&t.FillData(t.State.selected)}))},e.prototype.FillData=function(t){var e=this.Tasks.getItem(t);this.Form.setValues(e),this.Form.focus()},e.prototype.UpdateTaskTime=function(){var t=this.Form.$eventSource.config.name,e=this.Form.getValues();"duration"==t||"start_date"==t&&"project"==e.type?e.end_date=null:"end_date"!=t&&"start_date"!=t||(e.duration=null),nt(e),this.Form.blockEvent(),this.Form.setValues(e,!0),this.Form.unblockEvent()},e.prototype.UpdateTask=function(){var t=this,e=this.State.selected,i=this.Form.getValues();return this._inProgress="$temp"===e?this.Ops.saveTempTask(i):this.Ops.updateTask(e,i),this.app.callEvent("backend:operation",[this._inProgress]),this._inProgress.finally((function(){return t._inProgress=null})),this._inProgress},e.prototype.ToggleControls=function(t){if(this.Form.elements.end_date.show(),this.Form.elements.duration.show(),this.Form.elements.progress.show(),this.Form.elements.end_date.enable(),this.Form.elements.duration.enable(),this.Form.elements.progress.enable(),"project"==t||"milestone"==t){var e="project"==t?"disable":"hide";this.Form.elements.end_date[e](),this.Form.elements.duration[e](),this.Form.elements.progress[e]()}},e.prototype.Close=function(){var t=this;if(this.Compact&&this.Form.isDirty()){var e=this.app.getService("locale")._;webix.confirm({text:e("Save changes?")}).then((function(){return t.Done(!0)}),(function(){return t.Back(!0)}))}else this.Back(!0)},e.prototype.Back=function(t){if(t)this.app.callEvent("edit:stop");else{var e=this.Compact?"task.popup/":"../";this.show(e+"task.info",{target:"edit"})}},e.prototype.Done=function(t){var e=this;"$temp"===this.State.selected||this.Compact&&this.Form.isDirty()?this._inProgress?this._inProgress.then((function(){e.Back(t)})):this.UpdateTask().then((function(){return e.Back(t)})):this.Back(t)},e}(c),mt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i=this.getParam("state",!0),r={view:"button",width:130,label:e("Edit"),css:"webix_primary",click:function(){return t.EditTask()}},n=webix.skin.$active,o={view:"toolbar",css:"webix_subbar",borderless:!0,padding:{left:n.layoutPadding.form-(n.inputHeight-20)/2,right:n.layoutPadding.form},elements:[{view:"icon",icon:"wxi-close",click:function(){return t.Close()}},{},i.readonly?{}:r]},s={localId:"text",view:"template",css:"webix_gantt_task_info",template:function(e){return t.InfoTemplate(e)},borderless:!0},a={view:"button",label:e("Delete task"),css:"webix_danger webix_gantt_danger",align:"center",inputWidth:330,click:function(){webix.confirm({title:e("Delete task"),text:e("The task will be deleted permanently, are you sure?")}).then((function(){return t.DeleteTask()}))}};return{view:"proxy",body:{margin:0,rows:[o,{type:"form",borderless:!0,rows:[s,i.readonly?{}:a]}]}}},e.prototype.init=function(){var t=this;this.State=this.getParam("state",!0),this.Local=this.app.getService("local"),this.Tasks=this.Local.tasks(),this.Text=this.$$("text"),this.on(this.State.$changes,"selected",(function(e){e&&t.FillTemplate(e)})),this.on(this.Tasks.data,"onStoreUpdated",(function(e,i,r){"update"==r&&e==t.State.selected&&t.FillTemplate(t.State.selected)}))},e.prototype.FillTemplate=function(t){var e=webix.copy(this.Tasks.getItem(t));e.sources=this.Local.getLinks(t,"source"),e.targets=this.Local.getLinks(t,"target"),this.Text.setValues(e)},e.prototype.EditTask=function(){var t=this.getParam("compact",!0)?"task.popup/":"../";this.show(t+"task.form",{target:"edit"})},e.prototype.DeleteTask=function(){var t=this.app.getService("operations").removeTask(this.State.selected);this.app.callEvent("backend:operation",[t]),this.Close()},e.prototype.Close=function(){this.app.callEvent("edit:stop")},e.prototype.InfoTemplate=function(t){if(!t.start_date)return"";var e=this.app.getService("locale")._,i=e("(no title)"),r='\n\t\t\t<span class="webix_gantt_task_title">'+(t.text||i)+'</span><br><br>\n\t\t\t<span class="webix_strong">'+e("Start date")+"</span>: "+this.DateFormat(t.start_date)+"<br>";return"milestone"!==t.type&&(r+='<span class="webix_strong">'+e("End date")+"</span>: "+this.DateFormat(t.end_date)+'<br>\n\t\t\t<span class="webix_strong">'+e("Duration")+"</span>: "+t.duration+'<br>\n\t\t\t<span class="webix_strong">'+e("Progress")+"</span>: "+t.progress+"%\n\t\t<br>"),t.targets.length&&(r+=this.InfoTemplateChunk(t.targets,e("Predecessors"),i)),t.sources.length&&(r+=this.InfoTemplateChunk(t.sources,e("Successors"),i)),t.details&&(r+='<br><br><div class="webix_gantt_task_title">'+e("Notes")+'</div>\n\t\t\t\t<br><div class="webix_gantt_task_text">'+t.details.replace(/(?:\r\n|\r|\n)/g,"<br>")+"</div>"),r},e.prototype.InfoTemplateChunk=function(t,e,i){return'<br><span class="webix_strong">'+e+"</span>:<br>"+t.map((function(t){return"<li>"+(t.text||i)+"</li>"})).join("")},e.prototype.DateFormat=function(t){return webix.i18n.longDateFormatStr(t)},e}(c),wt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){return{view:"window",fullscreen:!0,head:!1,body:{$subview:!0}}},e}(c),yt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t,e=this,i=this.getParam("state"),r=this.app.getService("local").getScales(),n=this.app.getService("locale")._,o=this.getParam("compact",!0),s={id:"action",css:"webix_gantt_action",header:{text:'<span webix_tooltip="'+n("Add project")+'" class="webix_icon wxi-plus-circle"></span>',css:"webix_gantt_action"},template:function(t){return"$temp"===t.id?"":'<span webix_tooltip="'+n("Add task")+'" class="webix_icon wxi-plus"></span>'},width:44,minWidth:44},a=[{id:"text",css:"webix_gantt_title",header:n("Title"),template:function(t,e){return e.treetable(t,e)+(t.text||n("(no title)"))},fillspace:!0,hidden:o,batch:"full",sort:(t="text",function(e,i){return e[t].localeCompare(i[t],void 0,{ignorePunctuation:!0,numeric:!0})}),minWidth:150},{id:"start_date",header:n("Start date"),format:webix.i18n.dateFormatStr,hidden:o,batch:"full",sort:"date",minWidth:100}];o?(s.header.text="<span class='webix_icon gti-menu'>",i.readonly&&(s.template=""),a.unshift(s)):i.readonly||a.push(s);var u={view:"treetable",css:"webix_gantt_tree webix_header_border",prerender:!0,width:o?44:400,rowHeight:r.cellHeight,headerRowHeight:r.height,scroll:"xy",scrollAlignY:!1,select:"row",sort:"multi",resizeColumn:{headerOnly:!0,size:10},drag:"order",columns:a,tooltip:function(){return""},onClick:{"wxi-plus":function(t,i){return e.AddTempTask(i.row)},"wxi-plus-circle":function(){return e.AddTempTask("0")},"gti-menu":function(){return e.ToggleColumns()}},on:{onAfterOpen:function(t){e.RefreshTasks(),e.Ops.updateTask(t,{opened:1})},onAfterClose:function(t){e.RefreshTasks(),e.Ops.updateTask(t,{opened:0})},onItemClick:function(t){i.$batch({parent:null,selected:t})},onAfterSort:function(t,i,r){return e.SortTasks(t,i,r)},onColumnResize:function(t,i,r,n){return e.NormalizeColumns(t,n)},onBeforeDrop:function(t){var i=null;return i="$temp"===t.start?e.Ops.saveTempTask(e.Tasks.getItem(t.start),t.parent||0,t.index):e.Ops.moveTask(t.start,t.parent,t.index),e.app.callEvent("backend:operation",[i]),!1}}},l=function(){i.top=this.getScrollState().y};return webix.env.touch?u.on.onSyncScroll=u.on.onAfterScroll=l:u.on.onScrollY=l,u},e.prototype.init=function(t){var e=this;this.Tree=t,this.Tasks=this.app.getService("local").tasks(),this.State=this.getParam("state",!0),this.Ops=this.app.getService("operations"),this.Tree.sync(this.Tasks),this.Tasks.waitData.then((function(){e.RefreshTasks(),e.State.sort&&(e.Tree.data.blockEvent(),e.Tree.setState({sort:e.State.sort}),e.Tree.data.unblockEvent())})),this.on(this.State.$changes,"top",(function(t){return e.Tree.scrollTo(null,t)})),this.on(this.State.$changes,"selected",(function(t,i){"$temp"===i&&e.ClearTempTask(),t?e.Tree.select(t):e.Tree.unselect()})),this.on(this.Tasks.data,"onStoreUpdated",(function(t,i,r){"add"==r&&"$temp"!==t&&e.ClearTempTask()})),this.on(this.app,"task:add",(function(){return e.AddTempTask("0")}))},e.prototype.AddTempTask=function(t){if(this.State.parent!==t){var e=this.Tasks.getItem(t),i=e?e.start_date:this.app.getService("local").getScales().start;this.ClearTempTask(),this.State.selected=null;var r=this.Tasks.add(this.GetTempTask(i),e?0:-1,e?t:0);e&&this.Tree.open(t),this.State.$batch({parent:t,selected:r}),this.Tree.exists(t)&&this.Tree.showItem(r)}return!1},e.prototype.GetTempTask=function(t){return{id:"$temp",start_date:new Date(t),end_date:webix.Date.add(t,1,"day",!0),progress:0,text:""}},e.prototype.ClearTempTask=function(){this.Tasks.exists("$temp")&&this.Tasks.remove("$temp")},e.prototype.RefreshTasks=function(){this.Tasks.data.callEvent("onStoreUpdated",[])},e.prototype.SortTasks=function(t,e,i){var r=webix.isArray(t)?t:{by:t,dir:e,as:i},n=this.Tree.getState().sort;this.Tasks.sort(r),this.State.sort=n,"$temp"===this.State.selected&&this.app.callEvent("edit:stop")},e.prototype.ToggleColumns=function(){var t=this.Tree.isColumnVisible("text");this.Tree.showColumnBatch("full",!t),this.Tree.config.width=t?44:0,this.Tree.resize(),this.app.callEvent("bars:toggle",[t])},e.prototype.NormalizeColumns=function(t,e){if(e){var i=this.Tree,r=i.config.columns,n=i.getColumnIndex(t),o=r.length-1;"action"===r[o].id&&(o-=1),0===n?(r[o].fillspace=!0,r[o].width=0):n===o&&(r[0].fillspace=!0,r[0].width=0),i.refreshColumns()}},e}(c);webix.protoUI({name:"r-layout",sizeTrigger:function(t,e,i){this._compactValue=i,this._compactWidth=t,this._compactHandler=e,this._checkTrigger(this.$view.width,i)},_checkTrigger:function(t,e){return!this._compactWidth||!(t<=this._compactWidth&&!e||t>this._compactWidth&&e)||(this._compactWidth=null,this._compactHandler(!e),!1)},$setSize:function(t,e){if(this._checkTrigger(t,this._compactValue))return webix.ui.layout.prototype.$setSize.call(this,t,e)}},webix.ui.layout);var _t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;this.fCompact=this.getParam("forceCompact"),void 0!==this.fCompact&&this.setParam("compact",this.fCompact),this.Compact=this.getParam("compact"),this.State=this.getParam("state",!0);var e=this.Compact?{$subview:!0,name:"edit",popup:!0}:{view:"proxy",css:"webix_shadow_medium",borderless:!0,width:400,hidden:!0,localId:"edit",body:{$subview:!0,name:"edit"}},i=[yt,{view:this.Compact?"spacer":"resizer",css:"webix_gantt_resizer",width:1},ft,e];return{view:"abslayout",css:"webix_gantt",cells:[{view:"undefined"==typeof fCompact?"r-layout":"layout",localId:"main",borderless:!0,relative:!0,type:"clean",cols:i},{css:"webix_gantt_absbutton",view:"icon",icon:"wxi-plus",localId:"add",hidden:!this.Compact||this.State.readonly,width:50,height:50,right:20,bottom:20,click:function(){t.app.callEvent("task:add",[])}}]}},e.prototype.init=function(t){var e=this;this.fCompact||this.$$("main").sizeTrigger(this.app.config.compactWidth,(function(t){return e.SetCompactMode(t)}),!!this.Compact),this.on(this.State.$changes,"selected",(function(t,i){t&&"$temp"!=t&&!e.State.parent?e.ShowTask("info"):"$temp"===i&&(e.State.parent=null)})),this.on(this.State.$changes,"parent",(function(t){t&&e.ShowTask("form")})),this.on(this.app,"edit:stop",(function(){e.State.selected=null,e.HideTask()})),webix.extend(t,webix.ProgressBar),this.on(this.app,"backend:operation",(function(e){e&&(t.showProgress({type:"top",delay:2e3}),e.finally((function(){t.hideProgress()})))}))},e.prototype.ShowTask=function(t){t="task."+t,this.Compact?this.show("task.popup/"+t,{target:"edit"}):(this.$$("edit").show(),this.show(t,{target:"edit"}))},e.prototype.HideTask=function(){this.show("_blank",{target:"edit"}),this.Compact||this.$$("edit").hide()},e.prototype.SetCompactMode=function(t){var e=this;webix.delay((function(){e.setParam("compact",t),e.refresh()}))},e}(c),bt={JetView:c};bt["chart/bars"]=pt,bt.chart=ft,bt["chart/scale"]=dt,bt["task/form"]=vt,bt["task/info"]=mt,bt["task/popup"]=wt,bt["task/table"]=gt,bt.top=_t,bt.tree=yt;var xt=function(){function t(t,e){this.app=t;var i=webix.skin.$active,r=e.scaleStart||webix.Date.dayStart(new Date),n=e.scaleEnd||webix.Date.add(r,1,"month",!0);this.setScales(r,n,e.preciseTimeUnit,e.scaleCellWidth||200,i.barHeight-2*i.borderWidth,e.scales||[{unit:"day",step:1,format:"%d"}]),this.dateToLocalStr=webix.Date.dateToStr(webix.i18n.parseFormat)}return t.prototype.setScales=function(t,e,i,r,n,o){r?(this._scaleBase={width:r,height:n,scales:o},e=webix.Date.add(e,1,"day")):(r=this._scaleBase.width,n=this._scaleBase.height,o=this._scaleBase.scales),this._scales=it(t,e,i,r,n,o),this._taskHeight=this._scales.cellHeight-12,this.app.callEvent("onScalesUpdate",[this._scales])},t.prototype.getScales=function(){return this._scales},t.prototype.adjustScale=function(t,e){var i=this.getScales();t=tt(i.minUnit)(t,-1),e=tt(i.minUnit)(e,1),(i&&i.start>t||i.end<e)&&(this.setScales(i.start>t?t:i.start,i.end<e?e:i.end,i.precise),this.refreshTasks())},t.prototype.tasks=function(){var t=this;if(this._tasks)return this._tasks;var e=this._tasks=new webix.TreeCollection({on:{"data->onStoreLoad":function(){if(!t.app.config.scaleStart){var i=1/0,r=-1/0;if(e.data.each((function(t){t.start_date<i&&(i=t.start_date),t.end_date>r&&(r=t.end_date)})),"object"==typeof i){var n=t.getScales();t.setScales(tt(n.minUnit)(i,-1),tt(n.minUnit)(r,1),n.precise)}}},"data->onStoreUpdated":function(e,i,r){e="update"==r?e:null,t.refreshTasks(e),t.refreshLinks()}},scheme:{$init:function(t){t.start_date=webix.i18n.parseFormatDate(t.start_date),t.end_date=webix.i18n.parseFormatDate(t.end_date),nt(t),t.type=t.type||"task",t.open=t.opened?1*t.opened:0},$sort:{by:"position",dir:"asc",as:"int"},$serialize:function(e){return t.taskOut(e)},$export:function(e){return t.taskOut(e)}}});return e.parse(this.app.getService("backend").tasks().then((function(t){return function t(e,i){var r=e.filter((function(t){return t.parent==i}));return r.forEach((function(i){var r=t(e,i.id);r&&(i.data=r)})),r}(t,0)}))),e},t.prototype.refreshTasks=function(t,e){var i=this;t?function(t,e,i,r){var n=i.start,o=i.end,s=i.cellWidth,a=i.cellHeight,u=i.diff,l=i.minUnit,c=i.precise,h=t.start_date<n?n:t.start_date,p=t.end_date>o?o:t.end_date,d="milestone"==t.type,f=et(l,n);t.$h=r,t.$x=Math.round(u(h,f,c)*s)-(d?t.$h/2:0),t.$w=d?t.$h:Math.round(u(p,h,c,!0)*s),t.$y=a*e+(a-r)/2}(this._tasks.getItem(t),e=webix.isUndefined(e)?this._tasks.getIndexById(t):e,this._scales,this._taskHeight):this._tasks.data.order.forEach((function(t,e){i.refreshTasks(t,e)}))},t.prototype.links=function(){var t=this;if(this._links)return this._links;var e=this._links=new webix.DataCollection({on:{"data->onStoreUpdated":function(e){return t.refreshLinks(e)}},scheme:{$init:function(t){t.type=1*t.type}}});return e.parse(this.app.getService("backend").links()),e},t.prototype.refreshLinks=function(){var t=this;this._links&&this._links.data.each((function(e){var i=t._tasks.getItem(e.source),r=t._tasks.getItem(e.target);i&&r&&t._isTaskVisible(i)&&t._isTaskVisible(r)?ot(e,i,r,t._taskHeight):e.$p=""}))},t.prototype.getLinks=function(t,e){for(var i=this._links.find((function(i){return i[e]==t})),r=[],n=0;n<i.length;n++){var o=i[n],s=this._tasks.getItem(o["source"==e?"target":"source"]);s&&r.push({id:o.id,type:o.type.toString(),text:s.text,ttype:e})}return r},t.prototype.isHoliday=function(t){var e=t.getDay();return 0===e||6===e},t.prototype.taskOut=function(t){t=webix.copy(t);var e=this.dateToLocalStr;for(var i in t.start_date&&(t.start_date=e(t.start_date)),t.end_date&&(t.end_date=e(t.end_date)),t)0===i.indexOf("$")&&delete t[i];return t},t.prototype._isTaskVisible=function(t){for(;t.$parent;)if(!(t=this._tasks.getItem(t.$parent)).open)return!1;return!0},t}();var kt=function(){function t(t,e){this.app=t,this._url=e}return t.prototype.url=function(t){return this._url+t},t.prototype.tasks=function(){return webix.ajax(this.url("tasks")).then((function(t){return t.json()}))},t.prototype.links=function(){return webix.ajax(this.url("links")).then((function(t){return t.json()}))},t.prototype.addTask=function(t,e,i){return webix.ajax().post(this.url("tasks"),r(r({},t),{position:e,parent:i})).then((function(t){return t.json()}))},t.prototype.removeTask=function(t){return webix.ajax().del(this.url("tasks/"+t)).then((function(t){return t.json()}))},t.prototype.updateTask=function(t,e){return webix.ajax().put(this.url("tasks/"+t),e).then((function(t){return t.json()}))},t.prototype.addLink=function(t){return webix.ajax().post(this.url("links"),t).then((function(t){return t.json()}))},t.prototype.updateLink=function(t,e){return webix.ajax().put(this.url("links/"+t),e).then((function(t){return t.json()}))},t.prototype.removeLink=function(t){return webix.ajax().del(this.url("links/"+t)).then((function(t){return t.json()}))},t}(),St=function(){function t(t){this._app=t,this._local=this._app.getService("local"),this._back=this._app.getService("backend")}return t.prototype.addTask=function(t,e,i){var n=this;return this._back.addTask(t,e,i).then((function(o){return n._local.adjustScale(t.start_date,t.end_date),n._local.tasks().add(r(r({},t),{id:o.id,parent:i,position:e}),e,i),i&&n.syncProject(i),n.updateKidPositions(i,{start:e}),o}))},t.prototype.updateTask=function(t,e,i){var n=this,o=this._local.tasks(),s=webix.copy(o.getItem(t)),a=r(r({},s),e);return nt(a),"$temp"===t?this.saveTempTask(a):i||"project"!=e.type||"project"==s.type?this._back.updateTask(t,a).then((function(){return i||n._local.adjustScale(a.start_date,a.end_date),o.updateItem(t,a),i||webix.Date.equal(s.start_date,e.end_date)&&webix.Date.equal(s.end_date,e.end_date)||(s.$count&&"project"==s.type?n.syncTasks(t,s.start_date,e.start_date).then((function(){n.syncProject(s.parent)})):n.syncProject(s.parent)),a})):this.syncProject(t,a)},t.prototype.syncTasks=function(t,e,i){var n=this,o=i-e;if(o){var s=[];return this._local.tasks().data.eachSubItem(t,(function(t){var e=r(r({},t),{start_date:new Date(t.start_date.valueOf()+o),end_date:null});nt(e),s.push(n.updateTask(t.id,e,!0))})),webix.promise.all(s)}return webix.promise.resolve()},t.prototype.syncProject=function(t,e){var i=this,r=this._local.tasks();if(!e)for(e=r.getItem(t);e&&"project"!=e.type;)t=r.getParentId(t),e=r.getItem(t);if(e&&e.$count){var n=1/0,o=0,s=0,a=0;e.duration=null,r.data.eachSubItem(t,(function(t){n=t.start_date<n?t.start_date:n,o=t.end_date>o?t.end_date:o,!t.duration||"project"==t.type&&t.$count||(s+=t.duration*t.progress,a+=1*t.duration)})),webix.Date.equal(e.start_date,n)||(e.start_date=n),webix.Date.equal(e.end_date,o)||(e.end_date=o),e.progress=s?Math.round(s/a):s}if(e)return this.updateTask(t,e,!0).then((function(){return i.syncProject(e.parent),e}))},t.prototype.updateTaskTime=function(t,e,i){var n=this._local.tasks().getItem(t),o={},s=this._local.getScales(),a=s.precise?G[s.minUnit][0]:s.minUnit;if("start"===e||"move"===e){var u=s.precise?n.start_date:et(a,n.start_date);o.start_date=tt(a)(u,i),"start"===e&&o.start_date>n.end_date&&(o.start_date=tt(a)(n.end_date,-1))}if("end"===e){u=s.precise?n.end_date:et(a,tt(a)(n.end_date,1));o.end_date=tt(a)(u,i),o.end_date<n.start_date&&(o.end_date=tt(a)(n.start_date,1))}if("move"===e?o.end_date=null:o.duration=0,"$temp"===t){var l=r(r({},n),o);return nt(l),this.saveTempTask(l)}return this.updateTask(t,o)},t.prototype.removeTask=function(t){var e=this,i=this._local.tasks(),r=this._local.links();return r.find((function(e){return e.source==t||e.target==t})).forEach((function(t){return r.remove(t.id)})),this._back.removeTask(t).then((function(r){var n=i.getItem(t).parent;return i.remove(t),e.syncProject(n),r}))},t.prototype.saveTempTask=function(t,e,i){var r=this._app.getState();(webix.isUndefined(e)||webix.isUndefined(i))&&(i=this._local.tasks().getBranchIndex(r.selected),e="0"===r.parent?0:r.parent);return this.addTask(t,i,e).then((function(t){return r.selected=t.id}))},t.prototype.addLink=function(t){var e=this;return this._back.addLink(t).then((function(i){return t.id=i.id,e._local.links().add(t),t}))},t.prototype.updateLink=function(t,e){var i=this;return this._back.updateLink(t,e).then((function(r){return i._local.links().updateItem(t,e),r}))},t.prototype.removeLink=function(t){var e=this;return this._back.removeLink(t).then((function(i){return e._local.links().remove(t),i}))},t.prototype.moveTask=function(t,e,i){var r=this;e=e||0;var n=this._local.tasks(),o=n.data.branch[e],s=n.getItem(t).parent,a=n.data.getBranchIndex(t);return e==s&&(i===a||-1===i&&t===o[o.length-1])?null:(n.move(t,i,null,{parent:e}),this.updateTask(t,{parent:e},!0).then((function(){r.updateKidPositions(e,{start:-1===i?o.length-1:i})})).catch((function(){n.move(t,a,null,{parent:s})})))},t.prototype.updateKidPositions=function(t,e){for(var i=this._local.tasks(),r=i.data.branch[t],n=webix.isUndefined(e.start)?0:Math.max(e.start,0),o=webix.isUndefined(e.end)?r.length:Math.min(e.end,r.length),s=n?i.getItem(r[n-1]).position+1:0,a=n;a<o;a++)this.updateTask(r[a],{position:s+a-n},!0)},t}(),Tt=function(t){function e(e){var i=this,n=B({top:0,left:0,selected:null,parent:null,readonly:e.readonly||!1,sort:null}),o={router:y,version:"8.1.1",debug:!0,start:"/top",compactWidth:650,markers:[{css:"webix_gantt_today_marker",now:!0}],params:{state:n,forceCompact:e.compact}};(i=t.call(this,r(r({},o),e))||this).config.debug&&(webix.Promise=window.Promise);var s=function(t){return i.config.override&&i.config.override.get(t)||t};return i.setService("local",new(s(xt))(i,e)),i.setService("backend",new(s(kt))(i,e.url)),i.setService("operations",new(s(St))(i)),i.use(U,i.config.locale||{lang:"en",webix:{en:"en-US"}}),i}return i(e,t),e.prototype.require=function(t,e){return"jet-views"===t?bt[e]:"jet-locales"===t?Ct[e]:null},e.prototype.getState=function(){return this.config.params.state},e}(w);webix.protoUI({name:"gantt",app:Tt,getState:function(){return this.$app.getState()},getService:function(t){return this.$app.getService(t)},$init:function(){var t=this.$app.getState();for(var e in t)V(t,this.config,e)},$exportView:function(){return this.$app.getService("local").tasks()}},webix.ui.jetapp);var $t={Local:xt,Backend:kt,Operations:St},Ct={en:{Edit:"Edit",Done:"Done","Delete task":"Delete task","Delete link":"Delete link","The task will be deleted permanently, are you sure?":"The task will be deleted permanently, are you sure?","The link will be deleted permanently, are you sure?":"The link will be deleted permanently, are you sure?",Predecessors:"Predecessors",Successors:"Successors",Title:"Title","Start date":"Start date","End date":"End date",Duration:"Duration",Progress:"Progress",Notes:"Notes",Type:"Type",Project:"Project",Milestone:"Milestone","Add task":"Add task","Add project":"Add project","(no title)":"(no title)","Save changes?":"Save changes?","Related tasks":"Related tasks",Task:"Task",Link:"Link","End to start":"End to start","Start to start":"Start to start","End to end":"End to end","Start to end":"Start to End",Lasts:"Lasts",day:"day",days:"days"}};t.App=Tt,t.locales=Ct,t.services=$t,t.views=bt,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=gantt.min.js.map
