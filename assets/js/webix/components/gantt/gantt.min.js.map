{"version":3,"file":"gantt.min.js","sources":["../node_modules/webix-jet/dist/es6/jet.js","../node_modules/jet-restate/index.js","../sources/libs/webix-time.js","../sources/libs/gantt/time.js","../sources/libs/gantt/scales.js","../sources/helpers/dragscroll.js","../sources/libs/gantt/tasks.js","../sources/libs/gantt/links.js","../sources/helpers/dnd.js","../sources/views/chart/bars.js","../sources/views/chart/scale.js","../sources/views/chart/index.js","../sources/views/task/table.js","../sources/views/task/form.js","../sources/views/task/info.js","../sources/views/task/popup.js","../sources/views/tree.js","../sources/helpers/responsive.js","../sources/views/top.js","../sources/export_views.js","../sources/models/Local.js","../sources/models/Backend.js","../sources/models/Operations.js","../sources/app.js","../sources/locales/en.js"],"sourcesContent":["class NavigationBlocked {\r\n}\n\nclass JetBase {\r\n    constructor(webix, config) {\r\n        this.webixJet = true;\r\n        this.webix = webix;\r\n        this._events = [];\r\n        this._subs = {};\r\n        this._data = {};\r\n        if (config && config.params)\r\n            webix.extend(this._data, config.params);\r\n    }\r\n    getRoot() {\r\n        return this._root;\r\n    }\r\n    destructor() {\r\n        this._detachEvents();\r\n        this._destroySubs();\r\n        this._events = this._container = this.app = this._parent = this._root = null;\r\n    }\r\n    setParam(id, value, url) {\r\n        if (this._data[id] !== value) {\r\n            this._data[id] = value;\r\n            this._segment.update(id, value, 0);\r\n            if (url) {\r\n                return this.show(null);\r\n            }\r\n        }\r\n    }\r\n    getParam(id, parent) {\r\n        const value = this._data[id];\r\n        if (typeof value !== \"undefined\" || !parent) {\r\n            return value;\r\n        }\r\n        const view = this.getParentView();\r\n        if (view) {\r\n            return view.getParam(id, parent);\r\n        }\r\n    }\r\n    getUrl() {\r\n        return this._segment.suburl();\r\n    }\r\n    getUrlString() {\r\n        return this._segment.toString();\r\n    }\r\n    getParentView() {\r\n        return this._parent;\r\n    }\r\n    $$(id) {\r\n        if (typeof id === \"string\") {\r\n            const root = this.getRoot();\r\n            return root.queryView((obj => (obj.config.id === id || obj.config.localId === id) &&\r\n                (obj.$scope === root.$scope)), \"self\");\r\n        }\r\n        else {\r\n            return id;\r\n        }\r\n    }\r\n    on(obj, name, code) {\r\n        const id = obj.attachEvent(name, code);\r\n        this._events.push({ obj, id });\r\n        return id;\r\n    }\r\n    contains(view) {\r\n        for (const key in this._subs) {\r\n            const kid = this._subs[key].view;\r\n            if (kid === view || kid.contains(view)) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    getSubView(name) {\r\n        const sub = this.getSubViewInfo(name);\r\n        if (sub) {\r\n            return sub.subview.view;\r\n        }\r\n    }\r\n    getSubViewInfo(name) {\r\n        const sub = this._subs[name || \"default\"];\r\n        if (sub) {\r\n            return { subview: sub, parent: this };\r\n        }\r\n        if (name === \"_top\") {\r\n            this._subs[name] = { url: \"\", id: null, popup: true };\r\n            return this.getSubViewInfo(name);\r\n        }\r\n        // when called from a child view, searches for nearest parent with subview\r\n        if (this._parent) {\r\n            return this._parent.getSubViewInfo(name);\r\n        }\r\n        return null;\r\n    }\r\n    _detachEvents() {\r\n        const events = this._events;\r\n        for (let i = events.length - 1; i >= 0; i--) {\r\n            events[i].obj.detachEvent(events[i].id);\r\n        }\r\n    }\r\n    _destroySubs() {\r\n        // destroy sub views\r\n        for (const key in this._subs) {\r\n            const subView = this._subs[key].view;\r\n            // it possible that subview was not loaded with any content yet\r\n            // so check on null\r\n            if (subView) {\r\n                subView.destructor();\r\n            }\r\n        }\r\n        // reset to prevent memory leaks\r\n        this._subs = {};\r\n    }\r\n    _init_url_data() {\r\n        const url = this._segment.current();\r\n        this._data = {};\r\n        this.webix.extend(this._data, url.params, true);\r\n    }\r\n    _getDefaultSub() {\r\n        if (this._subs.default) {\r\n            return this._subs.default;\r\n        }\r\n        for (const key in this._subs) {\r\n            const sub = this._subs[key];\r\n            if (!sub.branch && sub.view && key !== \"_top\") {\r\n                const child = sub.view._getDefaultSub();\r\n                if (child) {\r\n                    return child;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    _routed_view() {\r\n        const parent = this.getParentView();\r\n        if (!parent) {\r\n            return true;\r\n        }\r\n        const sub = parent._getDefaultSub();\r\n        if (!sub && sub !== this) {\r\n            return false;\r\n        }\r\n        return parent._routed_view();\r\n    }\r\n}\n\nfunction parse(url) {\r\n    // remove starting /\r\n    if (url[0] === \"/\") {\r\n        url = url.substr(1);\r\n    }\r\n    // split url by \"/\"\r\n    const parts = url.split(\"/\");\r\n    const chunks = [];\r\n    // for each page in url\r\n    for (let i = 0; i < parts.length; i++) {\r\n        const test = parts[i];\r\n        const result = {};\r\n        // detect params\r\n        // support old \t\t\tsome:a=b:c=d\r\n        // and new notation\t\tsome?a=b&c=d\r\n        let pos = test.indexOf(\":\");\r\n        if (pos === -1) {\r\n            pos = test.indexOf(\"?\");\r\n        }\r\n        if (pos !== -1) {\r\n            const params = test.substr(pos + 1).split(/[\\:\\?\\&]/g);\r\n            // create hash of named params\r\n            for (const param of params) {\r\n                const dchunk = param.split(\"=\");\r\n                result[dchunk[0]] = decodeURIComponent(dchunk[1]);\r\n            }\r\n        }\r\n        // store parsed values\r\n        chunks[i] = {\r\n            page: (pos > -1 ? test.substr(0, pos) : test),\r\n            params: result,\r\n            isNew: true\r\n        };\r\n    }\r\n    // return array of page objects\r\n    return chunks;\r\n}\r\nfunction url2str(stack) {\r\n    const url = [];\r\n    for (const chunk of stack) {\r\n        url.push(\"/\" + chunk.page);\r\n        const params = obj2str(chunk.params);\r\n        if (params) {\r\n            url.push(\"?\" + params);\r\n        }\r\n    }\r\n    return url.join(\"\");\r\n}\r\nfunction obj2str(obj) {\r\n    const str = [];\r\n    for (const key in obj) {\r\n        if (typeof obj[key] === \"object\")\r\n            continue;\r\n        if (str.length) {\r\n            str.push(\"&\");\r\n        }\r\n        str.push(key + \"=\" + encodeURIComponent(obj[key]));\r\n    }\r\n    return str.join(\"\");\r\n}\n\nclass Route {\r\n    constructor(route, index) {\r\n        this._next = 1;\r\n        if (typeof route === \"string\") {\r\n            this.route = {\r\n                url: parse(route),\r\n                path: route\r\n            };\r\n        }\r\n        else {\r\n            this.route = route;\r\n        }\r\n        this.index = index;\r\n    }\r\n    current() {\r\n        return this.route.url[this.index];\r\n    }\r\n    next() {\r\n        return this.route.url[this.index + this._next];\r\n    }\r\n    suburl() {\r\n        return this.route.url.slice(this.index);\r\n    }\r\n    shift(params) {\r\n        const route = new Route(this.route, this.index + this._next);\r\n        route.setParams(route.route.url, params, route.index);\r\n        return route;\r\n    }\r\n    setParams(url, params, index) {\r\n        if (params) {\r\n            const old = url[index].params;\r\n            for (var key in params)\r\n                old[key] = params[key];\r\n        }\r\n    }\r\n    refresh() {\r\n        const url = this.route.url;\r\n        for (let i = this.index + 1; i < url.length; i++) {\r\n            url[i].isNew = true;\r\n        }\r\n    }\r\n    toString() {\r\n        const str = url2str(this.suburl());\r\n        return str ? str.substr(1) : \"\";\r\n    }\r\n    _join(path, kids) {\r\n        let url = this.route.url;\r\n        if (path === null) { // change of parameters, route elements are not affected\r\n            return url;\r\n        }\r\n        const old = this.route.url;\r\n        let reset = true;\r\n        url = old.slice(0, this.index + (kids ? this._next : 0));\r\n        if (path) {\r\n            url = url.concat(parse(path));\r\n            for (let i = 0; i < url.length; i++) {\r\n                if (old[i]) {\r\n                    url[i].view = old[i].view;\r\n                }\r\n                if (reset && old[i] && url[i].page === old[i].page) {\r\n                    url[i].isNew = false;\r\n                }\r\n                else if (url[i].isNew) {\r\n                    // if some segment was marked as new, all subsegments must be updated as well\r\n                    reset = false;\r\n                }\r\n            }\r\n        }\r\n        return url;\r\n    }\r\n    append(path) {\r\n        const url = this._join(path, true);\r\n        this.route.path = url2str(url);\r\n        this.route.url = url;\r\n        return this.route.path;\r\n    }\r\n    show(path, view, kids) {\r\n        const url = this._join(path.url, kids);\r\n        this.setParams(url, path.params, this.index + (kids ? this._next : 0));\r\n        return new Promise((res, rej) => {\r\n            const redirect = url2str(url);\r\n            const obj = {\r\n                url,\r\n                redirect,\r\n                confirm: Promise.resolve()\r\n            };\r\n            const app = view ? view.app : null;\r\n            // when creating a new route, it possible that it will not have any content\r\n            // guard is not necessary in such case\r\n            if (app) {\r\n                const result = app.callEvent(\"app:guard\", [obj.redirect, view, obj]);\r\n                if (!result) {\r\n                    rej(new NavigationBlocked());\r\n                    return;\r\n                }\r\n            }\r\n            obj.confirm.catch(err => rej(err)).then(() => {\r\n                if (obj.redirect === null) {\r\n                    rej(new NavigationBlocked());\r\n                    return;\r\n                }\r\n                if (obj.redirect !== redirect) {\r\n                    app.show(obj.redirect);\r\n                    rej(new NavigationBlocked());\r\n                    return;\r\n                }\r\n                this.route.path = redirect;\r\n                this.route.url = url;\r\n                res();\r\n            });\r\n        });\r\n    }\r\n    size(n) {\r\n        this._next = n;\r\n    }\r\n    split() {\r\n        const route = {\r\n            url: this.route.url.slice(this.index + 1),\r\n            path: \"\"\r\n        };\r\n        if (route.url.length) {\r\n            route.path = url2str(route.url);\r\n        }\r\n        return new Route(route, 0);\r\n    }\r\n    update(name, value, index) {\r\n        const chunk = this.route.url[this.index + (index || 0)];\r\n        if (!chunk) {\r\n            this.route.url.push({ page: \"\", params: {} });\r\n            return this.update(name, value, index);\r\n        }\r\n        if (name === \"\") {\r\n            chunk.page = value;\r\n        }\r\n        else {\r\n            chunk.params[name] = value;\r\n        }\r\n        this.route.path = url2str(this.route.url);\r\n    }\r\n}\n\nclass JetView extends JetBase {\r\n    constructor(app, config) {\r\n        super(app.webix);\r\n        this.app = app;\r\n        //this.$config = config;\r\n        this._children = [];\r\n    }\r\n    ui(ui, config) {\r\n        config = config || {};\r\n        const container = config.container || ui.container;\r\n        const jetview = this.app.createView(ui);\r\n        this._children.push(jetview);\r\n        jetview.render(container, this._segment, this);\r\n        if (typeof ui !== \"object\" || (ui instanceof JetBase)) {\r\n            // raw webix UI\r\n            return jetview;\r\n        }\r\n        else {\r\n            return jetview.getRoot();\r\n        }\r\n    }\r\n    show(path, config) {\r\n        config = config || {};\r\n        // convert parameters object to url\r\n        if (typeof path === \"object\") {\r\n            for (const key in path) {\r\n                this.setParam(key, path[key]);\r\n            }\r\n            path = null;\r\n        }\r\n        else {\r\n            // deligate to app in case of root prefix\r\n            if (path.substr(0, 1) === \"/\") {\r\n                return this.app.show(path, config);\r\n            }\r\n            // local path, do nothing\r\n            if (path.indexOf(\"./\") === 0) {\r\n                path = path.substr(2);\r\n            }\r\n            // parent path, call parent view\r\n            if (path.indexOf(\"../\") === 0) {\r\n                const parent = this.getParentView();\r\n                if (parent) {\r\n                    return parent.show(path.substr(3), config);\r\n                }\r\n                else {\r\n                    return this.app.show(\"/\" + path.substr(3));\r\n                }\r\n            }\r\n            const sub = this.getSubViewInfo(config.target);\r\n            if (sub) {\r\n                if (sub.parent !== this) {\r\n                    return sub.parent.show(path, config);\r\n                }\r\n                else if (config.target && config.target !== \"default\") {\r\n                    return this._renderFrameLock(config.target, sub.subview, {\r\n                        url: path,\r\n                        params: config.params,\r\n                    });\r\n                }\r\n            }\r\n            else {\r\n                if (path) {\r\n                    return this.app.show(\"/\" + path, config);\r\n                }\r\n            }\r\n        }\r\n        return this._show(this._segment, { url: path, params: config.params }, this);\r\n    }\r\n    _show(segment, path, view) {\r\n        return segment.show(path, view, true).then(() => {\r\n            this._init_url_data();\r\n            return this._urlChange();\r\n        }).then(() => {\r\n            if (segment.route.linkRouter) {\r\n                this.app.getRouter().set(segment.route.path, { silent: true });\r\n                this.app.callEvent(\"app:route\", [segment.route.path]);\r\n            }\r\n        });\r\n    }\r\n    init(_$view, _$) {\r\n        // stub\r\n    }\r\n    ready(_$view, _$url) {\r\n        // stub\r\n    }\r\n    config() {\r\n        this.app.webix.message(\"View:Config is not implemented\");\r\n    }\r\n    urlChange(_$view, _$url) {\r\n        // stub\r\n    }\r\n    destroy() {\r\n        // stub\r\n    }\r\n    destructor() {\r\n        this.destroy();\r\n        this._destroyKids();\r\n        // destroy actual UI\r\n        if (this._root) {\r\n            this._root.destructor();\r\n            super.destructor();\r\n        }\r\n    }\r\n    use(plugin, config) {\r\n        plugin(this.app, this, config);\r\n    }\r\n    refresh() {\r\n        const url = this.getUrl();\r\n        this.destroy();\r\n        this._destroyKids();\r\n        this._destroySubs();\r\n        this._detachEvents();\r\n        if (this._container.tagName) {\r\n            this._root.destructor();\r\n        }\r\n        this._segment.refresh();\r\n        return this._render(this._segment);\r\n    }\r\n    render(root, url, parent) {\r\n        if (typeof url === \"string\") {\r\n            url = new Route(url, 0);\r\n        }\r\n        this._segment = url;\r\n        this._parent = parent;\r\n        this._init_url_data();\r\n        root = root || document.body;\r\n        const _container = (typeof root === \"string\") ? this.webix.toNode(root) : root;\r\n        if (this._container !== _container) {\r\n            this._container = _container;\r\n            return this._render(url);\r\n        }\r\n        else {\r\n            return this._urlChange().then(() => this.getRoot());\r\n        }\r\n    }\r\n    _render(url) {\r\n        const config = this.config();\r\n        if (config.then) {\r\n            return config.then(cfg => this._render_final(cfg, url));\r\n        }\r\n        else {\r\n            return this._render_final(config, url);\r\n        }\r\n    }\r\n    _render_final(config, url) {\r\n        // get previous view in the same slot\r\n        let slot = null;\r\n        let container = null;\r\n        let show = false;\r\n        if (!this._container.tagName) {\r\n            slot = this._container;\r\n            if (slot.popup) {\r\n                container = document.body;\r\n                show = true;\r\n            }\r\n            else {\r\n                container = this.webix.$$(slot.id);\r\n            }\r\n        }\r\n        else {\r\n            container = this._container;\r\n        }\r\n        // view already destroyed\r\n        if (!this.app || !container) {\r\n            return Promise.reject(null);\r\n        }\r\n        let response;\r\n        const current = this._segment.current();\r\n        // using wrapper object, so ui can be changed from app:render event\r\n        const result = { ui: {} };\r\n        this.app.copyConfig(config, result.ui, this._subs);\r\n        this.app.callEvent(\"app:render\", [this, url, result]);\r\n        result.ui.$scope = this;\r\n        /* destroy old HTML attached views before creating new one */\r\n        if (!slot && current.isNew && current.view) {\r\n            current.view.destructor();\r\n        }\r\n        try {\r\n            // special handling for adding inside of multiview - preserve old id\r\n            if (slot && !show) {\r\n                const oldui = container;\r\n                const parent = oldui.getParentView();\r\n                if (parent && parent.name === \"multiview\" && !result.ui.id) {\r\n                    result.ui.id = oldui.config.id;\r\n                }\r\n            }\r\n            this._root = this.app.webix.ui(result.ui, container);\r\n            const asWin = this._root;\r\n            // check for url added to ignore this.ui calls\r\n            if (show && asWin.setPosition && !asWin.isVisible()) {\r\n                asWin.show();\r\n            }\r\n            // check, if we are replacing some older view\r\n            if (slot) {\r\n                if (slot.view && slot.view !== this && slot.view !== this.app) {\r\n                    slot.view.destructor();\r\n                }\r\n                slot.id = this._root.config.id;\r\n                if (this.getParentView() || !this.app.app)\r\n                    slot.view = this;\r\n                else {\r\n                    // when we have subapp, set whole app as a view\r\n                    // so on destruction, the whole app will be destroyed\r\n                    slot.view = this.app;\r\n                }\r\n            }\r\n            if (current.isNew) {\r\n                current.view = this;\r\n                current.isNew = false;\r\n            }\r\n            response = Promise.resolve(this._init(this._root, url)).then(() => {\r\n                return this._urlChange().then(() => {\r\n                    this._initUrl = null;\r\n                    return this.ready(this._root, url.suburl());\r\n                });\r\n            });\r\n        }\r\n        catch (e) {\r\n            response = Promise.reject(e);\r\n        }\r\n        return response.catch(err => this._initError(this, err));\r\n    }\r\n    _init(view, url) {\r\n        return this.init(view, url.suburl());\r\n    }\r\n    _urlChange() {\r\n        this.app.callEvent(\"app:urlchange\", [this, this._segment]);\r\n        const waits = [];\r\n        for (const key in this._subs) {\r\n            const frame = this._subs[key];\r\n            const wait = this._renderFrameLock(key, frame, null);\r\n            if (wait) {\r\n                waits.push(wait);\r\n            }\r\n        }\r\n        return Promise.all(waits).then(() => {\r\n            return this.urlChange(this._root, this._segment.suburl());\r\n        });\r\n    }\r\n    _renderFrameLock(key, frame, path) {\r\n        // if subview is not occupied by some rendering yet\r\n        if (!frame.lock) {\r\n            // retreive and store rendering end promise\r\n            const lock = this._renderFrame(key, frame, path);\r\n            if (lock) {\r\n                // clear lock after frame rendering\r\n                // as promise.finally is not supported by  Webix lesser than 6.2\r\n                // using a more verbose notation\r\n                frame.lock = lock.then(() => frame.lock = null, () => frame.lock = null);\r\n            }\r\n        }\r\n        // return rendering end promise\r\n        return frame.lock;\r\n    }\r\n    _renderFrame(key, frame, path) {\r\n        //default route\r\n        if (key === \"default\") {\r\n            if (this._segment.next()) {\r\n                // we have a next segment in url, render it\r\n                let params = path ? path.params : null;\r\n                if (frame.params) {\r\n                    params = this.webix.extend(params || {}, frame.params);\r\n                }\r\n                return this._createSubView(frame, this._segment.shift(params));\r\n            }\r\n            else if (frame.view && frame.popup) {\r\n                // there is no next segment, delete the existing sub-view\r\n                frame.view.destructor();\r\n                frame.view = null;\r\n            }\r\n        }\r\n        //if new path provided, set it to the frame\r\n        if (path !== null) {\r\n            frame.url = path.url;\r\n            if (frame.params) {\r\n                path.params = this.webix.extend(path.params || {}, frame.params);\r\n            }\r\n        }\r\n        // in case of routed sub-view\r\n        if (frame.route) {\r\n            // we have a new path for sub-view\r\n            if (path !== null) {\r\n                return frame.route.show(path, frame.view).then(() => {\r\n                    return this._createSubView(frame, frame.route);\r\n                });\r\n            }\r\n            // do not trigger onChange for isolated sub-views\r\n            if (frame.branch) {\r\n                return;\r\n            }\r\n        }\r\n        let view = frame.view;\r\n        // if view doesn't exists yet, init it\r\n        if (!view && frame.url) {\r\n            if (typeof frame.url === \"string\") {\r\n                // string, so we have isolated subview url\r\n                frame.route = new Route(frame.url, 0);\r\n                if (path)\r\n                    frame.route.setParams(frame.route.route.url, path.params, 0);\r\n                if (frame.params)\r\n                    frame.route.setParams(frame.route.route.url, frame.params, 0);\r\n                return this._createSubView(frame, frame.route);\r\n            }\r\n            else {\r\n                // object, so we have an embeded subview\r\n                if (typeof frame.url === \"function\" && !(view instanceof frame.url)) {\r\n                    view = new (this.app._override(frame.url))(this.app, \"\");\r\n                }\r\n                if (!view) {\r\n                    view = frame.url;\r\n                }\r\n            }\r\n        }\r\n        // trigger onChange for already existed view\r\n        if (view) {\r\n            return view.render(frame, (frame.route || this._segment), this);\r\n        }\r\n    }\r\n    _initError(view, err) {\r\n        /*\r\n            if view is destroyed, ignore any view related errors\r\n        */\r\n        if (this.app) {\r\n            this.app.error(\"app:error:initview\", [err, view]);\r\n        }\r\n        return true;\r\n    }\r\n    _createSubView(sub, suburl) {\r\n        return this.app.createFromURL(suburl.current()).then(view => {\r\n            return view.render(sub, suburl, this);\r\n        });\r\n    }\r\n    _destroyKids() {\r\n        // destroy child views\r\n        const uis = this._children;\r\n        for (let i = uis.length - 1; i >= 0; i--) {\r\n            if (uis[i] && uis[i].destructor) {\r\n                uis[i].destructor();\r\n            }\r\n        }\r\n        // reset vars for better GC processing\r\n        this._children = [];\r\n    }\r\n}\n\n// wrapper for raw objects and Jet 1.x structs\r\nclass JetViewRaw extends JetView {\r\n    constructor(app, config) {\r\n        super(app, config);\r\n        this._ui = config.ui;\r\n    }\r\n    config() {\r\n        return this._ui;\r\n    }\r\n}\n\nclass SubRouter {\r\n    constructor(cb, config, app) {\r\n        this.path = \"\";\r\n        this.app = app;\r\n    }\r\n    set(path, config) {\r\n        this.path = path;\r\n        const a = this.app;\r\n        a.app.getRouter().set(a._segment.append(this.path), { silent: true });\r\n    }\r\n    get() {\r\n        return this.path;\r\n    }\r\n}\n\nlet _once = true;\r\nclass JetAppBase extends JetBase {\r\n    constructor(config) {\r\n        const webix = (config || {}).webix || window.webix;\r\n        config = webix.extend({\r\n            name: \"App\",\r\n            version: \"1.0\",\r\n            start: \"/home\"\r\n        }, config, true);\r\n        super(webix, config);\r\n        this.config = config;\r\n        this.app = this.config.app;\r\n        this.ready = Promise.resolve();\r\n        this._services = {};\r\n        this.webix.extend(this, this.webix.EventSystem);\r\n    }\r\n    getUrl() {\r\n        return this._subSegment.suburl();\r\n    }\r\n    getUrlString() {\r\n        return this._subSegment.toString();\r\n    }\r\n    getService(name) {\r\n        let obj = this._services[name];\r\n        if (typeof obj === \"function\") {\r\n            obj = this._services[name] = obj(this);\r\n        }\r\n        return obj;\r\n    }\r\n    setService(name, handler) {\r\n        this._services[name] = handler;\r\n    }\r\n    destructor() {\r\n        this.getSubView().destructor();\r\n        super.destructor();\r\n    }\r\n    // copy object and collect extra handlers\r\n    copyConfig(obj, target, config) {\r\n        // raw ui config\r\n        if (obj instanceof JetBase ||\r\n            (typeof obj === \"function\" && obj.prototype instanceof JetBase)) {\r\n            obj = { $subview: obj };\r\n        }\r\n        // subview placeholder\r\n        if (typeof obj.$subview != \"undefined\") {\r\n            return this.addSubView(obj, target, config);\r\n        }\r\n        // process sub-properties\r\n        const isArray = obj instanceof Array;\r\n        target = target || (isArray ? [] : {});\r\n        for (const method in obj) {\r\n            let point = obj[method];\r\n            // view class\r\n            if (typeof point === \"function\" && point.prototype instanceof JetBase) {\r\n                point = { $subview: point };\r\n            }\r\n            if (point && typeof point === \"object\" &&\r\n                !(point instanceof this.webix.DataCollection) && !(point instanceof RegExp) && !(point instanceof Map)) {\r\n                if (point instanceof Date) {\r\n                    target[method] = new Date(point);\r\n                }\r\n                else {\r\n                    const copy = this.copyConfig(point, (point instanceof Array ? [] : {}), config);\r\n                    if (copy !== null) {\r\n                        if (isArray)\r\n                            target.push(copy);\r\n                        else\r\n                            target[method] = copy;\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                target[method] = point;\r\n            }\r\n        }\r\n        return target;\r\n    }\r\n    getRouter() {\r\n        return this.$router;\r\n    }\r\n    clickHandler(e, target) {\r\n        if (e) {\r\n            target = target || (e.target || e.srcElement);\r\n            if (target && target.getAttribute) {\r\n                const trigger = target.getAttribute(\"trigger\");\r\n                if (trigger) {\r\n                    this._forView(target, view => view.app.trigger(trigger));\r\n                    e.cancelBubble = true;\r\n                    return e.preventDefault();\r\n                }\r\n                const route = target.getAttribute(\"route\");\r\n                if (route) {\r\n                    this._forView(target, view => view.show(route));\r\n                    e.cancelBubble = true;\r\n                    return e.preventDefault();\r\n                }\r\n            }\r\n        }\r\n        const parent = target.parentNode;\r\n        if (parent) {\r\n            this.clickHandler(e, parent);\r\n        }\r\n    }\r\n    getRoot() {\r\n        return this.getSubView().getRoot();\r\n    }\r\n    refresh() {\r\n        if (!this._subSegment) {\r\n            return Promise.resolve(null);\r\n        }\r\n        return this.getSubView().refresh().then(view => {\r\n            this.callEvent(\"app:route\", [this.getUrl()]);\r\n            return view;\r\n        });\r\n    }\r\n    loadView(url) {\r\n        const views = this.config.views;\r\n        let result = null;\r\n        if (url === \"\") {\r\n            return Promise.resolve(this._loadError(\"\", new Error(\"Webix Jet: Empty url segment\")));\r\n        }\r\n        try {\r\n            if (views) {\r\n                if (typeof views === \"function\") {\r\n                    // custom loading strategy\r\n                    result = views(url);\r\n                }\r\n                else {\r\n                    // predefined hash\r\n                    result = views[url];\r\n                }\r\n                if (typeof result === \"string\") {\r\n                    url = result;\r\n                    result = null;\r\n                }\r\n            }\r\n            if (!result) {\r\n                if (url === \"_hidden\") {\r\n                    result = { hidden: true };\r\n                }\r\n                else if (url === \"_blank\") {\r\n                    result = {};\r\n                }\r\n                else {\r\n                    url = url.replace(/\\./g, \"/\");\r\n                    result = this.require(\"jet-views\", url);\r\n                }\r\n            }\r\n        }\r\n        catch (e) {\r\n            result = this._loadError(url, e);\r\n        }\r\n        // custom handler can return view or its promise\r\n        if (!result.then) {\r\n            result = Promise.resolve(result);\r\n        }\r\n        // set error handler\r\n        result = result\r\n            .then(module => module.__esModule ? module.default : module)\r\n            .catch(err => this._loadError(url, err));\r\n        return result;\r\n    }\r\n    _forView(target, handler) {\r\n        const view = this.webix.$$(target);\r\n        if (view) {\r\n            handler(view.$scope);\r\n        }\r\n    }\r\n    _loadViewDynamic(url) {\r\n        return null;\r\n    }\r\n    createFromURL(chunk) {\r\n        let view;\r\n        if (chunk.isNew || !chunk.view) {\r\n            view = this.loadView(chunk.page)\r\n                .then(ui => this.createView(ui, name, chunk.params));\r\n        }\r\n        else {\r\n            view = Promise.resolve(chunk.view);\r\n        }\r\n        return view;\r\n    }\r\n    _override(ui) {\r\n        const over = this.config.override;\r\n        if (over) {\r\n            let dv;\r\n            while (ui) {\r\n                dv = ui;\r\n                ui = over.get(ui);\r\n            }\r\n            return dv;\r\n        }\r\n        return ui;\r\n    }\r\n    createView(ui, name, params) {\r\n        ui = this._override(ui);\r\n        let obj;\r\n        if (typeof ui === \"function\") {\r\n            if (ui.prototype instanceof JetAppBase) {\r\n                // UI class\r\n                return new ui({ app: this, name, params, router: SubRouter });\r\n            }\r\n            else if (ui.prototype instanceof JetBase) {\r\n                // UI class\r\n                return new ui(this, { name, params });\r\n            }\r\n            else {\r\n                // UI factory functions\r\n                ui = ui(this);\r\n            }\r\n        }\r\n        if (ui instanceof JetBase) {\r\n            obj = ui;\r\n        }\r\n        else {\r\n            // UI object\r\n            obj = new JetViewRaw(this, { name, ui });\r\n        }\r\n        return obj;\r\n    }\r\n    // show view path\r\n    show(url, config) {\r\n        if (url && this.app && url.indexOf(\"//\") == 0)\r\n            return this.app.show(url.substr(1), config);\r\n        return this.render(this._container, url || this.config.start, config);\r\n    }\r\n    // event helpers\r\n    trigger(name, ...rest) {\r\n        this.apply(name, rest);\r\n    }\r\n    apply(name, data) {\r\n        this.callEvent(name, data);\r\n    }\r\n    action(name) {\r\n        return this.webix.bind(function (...rest) {\r\n            this.apply(name, rest);\r\n        }, this);\r\n    }\r\n    on(name, handler) {\r\n        this.attachEvent(name, handler);\r\n    }\r\n    use(plugin, config) {\r\n        plugin(this, null, config);\r\n    }\r\n    error(name, er) {\r\n        this.callEvent(name, er);\r\n        this.callEvent(\"app:error\", er);\r\n        /* tslint:disable */\r\n        if (this.config.debug) {\r\n            for (var i = 0; i < er.length; i++) {\r\n                console.error(er[i]);\r\n                if (er[i] instanceof Error) {\r\n                    let text = er[i].message;\r\n                    if (text.indexOf(\"Module build failed\") === 0) {\r\n                        text = text.replace(/\\x1b\\[[0-9;]*m/g, \"\");\r\n                        document.body.innerHTML = `<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>${text}</pre>`;\r\n                    }\r\n                    else {\r\n                        text += \"<br><br>Check console for more details\";\r\n                        this.webix.message({ type: \"error\", text: text, expire: -1 });\r\n                    }\r\n                }\r\n            }\r\n            debugger;\r\n        }\r\n        /* tslint:enable */\r\n    }\r\n    // renders top view\r\n    render(root, url, config) {\r\n        this._container = (typeof root === \"string\") ?\r\n            this.webix.toNode(root) :\r\n            (root || document.body);\r\n        const firstInit = !this.$router;\r\n        let path = null;\r\n        if (firstInit) {\r\n            if (_once && \"tagName\" in this._container) {\r\n                this.webix.event(document.body, \"click\", e => this.clickHandler(e));\r\n                _once = false;\r\n            }\r\n            if (typeof url === \"string\") {\r\n                url = new Route(url, 0);\r\n            }\r\n            this._subSegment = this._first_start(url);\r\n            this._subSegment.route.linkRouter = true;\r\n        }\r\n        else {\r\n            if (typeof url === \"string\") {\r\n                path = url;\r\n            }\r\n            else {\r\n                if (this.app) {\r\n                    path = url.split().route.path || this.config.start;\r\n                }\r\n                else {\r\n                    path = url.toString();\r\n                }\r\n            }\r\n        }\r\n        const params = config ? config.params : this.config.params || null;\r\n        const top = this.getSubView();\r\n        const segment = this._subSegment;\r\n        const ready = segment\r\n            .show({ url: path, params }, top)\r\n            .then(() => this.createFromURL(segment.current()))\r\n            .then(view => view.render(root, segment))\r\n            .then(base => {\r\n            this.$router.set(segment.route.path, { silent: true });\r\n            this.callEvent(\"app:route\", [this.getUrl()]);\r\n            return base;\r\n        });\r\n        this.ready = this.ready.then(() => ready);\r\n        return ready;\r\n    }\r\n    getSubView() {\r\n        if (this._subSegment) {\r\n            const view = this._subSegment.current().view;\r\n            if (view)\r\n                return view;\r\n        }\r\n        return new JetView(this, {});\r\n    }\r\n    require(type, url) { return null; }\r\n    _first_start(route) {\r\n        this._segment = route;\r\n        const cb = (a) => setTimeout(() => {\r\n            this.show(a).catch(e => {\r\n                if (!(e instanceof NavigationBlocked))\r\n                    throw e;\r\n            });\r\n        }, 1);\r\n        this.$router = new (this.config.router)(cb, this.config, this);\r\n        // start animation for top-level app\r\n        if (this._container === document.body && this.config.animation !== false) {\r\n            const node = this._container;\r\n            this.webix.html.addCss(node, \"webixappstart\");\r\n            setTimeout(() => {\r\n                this.webix.html.removeCss(node, \"webixappstart\");\r\n                this.webix.html.addCss(node, \"webixapp\");\r\n            }, 10);\r\n        }\r\n        if (!route) {\r\n            // if no url defined, check router first\r\n            let urlString = this.$router.get();\r\n            if (!urlString) {\r\n                urlString = this.config.start;\r\n                this.$router.set(urlString, { silent: true });\r\n            }\r\n            route = new Route(urlString, 0);\r\n        }\r\n        else if (this.app) {\r\n            const now = route.current().view;\r\n            route.current().view = this;\r\n            if (route.next()) {\r\n                route.refresh();\r\n                route = route.split();\r\n            }\r\n            else {\r\n                route = new Route(this.config.start, 0);\r\n            }\r\n            route.current().view = now;\r\n        }\r\n        return route;\r\n    }\r\n    // error during view resolving\r\n    _loadError(url, err) {\r\n        this.error(\"app:error:resolve\", [err, url]);\r\n        return { template: \" \" };\r\n    }\r\n    addSubView(obj, target, config) {\r\n        const url = obj.$subview !== true ? obj.$subview : null;\r\n        const name = obj.name || (url ? this.webix.uid() : \"default\");\r\n        target.id = obj.id || \"s\" + this.webix.uid();\r\n        const view = config[name] = {\r\n            id: target.id,\r\n            url,\r\n            branch: obj.branch,\r\n            popup: obj.popup,\r\n            params: obj.params\r\n        };\r\n        return view.popup ? null : target;\r\n    }\r\n}\n\nclass HashRouter {\r\n    constructor(cb, config) {\r\n        this.config = config || {};\r\n        this._detectPrefix();\r\n        this.cb = cb;\r\n        window.onpopstate = () => this.cb(this.get());\r\n    }\r\n    set(path, config) {\r\n        if (this.config.routes) {\r\n            const compare = path.split(\"?\", 2);\r\n            for (const key in this.config.routes) {\r\n                if (this.config.routes[key] === compare[0]) {\r\n                    path = key + (compare.length > 1 ? \"?\" + compare[1] : \"\");\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        if (this.get() !== path) {\r\n            window.history.pushState(null, null, this.prefix + this.sufix + path);\r\n        }\r\n        if (!config || !config.silent) {\r\n            setTimeout(() => this.cb(path), 1);\r\n        }\r\n    }\r\n    get() {\r\n        let path = this._getRaw().replace(this.prefix, \"\").replace(this.sufix, \"\");\r\n        path = (path !== \"/\" && path !== \"#\") ? path : \"\";\r\n        if (this.config.routes) {\r\n            const compare = path.split(\"?\", 2);\r\n            const key = this.config.routes[compare[0]];\r\n            if (key) {\r\n                path = key + (compare.length > 1 ? \"?\" + compare[1] : \"\");\r\n            }\r\n        }\r\n        return path;\r\n    }\r\n    _detectPrefix() {\r\n        // use \"#!\" for backward compatibility\r\n        const sufix = this.config.routerPrefix;\r\n        this.sufix = \"#\" + ((typeof sufix === \"undefined\") ? \"!\" : sufix);\r\n        this.prefix = document.location.href.split(\"#\", 2)[0];\r\n    }\r\n    _getRaw() {\r\n        return document.location.href;\r\n    }\r\n}\n\nlet isPatched = false;\r\nfunction patch(w) {\r\n    if (isPatched || !w) {\r\n        return;\r\n    }\r\n    isPatched = true;\r\n    // custom promise for IE8\r\n    const win = window;\r\n    if (!win.Promise) {\r\n        win.Promise = w.promise;\r\n    }\r\n    const version = w.version.split(\".\");\r\n    // will be fixed in webix 5.3\r\n    if (version[0] * 10 + version[1] * 1 < 53) {\r\n        w.ui.freeze = function (handler) {\r\n            // disabled because webix jet 5.0 can't handle resize of scrollview correctly\r\n            // w.ui.$freeze = true;\r\n            const res = handler();\r\n            if (res && res.then) {\r\n                res.then(function (some) {\r\n                    w.ui.$freeze = false;\r\n                    w.ui.resize();\r\n                    return some;\r\n                });\r\n            }\r\n            else {\r\n                w.ui.$freeze = false;\r\n                w.ui.resize();\r\n            }\r\n            return res;\r\n        };\r\n    }\r\n    // adding views as classes\r\n    const baseAdd = w.ui.baselayout.prototype.addView;\r\n    const baseRemove = w.ui.baselayout.prototype.removeView;\r\n    const config = {\r\n        addView(view, index) {\r\n            // trigger logic only for widgets inside of jet-view\r\n            // ignore case when addView used with already initialized widget\r\n            if (this.$scope && this.$scope.webixJet && !view.queryView) {\r\n                const jview = this.$scope;\r\n                const subs = {};\r\n                view = jview.app.copyConfig(view, {}, subs);\r\n                baseAdd.apply(this, [view, index]);\r\n                for (const key in subs) {\r\n                    jview._renderFrame(key, subs[key], null).then(() => {\r\n                        jview._subs[key] = subs[key];\r\n                    });\r\n                }\r\n                return view.id;\r\n            }\r\n            else {\r\n                return baseAdd.apply(this, arguments);\r\n            }\r\n        },\r\n        removeView() {\r\n            baseRemove.apply(this, arguments);\r\n            if (this.$scope && this.$scope.webixJet) {\r\n                const subs = this.$scope._subs;\r\n                // check all sub-views, destroy and clean the removed one\r\n                for (const key in subs) {\r\n                    const test = subs[key];\r\n                    if (!w.$$(test.id)) {\r\n                        test.view.destructor();\r\n                        delete subs[key];\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n    w.extend(w.ui.layout.prototype, config, true);\r\n    w.extend(w.ui.baselayout.prototype, config, true);\r\n    // wrapper for using Jet Apps as views\r\n    w.protoUI({\r\n        name: \"jetapp\",\r\n        $init(cfg) {\r\n            this.$app = new this.app(cfg);\r\n            const id = w.uid().toString();\r\n            cfg.body = { id };\r\n            this.$ready.push(function () {\r\n                this.callEvent(\"onInit\", [this.$app]);\r\n                this.$app.render({ id });\r\n            });\r\n        }\r\n    }, w.ui.proxy, w.EventSystem);\r\n}\n\nclass JetApp extends JetAppBase {\r\n    constructor(config) {\r\n        config.router = config.router || HashRouter;\r\n        super(config);\r\n        patch(this.webix);\r\n    }\r\n    require(type, url) {\r\n        return require(type + \"/\" + url);\r\n    }\r\n}\n\nclass StoreRouter {\r\n    constructor(cb, config, app) {\r\n        this.storage = config.storage || app.webix.storage.session;\r\n        this.name = (config.storeName || config.id + \":route\");\r\n        this.cb = cb;\r\n    }\r\n    set(path, config) {\r\n        this.storage.put(this.name, path);\r\n        if (!config || !config.silent) {\r\n            setTimeout(() => this.cb(path), 1);\r\n        }\r\n    }\r\n    get() {\r\n        return this.storage.get(this.name);\r\n    }\r\n}\n\nclass UrlRouter extends HashRouter {\r\n    _detectPrefix() {\r\n        this.prefix = \"\";\r\n        this.sufix = this.config.routerPrefix || \"\";\r\n    }\r\n    _getRaw() {\r\n        return document.location.pathname + (document.location.search || \"\");\r\n    }\r\n}\n\nclass EmptyRouter {\r\n    constructor(cb, _$config) {\r\n        this.path = \"\";\r\n        this.cb = cb;\r\n    }\r\n    set(path, config) {\r\n        this.path = path;\r\n        if (!config || !config.silent) {\r\n            setTimeout(() => this.cb(path), 1);\r\n        }\r\n    }\r\n    get() {\r\n        return this.path;\r\n    }\r\n}\n\nfunction UnloadGuard(app, view, config) {\r\n    view.on(app, `app:guard`, function (_$url, point, promise) {\r\n        if (point === view || point.contains(view)) {\r\n            const res = config();\r\n            if (res === false) {\r\n                promise.confirm = Promise.reject(new NavigationBlocked());\r\n            }\r\n            else {\r\n                promise.confirm = promise.confirm.then(() => res);\r\n            }\r\n        }\r\n    });\r\n}\n\n//     (c) 2012-2018 Airbnb, Inc.\n\n// var has = require('has');\nfunction has(store, key) {\n  return Object.prototype.hasOwnProperty.call(store, key);\n}\n// var forEach = require('for-each');\nfunction forEach(obj, handler, context) {\n  for (var key in obj) {\n    if (has(obj, key)) {\n      handler.call((context || obj), obj[key], key, obj);\n    }\n  }\n}\n// var trim = require('string.prototype.trim');\nfunction trim(str) {\n  return str.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '');\n}\n// var warning = require('warning');\nfunction warn(message) {\n  message = 'Warning: ' + message;\n  if (typeof console !== 'undefined') {\n    console.error(message);\n  }\n\n  try { throw new Error(message); } catch (x) {}\n}\n\nvar replace = String.prototype.replace;\nvar split = String.prototype.split;\n\n// #### Pluralization methods\n// The string that separates the different phrase possibilities.\nvar delimiter = '||||';\n\nvar russianPluralGroups = function (n) {\n  var end = n % 10;\n  if (n !== 11 && end === 1) {\n    return 0;\n  }\n  if (2 <= end && end <= 4 && !(n >= 12 && n <= 14)) {\n    return 1;\n  }\n  return 2;\n};\n\n// Mapping from pluralization group plural logic.\nvar pluralTypes = {\n  arabic: function (n) {\n    // http://www.arabeyes.org/Plural_Forms\n    if (n < 3) { return n; }\n    var lastTwo = n % 100;\n    if (lastTwo >= 3 && lastTwo <= 10) return 3;\n    return lastTwo >= 11 ? 4 : 5;\n  },\n  bosnian_serbian: russianPluralGroups,\n  chinese: function () { return 0; },\n  croatian: russianPluralGroups,\n  french: function (n) { return n > 1 ? 1 : 0; },\n  german: function (n) { return n !== 1 ? 1 : 0; },\n  russian: russianPluralGroups,\n  lithuanian: function (n) {\n    if (n % 10 === 1 && n % 100 !== 11) { return 0; }\n    return n % 10 >= 2 && n % 10 <= 9 && (n % 100 < 11 || n % 100 > 19) ? 1 : 2;\n  },\n  czech: function (n) {\n    if (n === 1) { return 0; }\n    return (n >= 2 && n <= 4) ? 1 : 2;\n  },\n  polish: function (n) {\n    if (n === 1) { return 0; }\n    var end = n % 10;\n    return 2 <= end && end <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2;\n  },\n  icelandic: function (n) { return (n % 10 !== 1 || n % 100 === 11) ? 1 : 0; },\n  slovenian: function (n) {\n    var lastTwo = n % 100;\n    if (lastTwo === 1) {\n      return 0;\n    }\n    if (lastTwo === 2) {\n      return 1;\n    }\n    if (lastTwo === 3 || lastTwo === 4) {\n      return 2;\n    }\n    return 3;\n  }\n};\n\n\n// Mapping from pluralization group to individual language codes/locales.\n// Will look up based on exact match, if not found and it's a locale will parse the locale\n// for language code, and if that does not exist will default to 'en'\nvar pluralTypeToLanguages = {\n  arabic: ['ar'],\n  bosnian_serbian: ['bs-Latn-BA', 'bs-Cyrl-BA', 'srl-RS', 'sr-RS'],\n  chinese: ['id', 'id-ID', 'ja', 'ko', 'ko-KR', 'lo', 'ms', 'th', 'th-TH', 'zh'],\n  croatian: ['hr', 'hr-HR'],\n  german: ['fa', 'da', 'de', 'en', 'es', 'fi', 'el', 'he', 'hi-IN', 'hu', 'hu-HU', 'it', 'nl', 'no', 'pt', 'sv', 'tr'],\n  french: ['fr', 'tl', 'pt-br'],\n  russian: ['ru', 'ru-RU'],\n  lithuanian: ['lt'],\n  czech: ['cs', 'cs-CZ', 'sk'],\n  polish: ['pl'],\n  icelandic: ['is'],\n  slovenian: ['sl-SL']\n};\n\nfunction langToTypeMap(mapping) {\n  var ret = {};\n  forEach(mapping, function (langs, type) {\n    forEach(langs, function (lang) {\n      ret[lang] = type;\n    });\n  });\n  return ret;\n}\n\nfunction pluralTypeName(locale) {\n  var langToPluralType = langToTypeMap(pluralTypeToLanguages);\n  return langToPluralType[locale]\n    || langToPluralType[split.call(locale, /-/, 1)[0]]\n    || langToPluralType.en;\n}\n\nfunction pluralTypeIndex(locale, count) {\n  return pluralTypes[pluralTypeName(locale)](count);\n}\n\nfunction escape(token) {\n  return token.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n}\n\nfunction constructTokenRegex(opts) {\n  var prefix = (opts && opts.prefix) || '%{';\n  var suffix = (opts && opts.suffix) || '}';\n\n  if (prefix === delimiter || suffix === delimiter) {\n    throw new RangeError('\"' + delimiter + '\" token is reserved for pluralization');\n  }\n\n  return new RegExp(escape(prefix) + '(.*?)' + escape(suffix), 'g');\n}\n\nvar dollarRegex = /\\$/g;\nvar dollarBillsYall = '$$';\nvar defaultTokenRegex = /%\\{(.*?)\\}/g;\n\n// ### transformPhrase(phrase, substitutions, locale)\n//\n// Takes a phrase string and transforms it by choosing the correct\n// plural form and interpolating it.\n//\n//     transformPhrase('Hello, %{name}!', {name: 'Spike'});\n//     // \"Hello, Spike!\"\n//\n// The correct plural form is selected if substitutions.smart_count\n// is set. You can pass in a number instead of an Object as `substitutions`\n// as a shortcut for `smart_count`.\n//\n//     transformPhrase('%{smart_count} new messages |||| 1 new message', {smart_count: 1}, 'en');\n//     // \"1 new message\"\n//\n//     transformPhrase('%{smart_count} new messages |||| 1 new message', {smart_count: 2}, 'en');\n//     // \"2 new messages\"\n//\n//     transformPhrase('%{smart_count} new messages |||| 1 new message', 5, 'en');\n//     // \"5 new messages\"\n//\n// You should pass in a third argument, the locale, to specify the correct plural type.\n// It defaults to `'en'` with 2 plural forms.\nfunction transformPhrase(phrase, substitutions, locale, tokenRegex) {\n  if (typeof phrase !== 'string') {\n    throw new TypeError('Polyglot.transformPhrase expects argument #1 to be string');\n  }\n\n  if (substitutions == null) {\n    return phrase;\n  }\n\n  var result = phrase;\n  var interpolationRegex = tokenRegex || defaultTokenRegex;\n\n  // allow number as a pluralization shortcut\n  var options = typeof substitutions === 'number' ? { smart_count: substitutions } : substitutions;\n\n  // Select plural form: based on a phrase text that contains `n`\n  // plural forms separated by `delimiter`, a `locale`, and a `substitutions.smart_count`,\n  // choose the correct plural form. This is only done if `count` is set.\n  if (options.smart_count != null && result) {\n    var texts = split.call(result, delimiter);\n    result = trim(texts[pluralTypeIndex(locale || 'en', options.smart_count)] || texts[0]);\n  }\n\n  // Interpolate: Creates a `RegExp` object for each interpolation placeholder.\n  result = replace.call(result, interpolationRegex, function (expression, argument) {\n    if (!has(options, argument) || options[argument] == null) { return expression; }\n    // Ensure replacement value is escaped to prevent special $-prefixed regex replace tokens.\n    return replace.call(options[argument], dollarRegex, dollarBillsYall);\n  });\n\n  return result;\n}\n\n// ### Polyglot class constructor\nfunction Polyglot(options) {\n  var opts = options || {};\n  this.phrases = {};\n  this.extend(opts.phrases || {});\n  this.currentLocale = opts.locale || 'en';\n  var allowMissing = opts.allowMissing ? transformPhrase : null;\n  this.onMissingKey = typeof opts.onMissingKey === 'function' ? opts.onMissingKey : allowMissing;\n  this.warn = opts.warn || warn;\n  this.tokenRegex = constructTokenRegex(opts.interpolation);\n}\n\n// ### polyglot.locale([locale])\n//\n// Get or set locale. Internally, Polyglot only uses locale for pluralization.\nPolyglot.prototype.locale = function (newLocale) {\n  if (newLocale) this.currentLocale = newLocale;\n  return this.currentLocale;\n};\n\n// ### polyglot.extend(phrases)\n//\n// Use `extend` to tell Polyglot how to translate a given key.\n//\n//     polyglot.extend({\n//       \"hello\": \"Hello\",\n//       \"hello_name\": \"Hello, %{name}\"\n//     });\n//\n// The key can be any string.  Feel free to call `extend` multiple times;\n// it will override any phrases with the same key, but leave existing phrases\n// untouched.\n//\n// It is also possible to pass nested phrase objects, which get flattened\n// into an object with the nested keys concatenated using dot notation.\n//\n//     polyglot.extend({\n//       \"nav\": {\n//         \"hello\": \"Hello\",\n//         \"hello_name\": \"Hello, %{name}\",\n//         \"sidebar\": {\n//           \"welcome\": \"Welcome\"\n//         }\n//       }\n//     });\n//\n//     console.log(polyglot.phrases);\n//     // {\n//     //   'nav.hello': 'Hello',\n//     //   'nav.hello_name': 'Hello, %{name}',\n//     //   'nav.sidebar.welcome': 'Welcome'\n//     // }\n//\n// `extend` accepts an optional second argument, `prefix`, which can be used\n// to prefix every key in the phrases object with some string, using dot\n// notation.\n//\n//     polyglot.extend({\n//       \"hello\": \"Hello\",\n//       \"hello_name\": \"Hello, %{name}\"\n//     }, \"nav\");\n//\n//     console.log(polyglot.phrases);\n//     // {\n//     //   'nav.hello': 'Hello',\n//     //   'nav.hello_name': 'Hello, %{name}'\n//     // }\n//\n// This feature is used internally to support nested phrase objects.\nPolyglot.prototype.extend = function (morePhrases, prefix) {\n  forEach(morePhrases, function (phrase, key) {\n    var prefixedKey = prefix ? prefix + '.' + key : key;\n    if (typeof phrase === 'object') {\n      this.extend(phrase, prefixedKey);\n    } else {\n      this.phrases[prefixedKey] = phrase;\n    }\n  }, this);\n};\n\n// ### polyglot.unset(phrases)\n// Use `unset` to selectively remove keys from a polyglot instance.\n//\n//     polyglot.unset(\"some_key\");\n//     polyglot.unset({\n//       \"hello\": \"Hello\",\n//       \"hello_name\": \"Hello, %{name}\"\n//     });\n//\n// The unset method can take either a string (for the key), or an object hash with\n// the keys that you would like to unset.\nPolyglot.prototype.unset = function (morePhrases, prefix) {\n  if (typeof morePhrases === 'string') {\n    delete this.phrases[morePhrases];\n  } else {\n    forEach(morePhrases, function (phrase, key) {\n      var prefixedKey = prefix ? prefix + '.' + key : key;\n      if (typeof phrase === 'object') {\n        this.unset(phrase, prefixedKey);\n      } else {\n        delete this.phrases[prefixedKey];\n      }\n    }, this);\n  }\n};\n\n// ### polyglot.clear()\n//\n// Clears all phrases. Useful for special cases, such as freeing\n// up memory if you have lots of phrases but no longer need to\n// perform any translation. Also used internally by `replace`.\nPolyglot.prototype.clear = function () {\n  this.phrases = {};\n};\n\n// ### polyglot.replace(phrases)\n//\n// Completely replace the existing phrases with a new set of phrases.\n// Normally, just use `extend` to add more phrases, but under certain\n// circumstances, you may want to make sure no old phrases are lying around.\nPolyglot.prototype.replace = function (newPhrases) {\n  this.clear();\n  this.extend(newPhrases);\n};\n\n\n// ### polyglot.t(key, options)\n//\n// The most-used method. Provide a key, and `t` will return the\n// phrase.\n//\n//     polyglot.t(\"hello\");\n//     => \"Hello\"\n//\n// The phrase value is provided first by a call to `polyglot.extend()` or\n// `polyglot.replace()`.\n//\n// Pass in an object as the second argument to perform interpolation.\n//\n//     polyglot.t(\"hello_name\", {name: \"Spike\"});\n//     => \"Hello, Spike\"\n//\n// If you like, you can provide a default value in case the phrase is missing.\n// Use the special option key \"_\" to specify a default.\n//\n//     polyglot.t(\"i_like_to_write_in_language\", {\n//       _: \"I like to write in %{language}.\",\n//       language: \"JavaScript\"\n//     });\n//     => \"I like to write in JavaScript.\"\n//\nPolyglot.prototype.t = function (key, options) {\n  var phrase, result;\n  var opts = options == null ? {} : options;\n  if (typeof this.phrases[key] === 'string') {\n    phrase = this.phrases[key];\n  } else if (typeof opts._ === 'string') {\n    phrase = opts._;\n  } else if (this.onMissingKey) {\n    var onMissingKey = this.onMissingKey;\n    result = onMissingKey(key, opts, this.currentLocale, this.tokenRegex);\n  } else {\n    this.warn('Missing translation for key: \"' + key + '\"');\n    result = key;\n  }\n  if (typeof phrase === 'string') {\n    result = transformPhrase(phrase, opts, this.currentLocale, this.tokenRegex);\n  }\n  return result;\n};\n\n\n// ### polyglot.has(key)\n//\n// Check if polyglot has a translation for given key\nPolyglot.prototype.has = function (key) {\n  return has(this.phrases, key);\n};\n\n// export transformPhrase\nPolyglot.transformPhrase = function transform(phrase, substitutions, locale) {\n  return transformPhrase(phrase, substitutions, locale);\n};\n\nvar webixPolyglot = Polyglot;\n\nfunction Locale(app, _view, config) {\r\n    config = config || {};\r\n    const storage = config.storage;\r\n    let lang = storage ? (storage.get(\"lang\") || \"en\") : (config.lang || \"en\");\r\n    function setLangData(name, data, silent) {\r\n        if (data.__esModule) {\r\n            data = data.default;\r\n        }\r\n        const pconfig = { phrases: data };\r\n        if (config.polyglot) {\r\n            app.webix.extend(pconfig, config.polyglot);\r\n        }\r\n        const poly = service.polyglot = new webixPolyglot(pconfig);\r\n        poly.locale(name);\r\n        service._ = app.webix.bind(poly.t, poly);\r\n        lang = name;\r\n        if (storage) {\r\n            storage.put(\"lang\", lang);\r\n        }\r\n        if (config.webix) {\r\n            const locName = config.webix[name];\r\n            if (locName) {\r\n                app.webix.i18n.setLocale(locName);\r\n            }\r\n        }\r\n        if (!silent) {\r\n            return app.refresh();\r\n        }\r\n        return Promise.resolve();\r\n    }\r\n    function getLang() { return lang; }\r\n    function setLang(name, silent) {\r\n        // ignore setLang if loading by path is disabled\r\n        if (config.path === false) {\r\n            return;\r\n        }\r\n        const path = (config.path ? config.path + \"/\" : \"\") + name;\r\n        const data = app.require(\"jet-locales\", path);\r\n        setLangData(name, data, silent);\r\n    }\r\n    const service = {\r\n        getLang, setLang, setLangData, _: null, polyglot: null\r\n    };\r\n    app.setService(\"locale\", service);\r\n    setLang(lang, true);\r\n}\n\nfunction show(view, config, value) {\r\n    if (config.urls) {\r\n        value = config.urls[value] || value;\r\n    }\r\n    else if (config.param) {\r\n        value = { [config.param]: value };\r\n    }\r\n    view.show(value);\r\n}\r\nfunction Menu(app, view, config) {\r\n    const frame = view.getSubViewInfo().parent;\r\n    const ui = view.$$(config.id || config);\r\n    let silent = false;\r\n    ui.attachEvent(\"onchange\", function () {\r\n        if (!silent) {\r\n            show(frame, config, this.getValue());\r\n        }\r\n    });\r\n    ui.attachEvent(\"onafterselect\", function () {\r\n        if (!silent) {\r\n            let id = null;\r\n            if (ui.setValue) {\r\n                id = this.getValue();\r\n            }\r\n            else if (ui.getSelectedId) {\r\n                id = ui.getSelectedId();\r\n            }\r\n            show(frame, config, id);\r\n        }\r\n    });\r\n    view.on(app, `app:route`, function () {\r\n        let name = \"\";\r\n        if (config.param) {\r\n            name = view.getParam(config.param, true);\r\n        }\r\n        else {\r\n            const segment = frame.getUrl()[1];\r\n            if (segment) {\r\n                name = segment.page;\r\n            }\r\n        }\r\n        if (name) {\r\n            silent = true;\r\n            if (ui.setValue && ui.getValue() !== name) {\r\n                ui.setValue(name);\r\n            }\r\n            else if (ui.select && ui.exists(name) && ui.getSelectedId() !== name) {\r\n                ui.select(name);\r\n            }\r\n            silent = false;\r\n        }\r\n    });\r\n}\n\nconst baseicons = {\r\n    good: \"check\",\r\n    error: \"warning\",\r\n    saving: \"refresh fa-spin\"\r\n};\r\nconst basetext = {\r\n    good: \"Ok\",\r\n    error: \"Error\",\r\n    saving: \"Connecting...\"\r\n};\r\nfunction Status(app, view, config) {\r\n    let status = \"good\";\r\n    let count = 0;\r\n    let iserror = false;\r\n    let expireDelay = config.expire;\r\n    if (!expireDelay && expireDelay !== false) {\r\n        expireDelay = 2000;\r\n    }\r\n    const texts = config.texts || basetext;\r\n    const icons = config.icons || baseicons;\r\n    if (typeof config === \"string\") {\r\n        config = { target: config };\r\n    }\r\n    function refresh(content) {\r\n        const area = view.$$(config.target);\r\n        if (area) {\r\n            if (!content) {\r\n                content = \"<div class='status_\" +\r\n                    status +\r\n                    \"'><span class='webix_icon fa-\" +\r\n                    icons[status] + \"'></span> \" + texts[status] + \"</div>\";\r\n            }\r\n            area.setHTML(content);\r\n        }\r\n    }\r\n    function success() {\r\n        count--;\r\n        setStatus(\"good\");\r\n    }\r\n    function fail(err) {\r\n        count--;\r\n        setStatus(\"error\", err);\r\n    }\r\n    function start(promise) {\r\n        count++;\r\n        setStatus(\"saving\");\r\n        if (promise && promise.then) {\r\n            promise.then(success, fail);\r\n        }\r\n    }\r\n    function getStatus() {\r\n        return status;\r\n    }\r\n    function hideStatus() {\r\n        if (count === 0) {\r\n            refresh(\" \");\r\n        }\r\n    }\r\n    function setStatus(mode, err) {\r\n        if (count < 0) {\r\n            count = 0;\r\n        }\r\n        if (mode === \"saving\") {\r\n            status = \"saving\";\r\n            refresh();\r\n        }\r\n        else {\r\n            iserror = (mode === \"error\");\r\n            if (count === 0) {\r\n                status = iserror ? \"error\" : \"good\";\r\n                if (iserror) {\r\n                    app.error(\"app:error:server\", [err.responseText || err]);\r\n                }\r\n                else {\r\n                    if (expireDelay) {\r\n                        setTimeout(hideStatus, expireDelay);\r\n                    }\r\n                }\r\n                refresh();\r\n            }\r\n        }\r\n    }\r\n    function track(data) {\r\n        const dp = app.webix.dp(data);\r\n        if (dp) {\r\n            view.on(dp, \"onAfterDataSend\", start);\r\n            view.on(dp, \"onAfterSaveError\", (_id, _obj, response) => fail(response));\r\n            view.on(dp, \"onAfterSave\", success);\r\n        }\r\n    }\r\n    app.setService(\"status\", {\r\n        getStatus,\r\n        setStatus,\r\n        track\r\n    });\r\n    if (config.remote) {\r\n        view.on(app.webix, \"onRemoteCall\", start);\r\n    }\r\n    if (config.ajax) {\r\n        view.on(app.webix, \"onBeforeAjax\", (_mode, _url, _data, _request, _headers, _files, promise) => {\r\n            start(promise);\r\n        });\r\n    }\r\n    if (config.data) {\r\n        track(config.data);\r\n    }\r\n}\n\nfunction Theme(app, _view, config) {\r\n    config = config || {};\r\n    const storage = config.storage;\r\n    let theme = storage ?\r\n        (storage.get(\"theme\") || \"flat-default\")\r\n        :\r\n            (config.theme || \"flat-default\");\r\n    const service = {\r\n        getTheme() { return theme; },\r\n        setTheme(name, silent) {\r\n            const parts = name.split(\"-\");\r\n            const links = document.getElementsByTagName(\"link\");\r\n            for (let i = 0; i < links.length; i++) {\r\n                const lname = links[i].getAttribute(\"title\");\r\n                if (lname) {\r\n                    if (lname === name || lname === parts[0]) {\r\n                        links[i].disabled = false;\r\n                    }\r\n                    else {\r\n                        links[i].disabled = true;\r\n                    }\r\n                }\r\n            }\r\n            app.webix.skin.set(parts[0]);\r\n            // remove old css\r\n            app.webix.html.removeCss(document.body, \"theme-\" + theme);\r\n            // add new css\r\n            app.webix.html.addCss(document.body, \"theme-\" + name);\r\n            theme = name;\r\n            if (storage) {\r\n                storage.put(\"theme\", name);\r\n            }\r\n            if (!silent) {\r\n                app.refresh();\r\n            }\r\n        }\r\n    };\r\n    app.setService(\"theme\", service);\r\n    service.setTheme(theme, true);\r\n}\n\nfunction copyParams(data, url, route) {\r\n    for (let i = 0; i < route.length; i++) {\r\n        data[route[i]] = url[i + 1] ? url[i + 1].page : \"\";\r\n    }\r\n}\r\nfunction UrlParam(app, view, config) {\r\n    const route = config.route || config;\r\n    const data = {};\r\n    view.on(app, \"app:urlchange\", function (subview, segment) {\r\n        if (view === subview) {\r\n            copyParams(data, segment.suburl(), route);\r\n            segment.size(route.length + 1);\r\n        }\r\n    });\r\n    const os = view.setParam;\r\n    const og = view.getParam;\r\n    view.setParam = function (name, value, show) {\r\n        const index = route.indexOf(name);\r\n        if (index >= 0) {\r\n            data[name] = value;\r\n            this._segment.update(\"\", value, index + 1);\r\n            if (show) {\r\n                return view.show(null);\r\n            }\r\n        }\r\n        else {\r\n            return os.call(this, name, value, show);\r\n        }\r\n    };\r\n    view.getParam = function (key, mode) {\r\n        const val = data[key];\r\n        if (typeof val !== \"undefined\") {\r\n            return val;\r\n        }\r\n        return og.call(this, key, mode);\r\n    };\r\n    copyParams(data, view.getUrl(), route);\r\n}\n\nfunction User(app, _view, config) {\r\n    config = config || {};\r\n    const login = config.login || \"/login\";\r\n    const logout = config.logout || \"/logout\";\r\n    const afterLogin = config.afterLogin || app.config.start;\r\n    const afterLogout = config.afterLogout || \"/login\";\r\n    const ping = config.ping || 5 * 60 * 1000;\r\n    const model = config.model;\r\n    let user = config.user;\r\n    const service = {\r\n        getUser() {\r\n            return user;\r\n        },\r\n        getStatus(server) {\r\n            if (!server) {\r\n                return user !== null;\r\n            }\r\n            return model.status().catch(() => null).then(data => {\r\n                user = data;\r\n            });\r\n        },\r\n        login(name, pass) {\r\n            return model.login(name, pass).then(data => {\r\n                user = data;\r\n                if (!data) {\r\n                    throw new Error(\"Access denied\");\r\n                }\r\n                app.callEvent(\"app:user:login\", [user]);\r\n                app.show(afterLogin);\r\n            });\r\n        },\r\n        logout() {\r\n            user = null;\r\n            return model.logout().then(res => {\r\n                app.callEvent(\"app:user:logout\", []);\r\n                return res;\r\n            });\r\n        }\r\n    };\r\n    function canNavigate(url, obj) {\r\n        if (url === logout) {\r\n            service.logout();\r\n            obj.redirect = afterLogout;\r\n        }\r\n        else if (url !== login && !service.getStatus()) {\r\n            obj.redirect = login;\r\n        }\r\n    }\r\n    app.setService(\"user\", service);\r\n    app.attachEvent(`app:guard`, function (url, _$root, obj) {\r\n        if (config.public && config.public(url)) {\r\n            return true;\r\n        }\r\n        if (typeof user === \"undefined\") {\r\n            obj.confirm = service.getStatus(true).then(() => canNavigate(url, obj));\r\n        }\r\n        return canNavigate(url, obj);\r\n    });\r\n    if (ping) {\r\n        setInterval(() => service.getStatus(true), ping);\r\n    }\r\n}\n\n/*\r\nMIT License\r\nCopyright (c) 2019 XB Software\r\n*/\r\nlet webix = window.webix;\r\nif (webix) {\r\n    patch(webix);\r\n}\r\nconst plugins = {\r\n    UnloadGuard, Locale, Menu, Theme, User, Status, UrlParam\r\n};\r\nconst errors = { NavigationBlocked };\r\nconst w = window;\r\nif (!w.Promise) {\r\n    w.Promise = w.webix.promise;\r\n}\n\nexport { plugins, errors, JetApp, JetView, HashRouter, StoreRouter, UrlRouter, EmptyRouter, SubRouter };\n//# sourceMappingURL=jet.js.map\n","var index = 1;\nfunction uid() {\n\treturn index++;\n}\n\nvar empty = undefined;\n\nexport function ignoreInitial(code) {\n\tlet init = false;\n\treturn function() {\n\t\tif (init) return code.apply(this, arguments);\n\t\telse init = true;\n\t};\n}\n\nvar context = null;\nexport function withContext(value, code) {\n\tcontext = value;\n\tcode();\n\tcontext = null;\n}\n\nexport function filter(rule, handler) {\n\treturn function(v, o, obj, meta) {\n\t\tif (rule(v, meta)) handler.apply(this, arguments);\n\t};\n}\n\nexport function link(source, target, key) {\n\tObject.defineProperty(target, key, {\n\t\tget: () => source[key],\n\t\tset: value => (source[key] = value),\n\t});\n}\n\nexport function debounce(handler, delay) {\n\tdelay = delay || 200;\n\tlet timer = null;\n\tlet data = null;\n\treturn function() {\n\t\tdata = arguments;\n\t\tif (!timer) {\n\t\t\ttimer = setTimeout(() => {\n\t\t\t\tclearTimeout(timer);\n\t\t\t\ttimer = null;\n\n\t\t\t\thandler.apply(this, data);\n\t\t\t}, delay);\n\t\t}\n\t};\n}\n\nexport function createState(data, config) {\n\tconfig = config || {};\n\tconst handlers = {};\n\tconst out = {};\n\n\tconst observe = function(mask, handler) {\n\t\tconst key = uid();\n\t\thandlers[key] = { mask, handler };\n\t\tif (mask === \"*\") handler(out, empty, mask);\n\t\telse handler(out[mask], empty, mask);\n\n\t\treturn key;\n\t};\n\n\tconst extend = function(data, sconfig){\n\t\tsconfig = sconfig || config;\n\t\t// normal js object\n\t\tfor (const key in data) {\n\t\t\tif (data.hasOwnProperty(key)) {\n\t\t\t\tconst test = data[key];\n\t\t\t\tif (sconfig.nested && typeof test === \"object\" && test) {\n\t\t\t\t\tout[key] = createState(test, sconfig);\n\t\t\t\t} else {\n\t\t\t\t\treactive(out, test, key, notify);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tconst observeEnd = function(id) {\n\t\tdelete handlers[id];\n\t};\n\n\tconst queue = [];\n\tlet waitInQueue = false;\n\n\tvar batch = function(code) {\n\t\tif (typeof code !== \"function\") {\n\t\t\tconst values = code;\n\t\t\tcode = () => {\n\t\t\t\tfor (const key in values) out[key] = values[key];\n\t\t\t};\n\t\t}\n\n\t\twaitInQueue = true;\n\t\tcode(out);\n\t\twaitInQueue = false;\n\t\twhile (queue.length) {\n\t\t\tconst obj = queue.shift();\n\t\t\tnotify.apply(this, obj);\n\t\t}\n\t};\n\n\tconst notify = function(key, old, value, meta) {\n\t\tif (waitInQueue) {\n\t\t\tqueue.push([key, old, value, meta]);\n\t\t\treturn;\n\t\t}\n\n\t\tconst list = Object.keys(handlers);\n\t\tfor (let i = 0; i < list.length; i++) {\n\t\t\tconst obj = handlers[list[i]];\n\t\t\tif (!obj) continue;\n\t\t\tif (obj.mask === \"*\" || obj.mask === key) {\n\t\t\t\tobj.handler(value, old, key, meta);\n\t\t\t}\n\t\t}\n\t};\n\n\tObject.defineProperty(out, \"$changes\", {\n\t\tvalue: {\n\t\t\tattachEvent: observe,\n\t\t\tdetachEvent: observeEnd,\n\t\t},\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\tObject.defineProperty(out, \"$observe\", {\n\t\tvalue: observe,\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\tObject.defineProperty(out, \"$batch\", {\n\t\tvalue: batch,\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\tObject.defineProperty(out, \"$extend\", {\n\t\tvalue: extend,\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\n\tout.$extend(data, config);\n\treturn out;\n}\n\nfunction reactive(obj, val, key, notify) {\n\tObject.defineProperty(obj, key, {\n\t\tget: function() {\n\t\t\treturn val;\n\t\t},\n\t\tset: function(value) {\n\t\t\tvar changed = false;\n\t\t\tif (val === null || value === null) {\n\t\t\t\tchanged = val !== value;\n\t\t\t} else {\n\t\t\t\tchanged = val.valueOf() != value.valueOf();\n\t\t\t}\n\n\t\t\tif (changed) {\n\t\t\t\tvar old = val;\n\t\t\t\tval = value;\n\t\t\t\tnotify(key, old, value, context);\n\t\t\t}\n\t\t},\n\t\tenumerable: true,\n\t\tconfigurable: false,\n\t});\n}","const d = webix.Date;\nexport function addMinutes(date, inc) {\n\treturn d.add(date, inc * 1, \"minute\", true);\n}\n\nexport function addHours(date, inc) {\n\treturn d.add(date, inc * 1, \"hour\", true);\n}\n\nexport function addDays(date, inc) {\n\treturn d.add(date, inc * 1, \"day\", true);\n}\n\nexport function addWeeks(date, inc) {\n\treturn d.add(date, inc * 1, \"week\", true);\n}\n\nexport function addMonths(date, inc) {\n\treturn d.add(date, inc * 1, \"month\", true);\n}\n\nexport function addQuarters(date, inc) {\n\treturn d.add(date, inc * 3, \"month\", true);\n}\n\nexport function addYears(date, inc) {\n\treturn d.add(date, inc * 1, \"year\", true);\n}\n\nexport function differenceInYears(a, b) {\n\treturn a.getFullYear() - b.getFullYear();\n}\n\nexport function differenceInMonths(a, b) {\n\treturn (\n\t\t(a.getFullYear() - b.getFullYear()) * 12 + (a.getMonth() - b.getMonth())\n\t);\n}\n\nconst day_length = 86400000;\nexport function differenceInCalendarDays(a, b) {\n\ta = new Date(a);\n\ta.setHours(0, 0, 0, 0);\n\tb = new Date(b);\n\tb.setHours(0, 0, 0, 0);\n\n\treturn Math.round((a.getTime() - b.getTime()) / day_length);\n}\n\nexport function differenceInQuarters(a, b) {\n\treturn (\n\t\t(a.getFullYear() - b.getFullYear()) * 4 +\n\t\t(Math.floor(a.getMonth() / 3) + 1) -\n\t\t(Math.floor(b.getMonth() / 3) + 1)\n\t);\n}\n\nexport function differenceInWeeks(a, b) {\n\tconst diff = differenceInCalendarDays(a, b) / 7;\n\treturn (\n\t\tMath.ceil(Math.abs(diff) - (a.getDay() <= b.getDay() ? 0 : 1)) *\n\t\tMath.sign(diff)\n\t);\n}\n\nexport function differenceInHours(a, b) {\n\treturn differenceInCalendarDays(a, b) * 24 + (a.getHours() - b.getHours());\n}\n\nexport function differenceInMinutes(a, b) {\n\treturn differenceInHours(a, b) * 60 + (a.getMinutes() - b.getMinutes());\n}\n\nconst f_cache = {};\nexport function format(date, format) {\n\treturn formatFunction(format)(date);\n}\nexport function formatFunction(format) {\n\tlet cb = f_cache[format];\n\tif (!cb) {\n\t\tcb = f_cache[format] = webix.Date.dateToStr(format);\n\t}\n\n\treturn cb;\n}\n","import {\n\taddMinutes,\n\taddHours,\n\taddDays,\n\taddWeeks,\n\taddMonths,\n\taddQuarters,\n\taddYears,\n\tdifferenceInYears,\n\tdifferenceInMonths,\n\tdifferenceInCalendarDays,\n\tdifferenceInQuarters,\n\tdifferenceInWeeks,\n\tdifferenceInHours,\n\tdifferenceInMinutes,\n\tformat,\n\tformatFunction,\n} from \"date-fns\";\n\nconst diff = {\n\tyear: differenceInYears,\n\tquarter: differenceInQuarters,\n\tmonth: differenceInMonths,\n\tweek: differenceInWeeks,\n\tday: differenceInCalendarDays,\n\thour: differenceInHours,\n\tminute: differenceInMinutes,\n};\n\nfunction countDaysInMonth(sdate) {\n\tif (!sdate) return 30;\n\n\tconst m = sdate.getMonth();\n\n\tif (m === 1) {\n\t\tconst y = sdate.getFullYear();\n\t\tif (y % 4) return 28;\n\t\tif (y % 100) return 29;\n\t\tif (y % 400) return 28;\n\t\treturn 29;\n\t}\n\n\tif ((m % 2 && m < 7) || (!(m % 2) && m > 7)) {\n\t\treturn 30;\n\t}\n\n\treturn 31;\n}\n/**\n * Smaller units for task position and width for scales with precision setting:\n * the name of the unit and the number within a larger unit\n */\nconst smallerCount = {\n\tyear: [\"quarter\", 4],\n\tquarter: [\"month\", 3],\n\tmonth: [\"day\", countDaysInMonth],\n\tweek: [\"day\", 7],\n\tday: [\"hour\", 24],\n\thour: [\"minute\", 60],\n};\n\nconst add = {\n\tyear: addYears,\n\tquarter: addQuarters,\n\tmonth: addMonths,\n\tweek: addWeeks,\n\tday: addDays,\n\thour: addHours,\n\tminute: addMinutes,\n};\n\n/**\n * Calculates the difference between two dates in units\n * @param {string} unit - the minimal unit of the current scale (\"hour\"-\"year\")\n * @param {Date} next - a later date\n * @param {Date} prev - an earlier date\n * @param {boolean} precise - current precision setting of the scales (if true, diff will be counted for smallerCount)\n * @param {boolean} wt - shows that diff will be counted for the width of a task\n * @returns {number} - an int (if precise is false) or a float number\n */\nfunction innerDiff(unit, next, prev, precise, wt) {\n\tconst minUnit = precise ? smallerCount[unit][0] : unit;\n\n\tlet start = prev;\n\tlet end = next;\n\tif (wt) {\n\t\tstart = getUnitStart(minUnit, prev);\n\t\tend = getUnitStart(minUnit, next);\n\t\tif (end < next) end = addUnit(minUnit)(end, 1);\n\t}\n\n\tif (precise) {\n\t\tlet filled = diff[minUnit](end, start);\n\t\tconst all = smallerCount[unit][1];\n\t\treturn filled / (typeof all === \"number\" ? all : all(prev));\n\t} else {\n\t\treturn diff[minUnit](end, start);\n\t}\n}\n\n/**\n * Returns a function for calculating the difference between two dates in units\n * @param {string} unit - the minimal unit of the current scale (\"hour\"-\"year\")\n * @returns {function} - details below\n */\nexport function getDiff(unit) {\n\t/**\n\t * the returned function calculates the difference between two dates based on passed parameters\n\t * @param {Date} next - first date\n\t * @param {Date} prev - second date\n\t * @param {boolean} precise false by default, true when used to count x-position\n\t * and width of tasks with 'step-1' precision\n\t * @param {boolean} wt - marker that diff is used to count width of a task;\n\t * if diff returns 0, you have to add 1; otherwise tasks that are within 1 unit will have 0 width\n\t * and will be displayed incorrectly\n\t * @returns {number} - the difference between two dates in 'units'; if 'precise' is true, the number is float, otherwise int\n\t */\n\treturn (next, prev, precise, wt) => {\n\t\tif (unit === \"month\" && precise) {\n\t\t\treturn getMonthDayDiff(next, prev, wt);\n\t\t} else {\n\t\t\treturn innerDiff(unit, next, prev, precise, wt);\n\t\t}\n\t};\n}\n\n/**\n * Calculates the difference in months between two days for a scale with precision setting\n * This is a specific case of diff counting, because a month can have 28-31 days\n * @param {*} end - a later date\n * @param {*} start - an earlier date\n * @param {*} wt - shows that diff will be counted for the width of a task\n * @returns {number} - a float number\n */\nfunction getMonthDayDiff(end, start, wt) {\n\tif (sameMonth(start, end)) {\n\t\treturn innerDiff(\"month\", end, start, true, wt);\n\t}\n\n\t// if starts not on 1st day\n\tlet daysOfFirstMonth = 0;\n\tif (start.getDate() > 1) {\n\t\tconst me = new Date(start.getFullYear(), start.getMonth() + 1, 1);\n\t\tdaysOfFirstMonth = innerDiff(\"month\", me, start, true);\n\t\tstart = me;\n\t}\n\n\t// if lasts 1+ whole months\n\tlet months = 0;\n\tif (!sameMonth(start, end)) {\n\t\tmonths = innerDiff(\"month\", webix.Date.monthStart(end), start); // int part\n\t\tstart = webix.Date.add(start, months, \"month\", true);\n\t}\n\n\t// all above plus days of last month if any\n\treturn daysOfFirstMonth + months + innerDiff(\"month\", end, start, true);\n}\n\nfunction sameMonth(a, b) {\n\treturn webix.Date.equal(webix.Date.monthStart(a), webix.Date.monthStart(b));\n}\n\nexport function addUnit(unit) {\n\treturn add[unit];\n}\n\nexport function getUnitStart(unit, start) {\n\tlet t;\n\tswitch (unit) {\n\t\tcase \"year\":\n\t\t\treturn new Date(start.getFullYear(), 0, 1);\n\t\tcase \"quarter\":\n\t\t\treturn new Date(\n\t\t\t\tstart.getFullYear(),\n\t\t\t\tMath.floor(start.getMonth() / 3) * 3,\n\t\t\t\t1\n\t\t\t);\n\t\tcase \"month\":\n\t\t\treturn new Date(start.getFullYear(), start.getMonth(), 1);\n\t\tcase \"week\":\n\t\t\tt = new Date(start.getFullYear(), start.getMonth(), start.getDate());\n\t\t\tt.setDate(start.getDate() - start.getDay());\n\t\t\treturn t;\n\t\tcase \"day\":\n\t\t\tt = new Date(start.getFullYear(), start.getMonth(), start.getDate());\n\t\t\tt.setHours(0, 0, 0, 0);\n\t\t\treturn t;\n\t\tcase \"hour\":\n\t\t\tt = new Date(start.getFullYear(), start.getMonth(), start.getDate());\n\t\t\tt.setHours(start.getHours(), 0, 0, 0);\n\t\t\treturn t;\n\t\tdefault:\n\t\t\treturn new Date(start);\n\t}\n}\n\nexport { format, formatFunction, smallerCount };\n","import { getUnitStart, addUnit, getDiff, format, formatFunction } from \"./time\";\n\nfunction getMinUnit(scales) {\n\tconst start = new Date();\n\treturn scales\n\t\t.map(item => ({ item, len: addUnit(item.unit)(start, 1) }))\n\t\t.sort((a, b) => (a.len < b.len ? -1 : 1))[0].item.unit;\n}\n\nexport function resetScales(start, end, precise, width, height, scales) {\n\t// console.log(\"[x] reset scales\");\n\n\tconst minUnit = getMinUnit(scales);\n\tconst diff = getDiff(minUnit);\n\n\tconst tempEnd = getUnitStart(minUnit, end);\n\tstart = getUnitStart(minUnit, start);\n\tend = tempEnd < end ? addUnit(minUnit)(tempEnd, 1) : tempEnd;\n\n\tconst fullWidth = diff(end, start) * width;\n\tconst fullHeight = height * scales.length;\n\n\tconst rows = scales.map(line => {\n\t\tconst cells = [];\n\t\tconst add = addUnit(line.unit);\n\t\tconst step = line.step || 1;\n\t\tconst countInWeeks = minUnit === \"week\" && line.unit !== \"week\";\n\n\t\tlet date = getUnitStart(line.unit, start);\n\t\twhile (date < end) {\n\t\t\tlet next = add(date, step);\n\n\t\t\tif (date < start) date = start;\n\t\t\tif (next > end) next = end;\n\n\t\t\t/**\n\t\t\t * Special handling for counting width of greater units in weeks\n\t\t\t * this code decides whether a week belongs to the current greater unit based on weekdays of this unit boundaries\n\t\t\t * if start day is Thursday+, then this greater unit should not count this week as its own\n\t\t\t * if end day is Thursday+, then this greater unit should count this week as its own\n\t\t\t */\n\t\t\tlet cdate = date;\n\t\t\tlet cnext = next;\n\t\t\tif (countInWeeks) {\n\t\t\t\tif (date.getDay() > 3) {\n\t\t\t\t\tcdate = webix.Date.add(date, 1, \"week\", true);\n\t\t\t\t}\n\t\t\t\tif (next.getDay() > 3) {\n\t\t\t\t\tcnext = webix.Date.add(next, 1, \"week\", true);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst cellWidth = (diff(cnext, cdate) || 1) * width;\n\n\t\t\t/*[ToDo] suggestion\n\t\t\t value must not be formatted within engine as it depends on app locale\n\t\t\t use scales.format function to format dates in UI\n\t\t\t*/\n\n\t\t\tconst value =\n\t\t\t\ttypeof line.format === \"function\"\n\t\t\t\t\t? line.format(date, next)\n\t\t\t\t\t: format(date, line.format);\n\n\t\t\tlet css = \"\";\n\t\t\tif (line.css)\n\t\t\t\tcss += typeof line.css === \"function\" ? line.css(date) : line.css;\n\n\t\t\tcells.push({\n\t\t\t\twidth: cellWidth,\n\t\t\t\tvalue,\n\t\t\t\tcss,\n\t\t\t\tdate,\n\t\t\t\tformat: formatFunction(line.format),\n\t\t\t});\n\n\t\t\tdate = next;\n\t\t}\n\n\t\treturn { cells, add, height, type: line.unit, step: line.step || 1 };\n\t});\n\n\tprecise = !!(minUnit === \"day\" ? precise : precise != false);\n\n\treturn {\n\t\trows,\n\t\twidth: fullWidth,\n\t\theight: fullHeight,\n\t\tcellWidth: width,\n\t\tcellHeight: height,\n\t\tdiff,\n\t\tstart,\n\t\tend,\n\t\tminUnit,\n\t\tprecise,\n\t};\n}\n\nexport function grid(width, height, color) {\n\tconst canvas = document.createElement(\"canvas\");\n\tcanvas.setAttribute(\"width\", width);\n\tcanvas.setAttribute(\"height\", height);\n\n\tconst ctx = canvas.getContext(\"2d\");\n\tctx.strokeStyle = color;\n\tctx.moveTo(0, height);\n\tctx.lineTo(width, height);\n\tctx.lineTo(width, 0);\n\tctx.stroke();\n\n\treturn canvas.toDataURL();\n}\n","function updateDragPos(e, pos) {\n\tif (webix.DragControl.active) {\n\t\tconst node = webix.DragControl.getNode();\n\n\t\tpos = webix.copy(pos);\n\t\twebix.DragControl.$dragPos(pos, e);\n\n\t\tnode.style.top = pos.y + webix.DragControl.top + \"px\";\n\t\tnode.style.left = pos.x + webix.DragControl.left + \"px\";\n\t}\n}\n\nconst DragScroll = {\n\tstart(ctx, e) {\n\t\tctx._auto_scroll_delay = webix.delay(\n\t\t\tDragScroll.autoScroll,\n\t\t\tctx,\n\t\t\t[e, webix.html.pos(e)],\n\t\t\t250\n\t\t);\n\t},\n\n\treset(ctx) {\n\t\tif (ctx._auto_scroll_delay)\n\t\t\tctx._auto_scroll_delay = window.clearTimeout(ctx._auto_scroll_delay);\n\t},\n\n\tautoScroll(e, pos) {\n\t\tconst yScroll = this.direction.indexOf(\"y\") !== -1;\n\t\tconst xScroll = this.direction.indexOf(\"x\") !== -1;\n\t\tconst box = webix.html.offset(this.from.$view);\n\n\t\tlet reset = false;\n\t\tif (yScroll && DragScroll.autoYScroll.call(this, pos, box, this.senseY))\n\t\t\treset = true;\n\t\tif (xScroll && DragScroll.autoXScroll.call(this, pos, box, this.senseX))\n\t\t\treset = true;\n\n\t\tif (reset) {\n\t\t\tupdateDragPos(e, pos);\n\t\t\tthis._auto_scroll_delay = webix.delay(\n\t\t\t\tDragScroll.autoScroll,\n\t\t\t\tthis,\n\t\t\t\t[e, pos],\n\t\t\t\t100\n\t\t\t);\n\t\t}\n\t},\n\n\tautoYScroll(pos, box, sense) {\n\t\tconst scroll = this.from.getScrollState();\n\n\t\tif (pos.y < box.y + sense) {\n\t\t\treturn DragScroll.autoScrollTo.call(\n\t\t\t\tthis,\n\t\t\t\tscroll.x,\n\t\t\t\tscroll.y - sense,\n\t\t\t\t\"y\"\n\t\t\t);\n\t\t} else if (pos.y > box.y + box.height - sense) {\n\t\t\treturn DragScroll.autoScrollTo.call(\n\t\t\t\tthis,\n\t\t\t\tscroll.x,\n\t\t\t\tscroll.y + sense,\n\t\t\t\t\"y\"\n\t\t\t);\n\t\t}\n\t\treturn false;\n\t},\n\n\tautoXScroll(pos, box, sense) {\n\t\tconst scroll = this.from.getScrollState();\n\n\t\tif (pos.x < box.x + sense) {\n\t\t\treturn DragScroll.autoScrollTo.call(\n\t\t\t\tthis,\n\t\t\t\tscroll.x - sense,\n\t\t\t\tscroll.y,\n\t\t\t\t\"x\"\n\t\t\t);\n\t\t} else if (pos.x > box.x + box.width - sense) {\n\t\t\treturn DragScroll.autoScrollTo.call(\n\t\t\t\tthis,\n\t\t\t\tscroll.x + sense,\n\t\t\t\tscroll.y,\n\t\t\t\t\"x\"\n\t\t\t);\n\t\t}\n\t\treturn false;\n\t},\n\n\tautoScrollTo(x, y, mode) {\n\t\tthis.from.scrollTo(x, y);\n\t\tthis.from.callEvent(\"onAfterAutoScroll\", []);\n\n\t\tconst scroll = this.from.getScrollState();\n\t\treturn Math.abs((mode === \"x\" ? x : y) - scroll[mode]) < 1;\n\t},\n};\n\nexport default DragScroll;\n","import { getDiff, addUnit, getUnitStart } from \"./time\";\n\nexport function updateTask(t, i, scales, taskHeight) {\n\tconst { start, end, cellWidth, cellHeight, diff, minUnit, precise } = scales;\n\n\tconst startDate = t.start_date < start ? start : t.start_date;\n\tconst endDate = t.end_date > end ? end : t.end_date;\n\tconst ms = t.type == \"milestone\";\n\n\tconst astart = getUnitStart(minUnit, start);\n\n\tt.$h = taskHeight;\n\tt.$x =\n\t\tMath.round(diff(startDate, astart, precise) * cellWidth) -\n\t\t(ms ? t.$h / 2 : 0);\n\tt.$w = ms\n\t\t? t.$h\n\t\t: Math.round(diff(endDate, startDate, precise, true) * cellWidth);\n\tt.$y = cellHeight * i + (cellHeight - taskHeight) / 2;\n\n\treturn t;\n}\n\nexport function updateTaskDuration(t) {\n\tif (\n\t\tt.start_date &&\n\t\tt.end_date &&\n\t\tt.start_date.valueOf() >= t.end_date.valueOf()\n\t) {\n\t\tt.end_date = null;\n\t\tt.duration = 1;\n\t}\n\tif (t.type == \"milestone\") {\n\t\tt.end_date = t.start_date;\n\t\tt.duration = 0;\n\t} else {\n\t\t//allow float duration for tasks smaller than day\n\t\tif (!t.duration) {\n\t\t\tconst d = getDiff(\"day\")(t.end_date, t.start_date, true);\n\t\t\tt.duration = d > 1 ? Math.floor(d) : parseFloat(d.toFixed(2));\n\t\t}\n\t\tif (!t.end_date) {\n\t\t\tif (t.duration < 1)\n\t\t\t\tt.end_date = addUnit(\"hour\")(t.start_date, Math.floor(24 * t.duration));\n\t\t\telse t.end_date = addUnit(\"day\")(t.start_date, t.duration);\n\t\t}\n\t}\n}\n\n// \tconst out = [].concat(tasks);\n// \tconst max = out.length;\n// \tlet rIndex = 0;\n// \tfor (var i = 0; i < max; i++) {\n// \t\tconst t = out[i];\n// \t\tupdater(t, rIndex++);\n// \t\tout[i] = { ...t };\n\n// \t\t// ignore closed branches\n// \t\tif (t.$skip) i += t.$skip;\n// \t}\n\n// \treturn out;\n// }\n\n// export function taskUpdate(self, t, i) {\n// \tconst upd = self.$updater(t, i);\n// \tt.duration = differenceInDays(t.end, t.start);\n// }\n\n// export function taskInit(t) {\n// \tif (!t.duration) t.duration = differenceInDays(t.end, t.start);\n// \tif (!t.end) t.end = addDays(t.start, t.duration);\n// }\n","const delta = 20;\n\nexport const updateLink = function(link, startTask, endTask, height) {\n\tconst dy = Math.round(height / 2);\n\n\tif (!startTask || !endTask) {\n\t\tlink.$p = \"\";\n\t\treturn link;\n\t}\n\n\tlet sx, sy, ex, ey;\n\tlet s_start = false;\n\tlet e_start = false;\n\n\tswitch (link.type) {\n\t\tcase 0:\n\t\t\te_start = true;\n\t\t\tbreak;\n\n\t\tcase 1:\n\t\t\ts_start = true;\n\t\t\te_start = true;\n\t\t\tbreak;\n\n\t\tcase 3:\n\t\t\ts_start = true;\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\n\tsx = s_start ? startTask.$x : startTask.$x + startTask.$w;\n\tsy = s_start ? startTask.$y : startTask.$y;\n\tex = e_start ? endTask.$x : endTask.$x + endTask.$w;\n\tey = e_start ? endTask.$y : endTask.$y;\n\n\tif (sx !== ex || sy !== ey) {\n\t\tconst lineCoords = getLineCoords(\n\t\t\tsx,\n\t\t\tsy + dy,\n\t\t\tex,\n\t\t\tey + dy,\n\t\t\ts_start,\n\t\t\te_start,\n\t\t\t38 / 2\n\t\t);\n\n\t\tconst arrowCoords = getArrowCoords(ex, ey + dy, e_start);\n\t\tlink.$p = `${lineCoords},${arrowCoords}`;\n\t}\n\n\treturn link;\n};\n\nfunction getLineCoords(sx, sy, ex, ey, s_start, e_start, gapp) {\n\tconst shift = delta * (s_start ? -1 : 1);\n\tconst backshift = delta * (e_start ? -1 : 1);\n\n\tconst sx1 = sx + shift;\n\tconst ex1 = ex + backshift;\n\tconst line = [sx, sy, sx1, sy, 0, 0, 0, 0, ex1, ey, ex, ey];\n\n\tconst dx = ex1 - sx1;\n\tlet dy = ey - sy;\n\n\tconst same = e_start === s_start;\n\tif (!same) {\n\t\tif ((ex1 <= sx && e_start) || (ex1 > sx && !e_start)) {\n\t\t\tdy -= gapp;\n\t\t}\n\t}\n\n\tif ((same && e_start && sx1 > ex1) || (same && !e_start && sx1 < ex1)) {\n\t\tline[4] = line[2] + dx;\n\t\tline[5] = line[3];\n\t\tline[6] = line[4];\n\t\tline[7] = line[5] + dy;\n\t} else {\n\t\tline[4] = line[2];\n\t\tline[5] = line[3] + dy;\n\t\tline[6] = line[4] + dx;\n\t\tline[7] = line[5];\n\t}\n\n\treturn line.join(\",\");\n}\n\nfunction getArrowCoords(x, y, start) {\n\tif (start) {\n\t\treturn `${x - 5},${y - 3},${x - 5},${y + 3},${x},${y}`;\n\t} else {\n\t\treturn `${x + 5},${y + 3},${x + 5},${y - 3},${x},${y}`;\n\t}\n}\n\nexport function newLink(box, start, end) {\n\tif (start && end) {\n\t\tconst width = end.x - start.x;\n\t\tconst height = end.y - start.y;\n\t\tconst left = (width > 0 ? start.x : end.x) - box.left;\n\t\tconst top = (height > 0 ? start.y : end.y) - box.top;\n\t\tconst p = `${width > 0 ? 0 : -width},${height > 0 ? 0 : -height},${\n\t\t\twidth > 0 ? width : 0\n\t\t},${height > 0 ? height : 0}`;\n\t\treturn { width: Math.abs(width), height: Math.abs(height), left, top, p };\n\t} else {\n\t\treturn null;\n\t}\n}\n","import DragScroll from \"./dragscroll\";\nimport { smallerCount } from \"../libs/gantt\";\n\nexport function initDnD(view) {\n\tconst ctrl = webix.copy(DragControl);\n\n\tctrl.view = view;\n\tctrl.master = this;\n\n\tctrl.Local = this.app.getService(\"local\");\n\n\twebix.DragControl.addDrag(view.$view, ctrl);\n\twebix.DragControl.addDrop(view.$view, ctrl, true);\n}\n\nexport function switchCursor(e, view) {\n\tif (webix.DragControl.active) return;\n\n\tconst id = webix.html.locate(e, \"webix_l_id\");\n\tif (id && view.getItem(id).type == \"task\") {\n\t\tconst node = view.getItemNode(id);\n\t\tconst mode = getMoveMode(node, e.clientX);\n\t\tnode.style.cursor = mode == \"move\" ? \"pointer\" : \"ew-resize\";\n\t}\n}\n\nfunction getMoveMode(node, x) {\n\tconst rect = node.getBoundingClientRect();\n\tconst p = (x - rect.left) / rect.width;\n\tconst minWidth = webix.env.touch ? 400 : 200;\n\tconst delta = 0.2 / (rect.width > minWidth ? rect.width / minWidth : 1);\n\n\tif (p < delta) return \"start\";\n\tif (p > 1 - delta) return \"end\";\n\treturn \"move\";\n}\n\nfunction updateDragScrollConfig(ds) {\n\tconst scales = this.Local.getScales();\n\tds.senseX = Math.round(scales.cellWidth * (webix.env.touch ? 1 : 0.5));\n\tds.senseY = Math.round(scales.cellHeight * (webix.env.touch ? 3 : 1));\n\treturn ds;\n}\n\nfunction isProgressDrag(t, node) {\n\twhile (t != node) {\n\t\tif (t.classList.contains(\"webix_gantt_progress_drag\")) return true;\n\t\tt = t.parentNode;\n\t}\n\treturn false;\n}\n\nconst DragControl = {\n\t$longTouchLimit: true,\n\t$dragCreate: function(t, e) {\n\t\tif (this.master.State.readonly) return false;\n\n\t\tconst id = this.locateEvent(e);\n\t\tif (id) {\n\t\t\tconst ctx = this.getContext();\n\t\t\tconst target = e.target;\n\n\t\t\tif (target.classList.contains(\"webix_gantt_link\")) {\n\t\t\t\tctx.mode = \"links\";\n\t\t\t\treturn Modes[ctx.mode].$dragCreate.call(this, t, e, id);\n\t\t\t}\n\n\t\t\tconst node = this.view.getItemNode(id);\n\t\t\tif (!webix.env.touch && isProgressDrag(target, node)) {\n\t\t\t\tctx.mode = \"progress\";\n\t\t\t\treturn Modes[ctx.mode].$dragCreate.call(this, t, e, id);\n\t\t\t}\n\n\t\t\tconst scroll = this.view.getScrollState();\n\t\t\tconst evContext = this.getEventContext(e);\n\n\t\t\tlet mode = getMoveMode(node, evContext.x);\n\t\t\tif (\n\t\t\t\tthis.view.getItem(id).type != \"task\" &&\n\t\t\t\t(mode == \"start\" || mode == \"end\")\n\t\t\t)\n\t\t\t\tmode = \"move\";\n\n\t\t\tconst scales = this.Local.getScales();\n\t\t\tlet step = scales.cellWidth;\n\t\t\tif (scales.precise) {\n\t\t\t\tconst nsc = smallerCount[scales.minUnit][1];\n\t\t\t\tstep = Math.round(step / (typeof nsc === \"number\" ? nsc : nsc()));\n\t\t\t}\n\n\t\t\twebix.extend(\n\t\t\t\tctx,\n\t\t\t\t{\n\t\t\t\t\tid,\n\t\t\t\t\tmode,\n\t\t\t\t\tnode,\n\t\t\t\t\tstep,\n\t\t\t\t\tdx: 0,\n\t\t\t\t\tfrom: this.view,\n\t\t\t\t\tx: evContext.x,\n\t\t\t\t\tscroll: scroll,\n\t\t\t\t\tt: parseInt(node.style.top),\n\t\t\t\t\tl: parseInt(node.style.left),\n\t\t\t\t\tw: parseInt(node.style.width),\n\t\t\t\t},\n\t\t\t\ttrue\n\t\t\t);\n\n\t\t\tif (Modes[ctx.mode].dragScroll)\n\t\t\t\twebix.extend(\n\t\t\t\t\tctx,\n\t\t\t\t\tupdateDragScrollConfig.call(this, Modes[ctx.mode].dragScroll)\n\t\t\t\t);\n\n\t\t\tconst html = node.cloneNode(true);\n\t\t\thtml.className += \" webix_drag_zone webix_gantt_mode_\" + mode;\n\n\t\t\tnode.style.visibility = \"hidden\";\n\t\t\twebix.html.addCss(t, \"webix_gantt_in_action\", true);\n\n\t\t\tt.style.cursor = mode == \"move\" ? \"move\" : \"ew-resize\";\n\t\t\tt.querySelector(\".webix_scroll_cont\").appendChild(html);\n\t\t\treturn html;\n\t\t}\n\t\treturn false;\n\t},\n\t$dragDestroy: function(t, node) {\n\t\tconst ctx = this.getContext();\n\n\t\tif (Modes[ctx.mode].dragScroll) DragScroll.reset(ctx);\n\n\t\tif (ctx.mode && Modes[ctx.mode].$dragDestroy)\n\t\t\treturn Modes[ctx.mode].$dragDestroy.call(this, t, node);\n\n\t\tif (ctx.$waitUpdate) {\n\t\t\tctx.$waitUpdate.catch(() => {\n\t\t\t\tthis.master.Action({ action: \"update-task-time\", id: ctx.id });\n\t\t\t});\n\t\t} else\n\t\t\tctx.$waitUpdate = this.master.Action({\n\t\t\t\taction: \"update-task-time\",\n\t\t\t\tid: ctx.id,\n\t\t\t});\n\n\t\tctx.$waitUpdate.finally(() => {\n\t\t\tctx.node.style.visibility = \"\";\n\t\t\twebix.html.remove(node);\n\t\t});\n\n\t\tt.style.cursor = \"\";\n\t\twebix.html.removeCss(t, \"webix_gantt_in_action\");\n\t\treturn false;\n\t},\n\t$dragIn: function(s, t, e) {\n\t\tconst ctx = this.getContext();\n\t\tif (!ctx.mode) return false;\n\n\t\tif (Modes[ctx.mode].dragScroll) {\n\t\t\tDragScroll.reset(ctx);\n\t\t\tDragScroll.start(ctx, e);\n\t\t}\n\n\t\tif (Modes[ctx.mode].$dragIn)\n\t\t\treturn Modes[ctx.mode].$dragIn.call(this, s, t, e);\n\t\treturn true;\n\t},\n\t$dragPos: function(pos) {\n\t\tconst ctx = this.getContext();\n\t\treturn Modes[ctx.mode].$dragPos.call(this, pos);\n\t},\n\t$dragOut: function(s, t, n, e) {\n\t\tconst ctx = this.getContext();\n\t\tif (Modes[ctx.mode].$dragOut)\n\t\t\treturn Modes[ctx.mode].$dragOut.call(this, s, t, n, e);\n\t\treturn null;\n\t},\n\t$drop: function(s, t, e) {\n\t\tconst ctx = this.getContext();\n\t\tif (!ctx.mode) return false;\n\n\t\tif (Modes[ctx.mode].$drop) return Modes[ctx.mode].$drop.call(this, s, t, e);\n\n\t\tconst { id, mode, dx, step } = ctx;\n\t\tconst time = Math.round(dx / step);\n\n\t\tctx[\"$waitUpdate\"] = this.master.Action({\n\t\t\taction: \"update-task-time\",\n\t\t\tmode,\n\t\t\ttime,\n\t\t\tid,\n\t\t});\n\t},\n\tlocateEvent: function(ev, context) {\n\t\tif (webix.env.touch && context) {\n\t\t\tev = document.elementFromPoint(context.x, context.y);\n\t\t}\n\t\treturn webix.html.locate(ev, \"webix_l_id\");\n\t},\n\tgetEventContext: function(e) {\n\t\tif (webix.env.touch) {\n\t\t\tif (e.changedTouches && !(e.touches && e.touches[0])) {\n\t\t\t\tconst t = e.changedTouches[0];\n\t\t\t\treturn { x: t.pageX, y: t.pageY };\n\t\t\t}\n\t\t\treturn e.time ? e : webix.env.mouse.context(e);\n\t\t}\n\t\treturn { x: e.clientX, y: e.clientY };\n\t},\n\tgetContext: function() {\n\t\treturn webix.DragControl.getContext();\n\t},\n\tsetDragOffset: function(node, target, e) {\n\t\tconst ctx = this.getContext();\n\t\tconst pos = webix.html.pos(e);\n\t\tconst offset = webix.html.offset(node);\n\n\t\tctx.width = offset.width;\n\t\tctx.height = offset.height;\n\t\tctx.x_offset = offset.x - pos.x;\n\t\tctx.y_offset = offset.y - pos.y;\n\t},\n};\n\nconst links = {\n\tdragScroll: {\n\t\tdirection: \"xy\",\n\t},\n\t$dragCreate: function(t, e, id) {\n\t\tconst ctx = this.getContext();\n\t\tconst link = e.target;\n\t\tconst node = this.view.getItemNode(id);\n\t\tconst scroll = this.view.getScrollState();\n\t\tconst offset = webix.html.offset(link);\n\t\tconst css = link.classList;\n\n\t\twebix.extend(\n\t\t\tctx,\n\t\t\t{\n\t\t\t\tid,\n\t\t\t\tfrom: this.view,\n\t\t\t\tnode,\n\t\t\t\tlink,\n\t\t\t\tfromStart: css.contains(\"webix_gantt_link_left\"),\n\t\t\t\tstart: {\n\t\t\t\t\tx: offset.x + offset.width / 2 + scroll.x,\n\t\t\t\t\ty: offset.y + offset.height / 2 + scroll.y,\n\t\t\t\t},\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\n\t\tif (Modes[ctx.mode].dragScroll)\n\t\t\twebix.extend(\n\t\t\t\tctx,\n\t\t\t\tupdateDragScrollConfig.call(this, Modes[ctx.mode].dragScroll)\n\t\t\t);\n\n\t\tlink.style.opacity = 1;\n\t\twebix.html.addCss(node, \"webix_gantt_task_in_action\", true);\n\n\t\tconst html = webix.html.create(\"div\", { visibility: \"hidden\" });\n\t\tdocument.body.appendChild(html);\n\t\treturn html;\n\t},\n\t$dragDestroy: function(t, node) {\n\t\tconst ctx = this.getContext();\n\n\t\tthis.master.Action({ action: \"temp-link\" });\n\n\t\tif (ctx.target) {\n\t\t\tconst node = this.view.getItemNode(ctx.target);\n\t\t\twebix.html.removeCss(node, \"webix_gantt_link_visible\");\n\t\t}\n\n\t\tctx.link.style.opacity = \"\";\n\t\twebix.html.removeCss(ctx.node, \"webix_gantt_task_in_action\");\n\t\twebix.html.remove(node);\n\n\t\treturn false;\n\t},\n\t$dragIn: function(s, t, e) {\n\t\tconst ctx = this.getContext();\n\t\tconst evContext = this.getEventContext(e);\n\t\tconst id = this.locateEvent(e, evContext);\n\n\t\tif (!id) return false;\n\n\t\tconst node = this.view.getItemNode(id);\n\t\tif (id != ctx.target) {\n\t\t\twebix.html.addCss(node, \"webix_gantt_link_visible\", true);\n\t\t\tctx.target = id;\n\t\t}\n\t\treturn node;\n\t},\n\t$dragPos: function(pos) {\n\t\tconst ctx = this.getContext();\n\t\tconst nscroll = this.view.getScrollState();\n\n\t\tctx.end = {\n\t\t\tx: pos.x + nscroll.x,\n\t\t\ty: pos.y + nscroll.y,\n\t\t};\n\n\t\tthis.master.Action({ action: \"temp-link\", start: ctx.start, end: ctx.end });\n\t},\n\t$dragOut: function(s, t, n, e) {\n\t\tconst ctx = this.getContext();\n\t\tconst evContext = this.getEventContext(e);\n\t\tconst id = this.locateEvent(e, evContext);\n\n\t\tif (ctx.target && id != ctx.target) {\n\t\t\tconst node = this.view.getItemNode(ctx.target);\n\t\t\twebix.html.removeCss(node, \"webix_gantt_link_visible\");\n\t\t\tctx.target = null;\n\t\t}\n\t\treturn null;\n\t},\n\t$drop: function(s, t, e) {\n\t\tconst ctx = this.getContext();\n\t\tconst source = ctx.id;\n\t\tconst evContext = this.getEventContext(e);\n\t\tconst target = this.locateEvent(e, evContext);\n\n\t\tif (!target || source == target) return false;\n\n\t\tconst node = this.view.getItemNode(target);\n\t\tconst rect = node.getBoundingClientRect();\n\t\tconst toStart = evContext.x - rect.left < rect.width / 2;\n\n\t\tconst type = (ctx.fromStart ? 1 : 0) + (toStart ? 0 : 2);\n\t\tthis.master.Action({ action: \"add-link\", source, target, type });\n\t},\n};\n\nconst resize = {\n\t$dragPos: function(pos) {\n\t\tconst ctx = this.getContext();\n\t\tconst nscroll = this.view.getScrollState();\n\t\tconst node = webix.DragControl.getNode();\n\t\tconst { mode, l, t, w, x, id, scroll, step } = ctx;\n\t\tconst dx = (ctx.dx = pos.x - x - scroll.x + nscroll.x);\n\n\t\tif (mode === \"start\") {\n\t\t\tpos.x = Math.min(l + dx, l + w - step);\n\t\t\tnode.style.width = `${Math.max(w - dx, step)}px`;\n\t\t} else if (mode === \"end\") {\n\t\t\tpos.x = l;\n\t\t\tnode.style.width = `${Math.max(w + dx, step)}px`;\n\t\t}\n\t\tpos.y = t;\n\n\t\tthis.master.Action({\n\t\t\taction: \"drag-task\",\n\t\t\tid,\n\t\t\tleft: pos.x,\n\t\t\twidth: parseInt(node.style.width),\n\t\t});\n\t},\n};\n\nconst move = {\n\tdragScroll: {\n\t\tdirection: \"x\",\n\t},\n\t$dragPos: function(pos) {\n\t\tconst ctx = this.getContext();\n\t\tconst { node, l, t, x, id, scroll } = ctx;\n\t\tconst nscroll = this.view.getScrollState();\n\t\tconst dx = (ctx.dx = pos.x - x - scroll.x + nscroll.x);\n\n\t\tpos.x = l + dx;\n\t\tpos.y = t;\n\n\t\tthis.master.Action({\n\t\t\taction: \"drag-task\",\n\t\t\tid,\n\t\t\tleft: pos.x,\n\t\t\twidth: parseInt(node.style.width),\n\t\t});\n\t},\n};\n\nconst progress = {\n\t$dragCreate: function(t, e, id) {\n\t\tconst ctx = this.getContext();\n\t\tconst node = this.view.getItemNode(id);\n\t\tconst prevProgress = this.view.getItem(id).progress;\n\t\tconst progressNode = node.querySelector(\".webix_gantt_progress\");\n\t\tconst evContext = this.getEventContext(e);\n\t\tconst scroll = this.view.getScrollState();\n\n\t\twebix.extend(\n\t\t\tctx,\n\t\t\t{\n\t\t\t\tid,\n\t\t\t\tnode,\n\t\t\t\tprevProgress,\n\t\t\t\tprogressNode,\n\t\t\t\tfrom: this.view,\n\t\t\t\tx: evContext.x,\n\t\t\t\tw: parseInt(node.style.width),\n\t\t\t\tscroll,\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\n\t\tt.style.cursor = \"ew-resize\";\n\t\twebix.html.addCss(t, \"webix_gantt_in_action\", true);\n\t\twebix.html.addCss(node, \"webix_gantt_mode_progress\", true);\n\n\t\tconst html = webix.html.create(\"div\", { visibility: \"hidden\" });\n\t\tdocument.body.appendChild(html);\n\t\treturn html;\n\t},\n\t$dragPos: function(pos) {\n\t\tconst ctx = this.getContext();\n\t\tconst { x, scroll, w } = ctx;\n\t\tconst nscroll = this.view.getScrollState();\n\n\t\tconst dx = pos.x - x - scroll.x + nscroll.x;\n\t\tconst progress = Math.min(\n\t\t\tMath.max(ctx.prevProgress + Math.round((dx * 100) / w), 0),\n\t\t\t100\n\t\t);\n\n\t\tif (ctx.progress != progress) {\n\t\t\tctx.progress = progress;\n\t\t\tModes[ctx.mode].updateTaskTemplate.call(this, ctx, progress);\n\t\t}\n\t},\n\t$drop: function() {\n\t\tconst ctx = this.getContext();\n\t\tconst { id, progress, prevProgress } = ctx;\n\n\t\tif (!webix.isUndefined(progress) && progress != prevProgress)\n\t\t\tctx[\"$waitUpdate\"] = this.master.Action({\n\t\t\t\taction: \"update-task-progress\",\n\t\t\t\tprogress,\n\t\t\t\tid,\n\t\t\t});\n\t},\n\t$dragDestroy: function(t, node) {\n\t\tconst ctx = this.getContext();\n\n\t\tif (ctx.$waitUpdate) {\n\t\t\tctx.$waitUpdate.catch(() => {\n\t\t\t\tthis.master.Action({ action: \"update-task-progress\", id: ctx.id });\n\t\t\t});\n\t\t} else\n\t\t\tctx.$waitUpdate = this.master.Action({\n\t\t\t\taction: \"update-task-progress\",\n\t\t\t\tid: ctx.id,\n\t\t\t});\n\n\t\tt.style.cursor = \"\";\n\t\twebix.html.removeCss(t, \"webix_gantt_in_action\");\n\t\twebix.html.removeCss(ctx.node, \"webix_gantt_mode_progress\");\n\n\t\twebix.html.remove(node);\n\t\treturn false;\n\t},\n\tupdateTaskTemplate(ctx, progress) {\n\t\tconst node = ctx.progressNode;\n\t\tnode.style.width = progress + \"%\";\n\t\tnode.innerHTML = this.master.DragProgressTemplate(progress);\n\t},\n};\n\nconst Modes = {\n\tlinks,\n\tmove,\n\tprogress,\n\tstart: resize,\n\tend: resize,\n};\n","import { JetView } from \"webix-jet\";\nimport { grid } from \"../../libs/gantt/scales\";\nimport { initDnD, switchCursor } from \"../../helpers/dnd\";\nimport { newLink, updateLink, getUnitStart } from \"../../libs/gantt\";\n\nexport default class BarsView extends JetView {\n\tconfig() {\n\t\tthis.State = this.getParam(\"state\", true);\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\treturn {\n\t\t\tview: \"abslayout\",\n\t\t\tcss: this.State.readonly ? \" webix_gantt_readonly\" : \"\",\n\t\t\tborderless: true,\n\t\t\tcells: [\n\t\t\t\t{\n\t\t\t\t\tview: \"template\",\n\t\t\t\t\tcss: \"webix_gantt_links\",\n\t\t\t\t\tborderless: true,\n\t\t\t\t\trelative: true,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"list\",\n\t\t\t\t\tborderless: true,\n\t\t\t\t\ttype: this.BarsType(_),\n\t\t\t\t\tcss: `webix_gantt${webix.env.touch ? \"_touch\" : \"\"}_bars`,\n\t\t\t\t\ton: {\n\t\t\t\t\t\tonItemClick: id => {\n\t\t\t\t\t\t\tthis.State.$batch({\n\t\t\t\t\t\t\t\tparent: null,\n\t\t\t\t\t\t\t\tselected: id,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\ttooltip: obj => this.GetTooltip(obj, _),\n\t\t\t\t\tscroll: \"xy\",\n\t\t\t\t\trelative: true,\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tinit(view) {\n\t\tconst [links, bars] = view.getChildViews();\n\t\tthis.Links = links;\n\t\tthis.Bars = bars;\n\n\t\tconst local = (this.Local = this.app.getService(\"local\"));\n\t\tconst scales = local.getScales();\n\t\tconst tdata = (this.TasksData = local.tasks());\n\t\tconst ldata = (this.LinksData = local.links().data);\n\n\t\tbars.sync(tdata);\n\t\tthis.RefreshLinks(ldata);\n\n\t\tthis.HandleScroll();\n\t\tthis.HandleDrag(scales);\n\t\tthis.HandleSelection(scales);\n\n\t\tthis.InitMarkers();\n\n\t\tthis.HandleHolidays(scales);\n\n\t\tthis.on(ldata, \"onStoreUpdated\", () => this.RefreshLinks(ldata));\n\t\tthis.on(this.app, \"onScalesUpdate\", scales => this.Resize(scales.width));\n\t\tthis.on(tdata.data, \"onStoreUpdated\", (id, data, action) => {\n\t\t\tthis.RefreshLinks(ldata);\n\t\t\tif (action !== \"update\") this.SetSelection();\n\t\t});\n\n\t\tview.$view.style.backgroundImage = `url(${grid(\n\t\t\tscales.cellWidth,\n\t\t\tscales.cellHeight,\n\t\t\twebix.skin.$name == \"contrast\" ? \"#808080\" : \"#ccc\"\n\t\t)})`;\n\t\tview.$view.style.marginTop = \"0px\";\n\t\tthis.Resize(scales.width);\n\t}\n\n\t/**\n\t * Returns a string with HTML of a task node content\n\t * @param {Object} obj - task data\n\t * @param {function} _ - the translator function of jet locale plugin, see https://webix.gitbook.io/webix-jet/part-ii-webix-jet-in-details/plugins#applying-the-locale\n\t * @returns {string}\n\t */\n\tBarsTemplate(obj, _) {\n\t\tconst text = obj.text || _(\"(no title)\");\n\t\treturn obj.type == \"milestone\" ? `<span>${text}</span>` : text;\n\t}\n\n\t/**\n\t * Returns all templates for bars\n\t * @param {function} _ - the translator function of jet locale plugin, see https://webix.gitbook.io/webix-jet/part-ii-webix-jet-in-details/plugins#applying-the-locale\n\t * @returns {Object} - all templates for bars\n\t */\n\tBarsType(_) {\n\t\treturn {\n\t\t\ttemplate: obj => this.BarsTemplate(obj, _),\n\t\t\ttemplateStart: task => {\n\t\t\t\tconst ms = task.type == \"milestone\";\n\t\t\t\tlet w = task.$w,\n\t\t\t\t\th = task.$h,\n\t\t\t\t\tdiff = 0,\n\t\t\t\t\tprogress = \"\";\n\n\t\t\t\tif (ms) {\n\t\t\t\t\tw = h = Math.ceil(Math.sqrt(Math.pow(task.$w, 2) / 2));\n\t\t\t\t\tdiff = Math.ceil((task.$w - w) / 2);\n\t\t\t\t} else {\n\t\t\t\t\tconst drag =\n\t\t\t\t\t\ttask.type == \"task\" ? this.DragProgressTemplate(task.progress) : \"\";\n\t\t\t\t\tprogress = `<div class=\"webix_gantt_progress\" style=\"width:${task.progress}%;\">${drag}</div>`;\n\t\t\t\t}\n\n\t\t\t\treturn `<div webix_l_id=\"${task.id}\" \n\t\t\t\t\tclass=\"webix_gantt_task_base webix_gantt_${task.type}\" \n\t\t\t\t\tstyle=\"left:${task.$x + diff}px;top:${task.$y +\n\t\t\t\t\tdiff}px;width:${w}px;height:${h}px;\" \n\t\t\t\t\tdata-id=\"${task.id}\">\n\t\t\t\t\t\t<div class=\"webix_gantt_link webix_gantt_link_left\"></div>\n\t\t\t\t\t\t${progress}\n\t\t\t\t\t\t<div class=\"webix_gantt_content\">`;\n\t\t\t},\n\t\t\ttemplateEnd: () =>\n\t\t\t\t`</div><div class=\"webix_gantt_link webix_gantt_link_right\"></div></div>`,\n\t\t};\n\t}\n\n\t/**\n\t * Returns a string with HTML of the progress drag marker\n\t * @param {number} progress - the progress of a task (number from 0 to 100)\n\t * @returns {string}\n\t */\n\tDragProgressTemplate(progress) {\n\t\treturn `<div class=\"webix_gantt_progress_drag\" style=\"left:${progress}%\">\n\t\t\t<span class=\"webix_gantt_progress_percent\">${progress}</span>\n\t\t</div>`;\n\t}\n\n\t/**\n\t * Extends the class with methods for DnD and handles cursor change for bars\n\t */\n\tHandleDrag() {\n\t\tinitDnD.call(this, this.Bars);\n\n\t\tif (!webix.env.touch)\n\t\t\tthis._mousemove_handler = webix.event(this.Bars.$view, \"mousemove\", e =>\n\t\t\t\tswitchCursor(e, this.Bars)\n\t\t\t);\n\t}\n\n\tdestroy() {\n\t\tthis._mousemove_handler = webix.eventRemove(this._mousemove_handler);\n\t\tthis._scroll_handler = webix.eventRemove(this._scroll_handler);\n\n\t\tif (this.Markers && this.Markers.length)\n\t\t\tfor (let i = 0; i < this.Markers.length; i++) {\n\t\t\t\tconst m = this.Markers[i];\n\t\t\t\tif (m.$interval) m.$interval = clearInterval(m.$interval);\n\t\t\t}\n\t}\n\n\t/**\n\t * Finds and returns the SVG element with all links or the temp link that is rendered while the user is linking two tasks\n\t * @param {Boolean} temp - if true, the method looks for the temp link\n\t * @returns {SVGElement}\n\t */\n\tGetLinks(temp) {\n\t\treturn this.Links.$view.querySelector(\n\t\t\t`.webix_gantt_${temp ? \"temp_line\" : \"lines\"}`\n\t\t);\n\t}\n\n\t/**\n\t * Handles scrolling\n\t */\n\tHandleScroll() {\n\t\tthis._scroll_handler = webix.event(this.Bars.$view, \"scroll\", ev => {\n\t\t\tconst bars = ev.target;\n\t\t\tconst top = Math.round(bars.scrollTop);\n\t\t\tconst left = Math.round(bars.scrollLeft);\n\n\t\t\tconst lines = this.GetLinks();\n\t\t\tconst temp = this.GetLinks(true);\n\t\t\tconst attrs = {\n\t\t\t\tviewBox: `${left} ${top} ${bars.scrollWidth} ${bars.scrollHeight}`,\n\t\t\t\twidth: bars.scrollWidth,\n\t\t\t\theight: bars.scrollHeight,\n\t\t\t};\n\n\t\t\tfor (let key in attrs) {\n\t\t\t\tlines.setAttribute(key, attrs[key]);\n\t\t\t\ttemp.setAttribute(key, attrs[key]);\n\t\t\t}\n\n\t\t\tthis.holidaysContainer.style.height = bars.scrollHeight + \"px\";\n\n\t\t\tif (this.containerForMarkers)\n\t\t\t\tthis.containerForMarkers.style.height = bars.scrollHeight + \"px\";\n\t\t\tthis.getRoot().$view.style.backgroundPosition = `-${left}px -${top}px`;\n\t\t\tthis.State.$batch({ top, left });\n\t\t});\n\n\t\tthis.on(this.State.$changes, \"top\", y => {\n\t\t\tthis.Bars.scrollTo(this.State.left, y);\n\t\t});\n\t}\n\n\t/**\n\t * Handles selection\n\t * @param {Object} scales - the current scales\n\t */\n\tHandleSelection(scales) {\n\t\tthis.selLine = webix.html.create(\"DIV\", {\n\t\t\tclass: \"webix_gantt_bar_selection\",\n\t\t\tstyle: `height:${scales.cellHeight}px;width:${scales.width}px`,\n\t\t});\n\t\tthis.Bars.$view.insertBefore(this.selLine, this.Bars.$view.firstChild);\n\n\t\tthis.on(this.State.$changes, \"selected\", () => this.SetSelection());\n\t}\n\n\t/**\n\t * Highlights the selected task\n\t */\n\tSetSelection() {\n\t\tconst id = this.State.selected;\n\t\tconst top = id\n\t\t\t? this.Bars.getIndexById(id) * this.Local.getScales().cellHeight\n\t\t\t: -100;\n\t\tthis.selLine.style.top = top + \"px\";\n\t}\n\n\t/**\n\t * Creates and renders markers (today and custom ones if they are provided)\n\t */\n\tInitMarkers() {\n\t\tconst markers = (this.Markers = this.app.config.markers);\n\t\tif (markers && markers.length) {\n\t\t\tthis.containerForMarkers = webix.html.create(\"DIV\", {\n\t\t\t\tclass: \"webix_gantt_markers\",\n\t\t\t\tstyle: `height:${this.Bars.$view.scrollHeight}px`,\n\t\t\t});\n\t\t\tthis.Bars.$view.insertBefore(\n\t\t\t\tthis.containerForMarkers,\n\t\t\t\tthis.Bars.$view.firstChild\n\t\t\t);\n\n\t\t\tthis.RenderMarkers(markers);\n\t\t\tthis.on(this.app, \"onScalesUpdate\", () =>\n\t\t\t\tthis.RenderMarkers(this.Markers)\n\t\t\t);\n\t\t}\n\t}\n\n\t/**\n\t * Renders markers (today and custom ones if they are provided)\n\t * @param {Array} markers - all markers\n\t */\n\tRenderMarkers(markers) {\n\t\tconst html = [];\n\t\tfor (let i = 0; i < markers.length; i++) {\n\t\t\tconst m = markers[i];\n\t\t\tif (m.now) {\n\t\t\t\tm.start_date = new Date();\n\t\t\t\tif (!m.$interval)\n\t\t\t\t\tm.$interval = setInterval(\n\t\t\t\t\t\titem => {\n\t\t\t\t\t\t\tconst node = this.containerForMarkers.querySelector(\n\t\t\t\t\t\t\t\t`[gantt_now=\"${item.$interval}\"]`\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tnode.style.left = this.GetMarkerPosition(new Date()) + \"px\";\n\t\t\t\t\t\t},\n\t\t\t\t\t\t5 * 60 * 1000,\n\t\t\t\t\t\tm\n\t\t\t\t\t);\n\t\t\t}\n\t\t\thtml.push(this.MarkerTemplate(markers[i]));\n\t\t}\n\t\tthis.containerForMarkers.innerHTML = html.join(\"\");\n\t}\n\n\t/**\n\t * Returns a string with HTML content of a marker\n\t * @param {Object} obj - marker settings\n\t * @returns {string}\n\t */\n\tMarkerTemplate(obj) {\n\t\tconst text = obj.text\n\t\t\t? `<span class=\"webix_gantt_marker_text\">${obj.text}</span>`\n\t\t\t: \"\";\n\n\t\treturn `<div\n\t\t\tgantt_now=\"${obj.$interval}\"\n\t\t\tclass=\"webix_gantt_marker ${obj.css || \"\"}\"\n\t\t\tstyle=\"left:${this.GetMarkerPosition(obj.start_date)}px\">${text}</div>`;\n\t}\n\n\t/**\n\t * Calculates new X position of a marker based on its date\n\t * @param {Date} date - the date from marker settings\n\t * @returns {number}\n\t */\n\tGetMarkerPosition(date) {\n\t\tconst { start, end, cellWidth, diff, minUnit } = this.Local.getScales();\n\t\tconst astart = getUnitStart(minUnit, start);\n\n\t\treturn date < start || date > end\n\t\t\t? -100\n\t\t\t: Math.round(diff(date, astart, true) * cellWidth);\n\t}\n\n\t/**\n\t * Returns a string with SVG with all links or a temp link\n\t * @param {string} lines - all lines as SVG polylines\n\t * @param {string} css - the name of CSS class for SVG (by default 'webix_gantt_lines' or 'webix_gantt_temp_line')\n\t * @returns {string}\n\t */\n\tLinksTemplate(lines, css) {\n\t\tconst bars = this.Bars.$view;\n\n\t\treturn `<svg\n\t\t\tclass=\"${css}\"\n\t\t\tviewBox=\"${this.State.left} ${this.State.top} ${bars.scrollWidth} ${bars.scrollHeight}\"\n\t\t\twidth=\"${bars.scrollWidth}\"\n\t\t\theight=\"${bars.scrollHeight}\"\n\t\t>${lines}</svg>`;\n\t}\n\n\t/**\n\t * Re-renders links\n\t * @param {DataCollection} ldata - a collection with link data\n\t */\n\tRefreshLinks(ldata) {\n\t\tconst lines = [];\n\n\t\tldata.order.each(id => {\n\t\t\tconst link = ldata.getItem(id);\n\t\t\tif (link.$p)\n\t\t\t\tlines.push(`<polyline data-id=\"${id}\" points=\"${link.$p}\" />`);\n\t\t});\n\n\t\tconst html =\n\t\t\tthis.LinksTemplate(lines.join(\"\"), \"webix_gantt_lines\") +\n\t\t\tthis.LinksTemplate('<polyline points=\"\" />', \"webix_gantt_temp_line\");\n\t\tthis.Links.setHTML(html);\n\t}\n\n\t/**\n\t * Refreshes links of a task\n\t * @param {string, number} tid - the ID of a task\n\t */\n\tRefreshTaskLinks(tid) {\n\t\tthis.LinksData.find(a => a.source == tid || a.target == tid).forEach(\n\t\t\tobj => {\n\t\t\t\tconst l = this.Links.$view.querySelector(`[data-id=\"${obj.id}\"]`);\n\t\t\t\tif (l) {\n\t\t\t\t\tconst s = this.TasksData.getItem(obj.source);\n\t\t\t\t\tconst e = this.TasksData.getItem(obj.target);\n\t\t\t\t\tupdateLink(obj, s, e, this.Local._taskHeight);\n\t\t\t\t\tl.setAttribute(\"points\", obj.$p);\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\t/**\n\t * Changes the width of the root component (list with bars)\n\t * @param {number} width\n\t */\n\tResize(width) {\n\t\tconst area = this.Bars.$view.querySelector(\".webix_scroll_cont\");\n\t\tarea.style.width = width + \"px\";\n\t\tarea.style.minHeight = \"1px\";\n\n\t\tif (this.selLine) this.selLine.style.width = width + \"px\";\n\t}\n\n\t/**\n\t * Handles actions with tasks\n\t * @param {Object} obj - settings of an action\n\t * @returns {Promise} - the result of asynchronous operations or an empty promise\n\t */\n\tAction(obj) {\n\t\tconst ops = this.app.getService(\"operations\");\n\t\t/**\n\t\t * Some actions invoke server-side request\n\t\t * therefore we need show progress bar for them\n\t\t */\n\t\tlet inProgress = null;\n\n\t\tif (obj.action === \"update-task-time\") {\n\t\t\tif (obj.time) {\n\t\t\t\tinProgress = ops.updateTaskTime(obj.id, obj.mode, obj.time);\n\t\t\t} else {\n\t\t\t\tthis.Local.refreshTasks(obj.id);\n\t\t\t\tthis.RefreshTaskLinks(obj.id);\n\t\t\t}\n\t\t} else if (obj.action === \"update-task-progress\") {\n\t\t\tif (!webix.isUndefined(obj.progress)) {\n\t\t\t\tinProgress = ops.updateTask(obj.id, { progress: obj.progress });\n\t\t\t} else {\n\t\t\t\tconst task = this.TasksData.getItem(obj.id);\n\t\t\t\tthis.Bars.render(obj.id, task, \"paint\");\n\t\t\t}\n\t\t} else if (obj.action === \"drag-task\") {\n\t\t\tconst task = this.TasksData.getItem(obj.id);\n\t\t\ttask.$x = parseInt(obj.left);\n\t\t\ttask.$w = parseInt(obj.width);\n\t\t\tthis.RefreshTaskLinks(obj.id);\n\t\t} else if (obj.action === \"add-link\") {\n\t\t\tconst { source, target, type } = obj;\n\t\t\tinProgress = ops.addLink({ source, target, type });\n\t\t} else if (obj.action === \"temp-link\") {\n\t\t\tconst { start, end } = obj;\n\t\t\tconst link = this.GetLinks(true).firstChild;\n\n\t\t\tif (!start) {\n\t\t\t\tlink.setAttribute(\"points\", \"\");\n\t\t\t} else {\n\t\t\t\tconst { left, top, p } = newLink(\n\t\t\t\t\tthis.Links.$view.getBoundingClientRect(),\n\t\t\t\t\tstart,\n\t\t\t\t\tend\n\t\t\t\t);\n\t\t\t\tconst shift = [left, top];\n\t\t\t\tconst points = p\n\t\t\t\t\t.split(\",\")\n\t\t\t\t\t.map((a, i) => a * 1 + shift[i % 2])\n\t\t\t\t\t.join(\",\");\n\n\t\t\t\tlink.setAttribute(\"points\", points);\n\t\t\t}\n\t\t}\n\n\t\tif (inProgress) {\n\t\t\tthis.app.callEvent(\"backend:operation\", [inProgress]);\n\t\t\treturn inProgress;\n\t\t}\n\t\treturn webix.promise.resolve();\n\t}\n\n\t/**\n\t * Adds the layer for holiday highlighting and renders it\n\t * @param {Object} scales - current scales\n\t */\n\tHandleHolidays(scales) {\n\t\tthis.holidaysContainer = webix.html.create(\"DIV\", {\n\t\t\tclass: \"webix_gantt_bar_holidays\",\n\t\t\tstyle: `height:${this.Bars.$view.scrollHeight}px;`,\n\t\t});\n\t\tthis.Bars.$view.insertBefore(\n\t\t\tthis.holidaysContainer,\n\t\t\tthis.Bars.$view.firstChild\n\t\t);\n\t\tthis.RenderHolidays(scales);\n\n\t\tthis.on(this.app, \"onScalesUpdate\", scales => this.RenderHolidays(scales));\n\t}\n\n\t/**\n\t * Renders holiday highlighting\n\t * @param {Object} scales - current scales\n\t */\n\tRenderHolidays(scales) {\n\t\tif (scales.minUnit === \"day\" || scales.minUnit === \"hour\") {\n\t\t\tlet html = \"\";\n\t\t\tlet date = webix.Date.copy(scales.start);\n\n\t\t\tlet end = webix.Date.dayStart(scales.end);\n\t\t\tif (!(scales.end - end)) {\n\t\t\t\tend = webix.Date.add(end, -1, \"day\", true);\n\t\t\t}\n\n\t\t\tlet hourOffset = scales.start.getHours();\n\n\t\t\twhile (date <= end) {\n\t\t\t\tif (this.Local.isHoliday(date)) {\n\t\t\t\t\thtml += this.HolidayTemplate(scales, date, hourOffset);\n\t\t\t\t}\n\t\t\t\tdate = webix.Date.add(webix.Date.dayStart(date), 1, \"day\", true);\n\t\t\t\thourOffset = webix.Date.equal(date, end)\n\t\t\t\t\t? 24 - Math.ceil(webix.Date.timePart(scales.end) / 60 / 60)\n\t\t\t\t\t: 0;\n\t\t\t}\n\n\t\t\tthis.holidaysContainer.innerHTML = html;\n\t\t}\n\t}\n\n\t/**\n\t * Returns a string with HTML of 1 holiday highlight element\n\t * @param {Object} scales - the current scales\n\t * @param {Date} date - the date of this element\n\t * @param {number} hourOffset - the hours of the scale start date\n\t * @returns {string}\n\t */\n\tHolidayTemplate(scales, date, hourOffset) {\n\t\tconst astart = getUnitStart(scales.minUnit, scales.start);\n\t\tconst x = Math.round(scales.diff(date, astart) * scales.cellWidth);\n\t\tconst w =\n\t\t\t(scales.minUnit === \"hour\" ? 24 - hourOffset : 1) * scales.cellWidth;\n\t\treturn `<div class=\"webix_gantt_holiday\" style=\"left:${x}px; width:${w}px;\"></div>`;\n\t}\n\n\t/**\n\t * Returns a string with HTML content of a tooltip for tasks\n\t * @param {Object} obj - task data\n\t * @param {function} _ - the translator function of jet locale plugin, see https://webix.gitbook.io/webix-jet/part-ii-webix-jet-in-details/plugins#applying-the-locale\n\t * @returns {string}\n\t */\n\tGetTooltip(obj, _) {\n\t\tconst parser = webix.i18n.longDateFormatStr;\n\t\tlet tip = `${obj.text || _(\"(no title)\")}<br>\n\t\t\t<br>${_(\"Start date\")}: ${parser(obj.start_date)}`;\n\n\t\tif (obj.type != \"milestone\") {\n\t\t\ttip += `<br>${_(\"End date\")}: ${parser(obj.end_date)}\n\t\t\t<br>${_(\"Lasts\")} ${obj.duration} ${obj.duration > 1 ? _(\"days\") : _(\"day\")}`;\n\t\t}\n\t\treturn tip;\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class ScalesView extends JetView {\n\tconfig() {\n\t\treturn { view: \"template\", height: 20, css: \"webix_gantt_scale\" };\n\t}\n\n\tinit() {\n\t\tconst view = this.getRoot();\n\t\tconst state = this.getParam(\"state\", true);\n\n\t\tthis.on(state.$changes, \"left\", x => view.scrollTo(x, null));\n\n\t\tthis.Local = this.app.getService(\"local\");\n\t\tconst scales = this.Local.getScales();\n\t\tthis.RenderScales(scales);\n\n\t\tthis.on(this.app, \"onScalesUpdate\", scales => this.RenderScales(scales));\n\t}\n\n\t/**\n\t * Renders gantt scales\n\t * @param {Object} s - the object that stores the data of current scales\n\t */\n\tRenderScales(s) {\n\t\tconst view = this.getRoot();\n\t\tconst html = s.rows\n\t\t\t.map(line => {\n\t\t\t\tconst canMarkHolidays =\n\t\t\t\t\t(line.type === \"hour\" || line.type === \"day\") && line.step === 1;\n\t\t\t\treturn (\n\t\t\t\t\t`<div class=\"webix_gantt_scale_row\" style='height:${line.height}px;width:${s.width}px'>` +\n\t\t\t\t\tline.cells\n\t\t\t\t\t\t.map(cell => this.CellTemplate(cell, canMarkHolidays))\n\t\t\t\t\t\t.join(\"\") +\n\t\t\t\t\t\"</div>\"\n\t\t\t\t);\n\t\t\t})\n\t\t\t.join(\"\");\n\n\t\tview.config.height = s.height;\n\t\tview.setHTML(html);\n\t\tview.resize();\n\t}\n\n\t/**\n\t * Returns the template string for a scale unit\n\t * @param {Object} cell - a scale unit\n\t * @param {boolean} canMarkHolidays - signals whether to add styling for holidays\n\t * @returns {string} - the template string of the scale cell\n\t */\n\tCellTemplate(cell, canMarkHolidays) {\n\t\treturn `<div class=\"webix_gantt_scale_cell ${cell.css +\n\t\t\t(canMarkHolidays && this.Local.isHoliday(cell.date)\n\t\t\t\t? \"webix_gantt_holiday_scale\"\n\t\t\t\t: \"\")}\" style=\"width:${cell.width}px;\">${cell.format(cell.date)}</div>`;\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nimport ScaleView from \"./scale\";\nimport BarsView from \"./bars\";\n\nexport default class ChartView extends JetView {\n\tconfig() {\n\t\treturn { rows: [ScaleView, BarsView] };\n\t}\n\tinit() {\n\t\tthis.on(this.app, \"bars:toggle\", v => {\n\t\t\tif (v) this.getRoot().show();\n\t\t\telse this.getRoot().hide();\n\t\t});\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class TableView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\tconst header = { template: _(\"Related tasks\"), type: \"section\" };\n\n\t\tconst table = {\n\t\t\tview: \"treetable\",\n\t\t\tcss: \"webix_gantt_tree webix_gantt_tree_link\",\n\t\t\theader: false,\n\t\t\tborderless: true,\n\t\t\tlocalId: \"links\",\n\t\t\tautoheight: true,\n\t\t\teditable: true,\n\t\t\tscroll: false,\n\t\t\tscheme: {\n\t\t\t\t$group: {\n\t\t\t\t\tby: \"ttype\",\n\t\t\t\t},\n\t\t\t},\n\t\t\tcolumns: [\n\t\t\t\t{\n\t\t\t\t\tid: \"task\",\n\t\t\t\t\tcss: \"webix_gantt_title\",\n\t\t\t\t\theader: _(\"Task\"),\n\t\t\t\t\tfillspace: true,\n\t\t\t\t\ttemplate: function(obj) {\n\t\t\t\t\t\tif (obj.$group)\n\t\t\t\t\t\t\treturn `<span class=\"webix_strong\">${_(\n\t\t\t\t\t\t\t\tobj.ttype == \"source\" ? _(\"Successors\") : _(\"Predecessors\")\n\t\t\t\t\t\t\t)}</span>`;\n\t\t\t\t\t\telse return obj.text || _(\"(no title)\");\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: \"type\",\n\t\t\t\t\tcss: \"webix_gantt_type\",\n\t\t\t\t\theader: _(\"Link\"),\n\t\t\t\t\twidth: 140,\n\t\t\t\t\ttemplate: function(obj, c, v, conf) {\n\t\t\t\t\t\tif (obj.$group) return \"\";\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tconst type = conf.collection.getItem(v).value;\n\t\t\t\t\t\t\treturn `${type}<span class=\"webix_icon wxi-menu-down\"></span>`;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\teditor: \"richselect\",\n\t\t\t\t\toptions: [\n\t\t\t\t\t\t{ id: \"0\", value: _(\"End to start\") },\n\t\t\t\t\t\t{ id: \"1\", value: _(\"Start to start\") },\n\t\t\t\t\t\t{ id: \"2\", value: _(\"End to end\") },\n\t\t\t\t\t\t{ id: \"3\", value: _(\"Start to end\") },\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\twidth: 30,\n\t\t\t\t\tcss: \"webix_gantt_action\",\n\t\t\t\t\ttemplate: function(obj) {\n\t\t\t\t\t\treturn obj.$group\n\t\t\t\t\t\t\t? \"\"\n\t\t\t\t\t\t\t: \"<span class='webix_icon wxi-trash'></span>\";\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\ton: {\n\t\t\t\tonBeforeEditStart: function(id) {\n\t\t\t\t\treturn !this.getItem(id).$group;\n\t\t\t\t},\n\t\t\t\tonBeforeEditStop: (v, editor) => {\n\t\t\t\t\tif (v.value != v.old) {\n\t\t\t\t\t\tthis.UpdateLink(editor.row, { type: v.value * 1 });\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonAfterLoad: function() {\n\t\t\t\t\tthis.openAll();\n\t\t\t\t},\n\t\t\t},\n\t\t\tonClick: {\n\t\t\t\t\"wxi-trash\": (e, id) => {\n\t\t\t\t\twebix\n\t\t\t\t\t\t.confirm({\n\t\t\t\t\t\t\ttitle: _(\"Delete link\"),\n\t\t\t\t\t\t\ttext: _(\"The link will be deleted permanently, are you sure?\"),\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.then(() => this.DeleteLink(id));\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\treturn {\n\t\t\trows: [header, table],\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.State = this.getParam(\"state\", true);\n\t\tthis.Ops = this.app.getService(\"operations\");\n\t\tthis.Links = this.$$(\"links\");\n\n\t\tthis.on(this.State.$changes, \"selected\", id => {\n\t\t\tif (id) this.FillData(id);\n\t\t});\n\t}\n\n\tFillData(id) {\n\t\tconst local = this.app.getService(\"local\");\n\t\tconst related = local\n\t\t\t.getLinks(id, \"target\")\n\t\t\t.concat(local.getLinks(id, \"source\"));\n\n\t\tthis.Links.clearAll();\n\t\tif (related.length) {\n\t\t\tthis.Links.parse(related);\n\t\t\tthis.Links.show();\n\t\t} else {\n\t\t\tthis.getRoot().hide();\n\t\t}\n\t}\n\n\tUpdateLink(id, obj) {\n\t\tconst inProgress = this.Ops.updateLink(id, obj);\n\t\tthis.app.callEvent(\"backend:operation\", [inProgress]);\n\t\tinProgress.then(() => {\n\t\t\tthis.Links.blockEvent();\n\t\t\tthis.Links.editCancel();\n\t\t\tthis.Links.unblockEvent();\n\n\t\t\tthis.Links.updateItem(id, obj);\n\t\t});\n\t}\n\n\tDeleteLink(id) {\n\t\tconst inProgress = this.Ops.removeLink(id);\n\t\tthis.app.callEvent(\"backend:operation\", [inProgress]);\n\t\tinProgress.then(() => {\n\t\t\tthis.FillData(this.State.selected);\n\t\t});\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport TableView from \"./table\";\nimport { updateTaskDuration } from \"../../libs/gantt\";\n\nexport default class FormView extends JetView {\n\tconfig() {\n\t\tthis.Compact = this.getParam(\"compact\", true);\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\tconst aSkin = webix.skin.$active;\n\t\tconst bar = {\n\t\t\tview: \"toolbar\",\n\t\t\tcss: \"webix_subbar\",\n\t\t\tborderless: true,\n\t\t\tpadding: {\n\t\t\t\tleft: aSkin.layoutPadding.form - (aSkin.inputHeight - 20) / 2,\n\t\t\t\tright: aSkin.layoutPadding.form,\n\t\t\t},\n\t\t\telements: [\n\t\t\t\t{\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"wxi-close\",\n\t\t\t\t\tclick: () => this.Close(),\n\t\t\t\t},\n\t\t\t\t{},\n\t\t\t\t{\n\t\t\t\t\tview: \"button\",\n\t\t\t\t\twidth: 130,\n\t\t\t\t\tcss: \"webix_primary\",\n\t\t\t\t\tvalue: _(\"Done\"),\n\t\t\t\t\tclick: () => this.Done(),\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\tconst form = {\n\t\t\tview: \"form\",\n\t\t\tlocalId: \"form\",\n\t\t\tborderless: true,\n\t\t\tautoheight: false,\n\t\t\tscroll: true,\n\t\t\telementsConfig: {\n\t\t\t\tlabelPosition: \"top\",\n\t\t\t},\n\t\t\telements: [\n\t\t\t\t{ view: \"text\", name: \"text\", label: _(\"Title\") },\n\t\t\t\t{\n\t\t\t\t\tview: \"richselect\",\n\t\t\t\t\tname: \"type\",\n\t\t\t\t\tlabel: _(\"Type\"),\n\t\t\t\t\toptions: [\n\t\t\t\t\t\t{ id: \"task\", value: _(\"Task\") },\n\t\t\t\t\t\t{ id: \"project\", value: _(\"Project\") },\n\t\t\t\t\t\t{ id: \"milestone\", value: _(\"Milestone\") },\n\t\t\t\t\t],\n\t\t\t\t\ton: {\n\t\t\t\t\t\tonChange: v => this.ToggleControls(v),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{ view: \"datepicker\", name: \"start_date\", label: _(\"Start date\") },\n\t\t\t\t{ view: \"datepicker\", name: \"end_date\", label: _(\"End date\") },\n\t\t\t\t{\n\t\t\t\t\tview: \"counter\",\n\t\t\t\t\tname: \"duration\",\n\t\t\t\t\tcss: \"webix_gantt_form_counter\",\n\t\t\t\t\tmin: 1,\n\t\t\t\t\tmax: 1000,\n\t\t\t\t\tlabel: _(\"Duration\"),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"slider\",\n\t\t\t\t\tname: \"progress\",\n\t\t\t\t\ttitle: webix.template(\"#value#%\"),\n\t\t\t\t\tlabel: _(\"Progress\"),\n\t\t\t\t},\n\t\t\t\tTableView,\n\t\t\t\t{\n\t\t\t\t\tview: \"textarea\",\n\t\t\t\t\tname: \"details\",\n\t\t\t\t\tlabel: _(\"Notes\"),\n\t\t\t\t\theight: 150,\n\t\t\t\t},\n\t\t\t],\n\t\t\ton: {\n\t\t\t\tonChange: () => {\n\t\t\t\t\tthis.UpdateTaskTime();\n\t\t\t\t\tif (!this.Compact) this.UpdateTask();\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\treturn {\n\t\t\tview: \"proxy\", // for borders\n\t\t\tbody: {\n\t\t\t\tmargin: 0,\n\t\t\t\tpadding: { bottom: 14 },\n\t\t\t\trows: [bar, form],\n\t\t\t},\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.State = this.getParam(\"state\", true);\n\t\tthis.Ops = this.app.getService(\"operations\");\n\t\tthis.Tasks = this.app.getService(\"local\").tasks();\n\t\tthis.Form = this.$$(\"form\");\n\n\t\t// fills form with data of selected and newly created task\n\t\tthis.on(this.State.$changes, \"selected\", id => {\n\t\t\tif (id) {\n\t\t\t\tthis.FillData(id);\n\t\t\t}\n\t\t});\n\n\t\t// updates for start and end dates of task while dnd happens and form is open\n\t\tthis.on(this.Tasks.data, \"onStoreUpdated\", (id, obj, mode) => {\n\t\t\tif (mode == \"update\" && id == this.State.selected)\n\t\t\t\tthis.FillData(this.State.selected);\n\t\t});\n\t}\n\n\tFillData(id) {\n\t\tconst item = this.Tasks.getItem(id);\n\t\tthis.Form.setValues(item);\n\t\tthis.Form.focus();\n\t}\n\n\tUpdateTaskTime() {\n\t\tconst f = this.Form.$eventSource.config.name;\n\t\tconst vals = this.Form.getValues();\n\n\t\tif (f == \"duration\" || (f == \"start_date\" && vals.type == \"project\"))\n\t\t\tvals.end_date = null;\n\t\telse if (f == \"end_date\" || f == \"start_date\") vals.duration = null;\n\n\t\tupdateTaskDuration(vals);\n\n\t\tthis.Form.blockEvent();\n\t\tthis.Form.setValues(vals, true);\n\t\tthis.Form.unblockEvent();\n\t}\n\n\tUpdateTask() {\n\t\tconst id = this.State.selected;\n\t\tconst vals = this.Form.getValues();\n\n\t\tthis._inProgress =\n\t\t\tid === \"$temp\"\n\t\t\t\t? this.Ops.saveTempTask(vals)\n\t\t\t\t: this.Ops.updateTask(id, vals);\n\t\tthis.app.callEvent(\"backend:operation\", [this._inProgress]);\n\n\t\tthis._inProgress.finally(() => (this._inProgress = null));\n\n\t\treturn this._inProgress;\n\t}\n\n\tToggleControls(v) {\n\t\tthis.Form.elements.end_date.show();\n\t\tthis.Form.elements.duration.show();\n\t\tthis.Form.elements.progress.show();\n\t\tthis.Form.elements.end_date.enable();\n\t\tthis.Form.elements.duration.enable();\n\t\tthis.Form.elements.progress.enable();\n\n\t\tif (v == \"project\" || v == \"milestone\") {\n\t\t\tconst action = v == \"project\" ? \"disable\" : \"hide\";\n\t\t\tthis.Form.elements.end_date[action]();\n\t\t\tthis.Form.elements.duration[action]();\n\t\t\tthis.Form.elements.progress[action]();\n\t\t}\n\t}\n\n\tClose() {\n\t\tif (this.Compact && this.Form.isDirty()) {\n\t\t\tconst _ = this.app.getService(\"locale\")._;\n\t\t\twebix\n\t\t\t\t.confirm({\n\t\t\t\t\ttext: _(\"Save changes?\"),\n\t\t\t\t})\n\t\t\t\t.then(() => this.Done(true), () => this.Back(true));\n\t\t} else {\n\t\t\tthis.Back(true);\n\t\t}\n\t}\n\n\tBack(exit) {\n\t\tif (exit) {\n\t\t\tthis.app.callEvent(\"edit:stop\");\n\t\t} else {\n\t\t\tconst path = this.Compact ? \"task.popup/\" : \"../\";\n\t\t\tthis.show(path + \"task.info\", { target: \"edit\" });\n\t\t}\n\t}\n\n\tDone(exit) {\n\t\tif (\n\t\t\tthis.State.selected === \"$temp\" ||\n\t\t\t(this.Compact && this.Form.isDirty())\n\t\t) {\n\t\t\tif (this._inProgress)\n\t\t\t\tthis._inProgress.then(() => {\n\t\t\t\t\tthis.Back(exit);\n\t\t\t\t});\n\t\t\telse this.UpdateTask().then(() => this.Back(exit));\n\t\t} else this.Back(exit);\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class TaskView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst state = this.getParam(\"state\", true);\n\n\t\tconst editButton = {\n\t\t\tview: \"button\",\n\t\t\twidth: 130,\n\t\t\tlabel: _(\"Edit\"),\n\t\t\tcss: \"webix_primary\",\n\t\t\tclick: () => this.EditTask(),\n\t\t};\n\n\t\tconst aSkin = webix.skin.$active;\n\t\tconst bar = {\n\t\t\tview: \"toolbar\",\n\t\t\tcss: \"webix_subbar\",\n\t\t\tborderless: true,\n\t\t\tpadding: {\n\t\t\t\tleft: aSkin.layoutPadding.form - (aSkin.inputHeight - 20) / 2,\n\t\t\t\tright: aSkin.layoutPadding.form,\n\t\t\t},\n\t\t\telements: [\n\t\t\t\t{\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"wxi-close\",\n\t\t\t\t\tclick: () => this.Close(),\n\t\t\t\t},\n\t\t\t\t{},\n\t\t\t\t!state.readonly ? editButton : {},\n\t\t\t],\n\t\t};\n\n\t\tconst info = {\n\t\t\tlocalId: \"text\",\n\t\t\tview: \"template\",\n\t\t\tcss: \"webix_gantt_task_info\",\n\t\t\ttemplate: obj => this.InfoTemplate(obj),\n\t\t\tborderless: true,\n\t\t};\n\n\t\tconst deleteButton = {\n\t\t\tview: \"button\",\n\t\t\tlabel: _(\"Delete task\"),\n\t\t\tcss: \"webix_danger webix_gantt_danger\",\n\t\t\talign: \"center\",\n\t\t\tinputWidth: 330,\n\t\t\tclick: () => {\n\t\t\t\twebix\n\t\t\t\t\t.confirm({\n\t\t\t\t\t\ttitle: _(\"Delete task\"),\n\t\t\t\t\t\ttext: _(\"The task will be deleted permanently, are you sure?\"),\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => this.DeleteTask());\n\t\t\t},\n\t\t};\n\n\t\treturn {\n\t\t\tview: \"proxy\", // for borders\n\t\t\tbody: {\n\t\t\t\tmargin: 0,\n\t\t\t\trows: [\n\t\t\t\t\tbar,\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: \"form\",\n\t\t\t\t\t\tborderless: true,\n\t\t\t\t\t\trows: [info, !state.readonly ? deleteButton : {}],\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.State = this.getParam(\"state\", true);\n\t\tthis.Local = this.app.getService(\"local\");\n\t\tthis.Tasks = this.Local.tasks();\n\t\tthis.Text = this.$$(\"text\");\n\n\t\tthis.on(this.State.$changes, \"selected\", id => {\n\t\t\tif (id) this.FillTemplate(id);\n\t\t});\n\t\tthis.on(this.Tasks.data, \"onStoreUpdated\", (id, obj, mode) => {\n\t\t\tif (mode == \"update\" && id == this.State.selected) {\n\t\t\t\tthis.FillTemplate(this.State.selected);\n\t\t\t}\n\t\t});\n\t}\n\n\tFillTemplate(id) {\n\t\tconst item = webix.copy(this.Tasks.getItem(id));\n\t\titem.sources = this.Local.getLinks(id, \"source\");\n\t\titem.targets = this.Local.getLinks(id, \"target\");\n\t\tthis.Text.setValues(item);\n\t}\n\n\tEditTask() {\n\t\tconst compact = this.getParam(\"compact\", true);\n\t\tconst path = compact ? \"task.popup/\" : \"../\";\n\t\tthis.show(path + \"task.form\", { target: \"edit\" });\n\t}\n\n\tDeleteTask() {\n\t\tconst inProgress = this.app\n\t\t\t.getService(\"operations\")\n\t\t\t.removeTask(this.State.selected);\n\t\tthis.app.callEvent(\"backend:operation\", [inProgress]);\n\t\tthis.Close();\n\t}\n\n\tClose() {\n\t\tthis.app.callEvent(\"edit:stop\");\n\t}\n\n\tInfoTemplate(obj) {\n\t\tif (!obj.start_date) return \"\";\n\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst empty = _(\"(no title)\");\n\n\t\tlet html = `\n\t\t\t<span class=\"webix_gantt_task_title\">${obj.text || empty}</span><br><br>\n\t\t\t<span class=\"webix_strong\">${_(\"Start date\")}</span>: ${this.DateFormat(\n\t\t\tobj.start_date\n\t\t)}<br>`;\n\n\t\tif (obj.type !== \"milestone\")\n\t\t\thtml += `<span class=\"webix_strong\">${_(\n\t\t\t\t\"End date\"\n\t\t\t)}</span>: ${this.DateFormat(obj.end_date)}<br>\n\t\t\t<span class=\"webix_strong\">${_(\"Duration\")}</span>: ${obj.duration}<br>\n\t\t\t<span class=\"webix_strong\">${_(\"Progress\")}</span>: ${obj.progress}%\n\t\t<br>`;\n\n\t\tif (obj.targets.length)\n\t\t\thtml += this.InfoTemplateChunk(obj.targets, _(\"Predecessors\"), empty);\n\t\tif (obj.sources.length)\n\t\t\thtml += this.InfoTemplateChunk(obj.sources, _(\"Successors\"), empty);\n\n\t\tif (obj.details) {\n\t\t\thtml += `<br><br><div class=\"webix_gantt_task_title\">${_(\"Notes\")}</div>\n\t\t\t\t<br><div class=\"webix_gantt_task_text\">${obj.details.replace(\n\t\t\t\t\t/(?:\\r\\n|\\r|\\n)/g,\n\t\t\t\t\t\"<br>\"\n\t\t\t\t)}</div>`;\n\t\t}\n\n\t\treturn html;\n\t}\n\n\tInfoTemplateChunk(arr, label, empty) {\n\t\tlet res = arr.map(s => `<li>${s.text || empty}</li>`).join(\"\");\n\t\treturn `<br><span class=\"webix_strong\">${label}</span>:<br>${res}`;\n\t}\n\n\tDateFormat(date) {\n\t\treturn webix.i18n.longDateFormatStr(date);\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class TaskPopup extends JetView {\n\tconfig() {\n\t\treturn {\n\t\t\tview: \"window\",\n\t\t\tfullscreen: true,\n\t\t\thead: false,\n\t\t\tbody: { $subview: true },\n\t\t};\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class TreeView extends JetView {\n\tconfig() {\n\t\tconst state = this.getParam(\"state\");\n\t\tconst scales = this.app.getService(\"local\").getScales();\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst compact = this.getParam(\"compact\", true);\n\n\t\tconst action = {\n\t\t\tid: \"action\",\n\t\t\tcss: \"webix_gantt_action\",\n\t\t\theader: {\n\t\t\t\ttext: `<span webix_tooltip=\"${_(\n\t\t\t\t\t\"Add project\"\n\t\t\t\t)}\" class=\"webix_icon wxi-plus-circle\"></span>`,\n\t\t\t\tcss: \"webix_gantt_action\",\n\t\t\t},\n\t\t\ttemplate: obj => {\n\t\t\t\tif (obj.id === \"$temp\") return \"\";\n\t\t\t\treturn `<span webix_tooltip=\"${_(\n\t\t\t\t\t\"Add task\"\n\t\t\t\t)}\" class=\"webix_icon wxi-plus\"></span>`;\n\t\t\t},\n\t\t\twidth: 44,\n\t\t\tminWidth: 44,\n\t\t};\n\n\t\tlet columns = [\n\t\t\t{\n\t\t\t\tid: \"text\",\n\t\t\t\tcss: \"webix_gantt_title\",\n\t\t\t\theader: _(\"Title\"),\n\t\t\t\ttemplate: (obj, common) =>\n\t\t\t\t\tcommon.treetable(obj, common) + (obj.text || _(\"(no title)\")),\n\t\t\t\tfillspace: true,\n\t\t\t\thidden: compact,\n\t\t\t\tbatch: \"full\",\n\t\t\t\tsort: sort(\"text\"),\n\t\t\t\tminWidth: 150,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: \"start_date\",\n\t\t\t\theader: _(\"Start date\"),\n\t\t\t\tformat: webix.i18n.dateFormatStr,\n\t\t\t\thidden: compact,\n\t\t\t\tbatch: \"full\",\n\t\t\t\tsort: \"date\",\n\t\t\t\tminWidth: 100,\n\t\t\t},\n\t\t];\n\n\t\tif (compact) {\n\t\t\taction.header.text = \"<span class='webix_icon gti-menu'>\";\n\t\t\tif (state.readonly) action.template = \"\";\n\t\t\tcolumns.unshift(action);\n\t\t} else if (!state.readonly) columns.push(action);\n\n\t\tconst tree = {\n\t\t\tview: \"treetable\",\n\t\t\tcss: \"webix_gantt_tree webix_header_border\",\n\t\t\tprerender: true,\n\t\t\twidth: compact ? 44 : 400,\n\t\t\trowHeight: scales.cellHeight,\n\t\t\theaderRowHeight: scales.height,\n\t\t\tscroll: \"xy\",\n\t\t\tscrollAlignY: false,\n\t\t\tselect: \"row\",\n\t\t\tsort: \"multi\",\n\t\t\tresizeColumn: {\n\t\t\t\theaderOnly: true,\n\t\t\t\tsize: 10,\n\t\t\t},\n\t\t\tdrag: \"order\",\n\t\t\tcolumns,\n\t\t\ttooltip: () => \"\",\n\t\t\tonClick: {\n\t\t\t\t\"wxi-plus\": (ev, id) => this.AddTempTask(id.row),\n\t\t\t\t\"wxi-plus-circle\": () => this.AddTempTask(\"0\"),\n\t\t\t\t\"gti-menu\": () => this.ToggleColumns(),\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonAfterOpen: id => {\n\t\t\t\t\tthis.RefreshTasks();\n\t\t\t\t\tthis.Ops.updateTask(id, { opened: 1 });\n\t\t\t\t},\n\t\t\t\tonAfterClose: id => {\n\t\t\t\t\tthis.RefreshTasks();\n\t\t\t\t\tthis.Ops.updateTask(id, { opened: 0 });\n\t\t\t\t},\n\t\t\t\tonItemClick: id => {\n\t\t\t\t\tstate.$batch({\n\t\t\t\t\t\tparent: null,\n\t\t\t\t\t\tselected: id,\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tonAfterSort: (by, dir, as) => this.SortTasks(by, dir, as),\n\t\t\t\tonColumnResize: (id, v, o, user) => this.NormalizeColumns(id, user),\n\t\t\t\tonBeforeDrop: ctx => {\n\t\t\t\t\tlet inProgress = null;\n\t\t\t\t\tif (ctx.start === \"$temp\") {\n\t\t\t\t\t\tinProgress = this.Ops.saveTempTask(\n\t\t\t\t\t\t\tthis.Tasks.getItem(ctx.start),\n\t\t\t\t\t\t\tctx.parent || 0,\n\t\t\t\t\t\t\tctx.index\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tinProgress = this.Ops.moveTask(ctx.start, ctx.parent, ctx.index);\n\t\t\t\t\t}\n\t\t\t\t\tthis.app.callEvent(\"backend:operation\", [inProgress]);\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\tconst handler = function() {\n\t\t\tstate.top = this.getScrollState().y;\n\t\t};\n\t\tif (webix.env.touch) {\n\t\t\ttree.on[\"onSyncScroll\"] = tree.on[\"onAfterScroll\"] = handler;\n\t\t} else tree.on[\"onScrollY\"] = handler;\n\n\t\treturn tree;\n\t}\n\n\tinit(view) {\n\t\tthis.Tree = view;\n\t\tthis.Tasks = this.app.getService(\"local\").tasks();\n\t\tthis.State = this.getParam(\"state\", true);\n\t\tthis.Ops = this.app.getService(\"operations\");\n\n\t\tthis.Tree.sync(this.Tasks);\n\t\tthis.Tasks.waitData.then(() => {\n\t\t\tthis.RefreshTasks();\n\n\t\t\tif (this.State.sort) {\n\t\t\t\t// UI-only: no need to re-apply sorting on collection\n\t\t\t\tthis.Tree.data.blockEvent();\n\t\t\t\tthis.Tree.setState({ sort: this.State.sort });\n\t\t\t\tthis.Tree.data.unblockEvent();\n\t\t\t}\n\t\t});\n\n\t\tthis.on(this.State.$changes, \"top\", y => this.Tree.scrollTo(null, y));\n\t\tthis.on(this.State.$changes, \"selected\", (id, oid) => {\n\t\t\tif (oid === \"$temp\") this.ClearTempTask();\n\t\t\tif (id) this.Tree.select(id);\n\t\t\telse this.Tree.unselect();\n\t\t});\n\n\t\tthis.on(this.Tasks.data, \"onStoreUpdated\", (id, obj, mode) => {\n\t\t\tif (mode == \"add\" && id !== \"$temp\") this.ClearTempTask();\n\t\t});\n\n\t\t//compact button\n\t\tthis.on(this.app, \"task:add\", () => this.AddTempTask(\"0\"));\n\t}\n\t/**\n\t * Adds temporary task\n\t * @param {string, number} pid - ID of parent task, can be \"0\" for root\n\t * @returns {boolean} returning false prevents selection of the parent task, if called from tree\n\t */\n\tAddTempTask(pid) {\n\t\tif (this.State.parent !== pid) {\n\t\t\tconst row = this.Tasks.getItem(pid);\n\t\t\tconst start = row\n\t\t\t\t? row.start_date\n\t\t\t\t: this.app.getService(\"local\").getScales().start;\n\n\t\t\tthis.ClearTempTask();\n\t\t\tthis.State.selected = null;\n\t\t\tconst id = this.Tasks.add(\n\t\t\t\tthis.GetTempTask(start),\n\t\t\t\trow ? 0 : -1,\n\t\t\t\trow ? pid : 0\n\t\t\t);\n\t\t\tif (row) {\n\t\t\t\tthis.Tree.open(pid);\n\t\t\t}\n\n\t\t\tthis.State.$batch({\n\t\t\t\tparent: pid,\n\t\t\t\tselected: id,\n\t\t\t});\n\n\t\t\tif (this.Tree.exists(pid)) this.Tree.showItem(id);\n\t\t}\n\n\t\treturn false;\n\t}\n\t/**\n\t * Returns and object with temporary task data\n\t * @param {Date} start - the start date of the new event\n\t * @returns {Object} - an object with default task fields\n\t */\n\tGetTempTask(start) {\n\t\treturn {\n\t\t\tid: \"$temp\",\n\t\t\tstart_date: new Date(start),\n\t\t\tend_date: webix.Date.add(start, 1, \"day\", true),\n\t\t\tprogress: 0,\n\t\t\ttext: \"\",\n\t\t};\n\t}\n\t/** Clears temporary task */\n\tClearTempTask() {\n\t\tif (this.Tasks.exists(\"$temp\")) this.Tasks.remove(\"$temp\");\n\t}\n\t/** Invokes tasks painting in the chart */\n\tRefreshTasks() {\n\t\tthis.Tasks.data.callEvent(\"onStoreUpdated\", []);\n\t}\n\t/**\n\t * Sorts tasks according to current sorting config\n\t * @param {string, array} by - data field, can store an array of sorting configs in case of multiple sorting\n\t * @param {string, number} dir - sorting direction, \"asc\" or \"desc\"\n\t * @param {string, number} as - data type, \"string\" by default\n\t */\n\tSortTasks(by, dir, as) {\n\t\tconst dataSorter = webix.isArray(by) ? by : { by, dir, as };\n\t\tconst sortState = this.Tree.getState().sort;\n\n\t\t// sort the collection to affect task bars\n\t\tthis.Tasks.sort(dataSorter);\n\t\t// save sorting state to restore it after app.refresh (switching from/to compact mode)\n\t\tthis.State.sort = sortState;\n\n\t\tif (this.State.selected === \"$temp\") this.app.callEvent(\"edit:stop\");\n\t}\n\t/** Shows and hides columns in a compact mode */\n\tToggleColumns() {\n\t\tconst vis = this.Tree.isColumnVisible(\"text\");\n\t\tthis.Tree.showColumnBatch(\"full\", !vis);\n\t\tthis.Tree.config.width = vis ? 44 : 0;\n\t\tthis.Tree.resize();\n\n\t\tthis.app.callEvent(\"bars:toggle\", [vis]);\n\t}\n\t/**\n\t * Adjusts columns after resizing\n\t * @param {string} id - ID of the column being resized\n\t * @param {boolean} user - defines whether resizing was triggered by user or API\n\t */\n\tNormalizeColumns(id, user) {\n\t\tif (!user) return;\n\t\tconst tree = this.Tree;\n\t\tconst columns = tree.config.columns;\n\t\tconst i = tree.getColumnIndex(id);\n\n\t\tlet last = columns.length - 1;\n\t\tif (columns[last].id === \"action\") last -= 1;\n\n\t\tif (i === 0) {\n\t\t\tcolumns[last].fillspace = true;\n\t\t\tcolumns[last].width = 0;\n\t\t} else if (i === last) {\n\t\t\tcolumns[0].fillspace = true;\n\t\t\tcolumns[0].width = 0;\n\t\t}\n\t\ttree.refreshColumns();\n\t}\n}\n\n/**\n * Prepares a sorting function with locale-based comparison\n * @param {string} by - column ID\n * @returns {function} sorting function\n */\nfunction sort(by) {\n\treturn (a, b) =>\n\t\ta[by].localeCompare(b[by], undefined, {\n\t\t\tignorePunctuation: true,\n\t\t\tnumeric: true,\n\t\t});\n}\n","webix.protoUI(\n\t{\n\t\tname: \"r-layout\",\n\t\tsizeTrigger(width, handler, value) {\n\t\t\tthis._compactValue = value;\n\t\t\tthis._compactWidth = width;\n\t\t\tthis._compactHandler = handler;\n\n\t\t\tthis._checkTrigger(this.$view.width, value);\n\t\t},\n\t\t_checkTrigger(x, value) {\n\t\t\tif (this._compactWidth) {\n\t\t\t\tif (\n\t\t\t\t\t(x <= this._compactWidth && !value) ||\n\t\t\t\t\t(x > this._compactWidth && value)\n\t\t\t\t) {\n\t\t\t\t\tthis._compactWidth = null;\n\t\t\t\t\tthis._compactHandler(!value);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t},\n\t\t$setSize(x, y) {\n\t\t\tif (this._checkTrigger(x, this._compactValue))\n\t\t\t\treturn webix.ui.layout.prototype.$setSize.call(this, x, y);\n\t\t},\n\t},\n\twebix.ui.layout\n);\n","import { JetView } from \"webix-jet\";\nimport TreeView from \"./tree\";\nimport ChartView from \"./chart\";\nimport \"../helpers/responsive\";\n\nexport default class TopView extends JetView {\n\tconfig() {\n\t\tthis.fCompact = this.getParam(\"forceCompact\");\n\t\tif (typeof this.fCompact !== \"undefined\")\n\t\t\tthis.setParam(\"compact\", this.fCompact);\n\t\tthis.Compact = this.getParam(\"compact\");\n\t\tthis.State = this.getParam(\"state\", true);\n\n\t\tconst edit = this.Compact\n\t\t\t? { $subview: true, name: \"edit\", popup: true }\n\t\t\t: {\n\t\t\t\t\tview: \"proxy\",\n\t\t\t\t\tcss: \"webix_shadow_medium\",\n\t\t\t\t\tborderless: true,\n\t\t\t\t\twidth: 400,\n\t\t\t\t\thidden: true,\n\t\t\t\t\tlocalId: \"edit\",\n\t\t\t\t\tbody: { $subview: true, name: \"edit\" },\n\t\t\t  };\n\n\t\tconst cols = [\n\t\t\tTreeView,\n\t\t\t{\n\t\t\t\tview: this.Compact ? \"spacer\" : \"resizer\",\n\t\t\t\tcss: \"webix_gantt_resizer\",\n\t\t\t\twidth: 1,\n\t\t\t},\n\t\t\tChartView,\n\t\t\tedit,\n\t\t];\n\n\t\tconst ui = {\n\t\t\tview: \"abslayout\",\n\t\t\tcss: \"webix_gantt\",\n\t\t\tcells: [\n\t\t\t\t{\n\t\t\t\t\tview: typeof fCompact === \"undefined\" ? \"r-layout\" : \"layout\",\n\t\t\t\t\tlocalId: \"main\",\n\t\t\t\t\tborderless: true,\n\t\t\t\t\trelative: true,\n\t\t\t\t\ttype: \"clean\",\n\t\t\t\t\tcols: cols,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tcss: \"webix_gantt_absbutton\",\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"wxi-plus\",\n\t\t\t\t\tlocalId: \"add\",\n\t\t\t\t\thidden: !this.Compact || this.State.readonly,\n\t\t\t\t\twidth: 50,\n\t\t\t\t\theight: 50,\n\t\t\t\t\tright: 20,\n\t\t\t\t\tbottom: 20,\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tthis.app.callEvent(\"task:add\", []);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\treturn ui;\n\t}\n\n\tinit(view) {\n\t\tif (!this.fCompact)\n\t\t\tthis.$$(\"main\").sizeTrigger(\n\t\t\t\tthis.app.config.compactWidth,\n\t\t\t\tmode => this.SetCompactMode(mode),\n\t\t\t\t!!this.Compact\n\t\t\t);\n\n\t\tthis.on(this.State.$changes, \"selected\", (id, oid) => {\n\t\t\tif (id && id != \"$temp\" && !this.State.parent) this.ShowTask(\"info\");\n\t\t\telse if (oid === \"$temp\") this.State.parent = null;\n\t\t});\n\t\tthis.on(this.State.$changes, \"parent\", id => {\n\t\t\tif (id) this.ShowTask(\"form\");\n\t\t});\n\t\tthis.on(this.app, \"edit:stop\", () => {\n\t\t\tthis.State.selected = null;\n\t\t\tthis.HideTask();\n\t\t});\n\n\t\twebix.extend(view, webix.ProgressBar);\n\t\tthis.on(this.app, \"backend:operation\", res => {\n\t\t\tif (res) {\n\t\t\t\tview.showProgress({ type: \"top\", delay: 2000 });\n\t\t\t\tres.finally(() => {\n\t\t\t\t\tview.hideProgress();\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tShowTask(path) {\n\t\tpath = `task.${path}`;\n\t\tif (this.Compact) {\n\t\t\tthis.show(`task.popup/${path}`, {\n\t\t\t\ttarget: \"edit\",\n\t\t\t});\n\t\t} else {\n\t\t\tthis.$$(\"edit\").show();\n\t\t\tthis.show(path, {\n\t\t\t\ttarget: \"edit\",\n\t\t\t});\n\t\t}\n\t}\n\n\tHideTask() {\n\t\t// we need to destroy the view inside first\n\t\tthis.show(\"_blank\", { target: \"edit\" });\n\t\tif (!this.Compact) this.$$(\"edit\").hide();\n\t}\n\n\tSetCompactMode(mode) {\n\t\t//let it render, then recreate\n\t\twebix.delay(() => {\n\t\t\tthis.setParam(\"compact\", mode);\n\t\t\tthis.refresh();\n\t\t});\n\t}\n}\n","import m0 from \"views/chart/bars\";\nimport m1 from \"views/chart/index.js\";\nimport m2 from \"views/chart/scale\";\nimport m3 from \"views/task/form\";\nimport m4 from \"views/task/info\";\nimport m5 from \"views/task/popup\";\nimport m6 from \"views/task/table\";\nimport m7 from \"views/top\";\nimport m8 from \"views/tree\";\nimport { JetView } from \"webix-jet\";\n\nconst views = { JetView };\nviews[\"chart/bars\"] = m0;\nviews[\"chart\"] = m1;\nviews[\"chart/scale\"] = m2;\nviews[\"task/form\"] = m3;\nviews[\"task/info\"] = m4;\nviews[\"task/popup\"] = m5;\nviews[\"task/table\"] = m6;\nviews[\"top\"] = m7;\nviews[\"tree\"] = m8;\n\nexport default views;\n","import {\n\tupdateTask,\n\tupdateTaskDuration,\n\tresetScales,\n\tupdateLink,\n\taddUnit,\n} from \"libs/gantt/index\";\n\nexport default class Local {\n\t/**\n\t * @constructor\n\t * @param {App} app - Jet App instance\n\t * @param {object} config - object with app settings\n\t */\n\tconstructor(app, config) {\n\t\tthis.app = app;\n\n\t\tconst active = webix.skin.$active;\n\t\tconst scaleStart = config.scaleStart || webix.Date.dayStart(new Date());\n\t\tconst scaleEnd =\n\t\t\tconfig.scaleEnd || webix.Date.add(scaleStart, 1, \"month\", true);\n\n\t\tthis.setScales(\n\t\t\tscaleStart,\n\t\t\tscaleEnd,\n\t\t\tconfig.preciseTimeUnit,\n\t\t\tconfig.scaleCellWidth || 200,\n\t\t\tactive.barHeight - active.borderWidth * 2,\n\t\t\tconfig.scales || [{ unit: \"day\", step: 1, format: \"%d\" }]\n\t\t);\n\n\t\tthis.dateToLocalStr = webix.Date.dateToStr(webix.i18n.parseFormat);\n\t}\n\n\t/**\n\t * Creates and paints scales\n\t * @param {Date} scaleStart - start date\n\t * @param {Date} scaleEnd - end date\n\t * @param {boolean} precise - flag that defines whether to round task position and width to a smaller unit\n\t * @param {number} width - width of smallest cell unit\n\t * @param {number} height - height of scale cell\n\t * @param {Array} scales - a set of scales (objects)\n\t */\n\tsetScales(scaleStart, scaleEnd, precise, width, height, scales) {\n\t\tif (width) {\n\t\t\tthis._scaleBase = { width, height, scales };\n\t\t\tscaleEnd = webix.Date.add(scaleEnd, 1, \"day\"); //inclusive\n\t\t} else {\n\t\t\twidth = this._scaleBase.width;\n\t\t\theight = this._scaleBase.height;\n\t\t\tscales = this._scaleBase.scales;\n\t\t}\n\n\t\tthis._scales = resetScales(\n\t\t\tscaleStart,\n\t\t\tscaleEnd,\n\t\t\tprecise,\n\t\t\twidth,\n\t\t\theight,\n\t\t\tscales\n\t\t);\n\t\tthis._taskHeight = this._scales.cellHeight - 12;\n\n\t\tthis.app.callEvent(\"onScalesUpdate\", [this._scales]);\n\t}\n\t/**\n\t * returns scales\n\t * @returns {object} current scales object\n\t */\n\tgetScales() {\n\t\treturn this._scales;\n\t}\n\t/**\n\t * Adjusts scale to start and end date of edited task\n\t * @param {Date} start - start date\n\t * @param {Date} end - end date\n\t */\n\tadjustScale(start, end) {\n\t\tconst s = this.getScales();\n\n\t\t// add 1 unit space around\n\t\tstart = addUnit(s.minUnit)(start, -1);\n\t\tend = addUnit(s.minUnit)(end, 1);\n\n\t\tif ((s && s.start > start) || s.end < end) {\n\t\t\tthis.setScales(\n\t\t\t\ts.start > start ? start : s.start,\n\t\t\t\ts.end < end ? end : s.end,\n\t\t\t\ts.precise\n\t\t\t);\n\t\t\tthis.refreshTasks();\n\t\t}\n\t}\n\t/**\n\t * Creates, fills and returns tasks collection\n\t * @returns {object} tasks Tree Collection\n\t */\n\ttasks() {\n\t\tif (this._tasks) return this._tasks;\n\n\t\tconst tasks = (this._tasks = new webix.TreeCollection({\n\t\t\ton: {\n\t\t\t\t\"data->onStoreLoad\": () => {\n\t\t\t\t\tif (!this.app.config.scaleStart) {\n\t\t\t\t\t\tlet min = Infinity;\n\t\t\t\t\t\tlet max = -Infinity;\n\t\t\t\t\t\ttasks.data.each(d => {\n\t\t\t\t\t\t\tif (d.start_date < min) min = d.start_date;\n\t\t\t\t\t\t\tif (d.end_date > max) max = d.end_date;\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (typeof min === \"object\") {\n\t\t\t\t\t\t\tconst s = this.getScales();\n\t\t\t\t\t\t\tthis.setScales(\n\t\t\t\t\t\t\t\taddUnit(s.minUnit)(min, -1),\n\t\t\t\t\t\t\t\taddUnit(s.minUnit)(max, 1),\n\t\t\t\t\t\t\t\ts.precise\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"data->onStoreUpdated\": (id, obj, mode) => {\n\t\t\t\t\tid = mode == \"update\" ? id : null;\n\t\t\t\t\tthis.refreshTasks(id);\n\t\t\t\t\tthis.refreshLinks();\n\t\t\t\t},\n\t\t\t},\n\t\t\tscheme: {\n\t\t\t\t$init: obj => {\n\t\t\t\t\tobj.start_date = webix.i18n.parseFormatDate(obj.start_date);\n\t\t\t\t\tobj.end_date = webix.i18n.parseFormatDate(obj.end_date);\n\t\t\t\t\tupdateTaskDuration(obj);\n\t\t\t\t\tobj.type = obj.type || \"task\";\n\t\t\t\t\tobj.open = obj.opened ? obj.opened * 1 : 0;\n\t\t\t\t},\n\t\t\t\t$sort: {\n\t\t\t\t\tby: \"position\",\n\t\t\t\t\tdir: \"asc\",\n\t\t\t\t\tas: \"int\",\n\t\t\t\t},\n\t\t\t\t$serialize: data => this.taskOut(data),\n\t\t\t\t$export: data => this.taskOut(data),\n\t\t\t},\n\t\t}));\n\n\t\ttasks.parse(\n\t\t\tthis.app\n\t\t\t\t.getService(\"backend\")\n\t\t\t\t.tasks()\n\t\t\t\t.then(data => getTree(data, 0))\n\t\t);\n\t\treturn tasks;\n\t}\n\t/** Re-paintes all tasks in chart */\n\trefreshTasks(updID, i) {\n\t\t// console.log(\"[x] render tasks\");\n\t\tif (!updID) {\n\t\t\tthis._tasks.data.order.forEach((id, i) => {\n\t\t\t\tthis.refreshTasks(id, i);\n\t\t\t});\n\t\t} else {\n\t\t\tconst t = this._tasks.getItem(updID);\n\t\t\ti = !webix.isUndefined(i) ? i : this._tasks.getIndexById(updID);\n\t\t\tupdateTask(t, i, this._scales, this._taskHeight);\n\t\t}\n\t}\n\t/**\n\t * Creates, fills and returns links collection\n\t * @returns {object} links Data Collection\n\t */\n\tlinks() {\n\t\tif (this._links) return this._links;\n\n\t\tconst links = (this._links = new webix.DataCollection({\n\t\t\ton: {\n\t\t\t\t\"data->onStoreUpdated\": id => this.refreshLinks(id),\n\t\t\t},\n\t\t\tscheme: {\n\t\t\t\t$init: obj => {\n\t\t\t\t\tobj.type = obj.type * 1;\n\t\t\t\t},\n\t\t\t},\n\t\t}));\n\n\t\tlinks.parse(this.app.getService(\"backend\").links());\n\t\treturn links;\n\t}\n\t/** Re-paints all links in chart */\n\trefreshLinks() {\n\t\tif (this._links)\n\t\t\tthis._links.data.each(l => {\n\t\t\t\tconst s = this._tasks.getItem(l.source);\n\t\t\t\tconst e = this._tasks.getItem(l.target);\n\t\t\t\tif (!s || !e || !this._isTaskVisible(s) || !this._isTaskVisible(e))\n\t\t\t\t\tl.$p = \"\";\n\t\t\t\telse updateLink(l, s, e, this._taskHeight);\n\t\t\t});\n\t}\n\t/**\n\t * Returns all links of a particular type for the specified task\n\t * @param {string, number} id - task id\n\t * @param {type} type - link type, \"source\" or \"target\"\n\t * @returns {array} links array\n\t */\n\tgetLinks(id, type) {\n\t\tconst found = this._links.find(a => a[type] == id);\n\t\tconst res = [];\n\n\t\tfor (let i = 0; i < found.length; i++) {\n\t\t\tconst a = found[i];\n\t\t\tconst t = this._tasks.getItem(a[type == \"source\" ? \"target\" : \"source\"]);\n\t\t\tif (t)\n\t\t\t\tres.push({\n\t\t\t\t\tid: a.id,\n\t\t\t\t\ttype: a.type.toString(),\n\t\t\t\t\ttext: t.text,\n\t\t\t\t\tttype: type,\n\t\t\t\t});\n\t\t}\n\t\treturn res;\n\t}\n\n\t/**\n\t * Checks is a day is a holiday\n\t * @param {Date} date - a date\n\t * @returns {boolean}\n\t * */\n\tisHoliday(date) {\n\t\tconst d = date.getDay();\n\t\treturn d === 0 || d === 6;\n\t}\n\n\ttaskOut(data) {\n\t\tdata = webix.copy(data);\n\n\t\tconst format = this.dateToLocalStr;\n\t\tif (data.start_date) data.start_date = format(data.start_date);\n\t\tif (data.end_date) data.end_date = format(data.end_date);\n\n\t\t// clean $-fields\n\t\tfor (let k in data) {\n\t\t\tif (k.indexOf(\"$\") === 0) delete data[k];\n\t\t}\n\n\t\treturn data;\n\t}\n\n\t/**\n\t * Checks whether the specified task is visible (all parents open)\n\t * @param {object} x - task object\n\t * @returns {boolean} task visibility\n\t */\n\t_isTaskVisible(x) {\n\t\twhile (x.$parent) {\n\t\t\tx = this._tasks.getItem(x.$parent);\n\t\t\tif (!x.open) return false;\n\t\t}\n\n\t\treturn true;\n\t}\n}\n\n// [TODO] optimize, or move to tree-collection\nfunction getTree(data, id) {\n\tconst tree = data.filter(a => a.parent == id);\n\ttree.forEach(a => {\n\t\tconst temp = getTree(data, a.id);\n\t\tif (temp) a.data = temp;\n\t});\n\n\treturn tree;\n}\n","export default class Backend {\n\t/**\n\t * @constructor\n\t * @param {App} app - Jet App instance\n\t * @param {string} url - server url\n\t */\n\tconstructor(app, url) {\n\t\tthis.app = app;\n\t\tthis._url = url;\n\t}\n\t/**\n\t * Returns absolute url based on relative one\n\t * @param {string} path - relative url\n\t * @returns {string} absolute url\n\t */\n\turl(path) {\n\t\treturn this._url + path;\n\t}\n\t/**\n\t * Loads tasks\n\t * @returns {promise} promise that resolves with tasks array\n\t */\n\ttasks() {\n\t\treturn webix.ajax(this.url(\"tasks\")).then(res => res.json());\n\t}\n\t/**\n\t * Loads links\n\t * @returns {promise} promise that resolves with links array\n\t */\n\tlinks() {\n\t\treturn webix.ajax(this.url(\"links\")).then(res => res.json());\n\t}\n\t/**\n\t * Adds task\n\t * @param {object} obj - object with task fields\n\t * @param {number} index - index within a parent branch\n\t * @param {string, number} parent - parent task id, can be \"0\" for root\n\t * @returns {promise} promise that resolves with server response\n\t */\n\taddTask(obj, position, parent) {\n\t\treturn webix\n\t\t\t.ajax()\n\t\t\t.post(this.url(\"tasks\"), { ...obj, position, parent })\n\t\t\t.then(res => res.json());\n\t}\n\t/**\n\t * Removes task\n\t * @param {string, number} id - task id\n\t * @returns {promise} promise that resolves with server response\n\t */\n\tremoveTask(id) {\n\t\treturn webix\n\t\t\t.ajax()\n\t\t\t.del(this.url(\"tasks/\" + id))\n\t\t\t.then(res => res.json());\n\t}\n\t/**\n\t * Updates task\n\t * @param {string, number} id - task id\n\t * @param {object} obj - object with task fields\n\t * @returns {promise} promise that resolves with with server response\n\t */\n\tupdateTask(id, obj) {\n\t\treturn webix\n\t\t\t.ajax()\n\t\t\t.put(this.url(\"tasks/\" + id), obj)\n\t\t\t.then(res => res.json());\n\t}\n\t/**\n\t * Adds link\n\t * @param {object} obj - object with link fields\n\t * @returns {promise} promise that resolves with server response\n\t */\n\taddLink(obj) {\n\t\treturn webix\n\t\t\t.ajax()\n\t\t\t.post(this.url(\"links\"), obj)\n\t\t\t.then(res => res.json());\n\t}\n\t/**\n\t * Updates link\n\t * @param {string, number} id - link id\n\t * @param {object} obj - object with link fields\n\t * @returns {promise} promise that resolves with with server response\n\t */\n\tupdateLink(id, obj) {\n\t\treturn webix\n\t\t\t.ajax()\n\t\t\t.put(this.url(\"links/\" + id), obj)\n\t\t\t.then(res => res.json());\n\t}\n\t/**\n\t * Removes link\n\t * @param {string, number} id - task id\n\t * @returns {promise} promise that resolves with server response\n\t */\n\tremoveLink(id) {\n\t\treturn webix\n\t\t\t.ajax()\n\t\t\t.del(this.url(\"links/\" + id))\n\t\t\t.then(res => res.json());\n\t}\n}\n","import {\n\taddUnit,\n\tupdateTaskDuration,\n\tgetUnitStart,\n\tsmallerCount,\n} from \"../libs/gantt\";\nexport default class Operations {\n\t/**\n\t * @constructor\n\t * @param {App} app - Jet App instance\n\t */\n\tconstructor(_app) {\n\t\tthis._app = _app;\n\t\tthis._local = this._app.getService(\"local\");\n\t\tthis._back = this._app.getService(\"backend\");\n\t}\n\t/**\n\t * Adds task\n\t * @param {object} obj - object with task fields\n\t * @param {number} index - index within a parent branch\n\t * @param {string, number} parent - parent task id, can be \"0\" for root\n\t * @returns {promise} promise that resolves with task object\n\t */\n\taddTask(obj, index, parent) {\n\t\treturn this._back.addTask(obj, index, parent).then(added => {\n\t\t\tthis._local.adjustScale(obj.start_date, obj.end_date);\n\n\t\t\tconst tasks = this._local.tasks();\n\t\t\ttasks.add(\n\t\t\t\t{ ...obj, id: added.id, parent, position: index },\n\t\t\t\tindex,\n\t\t\t\tparent\n\t\t\t);\n\n\t\t\tif (parent) {\n\t\t\t\tthis.syncProject(parent);\n\t\t\t}\n\n\t\t\t// tasks are added at specific position, so move all that follow\n\t\t\tthis.updateKidPositions(parent, { start: index });\n\n\t\t\treturn added;\n\t\t});\n\t}\n\t/**\n\t * Updates task\n\t * @param {string, number} id - task id\n\t * @param {object} obj - object with task fields\n\t * @param {boolean} inner - flag to mark inner logic call\n\t * @returns {promise} promise that resolves with task fields\n\t */\n\tupdateTask(id, obj, inner) {\n\t\tconst tasks = this._local.tasks();\n\t\tconst item = webix.copy(tasks.getItem(id));\n\t\tconst next = { ...item, ...obj };\n\t\tupdateTaskDuration(next);\n\n\t\tif (id === \"$temp\") return this.saveTempTask(next);\n\n\t\tif (!inner && obj.type == \"project\" && item.type != \"project\")\n\t\t\treturn this.syncProject(id, next);\n\n\t\treturn this._back.updateTask(id, next).then(() => {\n\t\t\t// scale must be updated before the task\n\t\t\tif (!inner) this._local.adjustScale(next.start_date, next.end_date);\n\n\t\t\ttasks.updateItem(id, next);\n\n\t\t\tif (!inner) {\n\t\t\t\tif (\n\t\t\t\t\t!(\n\t\t\t\t\t\twebix.Date.equal(item.start_date, obj.end_date) &&\n\t\t\t\t\t\twebix.Date.equal(item.end_date, obj.end_date)\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\tif (item.$count && item.type == \"project\")\n\t\t\t\t\t\tthis.syncTasks(id, item.start_date, obj.start_date).then(() => {\n\t\t\t\t\t\t\tthis.syncProject(item.parent);\n\t\t\t\t\t\t});\n\t\t\t\t\telse this.syncProject(item.parent);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn next;\n\t\t});\n\t}\n\t/**\n\t * Updates related tasks when project start changes\n\t * @param {string, number} id - project id\n\t * @param {Date} old - old start date\n\t * @param {Date} change - current start date\n\t */\n\tsyncTasks(id, old, change) {\n\t\tconst diff = change - old;\n\t\tif (diff) {\n\t\t\tconst p = [];\n\t\t\tthis._local.tasks().data.eachSubItem(id, kid => {\n\t\t\t\tconst changedKid = {\n\t\t\t\t\t...kid,\n\t\t\t\t\tstart_date: new Date(kid.start_date.valueOf() + diff),\n\t\t\t\t\tend_date: null,\n\t\t\t\t};\n\t\t\t\tupdateTaskDuration(changedKid);\n\n\t\t\t\tp.push(this.updateTask(kid.id, changedKid, true));\n\t\t\t});\n\t\t\treturn webix.promise.all(p);\n\t\t}\n\t\treturn webix.promise.resolve();\n\t}\n\t/**\n\t * Updates related project when task start or end date changes\n\t * @param {string, number} id - task id\n\t * @param {object} item - task object, if it is converted to project\n\t */\n\tsyncProject(id, item) {\n\t\tconst tasks = this._local.tasks();\n\n\t\tif (!item) {\n\t\t\titem = tasks.getItem(id);\n\t\t\twhile (item && item.type != \"project\") {\n\t\t\t\tid = tasks.getParentId(id);\n\t\t\t\titem = tasks.getItem(id);\n\t\t\t}\n\t\t}\n\t\tif (item && item.$count) {\n\t\t\tlet min = Infinity,\n\t\t\t\tmax = 0,\n\t\t\t\tprogress = 0,\n\t\t\t\tduration = 0;\n\t\t\titem.duration = null;\n\n\t\t\ttasks.data.eachSubItem(id, kid => {\n\t\t\t\tmin = kid.start_date < min ? kid.start_date : min;\n\t\t\t\tmax = kid.end_date > max ? kid.end_date : max;\n\t\t\t\tif (kid.duration && !(kid.type == \"project\" && kid.$count)) {\n\t\t\t\t\tprogress += kid.duration * kid.progress;\n\t\t\t\t\tduration += kid.duration * 1;\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (!webix.Date.equal(item.start_date, min)) item.start_date = min;\n\t\t\tif (!webix.Date.equal(item.end_date, max)) item.end_date = max;\n\t\t\titem.progress = progress ? Math.round(progress / duration) : progress;\n\t\t}\n\t\tif (item)\n\t\t\treturn this.updateTask(id, item, true).then(() => {\n\t\t\t\tthis.syncProject(item.parent);\n\t\t\t\treturn item;\n\t\t\t});\n\t}\n\t/**\n\t * Updates task time after drag-n-drop\n\t * @param {string, number} id - task id\n\t * @param {string} mode - type of change: \"start\", \"end\" or \"move\"\n\t * @param {number} time - number of units by which task was shifted, can be negative\n\t * @returns {promise} promise that resolves with change object\n\t */\n\tupdateTaskTime(id, mode, time) {\n\t\tconst tasks = this._local.tasks();\n\t\tconst task = tasks.getItem(id);\n\n\t\tconst obj = {};\n\t\tconst s = this._local.getScales();\n\n\t\tconst unit = s.precise ? smallerCount[s.minUnit][0] : s.minUnit;\n\t\tif (mode === \"start\" || mode === \"move\") {\n\t\t\tconst offsetDate = s.precise\n\t\t\t\t? task.start_date\n\t\t\t\t: getUnitStart(unit, task.start_date);\n\t\t\tobj.start_date = addUnit(unit)(offsetDate, time);\n\t\t\tif (mode === \"start\" && obj.start_date > task.end_date)\n\t\t\t\tobj.start_date = addUnit(unit)(task.end_date, -1);\n\t\t}\n\t\tif (mode === \"end\") {\n\t\t\tconst offsetDate = s.precise\n\t\t\t\t? task.end_date\n\t\t\t\t: getUnitStart(unit, addUnit(unit)(task.end_date, 1));\n\t\t\tobj.end_date = addUnit(unit)(offsetDate, time);\n\t\t\tif (obj.end_date < task.start_date)\n\t\t\t\tobj.end_date = addUnit(unit)(task.start_date, 1);\n\t\t}\n\n\t\tif (mode === \"move\") obj.end_date = null;\n\t\telse obj.duration = 0;\n\n\t\tif (id === \"$temp\") {\n\t\t\tconst ntask = { ...task, ...obj };\n\t\t\tupdateTaskDuration(ntask);\n\t\t\treturn this.saveTempTask(ntask);\n\t\t}\n\n\t\treturn this.updateTask(id, obj);\n\t}\n\t/**\n\t * Removes task\n\t * @param {string, number} id - task id\n\t * @returns {promise} promise that resolves with server response\n\t */\n\tremoveTask(id) {\n\t\tconst tasks = this._local.tasks();\n\t\tconst links = this._local.links();\n\n\t\t// [FIXME] - multiple redraw calls\n\t\tconst toRemove = links.find(a => a.source == id || a.target == id);\n\t\ttoRemove.forEach(a => links.remove(a.id));\n\n\t\treturn this._back.removeTask(id).then(res => {\n\t\t\tconst parent = tasks.getItem(id).parent;\n\t\t\ttasks.remove(id);\n\t\t\tthis.syncProject(parent);\n\t\t\treturn res;\n\t\t});\n\t}\n\t/**\n\t * Saves temp task (must be selected)\n\t * @param {object} obj - object with task fields\n\t * @param {number, string} pid - (optional) the ID of the parent task\n\t * @param {number} index - (optional) the position inside the parent branch to insert the new task at (counting from 0)\n\t * @returns {promise} promise that resolves with server response\n\t */\n\tsaveTempTask(obj, pid, index) {\n\t\tconst state = this._app.getState();\n\n\t\tif (webix.isUndefined(pid) || webix.isUndefined(index)) {\n\t\t\tconst tasks = this._local.tasks();\n\t\t\tindex = tasks.getBranchIndex(state.selected);\n\t\t\tpid = state.parent === \"0\" ? 0 : state.parent;\n\t\t}\n\n\t\treturn this.addTask(obj, index, pid).then(res => {\n\t\t\treturn (state.selected = res.id);\n\t\t});\n\t}\n\t/**\n\t * Adds link\n\t * @param {object} obj - object with link fields\n\t * @returns {promise} promise that resolves with link object\n\t */\n\taddLink(obj) {\n\t\treturn this._back.addLink(obj).then(added => {\n\t\t\tobj.id = added.id;\n\t\t\tthis._local.links().add(obj);\n\t\t\treturn obj;\n\t\t});\n\t}\n\t/**\n\t * Updates link\n\t * @param {string, number} id - link id\n\t * @param {object} obj - object with link fields\n\t * @returns {promise} promise that resolves with server response\n\t */\n\tupdateLink(id, obj) {\n\t\treturn this._back.updateLink(id, obj).then(res => {\n\t\t\tthis._local.links().updateItem(id, obj);\n\t\t\treturn res;\n\t\t});\n\t}\n\t/**\n\t * Removes link\n\t * @param {string, number} id - link id\n\t * @returns {promise} promise that resolves with server response\n\t */\n\tremoveLink(id) {\n\t\treturn this._back.removeLink(id).then(res => {\n\t\t\tthis._local.links().remove(id);\n\t\t\treturn res;\n\t\t});\n\t}\n\t/**\n\t * Moves the task to a new position within the task tree\n\t * @param {string, number} id - the ID of the task\n\t * @param {string, number} parent - the ID of the parent/branch (0 for root)\n\t * @param {number} index - the position within the target branch or root (starting from 0)\n\t * @returns {promise|null} - the promise of data operation or null\n\t */\n\tmoveTask(id, parent, index) {\n\t\tparent = parent || 0;\n\n\t\tconst tasks = this._local.tasks();\n\t\tconst branch = tasks.data.branch[parent];\n\t\tconst oldParent = tasks.getItem(id).parent;\n\t\tconst oldIndex = tasks.data.getBranchIndex(id);\n\t\tif (\n\t\t\tparent == oldParent &&\n\t\t\t(index === oldIndex || (index === -1 && id === branch[branch.length - 1]))\n\t\t)\n\t\t\treturn null;\n\n\t\ttasks.move(id, index, null, { parent });\n\n\t\treturn this.updateTask(id, { parent }, true)\n\t\t\t.then(() => {\n\t\t\t\tthis.updateKidPositions(parent, {\n\t\t\t\t\tstart: index === -1 ? branch.length - 1 : index,\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch(() => {\n\t\t\t\ttasks.move(id, oldIndex, null, {\n\t\t\t\t\tparent: oldParent,\n\t\t\t\t});\n\t\t\t});\n\t}\n\t/**\n\t * Updates positions of siblings of an inserted item\n\t * @param {number, string} parent - the ID of the branch root item\n\t * @param {number, string} id - the ID of the newly inserted item\n\t * @param {Object} range - (optional), can have start and/or end properties, that store indexes of those kids that need to update their positions\n\t */\n\tupdateKidPositions(parent, range) {\n\t\tconst tasks = this._local.tasks();\n\t\tconst branch = tasks.data.branch[parent];\n\n\t\tconst start = webix.isUndefined(range.start) ? 0 : Math.max(range.start, 0);\n\t\tconst end = webix.isUndefined(range.end)\n\t\t\t? branch.length\n\t\t\t: Math.min(range.end, branch.length);\n\n\t\tlet first = start ? tasks.getItem(branch[start - 1]).position + 1 : 0;\n\t\tfor (let index = start; index < end; index++) {\n\t\t\tthis.updateTask(branch[index], { position: first + index - start }, true);\n\t\t}\n\t}\n}\n","import { JetApp, plugins, EmptyRouter } from \"webix-jet\";\nimport { createState, link } from \"jet-restate\";\n\nimport views from \"./export_views\";\nimport en from \"locales/en\";\n\n// services\nimport Local from \"./models/Local\";\nimport Backend from \"./models/Backend\";\nimport Operations from \"./models/Operations\";\n\nexport class App extends JetApp {\n\tconstructor(config) {\n\t\t// widget state\n\t\tconst state = createState({\n\t\t\ttop: 0,\n\t\t\tleft: 0,\n\t\t\tselected: null,\n\t\t\tparent: null,\n\t\t\treadonly: config.readonly || false,\n\t\t\tsort: null,\n\t\t});\n\n\t\tconst defaults = {\n\t\t\trouter: EmptyRouter,\n\t\t\tversion: VERSION,\n\t\t\tdebug: DEBUG,\n\t\t\tstart: \"/top\",\n\t\t\tcompactWidth: 650,\n\t\t\tmarkers: [{ css: \"webix_gantt_today_marker\", now: true }],\n\t\t\tparams: { state, forceCompact: config.compact },\n\t\t};\n\n\t\tsuper({ ...defaults, ...config });\n\n\t\t// better error reporting\n\t\tif (this.config.debug) {\n\t\t\twebix.Promise = window.Promise;\n\t\t}\n\n\t\tconst dynamic = obj =>\n\t\t\tthis.config.override ? this.config.override.get(obj) || obj : obj;\n\n\t\tthis.setService(\"local\", new (dynamic(Local))(this, config));\n\t\tthis.setService(\"backend\", new (dynamic(Backend))(this, config.url));\n\t\tthis.setService(\"operations\", new (dynamic(Operations))(this));\n\n\t\tthis.use(\n\t\t\tplugins.Locale,\n\t\t\tthis.config.locale || {\n\t\t\t\tlang: \"en\",\n\t\t\t\twebix: {\n\t\t\t\t\ten: \"en-US\",\n\t\t\t\t},\n\t\t\t}\n\t\t);\n\t}\n\n\trequire(type, name) {\n\t\tif (type === \"jet-views\") return views[name];\n\t\telse if (type === \"jet-locales\") return locales[name];\n\n\t\treturn null;\n\t}\n\n\t// for external users\n\tgetState() {\n\t\treturn this.config.params.state;\n\t}\n}\n\nwebix.protoUI(\n\t{\n\t\tname: \"gantt\",\n\t\tapp: App,\n\t\tgetState() {\n\t\t\treturn this.$app.getState();\n\t\t},\n\t\tgetService(name) {\n\t\t\treturn this.$app.getService(name);\n\t\t},\n\t\t$init() {\n\t\t\tconst state = this.$app.getState();\n\t\t\tfor (let key in state) {\n\t\t\t\tlink(state, this.config, key);\n\t\t\t}\n\t\t},\n\t\t$exportView: function() {\n\t\t\treturn this.$app.getService(\"local\").tasks();\n\t\t},\n\t},\n\twebix.ui.jetapp\n);\n\n// re-export for customization\nconst services = { Local, Backend, Operations };\nconst locales = { en };\nexport { views, locales, services };\n","export default {\n\tEdit: \"Edit\",\n\tDone: \"Done\",\n\t\"Delete task\": \"Delete task\",\n\t\"Delete link\": \"Delete link\",\n\t\"The task will be deleted permanently, are you sure?\":\n\t\t\"The task will be deleted permanently, are you sure?\",\n\t\"The link will be deleted permanently, are you sure?\":\n\t\t\"The link will be deleted permanently, are you sure?\",\n\tPredecessors: \"Predecessors\",\n\tSuccessors: \"Successors\",\n\n\tTitle: \"Title\",\n\t\"Start date\": \"Start date\",\n\t\"End date\": \"End date\",\n\tDuration: \"Duration\",\n\tProgress: \"Progress\",\n\tNotes: \"Notes\",\n\tType: \"Type\",\n\tProject: \"Project\",\n\tMilestone: \"Milestone\",\n\t\"Add task\": \"Add task\",\n\t\"Add project\": \"Add project\",\n\t\"(no title)\": \"(no title)\",\n\t\"Save changes?\": \"Save changes?\",\n\n\t\"Related tasks\": \"Related tasks\",\n\tTask: \"Task\",\n\tLink: \"Link\",\n\t\"End to start\": \"End to start\",\n\t\"Start to start\": \"Start to start\",\n\t\"End to end\": \"End to end\",\n\t\"Start to end\": \"Start to End\",\n\n\tLasts: \"Lasts\",\n\tday: \"day\",\n\tdays: \"days\",\n};\n"],"names":["webix","config","this","webixJet","_events","_subs","_data","params","extend","JetBase","_root","_detachEvents","_destroySubs","_container","app","_parent","id","value","url","_segment","update","show","parent","view","getParentView","getParam","suburl","toString","root_1","getRoot","queryView","obj","localId","$scope","name","code","attachEvent","push","key","kid","contains","sub","getSubViewInfo","subview","popup","events","i","length","detachEvent","subView","destructor","current","default","branch","child","_getDefaultSub","_routed_view","parse","substr","parts","split","chunks","test","result","pos","indexOf","params_1","_i","dchunk","decodeURIComponent","page","isNew","url2str","stack","stack_1","chunk","obj2str","join","str","encodeURIComponent","route","index","_next","path","Route","slice","setParams","old","kids","reset","concat","_join","Promise","res","rej","redirect","confirm","resolve","callEvent","NavigationBlocked","catch","err","then","_this","n","_super","_children","__extends","JetView","ui","container","jetview","createView","render","setParam","parent_1","target","_renderFrameLock","_show","segment","_init_url_data","_urlChange","linkRouter","getRouter","set","silent","_$view","_$","_$url","message","destroy","_destroyKids","plugin","getUrl","tagName","refresh","_render","root","document","body","toNode","cfg","_render_final","response","slot","$$","reject","copyConfig","oldui","parent_2","asWin","setPosition","isVisible","_init","_initUrl","ready","e","_initError","init","waits","frame","wait","all","urlChange","lock","_renderFrame","next","_createSubView","shift","_override","error","createFromURL","uis","_ui","JetViewRaw","cb","SubRouter","a","append","_once","window","version","start","_services","EventSystem","JetAppBase","_subSegment","handler","getSubView","prototype","$subview","addSubView","isArray","Array","method","point","DataCollection","RegExp","Map","Date","copy","$router","srcElement","getAttribute","trigger_1","_forView","trigger","cancelBubble","preventDefault","route_1","parentNode","clickHandler","views","_loadError","Error","hidden","replace","require","module","__esModule","loadView","over","override","dv","get","router","rest","apply","data","bind","er","debug","console","text","innerHTML","type","expire","event","_first_start","top","base","setTimeout","animation","node_1","html","addCss","removeCss","now","urlString","template","uid","_detectPrefix","onpopstate","HashRouter","routes","compare","history","pushState","prefix","sufix","_getRaw","routerPrefix","location","href","isPatched","patch","w","win","promise","freeze","some","$freeze","resize","baseAdd","baselayout","addView","baseRemove","removeView","jview_1","subs_1","arguments","subs","layout","protoUI","$init","$app","$ready","proxy","JetApp","UrlRouter","pathname","search","_$config","EmptyRouter","has","store","Object","hasOwnProperty","call","forEach","context","warn","x","String","russianPluralGroups","end","pluralTypes","arabic","lastTwo","bosnian_serbian","chinese","croatian","french","german","russian","lithuanian","czech","polish","icelandic","slovenian","pluralTypeToLanguages","pluralTypeName","locale","ret","langToPluralType","langs","lang","en","escape","token","dollarRegex","defaultTokenRegex","transformPhrase","phrase","substitutions","tokenRegex","TypeError","interpolationRegex","options","smart_count","texts","count","pluralTypeIndex","expression","argument","Polyglot","opts","phrases","currentLocale","allowMissing","onMissingKey","suffix","RangeError","constructTokenRegex","interpolation","newLocale","morePhrases","prefixedKey","unset","clear","newPhrases","t","_","webixPolyglot","plugins","_view","storage","setLangData","pconfig","polyglot","poly","service","put","locName","i18n","setLocale","setLang","getLang","setService","link","source","defineProperty","createState","handlers","out","observe","mask","undefined","queue","waitInQueue","notify","meta","list","keys","enumerable","configurable","values_1","sconfig","nested","reactive","$extend","val","valueOf","d","differenceInCalendarDays","b","setHours","Math","round","getTime","differenceInHours","getHours","f_cache","format","date","formatFunction","dateToStr","diff","year","getFullYear","quarter","floor","getMonth","month","week","ceil","abs","getDay","sign","day","hour","minute","getMinutes","smallerCount","sdate","m","y","add","inc","innerDiff","unit","prev","precise","wt","minUnit","getUnitStart","addUnit","filled","getDiff","sameMonth","daysOfFirstMonth","getDate","me","months","monthStart","getMonthDayDiff","equal","setDate","resetScales","width","height","scales","map","item","len","sort","getMinUnit","tempEnd","fullWidth","fullHeight","rows","line","cells","step","countInWeeks","cdate","cnext","cellWidth","css","cellHeight","DragScroll","ctx","_auto_scroll_delay","delay","autoScroll","clearTimeout","yScroll","direction","xScroll","box","offset","from","$view","autoYScroll","senseY","autoXScroll","senseX","DragControl","active","node","getNode","$dragPos","style","left","updateDragPos","sense","scroll","getScrollState","autoScrollTo","mode","scrollTo","updateTaskDuration","start_date","end_date","duration","parseFloat","toFixed","updateLink","startTask","endTask","sx","sy","ex","ey","dy","$p","s_start","e_start","$x","$w","$y","lineCoords","gapp","sx1","ex1","dx","same","getLineCoords","arrowCoords","initDnD","ctrl","master","Local","getService","addDrag","addDrop","getMoveMode","rect","getBoundingClientRect","p","minWidth","env","touch","delta","updateDragScrollConfig","ds","getScales","$longTouchLimit","$dragCreate","State","readonly","locateEvent","getContext","classList","Modes","getItemNode","isProgressDrag","scroll_1","evContext","getEventContext","getItem","nsc","parseInt","l","dragScroll","cloneNode","className","visibility","cursor","querySelector","appendChild","$dragDestroy","$waitUpdate","Action","action","finally","remove","$dragIn","s","$dragOut","$drop","time","ev","elementFromPoint","locate","changedTouches","touches","pageX","pageY","mouse","clientX","clientY","setDragOffset","x_offset","y_offset","nscroll","min","max","links","fromStart","opacity","create","toStart","move","progress","prevProgress","progressNode","updateTaskTemplate","isUndefined","DragProgressTemplate","BarsView","borderless","relative","BarsType","on","onItemClick","$batch","selected","tooltip","GetTooltip","_a","getChildViews","bars","Links","Bars","local","tdata","TasksData","tasks","ldata","LinksData","sync","RefreshLinks","HandleScroll","HandleDrag","HandleSelection","InitMarkers","HandleHolidays","Resize","SetSelection","backgroundImage","color","canvas","createElement","setAttribute","strokeStyle","moveTo","lineTo","stroke","toDataURL","grid","skin","$name","marginTop","BarsTemplate","templateStart","task","ms","h","$h","sqrt","pow","drag","templateEnd","_mousemove_handler","switchCursor","eventRemove","_scroll_handler","Markers","$interval","clearInterval","temp","scrollTop","scrollLeft","lines","GetLinks","attrs","viewBox","scrollWidth","scrollHeight","holidaysContainer","containerForMarkers","backgroundPosition","$changes","selLine","class","insertBefore","firstChild","getIndexById","markers","RenderMarkers","setInterval","GetMarkerPosition","MarkerTemplate","astart","order","each","LinksTemplate","setHTML","tid","find","_taskHeight","area","minHeight","ops","inProgress","updateTaskTime","refreshTasks","RefreshTaskLinks","updateTask","addLink","top_1","newLink","shift_1","points","RenderHolidays","dayStart","hourOffset","isHoliday","HolidayTemplate","timePart","parser","longDateFormatStr","tip","ScalesView","state","RenderScales","canMarkHolidays","cell","CellTemplate","ChartView","ScaleView","v","hide","TableView","header","autoheight","editable","scheme","$group","by","columns","fillspace","ttype","c","conf","collection","editor","onBeforeEditStart","onBeforeEditStop","UpdateLink","row","onAfterLoad","openAll","onClick","wxi-trash","title","DeleteLink","Ops","FillData","related","getLinks","clearAll","blockEvent","editCancel","unblockEvent","updateItem","removeLink","FormView","Compact","aSkin","$active","margin","padding","bottom","layoutPadding","form","inputHeight","right","elements","icon","click","Close","Done","elementsConfig","labelPosition","label","onChange","ToggleControls","UpdateTaskTime","UpdateTask","Tasks","Form","setValues","focus","f","$eventSource","vals","getValues","_inProgress","saveTempTask","enable","isDirty","Back","exit","TaskView","editButton","EditTask","bar","info","InfoTemplate","deleteButton","align","inputWidth","DeleteTask","Text","FillTemplate","sources","targets","removeTask","empty","DateFormat","InfoTemplateChunk","details","arr","TaskPopup","fullscreen","head","TreeView","compact","common","treetable","batch","localeCompare","ignorePunctuation","numeric","dateFormatStr","unshift","tree","prerender","rowHeight","headerRowHeight","scrollAlignY","select","resizeColumn","headerOnly","size","wxi-plus","AddTempTask","wxi-plus-circle","gti-menu","ToggleColumns","onAfterOpen","RefreshTasks","opened","onAfterClose","onAfterSort","dir","as","SortTasks","onColumnResize","o","user","NormalizeColumns","onBeforeDrop","moveTask","Tree","waitData","setState","oid","ClearTempTask","unselect","pid","GetTempTask","open","exists","showItem","dataSorter","sortState","getState","vis","isColumnVisible","showColumnBatch","getColumnIndex","last","refreshColumns","sizeTrigger","_compactValue","_compactWidth","_compactHandler","_checkTrigger","$setSize","TopView","fCompact","edit","cols","compactWidth","SetCompactMode","ShowTask","HideTask","ProgressBar","showProgress","hideProgress","m0","m1","m2","m3","m4","m5","m6","m7","m8","scaleStart","scaleEnd","setScales","preciseTimeUnit","scaleCellWidth","barHeight","borderWidth","dateToLocalStr","parseFormat","_scaleBase","_scales","_tasks","TreeCollection","data->onStoreLoad","min_1","Infinity","max_1","data->onStoreUpdated","refreshLinks","parseFormatDate","$sort","$serialize","taskOut","$export","getTree","filter","updID","taskHeight","startDate","endDate","_links","_isTaskVisible","found","k","$parent","_url","Backend","ajax","json","position","post","del","_app","_local","_back","Operations","addTask","added","adjustScale","syncProject","updateKidPositions","inner","$count","syncTasks","change","p_1","eachSubItem","changedKid","getParentId","progress_1","duration_1","offsetDate","ntask","getBranchIndex","oldParent","oldIndex","range","first","defaults","forceCompact","dynamic","use","App","locales","$exportView","jetapp","services","Edit","Delete task","Delete link","The task will be deleted permanently, are you sure?","The link will be deleted permanently, are you sure?","Predecessors","Successors","Title","Start date","End date","Duration","Progress","Notes","Type","Project","Milestone","Add task","Add project","(no title)","Save changes?","Related tasks","Task","Link","End to start","Start to start","End to end","Start to end","Lasts","days"],"mappings":";;;;;;;;;;;;;;;;;;;;;8lBAAA,0BAII,WAAYA,EAAOC,GACfC,KAAKC,UAAW,EAChBD,KAAKF,MAAQA,EACbE,KAAKE,QAAU,GACfF,KAAKG,MAAQ,GACbH,KAAKI,MAAQ,GACTL,GAAUA,EAAOM,QACjBP,EAAMQ,OAAON,KAAKI,MAAOL,EAAOM,QAoI5C,OAlIIE,oBAAA,WACI,OAAOP,KAAKQ,OAEhBD,uBAAA,WACIP,KAAKS,gBACLT,KAAKU,eACLV,KAAKE,QAAUF,KAAKW,WAAaX,KAAKY,IAAMZ,KAAKa,QAAUb,KAAKQ,MAAQ,MAE5ED,qBAAA,SAASO,EAAIC,EAAOC,GAChB,GAAIhB,KAAKI,MAAMU,KAAQC,IACnBf,KAAKI,MAAMU,GAAMC,EACjBf,KAAKiB,SAASC,OAAOJ,EAAIC,EAAO,GAC5BC,GACA,OAAOhB,KAAKmB,KAAK,OAI7BZ,qBAAA,SAASO,EAAIM,GACT,IAAML,EAAQf,KAAKI,MAAMU,GACzB,QAAqB,IAAVC,IAA0BK,EACjC,OAAOL,EAEX,IAAMM,EAAOrB,KAAKsB,gBAClB,OAAID,EACOA,EAAKE,SAAST,EAAIM,QAD7B,GAIJb,mBAAA,WACI,OAAOP,KAAKiB,SAASO,UAEzBjB,yBAAA,WACI,OAAOP,KAAKiB,SAASQ,YAEzBlB,0BAAA,WACI,OAAOP,KAAKa,SAEhBN,eAAA,SAAGO,GACC,GAAkB,iBAAPA,EAAiB,CACxB,IAAMY,EAAO1B,KAAK2B,UAClB,OAAOD,EAAKE,oBAAWC,GAAO,OAACA,EAAI9B,OAAOe,KAAOA,GAAMe,EAAI9B,OAAO+B,UAAYhB,IACzEe,EAAIE,SAAWL,EAAKK,SAAU,QAGnC,OAAOjB,GAGfP,eAAA,SAAGsB,EAAKG,EAAMC,GACV,IAAMnB,EAAKe,EAAIK,YAAYF,EAAMC,GAEjC,OADAjC,KAAKE,QAAQiC,KAAK,CAAEN,MAAKf,OAClBA,GAEXP,qBAAA,SAASc,GACL,IAAK,IAAMe,KAAOpC,KAAKG,MAAO,CAC1B,IAAMkC,EAAMrC,KAAKG,MAAMiC,GAAKf,KAC5B,GAAIgB,IAAQhB,GAAQgB,EAAIC,SAASjB,GAC7B,OAAO,EAGf,OAAO,GAEXd,uBAAA,SAAWyB,GACP,IAAMO,EAAMvC,KAAKwC,eAAeR,GAChC,GAAIO,EACA,OAAOA,EAAIE,QAAQpB,MAG3Bd,2BAAA,SAAeyB,GACX,IAAMO,EAAMvC,KAAKG,MAAM6B,GAAQ,WAC/B,OAAIO,EACO,CAAEE,QAASF,EAAKnB,OAAQpB,MAEtB,SAATgC,GACAhC,KAAKG,MAAM6B,GAAQ,CAAEhB,IAAK,GAAIF,GAAI,KAAM4B,OAAO,GACxC1C,KAAKwC,eAAeR,IAG3BhC,KAAKa,QACEb,KAAKa,QAAQ2B,eAAeR,GAEhC,MAEXzB,0BAAA,WAEI,IADA,IAAMoC,EAAS3C,KAAKE,QACX0C,EAAID,EAAOE,OAAS,EAAGD,GAAK,EAAGA,IACpCD,EAAOC,GAAGf,IAAIiB,YAAYH,EAAOC,GAAG9B,KAG5CP,yBAAA,WAEI,IAAK,IAAM6B,KAAOpC,KAAKG,MAAO,CAC1B,IAAM4C,EAAU/C,KAAKG,MAAMiC,GAAKf,KAG5B0B,GACAA,EAAQC,aAIhBhD,KAAKG,MAAQ,IAEjBI,2BAAA,WACI,IAAMS,EAAMhB,KAAKiB,SAASgC,UAC1BjD,KAAKI,MAAQ,GACbJ,KAAKF,MAAMQ,OAAON,KAAKI,MAAOY,EAAIX,QAAQ,IAE9CE,2BAAA,WACI,GAAIP,KAAKG,MAAM+C,QACX,OAAOlD,KAAKG,MAAM+C,QAEtB,IAAK,IAAMd,KAAOpC,KAAKG,MAAO,CAC1B,IAAMoC,EAAMvC,KAAKG,MAAMiC,GACvB,IAAKG,EAAIY,QAAUZ,EAAIlB,MAAgB,SAARe,EAAgB,CAC3C,IAAMgB,EAAQb,EAAIlB,KAAKgC,iBACvB,GAAID,EACA,OAAOA,KAKvB7C,yBAAA,WACI,IAAMa,EAASpB,KAAKsB,gBACpB,IAAKF,EACD,OAAO,EAEX,IAAMmB,EAAMnB,EAAOiC,iBACnB,SAAKd,GAAOA,IAAQvC,OAGboB,EAAOkC,qBAItB,SAASC,EAAMvC,GAEI,MAAXA,EAAI,KACJA,EAAMA,EAAIwC,OAAO,IAMrB,IAHA,IAAMC,EAAQzC,EAAI0C,MAAM,KAClBC,EAAS,GAENf,EAAI,EAAGA,EAAIa,EAAMZ,OAAQD,IAAK,CACnC,IAAMgB,EAAOH,EAAMb,GACbiB,EAAS,GAIXC,EAAMF,EAAKG,QAAQ,KAIvB,IAHa,IAATD,IACAA,EAAMF,EAAKG,QAAQ,OAEV,IAATD,EAGA,IAFA,QAEoBE,EAFLJ,EAAKJ,OAAOM,EAAM,GAAGJ,MAAM,aAEtBO,WAAAA,IAAQ,CAAvB,IACKC,OAAeR,MAAM,KAC3BG,EAAOK,EAAO,IAAMC,mBAAmBD,EAAO,IAItDP,EAAOf,GAAK,CACRwB,KAAON,GAAO,EAAIF,EAAKJ,OAAO,EAAGM,GAAOF,EACxCvD,OAAQwD,EACRQ,OAAO,GAIf,OAAOV,EAEX,SAASW,EAAQC,GAEb,IADA,IAAMvD,EAAM,OACQwD,IAAAP,WAAAA,IAAO,CAAtB,IAAMQ,OACPzD,EAAImB,KAAK,IAAMsC,EAAML,MACrB,IAAM/D,EAASqE,EAAQD,EAAMpE,QACzBA,GACAW,EAAImB,KAAK,IAAM9B,GAGvB,OAAOW,EAAI2D,KAAK,IAEpB,SAASD,EAAQ7C,GACb,IAAM+C,EAAM,GACZ,IAAK,IAAMxC,KAAOP,EACU,iBAAbA,EAAIO,KAEXwC,EAAI/B,QACJ+B,EAAIzC,KAAK,KAEbyC,EAAIzC,KAAKC,EAAM,IAAMyC,mBAAmBhD,EAAIO,MAEhD,OAAOwC,EAAID,KAAK,IAGpB,iBACI,WAAYG,EAAOC,GACf/E,KAAKgF,MAAQ,EAEThF,KAAK8E,MADY,iBAAVA,EACM,CACT9D,IAAKuC,EAAMuB,GACXG,KAAMH,GAIGA,EAEjB9E,KAAK+E,MAAQA,EA+HrB,OA7HIG,oBAAA,WACI,OAAOlF,KAAK8E,MAAM9D,IAAIhB,KAAK+E,QAE/BG,iBAAA,WACI,OAAOlF,KAAK8E,MAAM9D,IAAIhB,KAAK+E,MAAQ/E,KAAKgF,QAE5CE,mBAAA,WACI,OAAOlF,KAAK8E,MAAM9D,IAAImE,MAAMnF,KAAK+E,QAErCG,kBAAA,SAAM7E,GACF,IAAMyE,EAAQ,IAAII,EAAMlF,KAAK8E,MAAO9E,KAAK+E,MAAQ/E,KAAKgF,OAEtD,OADAF,EAAMM,UAAUN,EAAMA,MAAM9D,IAAKX,EAAQyE,EAAMC,OACxCD,GAEXI,sBAAA,SAAUlE,EAAKX,EAAQ0E,GACnB,GAAI1E,EAAQ,CACR,IAAMgF,EAAMrE,EAAI+D,GAAO1E,OACvB,IAAK,IAAI+B,KAAO/B,EACZgF,EAAIjD,GAAO/B,EAAO+B,KAG9B8C,oBAAA,WAEI,IADA,IAAMlE,EAAMhB,KAAK8E,MAAM9D,IACd4B,EAAI5C,KAAK+E,MAAQ,EAAGnC,EAAI5B,EAAI6B,OAAQD,IACzC5B,EAAI4B,GAAGyB,OAAQ,GAGvBa,qBAAA,WACI,IAAMN,EAAMN,EAAQtE,KAAKwB,UACzB,OAAOoD,EAAMA,EAAIpB,OAAO,GAAK,IAEjC0B,kBAAA,SAAMD,EAAMK,GACR,IAAItE,EAAMhB,KAAK8E,MAAM9D,IACrB,GAAa,OAATiE,EACA,OAAOjE,EAEX,IAAMqE,EAAMrF,KAAK8E,MAAM9D,IACnBuE,GAAQ,EAEZ,GADAvE,EAAMqE,EAAIF,MAAM,EAAGnF,KAAK+E,OAASO,EAAOtF,KAAKgF,MAAQ,IACjDC,EAAM,CACNjE,EAAMA,EAAIwE,OAAOjC,EAAM0B,IACvB,IAAK,IAAIrC,EAAI,EAAGA,EAAI5B,EAAI6B,OAAQD,IACxByC,EAAIzC,KACJ5B,EAAI4B,GAAGvB,KAAOgE,EAAIzC,GAAGvB,MAErBkE,GAASF,EAAIzC,IAAM5B,EAAI4B,GAAGwB,OAASiB,EAAIzC,GAAGwB,KAC1CpD,EAAI4B,GAAGyB,OAAQ,EAEVrD,EAAI4B,GAAGyB,QAEZkB,GAAQ,GAIpB,OAAOvE,GAEXkE,mBAAA,SAAOD,GACH,IAAMjE,EAAMhB,KAAKyF,MAAMR,GAAM,GAG7B,OAFAjF,KAAK8E,MAAMG,KAAOX,EAAQtD,GAC1BhB,KAAK8E,MAAM9D,IAAMA,EACVhB,KAAK8E,MAAMG,MAEtBC,iBAAA,SAAKD,EAAM5D,EAAMiE,GAAjB,WACUtE,EAAMhB,KAAKyF,MAAMR,EAAKjE,IAAKsE,GAEjC,OADAtF,KAAKoF,UAAUpE,EAAKiE,EAAK5E,OAAQL,KAAK+E,OAASO,EAAOtF,KAAKgF,MAAQ,IAC5D,IAAIU,SAAQ,SAACC,EAAKC,GACrB,IAAMC,EAAWvB,EAAQtD,GACnBa,EAAM,CACRb,MACA6E,WACAC,QAASJ,QAAQK,WAEfnF,EAAMS,EAAOA,EAAKT,IAAM,KAG9B,GAAIA,IACeA,EAAIoF,UAAU,YAAa,CAACnE,EAAIgE,SAAUxE,EAAMQ,IAG3D,YADA+D,EAAI,IAAIK,GAIhBpE,EAAIiE,QAAQI,OAAM,SAAAC,GAAO,OAAAP,EAAIO,MAAMC,MAAK,WACpC,GAAqB,OAAjBvE,EAAIgE,SAAR,CAIA,GAAIhE,EAAIgE,WAAaA,EAGjB,OAFAjF,EAAIO,KAAKU,EAAIgE,eACbD,EAAI,IAAIK,GAGZI,EAAKvB,MAAMG,KAAOY,EAClBQ,EAAKvB,MAAM9D,IAAMA,EACjB2E,SAVIC,EAAI,IAAIK,UAcxBf,iBAAA,SAAKoB,GACDtG,KAAKgF,MAAQsB,GAEjBpB,kBAAA,WACI,IAAMJ,EAAQ,CACV9D,IAAKhB,KAAK8E,MAAM9D,IAAImE,MAAMnF,KAAK+E,MAAQ,GACvCE,KAAM,IAKV,OAHIH,EAAM9D,IAAI6B,SACViC,EAAMG,KAAOX,EAAQQ,EAAM9D,MAExB,IAAIkE,EAAMJ,EAAO,IAE5BI,mBAAA,SAAOlD,EAAMjB,EAAOgE,GAChB,IAAMN,EAAQzE,KAAK8E,MAAM9D,IAAIhB,KAAK+E,OAASA,GAAS,IACpD,IAAKN,EAED,OADAzE,KAAK8E,MAAM9D,IAAImB,KAAK,CAAEiC,KAAM,GAAI/D,OAAQ,KACjCL,KAAKkB,OAAOc,EAAMjB,EAAOgE,GAEvB,KAAT/C,EACAyC,EAAML,KAAOrD,EAGb0D,EAAMpE,OAAO2B,GAAQjB,EAEzBf,KAAK8E,MAAMG,KAAOX,EAAQtE,KAAK8E,MAAM9D,yBAKzC,WAAYJ,EAAKb,GAAjB,MACIwG,YAAM3F,EAAId,oBACVuG,EAAKzF,IAAMA,EAEXyF,EAAKG,UAAY,KAmVzB,OAxVsBC,OAOlBC,eAAA,SAAGC,EAAI5G,GAEH,IAAM6G,GADN7G,EAASA,GAAU,IACM6G,WAAaD,EAAGC,UACnCC,EAAU7G,KAAKY,IAAIkG,WAAWH,GAGpC,OAFA3G,KAAKwG,UAAUrE,KAAK0E,GACpBA,EAAQE,OAAOH,EAAW5G,KAAKiB,SAAUjB,MACvB,iBAAP2G,GAAoBA,aAAcpG,EAElCsG,EAGAA,EAAQlF,WAGvB+E,iBAAA,SAAKzB,EAAMlF,GAGP,GAFAA,EAASA,GAAU,GAEC,iBAATkF,EAAmB,CAC1B,IAAK,IAAM7C,KAAO6C,EACdjF,KAAKgH,SAAS5E,EAAK6C,EAAK7C,IAE5B6C,EAAO,SAEN,CAED,GAA0B,MAAtBA,EAAKzB,OAAO,EAAG,GACf,OAAOxD,KAAKY,IAAIO,KAAK8D,EAAMlF,GAO/B,GAJ2B,IAAvBkF,EAAKlB,QAAQ,QACbkB,EAAOA,EAAKzB,OAAO,IAGK,IAAxByB,EAAKlB,QAAQ,OAAc,CAC3B,IAAMkD,EAASjH,KAAKsB,gBACpB,OAAI2F,EACOA,EAAO9F,KAAK8D,EAAKzB,OAAO,GAAIzD,GAG5BC,KAAKY,IAAIO,KAAK,IAAM8D,EAAKzB,OAAO,IAG/C,IAAMjB,EAAMvC,KAAKwC,eAAezC,EAAOmH,QACvC,GAAI3E,EAAK,CACL,GAAIA,EAAInB,SAAWpB,KACf,OAAOuC,EAAInB,OAAOD,KAAK8D,EAAMlF,GAE5B,GAAIA,EAAOmH,QAA4B,YAAlBnH,EAAOmH,OAC7B,OAAOlH,KAAKmH,iBAAiBpH,EAAOmH,OAAQ3E,EAAIE,QAAS,CACrDzB,IAAKiE,EACL5E,OAAQN,EAAOM,cAKvB,GAAI4E,EACA,OAAOjF,KAAKY,IAAIO,KAAK,IAAM8D,EAAMlF,GAI7C,OAAOC,KAAKoH,MAAMpH,KAAKiB,SAAU,CAAED,IAAKiE,EAAM5E,OAAQN,EAAOM,QAAUL,OAE3E0G,kBAAA,SAAMW,EAASpC,EAAM5D,GAArB,WACI,OAAOgG,EAAQlG,KAAK8D,EAAM5D,GAAM,GAAM+E,MAAK,WAEvC,OADAC,EAAKiB,iBACEjB,EAAKkB,gBACbnB,MAAK,WACAiB,EAAQvC,MAAM0C,aACdnB,EAAKzF,IAAI6G,YAAYC,IAAIL,EAAQvC,MAAMG,KAAM,CAAE0C,QAAQ,IACvDtB,EAAKzF,IAAIoF,UAAU,YAAa,CAACqB,EAAQvC,MAAMG,YAI3DyB,iBAAA,SAAKkB,EAAQC,KAGbnB,kBAAA,SAAMkB,EAAQE,KAGdpB,mBAAA,WACI1G,KAAKY,IAAId,MAAMiI,QAAQ,mCAE3BrB,sBAAA,SAAUkB,EAAQE,KAGlBpB,oBAAA,aAGAA,uBAAA,WACI1G,KAAKgI,UACLhI,KAAKiI,eAEDjI,KAAKQ,QACLR,KAAKQ,MAAMwC,aACXuD,YAAMvD,wBAGd0D,gBAAA,SAAIwB,EAAQnI,GACRmI,EAAOlI,KAAKY,IAAKZ,KAAMD,IAE3B2G,oBAAA,WACgB1G,KAAKmI,SASjB,OARAnI,KAAKgI,UACLhI,KAAKiI,eACLjI,KAAKU,eACLV,KAAKS,gBACDT,KAAKW,WAAWyH,SAChBpI,KAAKQ,MAAMwC,aAEfhD,KAAKiB,SAASoH,UACPrI,KAAKsI,QAAQtI,KAAKiB,WAE7ByF,mBAAA,SAAO6B,EAAMvH,EAAKI,GAAlB,WACuB,iBAARJ,IACPA,EAAM,IAAIkE,EAAMlE,EAAK,IAEzBhB,KAAKiB,SAAWD,EAChBhB,KAAKa,QAAUO,EACfpB,KAAKsH,iBAEL,IAAM3G,EAA8B,iBADpC4H,EAAOA,GAAQC,SAASC,MACwBzI,KAAKF,MAAM4I,OAAOH,GAAQA,EAC1E,OAAIvI,KAAKW,aAAeA,GACpBX,KAAKW,WAAaA,EACXX,KAAKsI,QAAQtH,IAGbhB,KAAKuH,aAAanB,MAAK,WAAM,OAAAC,EAAK1E,cAGjD+E,oBAAA,SAAQ1F,GAAR,WACUjB,EAASC,KAAKD,SACpB,OAAIA,EAAOqG,KACArG,EAAOqG,MAAK,SAAAuC,GAAO,OAAAtC,EAAKuC,cAAcD,EAAK3H,MAG3ChB,KAAK4I,cAAc7I,EAAQiB,IAG1C0F,0BAAA,SAAc3G,EAAQiB,GAAtB,IAsBQ6H,SApBAC,EAAO,KACPlC,EAAY,KACZzF,GAAO,EAeX,GAdKnB,KAAKW,WAAWyH,QAWjBxB,EAAY5G,KAAKW,YAVjBmI,EAAO9I,KAAKW,YACH+B,OACLkE,EAAY4B,SAASC,KACrBtH,GAAO,GAGPyF,EAAY5G,KAAKF,MAAMiJ,GAAGD,EAAKhI,KAOlCd,KAAKY,MAAQgG,EACd,OAAOlB,QAAQsD,OAAO,MAG1B,IAAM/F,EAAUjD,KAAKiB,SAASgC,UAExBY,EAAS,CAAE8C,GAAI,IACrB3G,KAAKY,IAAIqI,WAAWlJ,EAAQ8D,EAAO8C,GAAI3G,KAAKG,OAC5CH,KAAKY,IAAIoF,UAAU,aAAc,CAAChG,KAAMgB,EAAK6C,IAC7CA,EAAO8C,GAAG5E,OAAS/B,MAEd8I,GAAQ7F,EAAQoB,OAASpB,EAAQ5B,MAClC4B,EAAQ5B,KAAK2B,aAEjB,IAEI,GAAI8F,IAAS3H,EAAM,CACf,IAAM+H,EAAQtC,EACRuC,EAASD,EAAM5H,gBACjB6H,GAA0B,cAAhBA,EAAOnH,OAAyB6B,EAAO8C,GAAG7F,KACpD+C,EAAO8C,GAAG7F,GAAKoI,EAAMnJ,OAAOe,IAGpCd,KAAKQ,MAAQR,KAAKY,IAAId,MAAM6G,GAAG9C,EAAO8C,GAAIC,GAC1C,IAAMwC,EAAQpJ,KAAKQ,MAEfW,GAAQiI,EAAMC,cAAgBD,EAAME,aACpCF,EAAMjI,OAGN2H,IACIA,EAAKzH,MAAQyH,EAAKzH,OAASrB,MAAQ8I,EAAKzH,OAASrB,KAAKY,KACtDkI,EAAKzH,KAAK2B,aAEd8F,EAAKhI,GAAKd,KAAKQ,MAAMT,OAAOe,GACxBd,KAAKsB,kBAAoBtB,KAAKY,IAAIA,IAClCkI,EAAKzH,KAAOrB,KAIZ8I,EAAKzH,KAAOrB,KAAKY,KAGrBqC,EAAQoB,QACRpB,EAAQ5B,KAAOrB,KACfiD,EAAQoB,OAAQ,GAEpBwE,EAAWnD,QAAQK,QAAQ/F,KAAKuJ,MAAMvJ,KAAKQ,MAAOQ,IAAMoF,MAAK,WACzD,OAAOC,EAAKkB,aAAanB,MAAK,WAE1B,OADAC,EAAKmD,SAAW,KACTnD,EAAKoD,MAAMpD,EAAK7F,MAAOQ,EAAIQ,gBAI9C,MAAOkI,GACHb,EAAWnD,QAAQsD,OAAOU,GAE9B,OAAOb,EAAS3C,OAAM,SAAAC,GAAO,OAAAE,EAAKsD,WAAWtD,EAAMF,OAEvDO,kBAAA,SAAMrF,EAAML,GACR,OAAOhB,KAAK4J,KAAKvI,EAAML,EAAIQ,WAE/BkF,uBAAA,WAAA,WACI1G,KAAKY,IAAIoF,UAAU,gBAAiB,CAAChG,KAAMA,KAAKiB,WAChD,IAAM4I,EAAQ,GACd,IAAK,IAAMzH,KAAOpC,KAAKG,MAAO,CAC1B,IAAM2J,EAAQ9J,KAAKG,MAAMiC,GACnB2H,EAAO/J,KAAKmH,iBAAiB/E,EAAK0H,EAAO,MAC3CC,GACAF,EAAM1H,KAAK4H,GAGnB,OAAOrE,QAAQsE,IAAIH,GAAOzD,MAAK,WAC3B,OAAOC,EAAK4D,UAAU5D,EAAK7F,MAAO6F,EAAKpF,SAASO,cAGxDkF,6BAAA,SAAiBtE,EAAK0H,EAAO7E,GAEzB,IAAK6E,EAAMI,KAAM,CAEb,IAAMA,EAAOlK,KAAKmK,aAAa/H,EAAK0H,EAAO7E,GACvCiF,IAIAJ,EAAMI,KAAOA,EAAK9D,MAAK,WAAM,OAAA0D,EAAMI,KAAO,QAAM,WAAM,OAAAJ,EAAMI,KAAO,SAI3E,OAAOJ,EAAMI,MAEjBxD,yBAAA,SAAatE,EAAK0H,EAAO7E,GAAzB,WAEI,GAAY,YAAR7C,EAAmB,CACnB,GAAIpC,KAAKiB,SAASmJ,OAAQ,CAEtB,IAAI/J,EAAS4E,EAAOA,EAAK5E,OAAS,KAIlC,OAHIyJ,EAAMzJ,SACNA,EAASL,KAAKF,MAAMQ,OAAOD,GAAU,GAAIyJ,EAAMzJ,SAE5CL,KAAKqK,eAAeP,EAAO9J,KAAKiB,SAASqJ,MAAMjK,IAEjDyJ,EAAMzI,MAAQyI,EAAMpH,QAEzBoH,EAAMzI,KAAK2B,aACX8G,EAAMzI,KAAO,MAWrB,GAPa,OAAT4D,IACA6E,EAAM9I,IAAMiE,EAAKjE,IACb8I,EAAMzJ,SACN4E,EAAK5E,OAASL,KAAKF,MAAMQ,OAAO2E,EAAK5E,QAAU,GAAIyJ,EAAMzJ,UAI7DyJ,EAAMhF,MAAO,CAEb,GAAa,OAATG,EACA,OAAO6E,EAAMhF,MAAM3D,KAAK8D,EAAM6E,EAAMzI,MAAM+E,MAAK,WAC3C,OAAOC,EAAKgE,eAAeP,EAAOA,EAAMhF,UAIhD,GAAIgF,EAAM3G,OACN,OAGR,IAAI9B,EAAOyI,EAAMzI,KAEjB,IAAKA,GAAQyI,EAAM9I,IAAK,CACpB,GAAyB,iBAAd8I,EAAM9I,IAOb,OALA8I,EAAMhF,MAAQ,IAAII,EAAM4E,EAAM9I,IAAK,GAC/BiE,GACA6E,EAAMhF,MAAMM,UAAU0E,EAAMhF,MAAMA,MAAM9D,IAAKiE,EAAK5E,OAAQ,GAC1DyJ,EAAMzJ,QACNyJ,EAAMhF,MAAMM,UAAU0E,EAAMhF,MAAMA,MAAM9D,IAAK8I,EAAMzJ,OAAQ,GACxDL,KAAKqK,eAAeP,EAAOA,EAAMhF,OAIf,mBAAdgF,EAAM9I,KAAwBK,aAAgByI,EAAM9I,MAC3DK,EAAO,IAAKrB,KAAKY,IAAI2J,UAAUT,EAAM9I,KAA9B,CAAoChB,KAAKY,IAAK,KAEpDS,IACDA,EAAOyI,EAAM9I,KAKzB,GAAIK,EACA,OAAOA,EAAK0F,OAAO+C,EAAQA,EAAMhF,OAAS9E,KAAKiB,SAAWjB,OAGlE0G,uBAAA,SAAWrF,EAAM8E,GAOb,OAHInG,KAAKY,KACLZ,KAAKY,IAAI4J,MAAM,qBAAsB,CAACrE,EAAK9E,KAExC,GAEXqF,2BAAA,SAAenE,EAAKf,GAApB,WACI,OAAOxB,KAAKY,IAAI6J,cAAcjJ,EAAOyB,WAAWmD,MAAK,SAAA/E,GACjD,OAAOA,EAAK0F,OAAOxE,EAAKf,EAAQ6E,OAGxCK,yBAAA,WAGI,IADA,IAAMgE,EAAM1K,KAAKwG,UACR5D,EAAI8H,EAAI7H,OAAS,EAAGD,GAAK,EAAGA,IAC7B8H,EAAI9H,IAAM8H,EAAI9H,GAAGI,YACjB0H,EAAI9H,GAAGI,aAIfhD,KAAKwG,UAAY,OAtVHjG,iBA4VlB,WAAYK,EAAKb,GAAjB,MACIwG,YAAM3F,EAAKb,gBACXsG,EAAKsE,IAAM5K,EAAO4G,KAK1B,OARyBF,OAKrBmE,mBAAA,WACI,OAAO5K,KAAK2K,QANKjE,gBAWrB,WAAYmE,EAAI9K,EAAQa,GACpBZ,KAAKiF,KAAO,GACZjF,KAAKY,IAAMA,EAUnB,OARIkK,gBAAA,SAAI7F,EAAMlF,GACNC,KAAKiF,KAAOA,EACZ,IAAM8F,EAAI/K,KAAKY,IACfmK,EAAEnK,IAAI6G,YAAYC,IAAIqD,EAAE9J,SAAS+J,OAAOhL,KAAKiF,MAAO,CAAE0C,QAAQ,KAElEmD,gBAAA,WACI,OAAO9K,KAAKiF,WAIhBgG,GAAQ,gBAER,WAAYlL,GAAZ,WACUD,GAASC,GAAU,IAAID,OAASoL,OAAOpL,aAC7CC,EAASD,EAAMQ,OAAO,CAClB0B,KAAM,MACNmJ,QAAS,MACTC,MAAO,SACRrL,GAAQ,IACXsG,EAAAE,YAAMzG,EAAOC,UACRA,OAASA,EACdsG,EAAKzF,IAAMyF,EAAKtG,OAAOa,IACvByF,EAAKoD,MAAQ/D,QAAQK,UACrBM,EAAKgF,UAAY,GACjBhF,EAAKvG,MAAMQ,OAAO+F,EAAMA,EAAKvG,MAAMwL,eA+W3C,OA5XyB7E,OAerB8E,mBAAA,WACI,OAAOvL,KAAKwL,YAAYhK,UAE5B+J,yBAAA,WACI,OAAOvL,KAAKwL,YAAY/J,YAE5B8J,uBAAA,SAAWvJ,GACP,IAAIH,EAAM7B,KAAKqL,UAAUrJ,GAIzB,MAHmB,mBAARH,IACPA,EAAM7B,KAAKqL,UAAUrJ,GAAQH,EAAI7B,OAE9B6B,GAEX0J,uBAAA,SAAWvJ,EAAMyJ,GACbzL,KAAKqL,UAAUrJ,GAAQyJ,GAE3BF,uBAAA,WACIvL,KAAK0L,aAAa1I,aAClBuD,YAAMvD,uBAGVuI,uBAAA,SAAW1J,EAAKqF,EAAQnH,GAOpB,IALI8B,aAAetB,GACC,mBAARsB,GAAsBA,EAAI8J,qBAAqBpL,KACvDsB,EAAM,CAAE+J,SAAU/J,SAGK,IAAhBA,EAAI+J,SACX,OAAO5L,KAAK6L,WAAWhK,EAAKqF,EAAQnH,GAGxC,IAAM+L,EAAUjK,aAAekK,MAE/B,IAAK,IAAMC,KADX9E,EAASA,IAAW4E,EAAU,GAAK,IACdjK,EAAK,CACtB,IAAIoK,EAAQpK,EAAImK,GAKhB,GAHqB,mBAAVC,GAAwBA,EAAMN,qBAAqBpL,IAC1D0L,EAAQ,CAAEL,SAAUK,KAEpBA,GAA0B,iBAAVA,GACdA,aAAiBjM,KAAKF,MAAMoM,gBAAqBD,aAAiBE,QAAaF,aAAiBG,IAelGlF,EAAO8E,GAAUC,OAdjB,GAAIA,aAAiBI,KACjBnF,EAAO8E,GAAU,IAAIK,KAAKJ,OAEzB,CACD,IAAMK,EAAOtM,KAAKiJ,WAAWgD,EAAQA,aAAiBF,MAAQ,GAAK,GAAKhM,GAC3D,OAATuM,IACIR,EACA5E,EAAO/E,KAAKmK,GAEZpF,EAAO8E,GAAUM,IAQrC,OAAOpF,GAEXqE,sBAAA,WACI,OAAOvL,KAAKuM,SAEhBhB,yBAAA,SAAa7B,EAAGxC,GACZ,GAAIwC,IACAxC,EAASA,GAAWwC,EAAExC,QAAUwC,EAAE8C,aACpBtF,EAAOuF,aAAc,CAC/B,IAAMC,EAAUxF,EAAOuF,aAAa,WACpC,GAAIC,EAGA,OAFA1M,KAAK2M,SAASzF,GAAQ,SAAA7F,GAAQ,OAAAA,EAAKT,IAAIgM,QAAQF,MAC/ChD,EAAEmD,cAAe,EACVnD,EAAEoD,iBAEb,IAAMC,EAAQ7F,EAAOuF,aAAa,SAClC,GAAIM,EAGA,OAFA/M,KAAK2M,SAASzF,GAAQ,SAAA7F,GAAQ,OAAAA,EAAKF,KAAK4L,MACxCrD,EAAEmD,cAAe,EACVnD,EAAEoD,iBAIrB,IAAM1L,EAAS8F,EAAO8F,WAClB5L,GACApB,KAAKiN,aAAavD,EAAGtI,IAG7BmK,oBAAA,WACI,OAAOvL,KAAK0L,aAAa/J,WAE7B4J,oBAAA,WAAA,WACI,OAAKvL,KAAKwL,YAGHxL,KAAK0L,aAAarD,UAAUjC,MAAK,SAAA/E,GAEpC,OADAgF,EAAKL,UAAU,YAAa,CAACK,EAAK8B,WAC3B9G,KAJAqE,QAAQK,QAAQ,OAO/BwF,qBAAA,SAASvK,GAAT,WACUkM,EAAQlN,KAAKD,OAAOmN,MACtBrJ,EAAS,KACb,GAAY,KAAR7C,EACA,OAAO0E,QAAQK,QAAQ/F,KAAKmN,WAAW,GAAI,IAAIC,MAAM,kCAEzD,IACQF,GASsB,iBANlBrJ,EAFiB,mBAAVqJ,EAEEA,EAAMlM,GAINkM,EAAMlM,MAGfA,EAAM6C,EACNA,EAAS,MAGZA,IACW,YAAR7C,EACA6C,EAAS,CAAEwJ,QAAQ,GAEN,WAARrM,EACL6C,EAAS,IAGT7C,EAAMA,EAAIsM,QAAQ,MAAO,KACzBzJ,EAAS7D,KAAKuN,QAAQ,YAAavM,KAI/C,MAAO0I,GACH7F,EAAS7D,KAAKmN,WAAWnM,EAAK0I,GAUlC,OAPK7F,EAAOuC,OACRvC,EAAS6B,QAAQK,QAAQlC,IAG7BA,EAASA,EACJuC,MAAK,SAAAoH,GAAU,OAAAA,EAAOC,WAAaD,EAAOtK,QAAUsK,KACpDtH,OAAM,SAAAC,GAAO,OAAAE,EAAK8G,WAAWnM,EAAKmF,OAG3CoF,qBAAA,SAASrE,EAAQuE,GACb,IAAMpK,EAAOrB,KAAKF,MAAMiJ,GAAG7B,GACvB7F,GACAoK,EAAQpK,EAAKU,SAGrBwJ,6BAAA,SAAiBvK,GACb,OAAO,MAEXuK,0BAAA,SAAc9G,GAAd,WASI,OAPIA,EAAMJ,QAAUI,EAAMpD,KACfrB,KAAK0N,SAASjJ,EAAML,MACtBgC,MAAK,SAAAO,GAAM,OAAAN,EAAKS,WAAWH,EAAI3E,KAAMyC,EAAMpE,WAGzCqF,QAAQK,QAAQtB,EAAMpD,OAIrCkK,sBAAA,SAAU5E,GACN,IAAMgH,EAAO3N,KAAKD,OAAO6N,SACzB,GAAID,EAAM,CAEN,IADA,IAAIE,SACGlH,GACHkH,EAAKlH,EACLA,EAAKgH,EAAKG,IAAInH,GAElB,OAAOkH,EAEX,OAAOlH,GAEX4E,uBAAA,SAAW5E,EAAI3E,EAAM3B,GAGjB,GAAkB,mBAFlBsG,EAAK3G,KAAKuK,UAAU5D,IAEU,CAC1B,GAAIA,EAAGgF,qBAAqBJ,EAExB,OAAO,IAAI5E,EAAG,CAAE/F,IAAKZ,KAAMgC,OAAM3B,SAAQ0N,OAAQjD,IAEhD,GAAInE,EAAGgF,qBAAqBpL,EAE7B,OAAO,IAAIoG,EAAG3G,KAAM,CAAEgC,OAAM3B,WAI5BsG,EAAKA,EAAG3G,MAUhB,OAPI2G,aAAcpG,EACRoG,EAIA,IAAIiE,EAAW5K,KAAM,CAAEgC,OAAM2E,QAK3C4E,iBAAA,SAAKvK,EAAKjB,GACN,OAAIiB,GAAOhB,KAAKY,KAA4B,GAArBI,EAAI+C,QAAQ,MACxB/D,KAAKY,IAAIO,KAAKH,EAAIwC,OAAO,GAAIzD,GACjCC,KAAK+G,OAAO/G,KAAKW,WAAYK,GAAOhB,KAAKD,OAAOqL,MAAOrL,IAGlEwL,oBAAA,SAAQvJ,OAAM,aAAAiC,mBAAAA,IAAA+J,oBACVhO,KAAKiO,MAAMjM,EAAMgM,IAErBzC,kBAAA,SAAMvJ,EAAMkM,GACRlO,KAAKgG,UAAUhE,EAAMkM,IAEzB3C,mBAAA,SAAOvJ,GACH,OAAOhC,KAAKF,MAAMqO,MAAK,eAAU,aAAAlK,mBAAAA,IAAA+J,kBAC7BhO,KAAKiO,MAAMjM,EAAMgM,KAClBhO,OAEPuL,eAAA,SAAGvJ,EAAMyJ,GACLzL,KAAKkC,YAAYF,EAAMyJ,IAE3BF,gBAAA,SAAIrD,EAAQnI,GACRmI,EAAOlI,KAAM,KAAMD,IAEvBwL,kBAAA,SAAMvJ,EAAMoM,GAIR,GAHApO,KAAKgG,UAAUhE,EAAMoM,GACrBpO,KAAKgG,UAAU,YAAaoI,GAExBpO,KAAKD,OAAOsO,MACZ,IAAK,IAAIzL,EAAI,EAAGA,EAAIwL,EAAGvL,OAAQD,IAE3B,GADA0L,QAAQ9D,MAAM4D,EAAGxL,IACbwL,EAAGxL,aAAcwK,MAAO,CACxB,IAAImB,EAAOH,EAAGxL,GAAGmF,QAC2B,IAAxCwG,EAAKxK,QAAQ,wBACbwK,EAAOA,EAAKjB,QAAQ,kBAAmB,IACvC9E,SAASC,KAAK+F,UAAY,sFAAsFD,aAGhHA,GAAQ,yCACRvO,KAAKF,MAAMiI,QAAQ,CAAE0G,KAAM,QAASF,KAAMA,EAAMG,QAAS,OAS7EnD,mBAAA,SAAOhD,EAAMvH,EAAKjB,GAAlB,WACIC,KAAKW,WAA8B,iBAAT4H,EACtBvI,KAAKF,MAAM4I,OAAOH,GACjBA,GAAQC,SAASC,KACtB,IACIxD,EAAO,MADQjF,KAAKuM,SAGhBtB,GAAS,YAAajL,KAAKW,aAC3BX,KAAKF,MAAM6O,MAAMnG,SAASC,KAAM,SAAS,SAAAiB,GAAK,OAAArD,EAAK4G,aAAavD,MAChEuB,GAAQ,GAEO,iBAARjK,IACPA,EAAM,IAAIkE,EAAMlE,EAAK,IAEzBhB,KAAKwL,YAAcxL,KAAK4O,aAAa5N,GACrChB,KAAKwL,YAAY1G,MAAM0C,YAAa,GAIhCvC,EADe,iBAARjE,EACAA,EAGHhB,KAAKY,IACEI,EAAI0C,QAAQoB,MAAMG,MAAQjF,KAAKD,OAAOqL,MAGtCpK,EAAIS,WAIvB,IAAMpB,EAASN,EAASA,EAAOM,OAASL,KAAKD,OAAOM,QAAU,KACxDwO,EAAM7O,KAAK0L,aACXrE,EAAUrH,KAAKwL,YACf/B,EAAQpC,EACTlG,KAAK,CAAEH,IAAKiE,EAAM5E,UAAUwO,GAC5BzI,MAAK,WAAM,OAAAC,EAAKoE,cAAcpD,EAAQpE,cACtCmD,MAAK,SAAA/E,GAAQ,OAAAA,EAAK0F,OAAOwB,EAAMlB,MAC/BjB,MAAK,SAAA0I,GAGN,OAFAzI,EAAKkG,QAAQ7E,IAAIL,EAAQvC,MAAMG,KAAM,CAAE0C,QAAQ,IAC/CtB,EAAKL,UAAU,YAAa,CAACK,EAAK8B,WAC3B2G,KAGX,OADA9O,KAAKyJ,MAAQzJ,KAAKyJ,MAAMrD,MAAK,WAAM,OAAAqD,KAC5BA,GAEX8B,uBAAA,WACI,GAAIvL,KAAKwL,YAAa,CAClB,IAAMnK,EAAOrB,KAAKwL,YAAYvI,UAAU5B,KACxC,GAAIA,EACA,OAAOA,EAEf,OAAO,IAAIqF,EAAQ1G,KAAM,KAE7BuL,oBAAA,SAAQkD,EAAMzN,GAAO,OAAO,MAC5BuK,yBAAA,SAAazG,GAAb,WACI9E,KAAKiB,SAAW6D,EAShB,GAFA9E,KAAKuM,QAAU,IAAKvM,KAAKD,OAAa,QAN3B,SAACgL,GAAM,OAAAgE,YAAW,WACzB1I,EAAKlF,KAAK4J,GAAG7E,OAAM,SAAAwD,GACf,KAAMA,aAAazD,GACf,MAAMyD,OAEf,KACyC1J,KAAKD,OAAQC,MAErDA,KAAKW,aAAe6H,SAASC,OAAkC,IAA1BzI,KAAKD,OAAOiP,UAAqB,CACtE,IAAMC,EAAOjP,KAAKW,WAClBX,KAAKF,MAAMoP,KAAKC,OAAOF,EAAM,iBAC7BF,YAAW,WACP1I,EAAKvG,MAAMoP,KAAKE,UAAUH,EAAM,iBAChC5I,EAAKvG,MAAMoP,KAAKC,OAAOF,EAAM,cAC9B,IAEP,GAAKnK,GASA,GAAI9E,KAAKY,IAAK,CACf,IAAMyO,EAAMvK,EAAM7B,UAAU5B,KAC5ByD,EAAM7B,UAAU5B,KAAOrB,KACnB8E,EAAMsF,QACNtF,EAAMuD,UACNvD,EAAQA,EAAMpB,SAGdoB,EAAQ,IAAII,EAAMlF,KAAKD,OAAOqL,MAAO,GAEzCtG,EAAM7B,UAAU5B,KAAOgO,OAnBf,CAER,IAAIC,EAAYtP,KAAKuM,QAAQuB,MACxBwB,IACDA,EAAYtP,KAAKD,OAAOqL,MACxBpL,KAAKuM,QAAQ7E,IAAI4H,EAAW,CAAE3H,QAAQ,KAE1C7C,EAAQ,IAAII,EAAMoK,EAAW,GAcjC,OAAOxK,GAGXyG,uBAAA,SAAWvK,EAAKmF,GAEZ,OADAnG,KAAKwK,MAAM,oBAAqB,CAACrE,EAAKnF,IAC/B,CAAEuO,SAAU,MAEvBhE,uBAAA,SAAW1J,EAAKqF,EAAQnH,GACpB,IAAMiB,GAAuB,IAAjBa,EAAI+J,SAAoB/J,EAAI+J,SAAW,KAC7C5J,EAAOH,EAAIG,OAAShB,EAAMhB,KAAKF,MAAM0P,MAAQ,WASnD,OARAtI,EAAOpG,GAAKe,EAAIf,IAAM,IAAMd,KAAKF,MAAM0P,OAC1BzP,EAAOiC,GAAQ,CACxBlB,GAAIoG,EAAOpG,GACXE,MACAmC,OAAQtB,EAAIsB,OACZT,MAAOb,EAAIa,MACXrC,OAAQwB,EAAIxB,SAEJqC,MAAQ,KAAOwE,MA1XV3G,gBA+XrB,WAAYsK,EAAI9K,GAAhB,WACIC,KAAKD,OAASA,GAAU,GACxBC,KAAKyP,gBACLzP,KAAK6K,GAAKA,EACVK,OAAOwE,WAAa,WAAM,OAAArJ,EAAKwE,GAAGxE,EAAKyH,QAwC/C,OAtCI6B,gBAAA,SAAI1K,EAAMlF,GAAV,WACI,GAAIC,KAAKD,OAAO6P,OAAQ,CACpB,IAAMC,EAAU5K,EAAKvB,MAAM,IAAK,GAChC,IAAK,IAAMtB,KAAOpC,KAAKD,OAAO6P,OAC1B,GAAI5P,KAAKD,OAAO6P,OAAOxN,KAASyN,EAAQ,GAAI,CACxC5K,EAAO7C,GAAOyN,EAAQhN,OAAS,EAAI,IAAMgN,EAAQ,GAAK,IACtD,OAIR7P,KAAK8N,QAAU7I,GACfiG,OAAO4E,QAAQC,UAAU,KAAM,KAAM/P,KAAKgQ,OAAShQ,KAAKiQ,MAAQhL,GAE/DlF,GAAWA,EAAO4H,QACnBoH,YAAW,WAAM,OAAA1I,EAAKwE,GAAG5F,KAAO,IAGxC0K,gBAAA,WACI,IAAI1K,EAAOjF,KAAKkQ,UAAU5C,QAAQtN,KAAKgQ,OAAQ,IAAI1C,QAAQtN,KAAKiQ,MAAO,IAEvE,GADAhL,EAAiB,MAATA,GAAyB,MAATA,EAAgBA,EAAO,GAC3CjF,KAAKD,OAAO6P,OAAQ,CACpB,IAAMC,EAAU5K,EAAKvB,MAAM,IAAK,GAC1BtB,EAAMpC,KAAKD,OAAO6P,OAAOC,EAAQ,IACnCzN,IACA6C,EAAO7C,GAAOyN,EAAQhN,OAAS,EAAI,IAAMgN,EAAQ,GAAK,KAG9D,OAAO5K,GAEX0K,0BAAA,WAEI,IAAMM,EAAQjQ,KAAKD,OAAOoQ,aAC1BnQ,KAAKiQ,MAAQ,UAAyB,IAAVA,EAAyB,IAAMA,GAC3DjQ,KAAKgQ,OAASxH,SAAS4H,SAASC,KAAK3M,MAAM,IAAK,GAAG,IAEvDiM,oBAAA,WACI,OAAOnH,SAAS4H,SAASC,WAI7BC,GAAY,EAChB,SAASC,EAAMC,GACX,IAAIF,GAAcE,EAAlB,CAGAF,GAAY,EAEZ,IAAMG,EAAMvF,OACPuF,EAAI/K,UACL+K,EAAI/K,QAAU8K,EAAEE,SAEpB,IAAMvF,EAAUqF,EAAErF,QAAQzH,MAAM,KAEf,GAAbyH,EAAQ,GAAuB,EAAbA,EAAQ,GAAS,KACnCqF,EAAE7J,GAAGgK,OAAS,SAAUlF,GAGpB,IAAM9F,EAAM8F,IAYZ,OAXI9F,GAAOA,EAAIS,KACXT,EAAIS,MAAK,SAAUwK,GAGf,OAFAJ,EAAE7J,GAAGkK,SAAU,EACfL,EAAE7J,GAAGmK,SACEF,MAIXJ,EAAE7J,GAAGkK,SAAU,EACfL,EAAE7J,GAAGmK,UAEFnL,IAIf,IAAMoL,EAAUP,EAAE7J,GAAGqK,WAAWrF,UAAUsF,QACpCC,EAAaV,EAAE7J,GAAGqK,WAAWrF,UAAUwF,WACvCpR,EAAS,CACXkR,iBAAQ5P,EAAM0D,GAGV,GAAI/E,KAAK+B,QAAU/B,KAAK+B,OAAO9B,WAAaoB,EAAKO,UAAW,CACxD,IAAMwP,EAAQpR,KAAK+B,OACbsP,EAAO,GACbhQ,EAAO+P,EAAMxQ,IAAIqI,WAAW5H,EAAM,GAAIgQ,GACtCN,EAAQ9C,MAAMjO,KAAM,CAACqB,EAAM0D,mBAChB3C,GACPgP,EAAMjH,aAAa/H,EAAKiP,EAAKjP,GAAM,MAAMgE,MAAK,WAC1CgL,EAAMjR,MAAMiC,GAAOiP,EAAKjP,OAFhC,IAAK,IAAMA,KAAOiP,IAAPjP,GAKX,OAAOf,EAAKP,GAGZ,OAAOiQ,EAAQ9C,MAAMjO,KAAMsR,YAGnCH,sBAEI,GADAD,EAAWjD,MAAMjO,KAAMsR,WACnBtR,KAAK+B,QAAU/B,KAAK+B,OAAO9B,SAAU,CACrC,IAAMsR,EAAOvR,KAAK+B,OAAO5B,MAEzB,IAAK,IAAMiC,KAAOmP,EAAM,CACpB,IAAM3N,EAAO2N,EAAKnP,GACboO,EAAEzH,GAAGnF,EAAK9C,MACX8C,EAAKvC,KAAK2B,oBACHuO,EAAKnP,QAMhCoO,EAAElQ,OAAOkQ,EAAE7J,GAAG6K,OAAO7F,UAAW5L,GAAQ,GACxCyQ,EAAElQ,OAAOkQ,EAAE7J,GAAGqK,WAAWrF,UAAW5L,GAAQ,GAE5CyQ,EAAEiB,QAAQ,CACNzP,KAAM,SACN0P,eAAM/I,GACF3I,KAAK2R,KAAO,IAAI3R,KAAKY,IAAI+H,GACzB,IAAM7H,EAAK0P,EAAEhB,MAAM/N,WACnBkH,EAAIF,KAAO,CAAE3H,MACbd,KAAK4R,OAAOzP,MAAK,WACbnC,KAAKgG,UAAU,SAAU,CAAChG,KAAK2R,OAC/B3R,KAAK2R,KAAK5K,OAAO,CAAEjG,YAG5B0P,EAAE7J,GAAGkL,MAAOrB,EAAElF,cAGrB,kBACI,WAAYvL,GAAZ,aACIA,EAAOgO,OAAShO,EAAOgO,QAAU4B,EAEjCY,GADAlK,EAAAE,YAAMxG,UACKD,SAKnB,OATqB2G,OAMjBqL,oBAAA,SAAQrD,EAAMzN,GACV,OAAOuM,QAAQkB,EAAO,IAAMzN,OAPfuK,kBA4BrB,4DAAwB9E,OACpBsL,0BAAA,WACI/R,KAAKgQ,OAAS,GACdhQ,KAAKiQ,MAAQjQ,KAAKD,OAAOoQ,cAAgB,IAE7C4B,oBAAA,WACI,OAAOvJ,SAAS4H,SAAS4B,UAAYxJ,SAAS4H,SAAS6B,QAAU,MANjDtC,cAWpB,WAAY9E,EAAIqH,GACZlS,KAAKiF,KAAO,GACZjF,KAAK6K,GAAKA,EAWlB,OATIsH,gBAAA,SAAIlN,EAAMlF,GAAV,WACIC,KAAKiF,KAAOA,EACPlF,GAAWA,EAAO4H,QACnBoH,YAAW,WAAM,OAAA1I,EAAKwE,GAAG5F,KAAO,IAGxCkN,gBAAA,WACI,OAAOnS,KAAKiF,YAqBpB,SAASmN,EAAIC,EAAOjQ,GAClB,OAAOkQ,OAAO3G,UAAU4G,eAAeC,KAAKH,EAAOjQ,GAGrD,SAASqQ,EAAQ5Q,EAAK4J,EAASiH,GAC7B,IAAK,IAAItQ,KAAOP,EACVuQ,EAAIvQ,EAAKO,IACXqJ,EAAQ+G,KAAME,GAAW7Q,EAAMA,EAAIO,GAAMA,EAAKP,GASpD,SAAS8Q,EAAK5K,GACZA,EAAU,YAAcA,EACD,oBAAZuG,SACTA,QAAQ9D,MAAMzC,GAGhB,IAAM,MAAM,IAAIqF,MAAMrF,GAAY,MAAO6K,KAG3C,IAAItF,EAAUuF,OAAOlH,UAAU2B,QAC3B5J,EAAQmP,OAAOlH,UAAUjI,MAMzBoP,EAAsB,SAAUxM,GAClC,IAAIyM,EAAMzM,EAAI,GACd,OAAU,KAANA,GAAoB,IAARyM,EACP,EAEL,GAAKA,GAAOA,GAAO,KAAOzM,GAAK,IAAMA,GAAK,IACrC,EAEF,GAIL0M,EAAc,CAChBC,OAAQ,SAAU3M,GAEhB,GAAIA,EAAI,EAAK,OAAOA,EACpB,IAAI4M,EAAU5M,EAAI,IAClB,OAAI4M,GAAW,GAAKA,GAAW,GAAW,EACnCA,GAAW,GAAK,EAAI,GAE7BC,gBAAiBL,EACjBM,QAAS,WAAc,OAAO,GAC9BC,SAAUP,EACVQ,OAAQ,SAAUhN,GAAK,OAAOA,EAAI,EAAI,EAAI,GAC1CiN,OAAQ,SAAUjN,GAAK,OAAa,IAANA,EAAU,EAAI,GAC5CkN,QAASV,EACTW,WAAY,SAAUnN,GACpB,OAAIA,EAAI,IAAO,GAAKA,EAAI,KAAQ,GAAa,EACtCA,EAAI,IAAM,GAAKA,EAAI,IAAM,IAAMA,EAAI,IAAM,IAAMA,EAAI,IAAM,IAAM,EAAI,GAE5EoN,MAAO,SAAUpN,GACf,OAAU,IAANA,EAAkB,EACdA,GAAK,GAAKA,GAAK,EAAK,EAAI,GAElCqN,OAAQ,SAAUrN,GAChB,GAAU,IAANA,EAAW,OAAO,EACtB,IAAIyM,EAAMzM,EAAI,GACd,OAAO,GAAKyM,GAAOA,GAAO,IAAMzM,EAAI,IAAM,IAAMA,EAAI,KAAO,IAAM,EAAI,GAEvEsN,UAAW,SAAUtN,GAAK,OAAQA,EAAI,IAAO,GAAKA,EAAI,KAAQ,GAAM,EAAI,GACxEuN,UAAW,SAAUvN,GACnB,IAAI4M,EAAU5M,EAAI,IAClB,OAAgB,IAAZ4M,EACK,EAEO,IAAZA,EACK,EAEO,IAAZA,GAA6B,IAAZA,EACZ,EAEF,IAQPY,EAAwB,CAC1Bb,OAAQ,CAAC,MACTE,gBAAiB,CAAC,aAAc,aAAc,SAAU,SACxDC,QAAS,CAAC,KAAM,QAAS,KAAM,KAAM,QAAS,KAAM,KAAM,KAAM,QAAS,MACzEC,SAAU,CAAC,KAAM,SACjBE,OAAQ,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,QAAS,KAAM,QAAS,KAAM,KAAM,KAAM,KAAM,KAAM,MAC/GD,OAAQ,CAAC,KAAM,KAAM,SACrBE,QAAS,CAAC,KAAM,SAChBC,WAAY,CAAC,MACbC,MAAO,CAAC,KAAM,QAAS,MACvBC,OAAQ,CAAC,MACTC,UAAW,CAAC,MACZC,UAAW,CAAC,UAad,SAASE,EAAeC,GACtB,IAVIC,EAUAC,GAVAD,EAAM,GACVxB,EASqCqB,GATpB,SAAUK,EAAO1F,GAChCgE,EAAQ0B,GAAO,SAAUC,GACvBH,EAAIG,GAAQ3F,QAGTwF,GAKP,OAAOC,EAAiBF,IACnBE,EAAiBxQ,EAAM8O,KAAKwB,EAAQ,IAAK,GAAG,KAC5CE,EAAiBG,GAOxB,SAASC,EAAOC,GACd,OAAOA,EAAMjH,QAAQ,sBAAuB,QAc9C,IAAIkH,EAAc,MAEdC,EAAoB,cAyBxB,SAASC,EAAgBC,EAAQC,EAAeZ,EAAQa,GACtD,GAAsB,iBAAXF,EACT,MAAM,IAAIG,UAAU,6DAGtB,GAAqB,MAAjBF,EACF,OAAOD,EAGT,IAAI9Q,EAAS8Q,EACTI,EAAqBF,GAAcJ,EAGnCO,EAAmC,iBAAlBJ,EAA6B,CAAEK,YAAaL,GAAkBA,EAKnF,GAA2B,MAAvBI,EAAQC,aAAuBpR,EAAQ,CACzC,IAAIqR,EAAQxR,EAAM8O,KAAK3O,EA9JX,QA+JZA,GAAcqR,EAlElB,SAAyBlB,EAAQmB,GAC/B,OAAOnC,EAAYe,EAAeC,IAASmB,GAiErBC,CAAgBpB,GAAU,KAAMgB,EAAQC,eAAiBC,EAAM,IAhL1E5H,QAAQ,qCAAsC,IA0LzD,OANAzJ,EAASyJ,EAAQkF,KAAK3O,EAAQkR,GAAoB,SAAUM,EAAYC,GACtE,OAAKlD,EAAI4C,EAASM,IAAkC,MAArBN,EAAQM,GAEhChI,EAAQkF,KAAKwC,EAAQM,GAAWd,EArDrB,MAmDiDa,KASvE,SAASE,EAASP,GAChB,IAAIQ,EAAOR,GAAW,GACtBhV,KAAKyV,QAAU,GACfzV,KAAKM,OAAOkV,EAAKC,SAAW,IAC5BzV,KAAK0V,cAAgBF,EAAKxB,QAAU,KACpC,IAAI2B,EAAeH,EAAKG,aAAejB,EAAkB,KACzD1U,KAAK4V,aAA4C,mBAAtBJ,EAAKI,aAA8BJ,EAAKI,aAAeD,EAClF3V,KAAK2S,KAAO6C,EAAK7C,MAAQA,EACzB3S,KAAK6U,WAhFP,SAA6BW,GAC3B,IAAIxF,EAAUwF,GAAQA,EAAKxF,QAAW,KAClC6F,EAAUL,GAAQA,EAAKK,QAAW,IAEtC,GAzGc,SAyGV7F,GAzGU,SAyGc6F,EAC1B,MAAM,IAAIC,WAAW,8CAGvB,OAAO,IAAI3J,OAAOmI,EAAOtE,GAAU,QAAUsE,EAAOuB,GAAS,KAwE3CE,CAAoBP,EAAKQ,eAM7CT,EAAS5J,UAAUqI,OAAS,SAAUiC,GAEpC,OADIA,IAAWjW,KAAK0V,cAAgBO,GAC7BjW,KAAK0V,eAoDdH,EAAS5J,UAAUrL,OAAS,SAAU4V,EAAalG,GACjDyC,EAAQyD,GAAa,SAAUvB,EAAQvS,GACrC,IAAI+T,EAAcnG,EAASA,EAAS,IAAM5N,EAAMA,EAC1B,iBAAXuS,EACT3U,KAAKM,OAAOqU,EAAQwB,GAEpBnW,KAAKyV,QAAQU,GAAexB,IAE7B3U,OAcLuV,EAAS5J,UAAUyK,MAAQ,SAAUF,EAAalG,GACrB,iBAAhBkG,SACFlW,KAAKyV,QAAQS,GAEpBzD,EAAQyD,GAAa,SAAUvB,EAAQvS,GACrC,IAAI+T,EAAcnG,EAASA,EAAS,IAAM5N,EAAMA,EAC1B,iBAAXuS,EACT3U,KAAKoW,MAAMzB,EAAQwB,UAEZnW,KAAKyV,QAAQU,KAErBnW,OASPuV,EAAS5J,UAAU0K,MAAQ,WACzBrW,KAAKyV,QAAU,IAQjBF,EAAS5J,UAAU2B,QAAU,SAAUgJ,GACrCtW,KAAKqW,QACLrW,KAAKM,OAAOgW,IA6Bdf,EAAS5J,UAAU4K,EAAI,SAAUnU,EAAK4S,GACpC,IAAIL,EAAQ9Q,EACR2R,EAAkB,MAAXR,EAAkB,GAAKA,EAClC,GAAiC,iBAAtBhV,KAAKyV,QAAQrT,GACtBuS,EAAS3U,KAAKyV,QAAQrT,QACjB,GAAsB,iBAAXoT,EAAKgB,EACrB7B,EAASa,EAAKgB,OACT,GAAIxW,KAAK4V,aAAc,CAE5B/R,GAAS+R,EADU5V,KAAK4V,cACFxT,EAAKoT,EAAMxV,KAAK0V,cAAe1V,KAAK6U,iBAE1D7U,KAAK2S,KAAK,iCAAmCvQ,EAAM,KACnDyB,EAASzB,EAKX,MAHsB,iBAAXuS,IACT9Q,EAAS6Q,EAAgBC,EAAQa,EAAMxV,KAAK0V,cAAe1V,KAAK6U,aAE3DhR,GAOT0R,EAAS5J,UAAUyG,IAAM,SAAUhQ,GACjC,OAAOgQ,EAAIpS,KAAKyV,QAASrT,IAI3BmT,EAASb,gBAAkB,SAAmBC,EAAQC,EAAeZ,GACnE,OAAOU,EAAgBC,EAAQC,EAAeZ,IAGhD,IAAIyC,EAAgBlB,EAsWpB,IAAIzV,EAAQoL,OAAOpL,MACfA,GACAyQ,EAAMzQ,GAEV,IAAM4W,EAxWN,SAAgB9V,EAAK+V,EAAO5W,GAExB,IAAM6W,GADN7W,EAASA,GAAU,IACI6W,QACnBxC,EAAOwC,EAAWA,EAAQ9I,IAAI,SAAW,KAAS/N,EAAOqU,MAAQ,KACrE,SAASyC,EAAY7U,EAAMkM,EAAMvG,GACzBuG,EAAKT,aACLS,EAAOA,EAAKhL,SAEhB,IAAM4T,EAAU,CAAErB,QAASvH,GACvBnO,EAAOgX,UACPnW,EAAId,MAAMQ,OAAOwW,EAAS/W,EAAOgX,UAErC,IAAMC,EAAOC,EAAQF,SAAW,IAAIN,EAAcK,GAOlD,GANAE,EAAKhD,OAAOhS,GACZiV,EAAQT,EAAI5V,EAAId,MAAMqO,KAAK6I,EAAKT,EAAGS,GACnC5C,EAAOpS,EACH4U,GACAA,EAAQM,IAAI,OAAQ9C,GAEpBrU,EAAOD,MAAO,CACd,IAAMqX,EAAUpX,EAAOD,MAAMkC,GACzBmV,GACAvW,EAAId,MAAMsX,KAAKC,UAAUF,GAGjC,OAAKxP,EAGEjC,QAAQK,UAFJnF,EAAIyH,UAKnB,SAASiP,EAAQtV,EAAM2F,GAEnB,IAAoB,IAAhB5H,EAAOkF,KAAX,CAGA,IAAMA,GAAQlF,EAAOkF,KAAOlF,EAAOkF,KAAO,IAAM,IAAMjD,EAEtD6U,EAAY7U,EADCpB,EAAI2M,QAAQ,cAAetI,GAChB0C,IAE5B,IAAMsP,EAAU,CACZM,QAXJ,WAAqB,OAAOnD,GAWfkD,UAAST,cAAaL,EAAG,KAAMO,SAAU,MAEtDnW,EAAI4W,WAAW,SAAUP,GACzBK,EAAQlD,GAAM,IAgUZ5D,EAAItF,OACLsF,EAAE9K,UACH8K,EAAE9K,QAAU8K,EAAE1Q,MAAM4Q,SC7gExB,IAAI3L,EAAQ,WA4BI0S,EAAKC,EAAQxQ,EAAQ9E,GACpCkQ,OAAOqF,eAAezQ,EAAQ9E,EAAK,CAClC0L,IAAK,WAAM,OAAA4J,EAAOtV,IAClBsF,IAAK,SAAA3G,GAAS,OAAC2W,EAAOtV,GAAOrB,cAqBf6W,EAAY1J,EAAMnO,GACjCA,EAASA,GAAU,GACnB,IAAM8X,EAAW,GACXC,EAAM,GAENC,EAAU,SAASC,EAAMvM,GAC9B,IAAMrJ,EAxDA2C,IA6DN,OAJA8S,EAASzV,GAAO,CAAE4V,OAAMvM,WACNA,EAAL,MAATuM,EAAsBF,EACbA,EAAIE,QAxDPC,EAuD4BD,GAG/B5V,GAsBF8V,EAAQ,GACVC,GAAc,EAmBZC,EAAS,SAAShW,EAAKiD,EAAKtE,EAAOsX,GACxC,GAAIF,EACHD,EAAM/V,KAAK,CAACC,EAAKiD,EAAKtE,EAAOsX,SAK9B,IADA,IAAMC,EAAOhG,OAAOiG,KAAKV,GAChBjV,EAAI,EAAGA,EAAI0V,EAAKzV,OAAQD,IAAK,CACrC,IAAMf,EAAMgW,EAASS,EAAK1V,IACrBf,IACY,MAAbA,EAAImW,MAAgBnW,EAAImW,OAAS5V,GACpCP,EAAI4J,QAAQ1K,EAAOsE,EAAKjD,EAAKiW,MA8BhC,OAzBA/F,OAAOqF,eAAeG,EAAK,WAAY,CACtC/W,MAAO,CACNmB,YAAa6V,EACbjV,YA3CiB,SAAShC,UACpB+W,EAAS/W,KA4ChB0X,YAAY,EACZC,cAAc,IAEfnG,OAAOqF,eAAeG,EAAK,WAAY,CACtC/W,MAAOgX,EACPS,YAAY,EACZC,cAAc,IAEfnG,OAAOqF,eAAeG,EAAK,SAAU,CACpC/W,MA/CW,SAASkB,GACpB,GAAoB,mBAATA,EAAqB,CAC/B,IAAMyW,EAASzW,EACfA,EAAO,WACN,IAAK,IAAMG,KAAOsW,EAAQZ,EAAI1V,GAAOsW,EAAOtW,IAO9C,IAHA+V,GAAc,EACdlW,EAAK6V,GACLK,GAAc,EACPD,EAAMrV,QAAQ,CACpB,IAAMhB,EAAMqW,EAAM5N,QAClB8N,EAAOnK,MAAMjO,KAAM6B,KAmCpB2W,YAAY,EACZC,cAAc,IAEfnG,OAAOqF,eAAeG,EAAK,UAAW,CACrC/W,MA1Ec,SAASmN,EAAMyK,GAG7B,IAAK,IAAMvW,KAFXuW,EAAUA,GAAW5Y,EAEHmO,EACjB,GAAIA,EAAKqE,eAAenQ,GAAM,CAC7B,IAAMwB,EAAOsK,EAAK9L,GACduW,EAAQC,QAA0B,iBAAThV,GAAqBA,EACjDkU,EAAI1V,GAAOwV,EAAYhU,EAAM+U,GAE7BE,EAASf,EAAKlU,EAAMxB,EAAKgW,KAkE5BI,YAAY,EACZC,cAAc,IAGfX,EAAIgB,QAAQ5K,EAAMnO,GACX+X,EAGR,SAASe,EAAShX,EAAKkX,EAAK3W,EAAKgW,GAChC9F,OAAOqF,eAAe9V,EAAKO,EAAK,CAC/B0L,IAAK,WACJ,OAAOiL,GAERrR,IAAK,SAAS3G,GAQb,GANY,OAARgY,GAA0B,OAAVhY,EACTgY,IAAQhY,EAERgY,EAAIC,WAAajY,EAAMiY,UAGrB,CACZ,IAAI3T,EAAM0T,EACVA,EAAMhY,EACNqX,EAAOhW,EAAKiD,EAAKtE,EAtJP,QAyJZyX,YAAY,EACZC,cAAc,ICzKhB,IAAMQ,EAAInZ,MAAMuM,cAwCA6M,EAAyBnO,EAAGoO,GAM3C,OALApO,EAAI,IAAIsB,KAAKtB,IACXqO,SAAS,EAAG,EAAG,EAAG,IACpBD,EAAI,IAAI9M,KAAK8M,IACXC,SAAS,EAAG,EAAG,EAAG,GAEbC,KAAKC,OAAOvO,EAAEwO,UAAYJ,EAAEI,WAPjB,gBA0BHC,EAAkBzO,EAAGoO,GACpC,OAAwC,GAAjCD,EAAyBnO,EAAGoO,IAAWpO,EAAE0O,WAAaN,EAAEM,YAOhE,IAAMC,EAAU,YACAC,EAAOC,EAAMD,GAC5B,OAAOE,EAAeF,EAAfE,CAAuBD,YAEfC,EAAeF,GAC9B,IAAI9O,EAAK6O,EAAQC,GAKjB,OAJK9O,IACJA,EAAK6O,EAAQC,GAAU7Z,MAAMuM,KAAKyN,UAAUH,IAGtC9O,EChER,IAAMkP,EAAO,CACZC,cDSiCjP,EAAGoO,GACpC,OAAOpO,EAAEkP,cAAgBd,EAAEc,eCT3BC,iBD4BoCnP,EAAGoO,GACvC,OACuC,GAArCpO,EAAEkP,cAAgBd,EAAEc,gBACpBZ,KAAKc,MAAMpP,EAAEqP,WAAa,GAAK,IAC/Bf,KAAKc,MAAMhB,EAAEiB,WAAa,GAAK,IC/BjCC,eDWkCtP,EAAGoO,GACrC,OACuC,IAArCpO,EAAEkP,cAAgBd,EAAEc,gBAAuBlP,EAAEqP,WAAajB,EAAEiB,aCZ9DE,cDkCiCvP,EAAGoO,GACpC,IAAMY,EAAOb,EAAyBnO,EAAGoO,GAAK,EAC9C,OACCE,KAAKkB,KAAKlB,KAAKmB,IAAIT,IAAShP,EAAE0P,UAAYtB,EAAEsB,SAAW,EAAI,IAC3DpB,KAAKqB,KAAKX,ICrCXY,IAAKzB,EACL0B,KAAMpB,EACNqB,gBD2CmC9P,EAAGoO,GACtC,OAAiC,GAA1BK,EAAkBzO,EAAGoO,IAAWpO,EAAE+P,aAAe3B,EAAE2B,gBClB3D,IAAMC,EAAe,CACpBf,KAAM,CAAC,UAAW,GAClBE,QAAS,CAAC,QAAS,GACnBG,MAAO,CAAC,MA1BT,SAA0BW,GACzB,IAAKA,EAAO,OAAO,GAEnB,IAAMC,EAAID,EAAMZ,WAEhB,GAAU,IAANa,EAAS,CACZ,IAAMC,EAAIF,EAAMf,cAChB,OAAIiB,EAAI,EAAU,GACdA,EAAI,IAAY,GAChBA,EAAI,IAAY,GACb,GAGR,OAAKD,EAAI,GAAKA,EAAI,KAASA,EAAI,IAAMA,EAAI,EACjC,GAGD,KAUPX,KAAM,CAAC,MAAO,GACdK,IAAK,CAAC,OAAQ,IACdC,KAAM,CAAC,SAAU,KAGZO,EAAM,CACXnB,cDrCwBJ,EAAMwB,GAC9B,OAAOnC,EAAEkC,IAAIvB,EAAY,EAANwB,EAAS,QAAQ,ICqCpClB,iBD1C2BN,EAAMwB,GACjC,OAAOnC,EAAEkC,IAAIvB,EAAY,EAANwB,EAAS,SAAS,IC0CrCf,eD/CyBT,EAAMwB,GAC/B,OAAOnC,EAAEkC,IAAIvB,EAAY,EAANwB,EAAS,SAAS,IC+CrCd,cDpDwBV,EAAMwB,GAC9B,OAAOnC,EAAEkC,IAAIvB,EAAY,EAANwB,EAAS,QAAQ,ICoDpCT,aDzDuBf,EAAMwB,GAC7B,OAAOnC,EAAEkC,IAAIvB,EAAY,EAANwB,EAAS,OAAO,ICyDnCR,cD9DwBhB,EAAMwB,GAC9B,OAAOnC,EAAEkC,IAAIvB,EAAY,EAANwB,EAAS,QAAQ,IC8DpCP,gBDnE0BjB,EAAMwB,GAChC,OAAOnC,EAAEkC,IAAIvB,EAAY,EAANwB,EAAS,UAAU,KC8EvC,SAASC,EAAUC,EAAMlR,EAAMmR,EAAMC,EAASC,GAC7C,IAAMC,EAAUF,EAAUT,EAAaO,GAAM,GAAKA,EAE9ClQ,EAAQmQ,EACRxI,EAAM3I,EAOV,GANIqR,IACHrQ,EAAQuQ,GAAaD,EAASH,IAC9BxI,EAAM4I,GAAaD,EAAStR,IAClBA,IAAM2I,EAAM6I,GAAQF,EAARE,CAAiB7I,EAAK,KAGzCyI,EAAS,CACZ,IAAIK,EAAS9B,EAAK2B,GAAS3I,EAAK3H,GAC1BpB,EAAM+Q,EAAaO,GAAM,GAC/B,OAAOO,GAAyB,iBAAR7R,EAAmBA,EAAMA,EAAIuR,IAErD,OAAOxB,EAAK2B,GAAS3I,EAAK3H,YASZ0Q,EAAQR,GAYvB,OAAO,SAAClR,EAAMmR,EAAMC,EAASC,GAC5B,MAAa,UAATH,GAAoBE,EAgB1B,SAAyBzI,EAAK3H,EAAOqQ,GACpC,GAAIM,EAAU3Q,EAAO2H,GACpB,OAAOsI,EAAU,QAAStI,EAAK3H,GAAO,EAAMqQ,GAI7C,IAAIO,EAAmB,EACvB,GAAI5Q,EAAM6Q,UAAY,EAAG,CACxB,IAAMC,EAAK,IAAI7P,KAAKjB,EAAM6O,cAAe7O,EAAMgP,WAAa,EAAG,GAC/D4B,EAAmBX,EAAU,QAASa,EAAI9Q,GAAO,GACjDA,EAAQ8Q,EAIT,IAAIC,EAAS,EACRJ,EAAU3Q,EAAO2H,KACrBoJ,EAASd,EAAU,QAASvb,MAAMuM,KAAK+P,WAAWrJ,GAAM3H,GACxDA,EAAQtL,MAAMuM,KAAK8O,IAAI/P,EAAO+Q,EAAQ,SAAS,IAIhD,OAAOH,EAAmBG,EAASd,EAAU,QAAStI,EAAK3H,GAAO,GApCzDiR,CAAgBjS,EAAMmR,EAAME,GAE5BJ,EAAUC,EAAMlR,EAAMmR,EAAMC,EAASC,IAqC/C,SAASM,EAAUhR,EAAGoO,GACrB,OAAOrZ,MAAMuM,KAAKiQ,MAAMxc,MAAMuM,KAAK+P,WAAWrR,GAAIjL,MAAMuM,KAAK+P,WAAWjD,aAGzDyC,GAAQN,GACvB,OAAOH,EAAIG,YAGIK,GAAaL,EAAMlQ,GAClC,IAAImL,EACJ,OAAQ+E,GACP,IAAK,OACJ,OAAO,IAAIjP,KAAKjB,EAAM6O,cAAe,EAAG,GACzC,IAAK,UACJ,OAAO,IAAI5N,KACVjB,EAAM6O,cAC6B,EAAnCZ,KAAKc,MAAM/O,EAAMgP,WAAa,GAC9B,GAEF,IAAK,QACJ,OAAO,IAAI/N,KAAKjB,EAAM6O,cAAe7O,EAAMgP,WAAY,GACxD,IAAK,OAGJ,OAFA7D,EAAI,IAAIlK,KAAKjB,EAAM6O,cAAe7O,EAAMgP,WAAYhP,EAAM6Q,YACxDM,QAAQnR,EAAM6Q,UAAY7Q,EAAMqP,UAC3BlE,EACR,IAAK,MAGJ,OAFAA,EAAI,IAAIlK,KAAKjB,EAAM6O,cAAe7O,EAAMgP,WAAYhP,EAAM6Q,YACxD7C,SAAS,EAAG,EAAG,EAAG,GACb7C,EACR,IAAK,OAGJ,OAFAA,EAAI,IAAIlK,KAAKjB,EAAM6O,cAAe7O,EAAMgP,WAAYhP,EAAM6Q,YACxD7C,SAAShO,EAAMqO,WAAY,EAAG,EAAG,GAC5BlD,EACR,QACC,OAAO,IAAIlK,KAAKjB,aCvLHoR,GAAYpR,EAAO2H,EAAKyI,EAASiB,EAAOC,EAAQC,GAG/D,IAAMjB,EAVP,SAAoBiB,GACnB,IAAMvR,EAAQ,IAAIiB,KAClB,OAAOsQ,EACLC,KAAI,SAAAC,GAAQ,OAAGA,OAAMC,IAAKlB,GAAQiB,EAAKvB,KAAbM,CAAmBxQ,EAAO,OACpD2R,MAAK,SAAChS,EAAGoO,GAAM,OAACpO,EAAE+R,IAAM3D,EAAE2D,KAAO,EAAI,KAAI,GAAGD,KAAKvB,KAMnC0B,CAAWL,GACrB5C,EAAO+B,EAAQJ,GAEfuB,EAAUtB,GAAaD,EAAS3I,GACtC3H,EAAQuQ,GAAaD,EAAStQ,GAC9B2H,EAAMkK,EAAUlK,EAAM6I,GAAQF,EAARE,CAAiBqB,EAAS,GAAKA,EAErD,IAAMC,EAAYnD,EAAKhH,EAAK3H,GAASqR,EAC/BU,EAAaT,EAASC,EAAO9Z,OAgEnC,MAAO,CACNua,KA/DYT,EAAOC,KAAI,SAAAS,GAOvB,IANA,IAAMC,EAAQ,GACRnC,EAAMS,GAAQyB,EAAK/B,MACnBiC,EAAOF,EAAKE,MAAQ,EACpBC,EAA2B,SAAZ9B,GAAoC,SAAd2B,EAAK/B,KAE5C1B,EAAO+B,GAAa0B,EAAK/B,KAAMlQ,GAC5BwO,EAAO7G,GAAK,CAClB,IAAI3I,EAAO+Q,EAAIvB,EAAM2D,GAEjB3D,EAAOxO,IAAOwO,EAAOxO,GACrBhB,EAAO2I,IAAK3I,EAAO2I,GAQvB,IAAI0K,EAAQ7D,EACR8D,EAAQtT,EACRoT,IACC5D,EAAKa,SAAW,IACnBgD,EAAQ3d,MAAMuM,KAAK8O,IAAIvB,EAAM,EAAG,QAAQ,IAErCxP,EAAKqQ,SAAW,IACnBiD,EAAQ5d,MAAMuM,KAAK8O,IAAI/Q,EAAM,EAAG,QAAQ,KAI1C,IAAMuT,GAAa5D,EAAK2D,EAAOD,IAAU,GAAKhB,EAOxC1b,EACkB,mBAAhBsc,EAAK1D,OACT0D,EAAK1D,OAAOC,EAAMxP,GAClBuP,EAAOC,EAAMyD,EAAK1D,QAElBiE,EAAM,GACNP,EAAKO,MACRA,GAA2B,mBAAbP,EAAKO,IAAqBP,EAAKO,IAAIhE,GAAQyD,EAAKO,KAE/DN,EAAMnb,KAAK,CACVsa,MAAOkB,EACP5c,QACA6c,MACAhE,OACAD,OAAQE,EAAewD,EAAK1D,UAG7BC,EAAOxP,EAGR,MAAO,CAAEkT,QAAOnC,MAAKuB,SAAQjO,KAAM4O,EAAK/B,KAAMiC,KAAMF,EAAKE,MAAQ,MAOjEd,MAAOS,EACPR,OAAQS,EACRQ,UAAWlB,EACXoB,WAAYnB,EACZ3C,OACA3O,QACA2H,MACA2I,UACAF,QAZDA,KAAyB,QAAZE,EAAoBF,EAAqB,GAAXA,ICtE5C,IAAMsC,GAAa,CAClB1S,eAAM2S,EAAKrU,GACVqU,EAAIC,mBAAqBle,MAAMme,MAC9BH,GAAWI,WACXH,EACA,CAACrU,EAAG5J,MAAMoP,KAAKpL,IAAI4F,IACnB,MAIFnE,eAAMwY,GACDA,EAAIC,qBACPD,EAAIC,mBAAqB9S,OAAOiT,aAAaJ,EAAIC,sBAGnDE,oBAAWxU,EAAG5F,GACb,IAAMsa,GAA2C,IAAjCpe,KAAKqe,UAAUta,QAAQ,KACjCua,GAA2C,IAAjCte,KAAKqe,UAAUta,QAAQ,KACjCwa,EAAMze,MAAMoP,KAAKsP,OAAOxe,KAAKye,KAAKC,OAEpCnZ,GAAQ,EACR6Y,GAAWN,GAAWa,YAAYnM,KAAKxS,KAAM8D,EAAKya,EAAKve,KAAK4e,UAC/DrZ,GAAQ,GACL+Y,GAAWR,GAAWe,YAAYrM,KAAKxS,KAAM8D,EAAKya,EAAKve,KAAK8e,UAC/DvZ,GAAQ,GAELA,KAtCN,SAAuBmE,EAAG5F,GACzB,GAAIhE,MAAMif,YAAYC,OAAQ,CAC7B,IAAMC,EAAOnf,MAAMif,YAAYG,UAE/Bpb,EAAMhE,MAAMwM,KAAKxI,GACjBhE,MAAMif,YAAYI,SAASrb,EAAK4F,GAEhCuV,EAAKG,MAAMvQ,IAAM/K,EAAIoX,EAAIpb,MAAMif,YAAYlQ,IAAM,KACjDoQ,EAAKG,MAAMC,KAAOvb,EAAI8O,EAAI9S,MAAMif,YAAYM,KAAO,MA+BlDC,CAAc5V,EAAG5F,GACjB9D,KAAKge,mBAAqBle,MAAMme,MAC/BH,GAAWI,WACXle,KACA,CAAC0J,EAAG5F,GACJ,OAKH6a,qBAAY7a,EAAKya,EAAKgB,GACrB,IAAMC,EAASxf,KAAKye,KAAKgB,iBAEzB,OAAI3b,EAAIoX,EAAIqD,EAAIrD,EAAIqE,EACZzB,GAAW4B,aAAalN,KAC9BxS,KACAwf,EAAO5M,EACP4M,EAAOtE,EAAIqE,EACX,KAESzb,EAAIoX,EAAIqD,EAAIrD,EAAIqD,EAAI7B,OAAS6C,GAChCzB,GAAW4B,aAAalN,KAC9BxS,KACAwf,EAAO5M,EACP4M,EAAOtE,EAAIqE,EACX,MAMHV,qBAAY/a,EAAKya,EAAKgB,GACrB,IAAMC,EAASxf,KAAKye,KAAKgB,iBAEzB,OAAI3b,EAAI8O,EAAI2L,EAAI3L,EAAI2M,EACZzB,GAAW4B,aAAalN,KAC9BxS,KACAwf,EAAO5M,EAAI2M,EACXC,EAAOtE,EACP,KAESpX,EAAI8O,EAAI2L,EAAI3L,EAAI2L,EAAI9B,MAAQ8C,GAC/BzB,GAAW4B,aAAalN,KAC9BxS,KACAwf,EAAO5M,EAAI2M,EACXC,EAAOtE,EACP,MAMHwE,sBAAa9M,EAAGsI,EAAGyE,GAClB3f,KAAKye,KAAKmB,SAAShN,EAAGsI,GACtBlb,KAAKye,KAAKzY,UAAU,oBAAqB,IAEzC,IAAMwZ,EAASxf,KAAKye,KAAKgB,iBACzB,OAAOpG,KAAKmB,KAAc,MAATmF,EAAe/M,EAAIsI,GAAKsE,EAAOG,IAAS,aCzE3CE,GAAmBtJ,GASlC,GAPCA,EAAEuJ,YACFvJ,EAAEwJ,UACFxJ,EAAEuJ,WAAW9G,WAAazC,EAAEwJ,SAAS/G,YAErCzC,EAAEwJ,SAAW,KACbxJ,EAAEyJ,SAAW,GAEA,aAAVzJ,EAAE9H,KACL8H,EAAEwJ,SAAWxJ,EAAEuJ,WACfvJ,EAAEyJ,SAAW,MACP,CAEN,IAAKzJ,EAAEyJ,SAAU,CAChB,IAAM/G,EAAI6C,EAAQ,MAARA,CAAevF,EAAEwJ,SAAUxJ,EAAEuJ,YAAY,GACnDvJ,EAAEyJ,SAAW/G,EAAI,EAAII,KAAKc,MAAMlB,GAAKgH,WAAWhH,EAAEiH,QAAQ,IAEtD3J,EAAEwJ,WACFxJ,EAAEyJ,SAAW,EAChBzJ,EAAEwJ,SAAWnE,GAAQ,OAARA,CAAgBrF,EAAEuJ,WAAYzG,KAAKc,MAAM,GAAK5D,EAAEyJ,WACzDzJ,EAAEwJ,SAAWnE,GAAQ,MAARA,CAAerF,EAAEuJ,WAAYvJ,EAAEyJ,YC5CpD,IAEaG,GAAa,SAAS1I,EAAM2I,EAAWC,EAAS3D,GAC5D,IAOI4D,EAAIC,EAAIC,EAAIC,EAPVC,EAAKrH,KAAKC,MAAMoD,EAAS,GAE/B,IAAK0D,IAAcC,EAElB,OADA5I,EAAKkJ,GAAK,GACHlJ,EAIR,IA6EuB7E,EAAGsI,EA7EtB0F,GAAU,EACVC,GAAU,EAEd,OAAQpJ,EAAKhJ,MACZ,KAAK,EACJoS,GAAU,EACV,MAED,KAAK,EACJD,GAAU,EACVC,GAAU,EACV,MAED,KAAK,EACJD,GAAU,EAYZ,GALAN,EAAKM,EAAUR,EAAUU,GAAKV,EAAUU,GAAKV,EAAUW,GACvDR,EAAeH,EAAUY,GACzBR,EAAKK,EAAUR,EAAQS,GAAKT,EAAQS,GAAKT,EAAQU,GACjDN,EAAeJ,EAAQW,GAEnBV,IAAOE,GAAMD,IAAOE,EAAI,CAC3B,IAAMQ,EAiBR,SAAuBX,EAAIC,EAAIC,EAAIC,EAAIG,EAASC,EAASK,GACxD,IAGMC,EAAMb,EA3DC,IAwDUM,GAAW,EAAI,GAIhCQ,EAAMZ,EA5DC,IAyDcK,GAAW,EAAI,GAIpCxD,EAAO,CAACiD,EAAIC,EAAIY,EAAKZ,EAAI,EAAG,EAAG,EAAG,EAAGa,EAAKX,EAAID,EAAIC,GAElDY,EAAKD,EAAMD,EACbT,EAAKD,EAAKF,EAERe,EAAOT,IAAYD,EACpBU,IACCF,GAAOd,GAAMO,GAAaO,EAAMd,IAAOO,KAC3CH,GAAMQ,GAIHI,GAAQT,GAAWM,EAAMC,GAASE,IAAST,GAAWM,EAAMC,GAChE/D,EAAK,GAAKA,EAAK,GAAKgE,EACpBhE,EAAK,GAAKA,EAAK,GACfA,EAAK,GAAKA,EAAK,GACfA,EAAK,GAAKA,EAAK,GAAKqD,IAEpBrD,EAAK,GAAKA,EAAK,GACfA,EAAK,GAAKA,EAAK,GAAKqD,EACpBrD,EAAK,GAAKA,EAAK,GAAKgE,EACpBhE,EAAK,GAAKA,EAAK,IAGhB,OAAOA,EAAK1Y,KAAK,KA/CG4c,CAClBjB,EACAC,EAAKG,EACLF,EACAC,EAAKC,EACLE,EACAC,EACA,IAGKW,GAwCgB5O,EAxCa4N,EAwCVtF,EAxCcuF,EAAKC,EAAIG,EA0CtCjO,EAAI,OAAKsI,EAAI,QAAKtI,EAAI,QAAKsI,EAAI,OAAKtI,MAAKsI,EAEzCtI,EAAI,OAAKsI,EAAI,QAAKtI,EAAI,QAAKsI,EAAI,OAAKtI,MAAKsI,GA3CnDzD,EAAKkJ,GAAQM,MAAcO,EAG5B,OAAO/J,YCjDQgK,GAAQpgB,GACvB,IAAMqgB,EAAO5hB,MAAMwM,KAAKyS,IAExB2C,EAAKrgB,KAAOA,EACZqgB,EAAKC,OAAS3hB,KAEd0hB,EAAKE,MAAQ5hB,KAAKY,IAAIihB,WAAW,SAEjC/hB,MAAMif,YAAY+C,QAAQzgB,EAAKqd,MAAOgD,GACtC5hB,MAAMif,YAAYgD,QAAQ1gB,EAAKqd,MAAOgD,GAAM,GAc7C,SAASM,GAAY/C,EAAMrM,GAC1B,IAAMqP,EAAOhD,EAAKiD,wBACZC,GAAKvP,EAAIqP,EAAK5C,MAAQ4C,EAAKxF,MAC3B2F,EAAWtiB,MAAMuiB,IAAIC,MAAQ,IAAM,IACnCC,EAAQ,IAAON,EAAKxF,MAAQ2F,EAAWH,EAAKxF,MAAQ2F,EAAW,GAErE,OAAID,EAAII,EAAc,QAClBJ,EAAI,EAAII,EAAc,MACnB,OAGR,SAASC,GAAuBC,GAC/B,IAAM9F,EAAS3c,KAAK4hB,MAAMc,YAG1B,OAFAD,EAAG3D,OAASzF,KAAKC,MAAMqD,EAAOgB,WAAa7d,MAAMuiB,IAAIC,MAAQ,EAAI,KACjEG,EAAG7D,OAASvF,KAAKC,MAAMqD,EAAOkB,YAAc/d,MAAMuiB,IAAIC,MAAQ,EAAI,IAC3DG,EAWR,IAAM1D,GAAc,CACnB4D,iBAAiB,EACjBC,YAAa,SAASrM,EAAG7M,GACxB,GAAI1J,KAAK2hB,OAAOkB,MAAMC,SAAU,OAAO,EAEvC,IAAMhiB,EAAKd,KAAK+iB,YAAYrZ,GAC5B,GAAI5I,EAAI,CACP,IAAMid,EAAM/d,KAAKgjB,aACX9b,EAASwC,EAAExC,OAEjB,GAAIA,EAAO+b,UAAU3gB,SAAS,oBAE7B,OADAyb,EAAI4B,KAAO,QACJuD,GAAMnF,EAAI4B,MAAMiD,YAAYpQ,KAAKxS,KAAMuW,EAAG7M,EAAG5I,GAGrD,IAAMme,EAAOjf,KAAKqB,KAAK8hB,YAAYriB,GACnC,IAAKhB,MAAMuiB,IAAIC,OAxBlB,SAAwB/L,EAAG0I,GAC1B,KAAO1I,GAAK0I,GAAM,CACjB,GAAI1I,EAAE0M,UAAU3gB,SAAS,6BAA8B,OAAO,EAC9DiU,EAAIA,EAAEvJ,WAEP,OAAO,EAmBmBoW,CAAelc,EAAQ+X,GAE9C,OADAlB,EAAI4B,KAAO,WACJuD,GAAMnF,EAAI4B,MAAMiD,YAAYpQ,KAAKxS,KAAMuW,EAAG7M,EAAG5I,GAGrD,IAAMuiB,EAASrjB,KAAKqB,KAAKoe,iBACnB6D,EAAYtjB,KAAKujB,gBAAgB7Z,GAEnCiW,EAAOqC,GAAY/C,EAAMqE,EAAU1Q,GAER,QAA9B5S,KAAKqB,KAAKmiB,QAAQ1iB,GAAI2N,MACb,SAARkR,GAA2B,OAARA,IAEpBA,EAAO,QAER,IAAMhD,EAAS3c,KAAK4hB,MAAMc,YACtBnF,EAAOZ,EAAOgB,UAClB,GAAIhB,EAAOnB,QAAS,CACnB,IAAMiI,EAAM1I,EAAa4B,EAAOjB,SAAS,GACzC6B,EAAOlE,KAAKC,MAAMiE,GAAuB,iBAARkG,EAAmBA,EAAMA,MAG3D3jB,MAAMQ,OACLyd,EACA,CACCjd,KACA6e,OACAV,OACA1B,OACA8D,GAAI,EACJ5C,KAAMze,KAAKqB,KACXuR,EAAG0Q,EAAU1Q,EACb4M,OAAQ6D,EACR9M,EAAGmN,SAASzE,EAAKG,MAAMvQ,KACvB8U,EAAGD,SAASzE,EAAKG,MAAMC,MACvB7O,EAAGkT,SAASzE,EAAKG,MAAM3C,SAExB,GAGGyG,GAAMnF,EAAI4B,MAAMiE,YACnB9jB,MAAMQ,OACLyd,EACAyE,GAAuBhQ,KAAKxS,KAAMkjB,GAAMnF,EAAI4B,MAAMiE,aAGpD,IAAM1U,EAAO+P,EAAK4E,WAAU,GAQ5B,OAPA3U,EAAK4U,WAAa,qCAAuCnE,EAEzDV,EAAKG,MAAM2E,WAAa,SACxBjkB,MAAMoP,KAAKC,OAAOoH,EAAG,yBAAyB,GAE9CA,EAAE6I,MAAM4E,OAAiB,QAARrE,EAAiB,OAAS,YAC3CpJ,EAAE0N,cAAc,sBAAsBC,YAAYhV,GAC3CA,EAER,OAAO,GAERiV,aAAc,SAAS5N,EAAG0I,GAAZ,WACPlB,EAAM/d,KAAKgjB,aAIjB,OAFIE,GAAMnF,EAAI4B,MAAMiE,YAAY9F,GAAWvY,MAAMwY,GAE7CA,EAAI4B,MAAQuD,GAAMnF,EAAI4B,MAAMwE,aACxBjB,GAAMnF,EAAI4B,MAAMwE,aAAa3R,KAAKxS,KAAMuW,EAAG0I,IAE/ClB,EAAIqG,YACPrG,EAAIqG,YAAYle,OAAM,WACrBG,EAAKsb,OAAO0C,OAAO,CAAEC,OAAQ,mBAAoBxjB,GAAIid,EAAIjd,QAG1Did,EAAIqG,YAAcpkB,KAAK2hB,OAAO0C,OAAO,CACpCC,OAAQ,mBACRxjB,GAAIid,EAAIjd,KAGVid,EAAIqG,YAAYG,SAAQ,WACvBxG,EAAIkB,KAAKG,MAAM2E,WAAa,GAC5BjkB,MAAMoP,KAAKsV,OAAOvF,MAGnB1I,EAAE6I,MAAM4E,OAAS,GACjBlkB,MAAMoP,KAAKE,UAAUmH,EAAG,0BACjB,IAERkO,QAAS,SAASC,EAAGnO,EAAG7M,GACvB,IAAMqU,EAAM/d,KAAKgjB,aACjB,QAAKjF,EAAI4B,OAELuD,GAAMnF,EAAI4B,MAAMiE,aACnB9F,GAAWvY,MAAMwY,GACjBD,GAAW1S,MAAM2S,EAAKrU,KAGnBwZ,GAAMnF,EAAI4B,MAAM8E,SACZvB,GAAMnF,EAAI4B,MAAM8E,QAAQjS,KAAKxS,KAAM0kB,EAAGnO,EAAG7M,KAGlDyV,SAAU,SAASrb,GAClB,IAAMia,EAAM/d,KAAKgjB,aACjB,OAAOE,GAAMnF,EAAI4B,MAAMR,SAAS3M,KAAKxS,KAAM8D,IAE5C6gB,SAAU,SAASD,EAAGnO,EAAGjQ,EAAGoD,GAC3B,IAAMqU,EAAM/d,KAAKgjB,aACjB,OAAIE,GAAMnF,EAAI4B,MAAMgF,SACZzB,GAAMnF,EAAI4B,MAAMgF,SAASnS,KAAKxS,KAAM0kB,EAAGnO,EAAGjQ,EAAGoD,GAC9C,MAERkb,MAAO,SAASF,EAAGnO,EAAG7M,GACrB,IAAMqU,EAAM/d,KAAKgjB,aACjB,IAAKjF,EAAI4B,KAAM,OAAO,EAEtB,GAAIuD,GAAMnF,EAAI4B,MAAMiF,MAAO,OAAO1B,GAAMnF,EAAI4B,MAAMiF,MAAMpS,KAAKxS,KAAM0kB,EAAGnO,EAAG7M,GAEjE,IAAA5I,EAAuBid,KAAnB4B,EAAmB5B,OAAbsD,EAAatD,KAATR,EAASQ,OACzB8G,EAAOxL,KAAKC,MAAM+H,EAAK9D,GAE7BQ,EAAiB,YAAI/d,KAAK2hB,OAAO0C,OAAO,CACvCC,OAAQ,mBACR3E,OACAkF,OACA/jB,QAGFiiB,YAAa,SAAS+B,EAAIpS,GAIzB,OAHI5S,MAAMuiB,IAAIC,OAAS5P,IACtBoS,EAAKtc,SAASuc,iBAAiBrS,EAAQE,EAAGF,EAAQwI,IAE5Cpb,MAAMoP,KAAK8V,OAAOF,EAAI,eAE9BvB,gBAAiB,SAAS7Z,GACzB,GAAI5J,MAAMuiB,IAAIC,MAAO,CACpB,GAAI5Y,EAAEub,kBAAoBvb,EAAEwb,UAAWxb,EAAEwb,QAAQ,IAAK,CACrD,IAAM3O,EAAI7M,EAAEub,eAAe,GAC3B,MAAO,CAAErS,EAAG2D,EAAE4O,MAAOjK,EAAG3E,EAAE6O,OAE3B,OAAO1b,EAAEmb,KAAOnb,EAAI5J,MAAMuiB,IAAIgD,MAAM3S,QAAQhJ,GAE7C,MAAO,CAAEkJ,EAAGlJ,EAAE4b,QAASpK,EAAGxR,EAAE6b,UAE7BvC,WAAY,WACX,OAAOljB,MAAMif,YAAYiE,cAE1BwC,cAAe,SAASvG,EAAM/X,EAAQwC,GACrC,IAAMqU,EAAM/d,KAAKgjB,aACXlf,EAAMhE,MAAMoP,KAAKpL,IAAI4F,GACrB8U,EAAS1e,MAAMoP,KAAKsP,OAAOS,GAEjClB,EAAItB,MAAQ+B,EAAO/B,MACnBsB,EAAIrB,OAAS8B,EAAO9B,OACpBqB,EAAI0H,SAAWjH,EAAO5L,EAAI9O,EAAI8O,EAC9BmL,EAAI2H,SAAWlH,EAAOtD,EAAIpX,EAAIoX,IAmH1BpK,GAAS,CACdqO,SAAU,SAASrb,GAClB,IAAMia,EAAM/d,KAAKgjB,aACX2C,EAAU3lB,KAAKqB,KAAKoe,iBACpBR,EAAOnf,MAAMif,YAAYG,UACvBS,EAAuC5B,OAAjC4F,EAAiC5F,IAA9BxH,EAA8BwH,IAA3BvN,EAA2BuN,IAAxBnL,EAAwBmL,IAArBjd,EAAqBid,KAAjByB,EAAiBzB,SAATR,EAASQ,OACzCsD,EAAMtD,EAAIsD,GAAKvd,EAAI8O,EAAIA,EAAI4M,EAAO5M,EAAI+S,EAAQ/S,EAEvC,UAAT+M,GACH7b,EAAI8O,EAAIyG,KAAKuM,IAAIjC,EAAItC,EAAIsC,EAAInT,EAAI+M,GACjC0B,EAAKG,MAAM3C,MAAWpD,KAAKwM,IAAIrV,EAAI6Q,EAAI9D,SACpB,QAAToC,IACV7b,EAAI8O,EAAI+Q,EACR1E,EAAKG,MAAM3C,MAAWpD,KAAKwM,IAAIrV,EAAI6Q,EAAI9D,SAExCzZ,EAAIoX,EAAI3E,EAERvW,KAAK2hB,OAAO0C,OAAO,CAClBC,OAAQ,YACRxjB,KACAue,KAAMvb,EAAI8O,EACV6J,MAAOiH,SAASzE,EAAKG,MAAM3C,WAiHxByG,GAAQ,CACb4C,MAtPa,CACblC,WAAY,CACXvF,UAAW,MAEZuE,YAAa,SAASrM,EAAG7M,EAAG5I,GAC3B,IAAMid,EAAM/d,KAAKgjB,aACXvL,EAAO/N,EAAExC,OACT+X,EAAOjf,KAAKqB,KAAK8hB,YAAYriB,GAC7B0e,EAASxf,KAAKqB,KAAKoe,iBACnBjB,EAAS1e,MAAMoP,KAAKsP,OAAO/G,GAC3BmG,EAAMnG,EAAKwL,UAEjBnjB,MAAMQ,OACLyd,EACA,CACCjd,KACA2d,KAAMze,KAAKqB,KACX4d,OACAxH,OACAsO,UAAWnI,EAAItb,SAAS,yBACxB8I,MAAO,CACNwH,EAAG4L,EAAO5L,EAAI4L,EAAO/B,MAAQ,EAAI+C,EAAO5M,EACxCsI,EAAGsD,EAAOtD,EAAIsD,EAAO9B,OAAS,EAAI8C,EAAOtE,KAG3C,GAGGgI,GAAMnF,EAAI4B,MAAMiE,YACnB9jB,MAAMQ,OACLyd,EACAyE,GAAuBhQ,KAAKxS,KAAMkjB,GAAMnF,EAAI4B,MAAMiE,aAGpDnM,EAAK2H,MAAM4G,QAAU,EACrBlmB,MAAMoP,KAAKC,OAAO8P,EAAM,8BAA8B,GAEtD,IAAM/P,EAAOpP,MAAMoP,KAAK+W,OAAO,MAAO,CAAElC,WAAY,WAEpD,OADAvb,SAASC,KAAKyb,YAAYhV,GACnBA,GAERiV,aAAc,SAAS5N,EAAG0I,GACzB,IAAMlB,EAAM/d,KAAKgjB,aAIjB,GAFAhjB,KAAK2hB,OAAO0C,OAAO,CAAEC,OAAQ,cAEzBvG,EAAI7W,OAAQ,CACf,IAAM+H,EAAOjP,KAAKqB,KAAK8hB,YAAYpF,EAAI7W,QACvCpH,MAAMoP,KAAKE,UAAUH,EAAM,4BAO5B,OAJA8O,EAAItG,KAAK2H,MAAM4G,QAAU,GACzBlmB,MAAMoP,KAAKE,UAAU2O,EAAIkB,KAAM,8BAC/Bnf,MAAMoP,KAAKsV,OAAOvF,IAEX,GAERwF,QAAS,SAASC,EAAGnO,EAAG7M,GACvB,IAAMqU,EAAM/d,KAAKgjB,aACXM,EAAYtjB,KAAKujB,gBAAgB7Z,GACjC5I,EAAKd,KAAK+iB,YAAYrZ,EAAG4Z,GAE/B,IAAKxiB,EAAI,OAAO,EAEhB,IAAMme,EAAOjf,KAAKqB,KAAK8hB,YAAYriB,GAKnC,OAJIA,GAAMid,EAAI7W,SACbpH,MAAMoP,KAAKC,OAAO8P,EAAM,4BAA4B,GACpDlB,EAAI7W,OAASpG,GAEPme,GAERE,SAAU,SAASrb,GAClB,IAAMia,EAAM/d,KAAKgjB,aACX2C,EAAU3lB,KAAKqB,KAAKoe,iBAE1B1B,EAAIhL,IAAM,CACTH,EAAG9O,EAAI8O,EAAI+S,EAAQ/S,EACnBsI,EAAGpX,EAAIoX,EAAIyK,EAAQzK,GAGpBlb,KAAK2hB,OAAO0C,OAAO,CAAEC,OAAQ,YAAalZ,MAAO2S,EAAI3S,MAAO2H,IAAKgL,EAAIhL,OAEtE4R,SAAU,SAASD,EAAGnO,EAAGjQ,EAAGoD,GAC3B,IAAMqU,EAAM/d,KAAKgjB,aACXM,EAAYtjB,KAAKujB,gBAAgB7Z,GACjC5I,EAAKd,KAAK+iB,YAAYrZ,EAAG4Z,GAE/B,GAAIvF,EAAI7W,QAAUpG,GAAMid,EAAI7W,OAAQ,CACnC,IAAM+X,EAAOjf,KAAKqB,KAAK8hB,YAAYpF,EAAI7W,QACvCpH,MAAMoP,KAAKE,UAAU6P,EAAM,4BAC3BlB,EAAI7W,OAAS,KAEd,OAAO,MAER0d,MAAO,SAASF,EAAGnO,EAAG7M,GACrB,IAAMqU,EAAM/d,KAAKgjB,aACXtL,EAASqG,EAAIjd,GACbwiB,EAAYtjB,KAAKujB,gBAAgB7Z,GACjCxC,EAASlH,KAAK+iB,YAAYrZ,EAAG4Z,GAEnC,IAAKpc,GAAUwQ,GAAUxQ,EAAQ,OAAO,EAExC,IACM+a,EADOjiB,KAAKqB,KAAK8hB,YAAYjc,GACjBgb,wBACZgE,EAAU5C,EAAU1Q,EAAIqP,EAAK5C,KAAO4C,EAAKxF,MAAQ,EAEjDhO,GAAQsP,EAAIgI,UAAY,EAAI,IAAMG,EAAU,EAAI,GACtDlmB,KAAK2hB,OAAO0C,OAAO,CAAEC,OAAQ,WAAY5M,SAAQxQ,SAAQuH,WA4I1D0X,KA9GY,CACZvC,WAAY,CACXvF,UAAW,KAEZc,SAAU,SAASrb,GAClB,IAAMia,EAAM/d,KAAKgjB,aACT/D,EAA8BlB,OAAxB4F,EAAwB5F,IAArBxH,EAAqBwH,IAAlBnL,EAAkBmL,IAAfjd,EAAeid,KAAXyB,EAAWzB,SAChC4H,EAAU3lB,KAAKqB,KAAKoe,iBACpB4B,EAAMtD,EAAIsD,GAAKvd,EAAI8O,EAAIA,EAAI4M,EAAO5M,EAAI+S,EAAQ/S,EAEpD9O,EAAI8O,EAAI+Q,EAAItC,EACZvd,EAAIoX,EAAI3E,EAERvW,KAAK2hB,OAAO0C,OAAO,CAClBC,OAAQ,YACRxjB,KACAue,KAAMvb,EAAI8O,EACV6J,MAAOiH,SAASzE,EAAKG,MAAM3C,WA8F7B2J,SAzFgB,CAChBxD,YAAa,SAASrM,EAAG7M,EAAG5I,GAC3B,IAAMid,EAAM/d,KAAKgjB,aACX/D,EAAOjf,KAAKqB,KAAK8hB,YAAYriB,GAC7BulB,EAAermB,KAAKqB,KAAKmiB,QAAQ1iB,GAAIslB,SACrCE,EAAerH,EAAKgF,cAAc,yBAClCX,EAAYtjB,KAAKujB,gBAAgB7Z,GACjC8V,EAASxf,KAAKqB,KAAKoe,iBAEzB3f,MAAMQ,OACLyd,EACA,CACCjd,KACAme,OACAoH,eACAC,eACA7H,KAAMze,KAAKqB,KACXuR,EAAG0Q,EAAU1Q,EACbpC,EAAGkT,SAASzE,EAAKG,MAAM3C,OACvB+C,WAED,GAGDjJ,EAAE6I,MAAM4E,OAAS,YACjBlkB,MAAMoP,KAAKC,OAAOoH,EAAG,yBAAyB,GAC9CzW,MAAMoP,KAAKC,OAAO8P,EAAM,6BAA6B,GAErD,IAAM/P,EAAOpP,MAAMoP,KAAK+W,OAAO,MAAO,CAAElC,WAAY,WAEpD,OADAvb,SAASC,KAAKyb,YAAYhV,GACnBA,GAERiQ,SAAU,SAASrb,GAClB,IAAMia,EAAM/d,KAAKgjB,aACTpQ,EAAiBmL,IAAdyB,EAAczB,SAANvN,EAAMuN,IACnB4H,EAAU3lB,KAAKqB,KAAKoe,iBAEpB4B,EAAKvd,EAAI8O,EAAIA,EAAI4M,EAAO5M,EAAI+S,EAAQ/S,EACpCwT,EAAW/M,KAAKuM,IACrBvM,KAAKwM,IAAI9H,EAAIsI,aAAehN,KAAKC,MAAY,IAAL+H,EAAY7Q,GAAI,GACxD,KAGGuN,EAAIqI,UAAYA,IACnBrI,EAAIqI,SAAWA,EACflD,GAAMnF,EAAI4B,MAAM4G,mBAAmB/T,KAAKxS,KAAM+d,EAAKqI,KAGrDxB,MAAO,WACN,IAAM7G,EAAM/d,KAAKgjB,aACTliB,EAA+Bid,KAA3BqI,EAA2BrI,WAAjBsI,EAAiBtI,eAElCje,MAAM0mB,YAAYJ,IAAaA,GAAYC,IAC/CtI,EAAiB,YAAI/d,KAAK2hB,OAAO0C,OAAO,CACvCC,OAAQ,uBACR8B,WACAtlB,SAGHqjB,aAAc,SAAS5N,EAAG0I,GAAZ,WACPlB,EAAM/d,KAAKgjB,aAiBjB,OAfIjF,EAAIqG,YACPrG,EAAIqG,YAAYle,OAAM,WACrBG,EAAKsb,OAAO0C,OAAO,CAAEC,OAAQ,uBAAwBxjB,GAAIid,EAAIjd,QAG9Did,EAAIqG,YAAcpkB,KAAK2hB,OAAO0C,OAAO,CACpCC,OAAQ,uBACRxjB,GAAIid,EAAIjd,KAGVyV,EAAE6I,MAAM4E,OAAS,GACjBlkB,MAAMoP,KAAKE,UAAUmH,EAAG,yBACxBzW,MAAMoP,KAAKE,UAAU2O,EAAIkB,KAAM,6BAE/Bnf,MAAMoP,KAAKsV,OAAOvF,IACX,GAERsH,4BAAmBxI,EAAKqI,GACvB,IAAMnH,EAAOlB,EAAIuI,aACjBrH,EAAKG,MAAM3C,MAAQ2J,EAAW,IAC9BnH,EAAKzQ,UAAYxO,KAAK2hB,OAAO8E,qBAAqBL,KAQnDhb,MAAO0F,GACPiC,IAAKjC,mBCpdN,4DAqgBA,OArgBsCrK,OACrCigB,mBAAA,WAAA,WACC1mB,KAAK6iB,MAAQ7iB,KAAKuB,SAAS,SAAS,GACpC,IAAMiV,EAAIxW,KAAKY,IAAIihB,WAAW,UAAUrL,EAExC,MAAO,CACNnV,KAAM,YACNuc,IAAK5d,KAAK6iB,MAAMC,SAAW,wBAA0B,GACrD6D,YAAY,EACZrJ,MAAO,CACN,CACCjc,KAAM,WACNuc,IAAK,oBACL+I,YAAY,EACZC,UAAU,GAEX,CACCvlB,KAAM,OACNslB,YAAY,EACZlY,KAAMzO,KAAK6mB,SAASrQ,GACpBoH,IAAK,eAAc9d,MAAMuiB,IAAIC,MAAQ,SAAW,YAChDwE,GAAI,CACHC,YAAa,SAAAjmB,GACZuF,EAAKwc,MAAMmE,OAAO,CACjB5lB,OAAQ,KACR6lB,SAAUnmB,MAIbomB,QAAS,SAAArlB,GAAO,OAAAwE,EAAK8gB,WAAWtlB,EAAK2U,IACrCgJ,OAAQ,KACRoH,UAAU,MAMdF,iBAAA,SAAKrlB,GAAL,WACO+lB,EAAgB/lB,EAAKgmB,gBAApBvB,OAAOwB,OACdtnB,KAAKunB,MAAQzB,EACb9lB,KAAKwnB,KAAOF,EAEZ,IAAMG,EAASznB,KAAK4hB,MAAQ5hB,KAAKY,IAAIihB,WAAW,SAC1ClF,EAAS8K,EAAM/E,YACfgF,EAAS1nB,KAAK2nB,UAAYF,EAAMG,QAChCC,EAAS7nB,KAAK8nB,UAAYL,EAAM3B,QAAQ5X,KAE9CoZ,EAAKS,KAAKL,GACV1nB,KAAKgoB,aAAaH,GAElB7nB,KAAKioB,eACLjoB,KAAKkoB,WAAWvL,GAChB3c,KAAKmoB,gBAAgBxL,GAErB3c,KAAKooB,cAELpoB,KAAKqoB,eAAe1L,GAEpB3c,KAAK8mB,GAAGe,EAAO,kBAAkB,WAAM,OAAAxhB,EAAK2hB,aAAaH,MACzD7nB,KAAK8mB,GAAG9mB,KAAKY,IAAK,kBAAkB,SAAA+b,GAAU,OAAAtW,EAAKiiB,OAAO3L,EAAOF,UACjEzc,KAAK8mB,GAAGY,EAAMxZ,KAAM,kBAAkB,SAACpN,EAAIoN,EAAMoW,GAChDje,EAAK2hB,aAAaH,GACH,WAAXvD,GAAqBje,EAAKkiB,kBAG/BlnB,EAAKqd,MAAMU,MAAMoJ,gBAAkB,gBL4BhB/L,EAAOC,EAAQ+L,GACnC,IAAMC,EAASlgB,SAASmgB,cAAc,UACtCD,EAAOE,aAAa,QAASnM,GAC7BiM,EAAOE,aAAa,SAAUlM,GAE9B,IAAMqB,EAAM2K,EAAO1F,WAAW,MAO9B,OANAjF,EAAI8K,YAAcJ,EAClB1K,EAAI+K,OAAO,EAAGpM,GACdqB,EAAIgL,OAAOtM,EAAOC,GAClBqB,EAAIgL,OAAOtM,EAAO,GAClBsB,EAAIiL,SAEGN,EAAOO,YKxC6BC,CACzCvM,EAAOgB,UACPhB,EAAOkB,WACa,YAApB/d,MAAMqpB,KAAKC,MAAsB,UAAY,YAE9C/nB,EAAKqd,MAAMU,MAAMiK,UAAY,MAC7BrpB,KAAKsoB,OAAO3L,EAAOF,QASpBiK,yBAAA,SAAa7kB,EAAK2U,GACjB,IAAMjI,EAAO1M,EAAI0M,MAAQiI,EAAE,cAC3B,MAAmB,aAAZ3U,EAAI4M,KAAsB,SAASF,YAAgBA,GAQ3DmY,qBAAA,SAASlQ,GAAT,WACC,MAAO,CACNjH,SAAU,SAAA1N,GAAO,OAAAwE,EAAKijB,aAAaznB,EAAK2U,IACxC+S,cAAe,SAAAC,GACd,IAAMC,EAAkB,aAAbD,EAAK/a,KACZ+B,EAAIgZ,EAAKzI,GACZ2I,EAAIF,EAAKG,GACT5P,EAAO,EACPqM,EAAW,GAEZ,GAAIqD,EACHjZ,EAAIkZ,EAAIrQ,KAAKkB,KAAKlB,KAAKuQ,KAAKvQ,KAAKwQ,IAAIL,EAAKzI,GAAI,GAAK,IACnDhH,EAAOV,KAAKkB,MAAMiP,EAAKzI,GAAKvQ,GAAK,OAC3B,CACN,IAAMsZ,EACQ,QAAbN,EAAK/a,KAAiBpI,EAAKogB,qBAAqB+C,EAAKpD,UAAY,GAClEA,EAAW,kDAAkDoD,EAAKpD,gBAAe0D,WAGlF,MAAO,oBAAoBN,EAAK1oB,6DACY0oB,EAAK/a,mCAClC+a,EAAK1I,GAAK/G,cAAcyP,EAAKxI,GAC3CjH,eAAgBvJ,eAAckZ,+BACnBF,EAAK1oB,8FAEbslB,qDAGL2D,YAAa,WACZ,MAAA,6EASHrD,iCAAA,SAAqBN,GACpB,MAAO,sDAAsDA,2DACfA,yBAO/CM,uBAAA,WAAA,WACCjF,GAAQjP,KAAKxS,KAAMA,KAAKwnB,MAEnB1nB,MAAMuiB,IAAIC,QACdtiB,KAAKgqB,mBAAqBlqB,MAAM6O,MAAM3O,KAAKwnB,KAAK9I,MAAO,aAAa,SAAAhV,GACnE,gBDpIyBA,EAAGrI,GAC/B,IAAIvB,MAAMif,YAAYC,OAAtB,CAEA,IAAMle,EAAKhB,MAAMoP,KAAK8V,OAAOtb,EAAG,cAChC,GAAI5I,GAA+B,QAAzBO,EAAKmiB,QAAQ1iB,GAAI2N,KAAgB,CAC1C,IAAMwQ,EAAO5d,EAAK8hB,YAAYriB,GACxB6e,EAAOqC,GAAY/C,EAAMvV,EAAE4b,SACjCrG,EAAKG,MAAM4E,OAAiB,QAARrE,EAAiB,UAAY,cC6H/CsK,CAAavgB,EAAGrD,EAAKmhB,WAIxBd,oBAAA,WAIC,GAHA1mB,KAAKgqB,mBAAqBlqB,MAAMoqB,YAAYlqB,KAAKgqB,oBACjDhqB,KAAKmqB,gBAAkBrqB,MAAMoqB,YAAYlqB,KAAKmqB,iBAE1CnqB,KAAKoqB,SAAWpqB,KAAKoqB,QAAQvnB,OAChC,IAAK,IAAID,EAAI,EAAGA,EAAI5C,KAAKoqB,QAAQvnB,OAAQD,IAAK,CAC7C,IAAMqY,EAAIjb,KAAKoqB,QAAQxnB,GACnBqY,EAAEoP,YAAWpP,EAAEoP,UAAYC,cAAcrP,EAAEoP,cASlD3D,qBAAA,SAAS6D,GACR,OAAOvqB,KAAKunB,MAAM7I,MAAMuF,cACvB,iBAAgBsG,EAAO,YAAc,WAOvC7D,yBAAA,WAAA,WACC1mB,KAAKmqB,gBAAkBrqB,MAAM6O,MAAM3O,KAAKwnB,KAAK9I,MAAO,UAAU,SAAAoG,GAC7D,IAAMwC,EAAOxC,EAAG5d,OACV2H,EAAMwK,KAAKC,MAAMgO,EAAKkD,WACtBnL,EAAOhG,KAAKC,MAAMgO,EAAKmD,YAEvBC,EAAQrkB,EAAKskB,WACbJ,EAAOlkB,EAAKskB,UAAS,GACrBC,EAAQ,CACbC,QAAYxL,MAAQxQ,MAAOyY,EAAKwD,gBAAexD,EAAKyD,aACpDtO,MAAO6K,EAAKwD,YACZpO,OAAQ4K,EAAKyD,cAGd,IAAK,IAAI3oB,KAAOwoB,EACfF,EAAM9B,aAAaxmB,EAAKwoB,EAAMxoB,IAC9BmoB,EAAK3B,aAAaxmB,EAAKwoB,EAAMxoB,IAG9BiE,EAAK2kB,kBAAkB5L,MAAM1C,OAAS4K,EAAKyD,aAAe,KAEtD1kB,EAAK4kB,sBACR5kB,EAAK4kB,oBAAoB7L,MAAM1C,OAAS4K,EAAKyD,aAAe,MAC7D1kB,EAAK1E,UAAU+c,MAAMU,MAAM8L,mBAAqB,IAAI7L,SAAWxQ,OAC/DxI,EAAKwc,MAAMmE,OAAO,CAAEnY,MAAKwQ,YAG1Brf,KAAK8mB,GAAG9mB,KAAK6iB,MAAMsI,SAAU,OAAO,SAAAjQ,GACnC7U,EAAKmhB,KAAK5H,SAASvZ,EAAKwc,MAAMxD,KAAMnE,OAQtCwL,4BAAA,SAAgB/J,GAAhB,WACC3c,KAAKorB,QAAUtrB,MAAMoP,KAAK+W,OAAO,MAAO,CACvCoF,MAAO,4BACPjM,MAAO,UAAUzC,EAAOkB,uBAAsBlB,EAAOF,aAEtDzc,KAAKwnB,KAAK9I,MAAM4M,aAAatrB,KAAKorB,QAASprB,KAAKwnB,KAAK9I,MAAM6M,YAE3DvrB,KAAK8mB,GAAG9mB,KAAK6iB,MAAMsI,SAAU,YAAY,WAAM,OAAA9kB,EAAKkiB,mBAMrD7B,yBAAA,WACC,IAAM5lB,EAAKd,KAAK6iB,MAAMoE,SAChBpY,EAAM/N,EACTd,KAAKwnB,KAAKgE,aAAa1qB,GAAMd,KAAK4hB,MAAMc,YAAY7E,YACnD,IACJ7d,KAAKorB,QAAQhM,MAAMvQ,IAAMA,EAAM,MAMhC6X,wBAAA,WAAA,WACO+E,EAAWzrB,KAAKoqB,QAAUpqB,KAAKY,IAAIb,OAAO0rB,QAC5CA,GAAWA,EAAQ5oB,SACtB7C,KAAKirB,oBAAsBnrB,MAAMoP,KAAK+W,OAAO,MAAO,CACnDoF,MAAO,sBACPjM,MAAO,UAAUpf,KAAKwnB,KAAK9I,MAAMqM,oBAElC/qB,KAAKwnB,KAAK9I,MAAM4M,aACftrB,KAAKirB,oBACLjrB,KAAKwnB,KAAK9I,MAAM6M,YAGjBvrB,KAAK0rB,cAAcD,GACnBzrB,KAAK8mB,GAAG9mB,KAAKY,IAAK,kBAAkB,WACnC,OAAAyF,EAAKqlB,cAAcrlB,EAAK+jB,cAS3B1D,0BAAA,SAAc+E,GAEb,IAFD,WACOvc,EAAO,GACJtM,EAAI,EAAGA,EAAI6oB,EAAQ5oB,OAAQD,IAAK,CACxC,IAAMqY,EAAIwQ,EAAQ7oB,GACdqY,EAAE5L,MACL4L,EAAE6E,WAAa,IAAIzT,KACd4O,EAAEoP,YACNpP,EAAEoP,UAAYsB,aACb,SAAA9O,GACcxW,EAAK4kB,oBAAoBhH,cACrC,eAAepH,EAAKwN,gBAEhBjL,MAAMC,KAAOhZ,EAAKulB,kBAAkB,IAAIvf,MAAU,OAExD,IACA4O,KAGH/L,EAAK/M,KAAKnC,KAAK6rB,eAAeJ,EAAQ7oB,KAEvC5C,KAAKirB,oBAAoBzc,UAAYU,EAAKvK,KAAK,KAQhD+hB,2BAAA,SAAe7kB,GACd,IAAM0M,EAAO1M,EAAI0M,KACd,yCAAyC1M,EAAI0M,eAC7C,GAEH,MAAO,0BACO1M,EAAIwoB,iDACWxoB,EAAI+b,KAAO,4BACzB5d,KAAK4rB,kBAAkB/pB,EAAIie,mBAAkBvR,YAQ7DmY,8BAAA,SAAkB9M,GACX,IAAAwN,EAA2CpnB,KAAK4hB,MAAMc,YAApDtX,UAAO2H,QAAK4K,cAAW5D,SACzB+R,EAASnQ,aAAsBvQ,GAErC,OAAOwO,EAAOxO,GAASwO,EAAO7G,GAC1B,IACDsG,KAAKC,MAAMS,EAAKH,EAAMkS,GAAQ,GAAQnO,IAS1C+I,0BAAA,SAAcgE,EAAO9M,GACpB,IAAM0J,EAAOtnB,KAAKwnB,KAAK9I,MAEvB,MAAO,sBACGd,uBACE5d,KAAK6iB,MAAMxD,SAAQrf,KAAK6iB,MAAMhU,QAAOyY,EAAKwD,gBAAexD,EAAKyD,gCAChEzD,EAAKwD,gCACJxD,EAAKyD,wBACbL,YAOJhE,yBAAA,SAAamB,GACZ,IAAM6C,EAAQ,GAEd7C,EAAMkE,MAAMC,MAAK,SAAAlrB,GAChB,IAAM2W,EAAOoQ,EAAMrE,QAAQ1iB,GACvB2W,EAAKkJ,IACR+J,EAAMvoB,KAAK,sBAAsBrB,eAAe2W,EAAKkJ,cAGvD,IAAMzR,EACLlP,KAAKisB,cAAcvB,EAAM/lB,KAAK,IAAK,qBACnC3E,KAAKisB,cAAc,yBAA0B,yBAC9CjsB,KAAKunB,MAAM2E,QAAQhd,IAOpBwX,6BAAA,SAAiByF,GAAjB,WACCnsB,KAAK8nB,UAAUsE,MAAK,SAAArhB,GAAK,OAAAA,EAAE2M,QAAUyU,GAAOphB,EAAE7D,QAAUilB,KAAK1Z,SAC5D,SAAA5Q,GACC,IAAM8hB,EAAItd,EAAKkhB,MAAM7I,MAAMuF,cAAc,aAAapiB,EAAIf,SAC1D,GAAI6iB,EAAG,CACN,IAAMe,EAAIre,EAAKshB,UAAUnE,QAAQ3hB,EAAI6V,QAC/BhO,EAAIrD,EAAKshB,UAAUnE,QAAQ3hB,EAAIqF,QACrCiZ,GAAWte,EAAK6iB,EAAGhb,EAAGrD,EAAKub,MAAMyK,aACjC1I,EAAEiF,aAAa,SAAU/mB,EAAI8e,SAUjC+F,mBAAA,SAAOjK,GACN,IAAM6P,EAAOtsB,KAAKwnB,KAAK9I,MAAMuF,cAAc,sBAC3CqI,EAAKlN,MAAM3C,MAAQA,EAAQ,KAC3B6P,EAAKlN,MAAMmN,UAAY,MAEnBvsB,KAAKorB,UAASprB,KAAKorB,QAAQhM,MAAM3C,MAAQA,EAAQ,OAQtDiK,mBAAA,SAAO7kB,GACN,IAAM2qB,EAAMxsB,KAAKY,IAAIihB,WAAW,cAK5B4K,EAAa,KAEjB,GAAmB,qBAAf5qB,EAAIyiB,OACHziB,EAAIgjB,KACP4H,EAAaD,EAAIE,eAAe7qB,EAAIf,GAAIe,EAAI8d,KAAM9d,EAAIgjB,OAEtD7kB,KAAK4hB,MAAM+K,aAAa9qB,EAAIf,IAC5Bd,KAAK4sB,iBAAiB/qB,EAAIf,UAErB,GAAmB,yBAAfe,EAAIyiB,OACd,GAAKxkB,MAAM0mB,YAAY3kB,EAAIukB,UAEpB,CACN,IAAMoD,EAAOxpB,KAAK2nB,UAAUnE,QAAQ3hB,EAAIf,IACxCd,KAAKwnB,KAAKzgB,OAAOlF,EAAIf,GAAI0oB,EAAM,cAH/BiD,EAAaD,EAAIK,WAAWhrB,EAAIf,GAAI,CAAEslB,SAAUvkB,EAAIukB,gBAK/C,GAAmB,cAAfvkB,EAAIyiB,OAAwB,EAChCkF,EAAOxpB,KAAK2nB,UAAUnE,QAAQ3hB,EAAIf,KACnCggB,GAAK4C,SAAS7hB,EAAIwd,MACvBmK,EAAKzI,GAAK2C,SAAS7hB,EAAI4a,OACvBzc,KAAK4sB,iBAAiB/qB,EAAIf,SACpB,GAAmB,aAAfe,EAAIyiB,OAAuB,CAC7B,IAAA5M,EAAyB7V,SAAjBqF,EAAiBrF,SAAT4M,EAAS5M,OACjC4qB,EAAaD,EAAIM,QAAQ,CAAEpV,SAAQxQ,SAAQuH,cACrC,GAAmB,cAAf5M,EAAIyiB,OAAwB,CAC9B,IAAAlZ,EAAevJ,QAARkR,EAAQlR,MACjB4V,EAAOzX,KAAK2qB,UAAS,GAAMY,WAEjC,GAAKngB,EAEE,CACA,IAAAgc,WFpUc7I,EAAKnT,EAAO2H,GACnC,GAAI3H,GAAS2H,EAAK,CACjB,IAAM0J,EAAQ1J,EAAIH,EAAIxH,EAAMwH,EACtB8J,EAAS3J,EAAImI,EAAI9P,EAAM8P,EACvBmE,GAAQ5C,EAAQ,EAAIrR,EAAMwH,EAAIG,EAAIH,GAAK2L,EAAIc,KAC3C0N,GAAOrQ,EAAS,EAAItR,EAAM8P,EAAInI,EAAImI,GAAKqD,EAAI1P,IAC3CsT,GAAO1F,EAAQ,EAAI,GAAKA,QAASC,EAAS,EAAI,GAAKA,QACxDD,EAAQ,EAAIA,EAAQ,QACjBC,EAAS,EAAIA,EAAS,GAC1B,MAAO,CAAED,MAAOpD,KAAKmB,IAAIiC,GAAQC,OAAQrD,KAAKmB,IAAIkC,GAAS2C,OAAMxQ,MAAKsT,KAEtE,OAAO,KEyToB6K,CACxBhtB,KAAKunB,MAAM7I,MAAMwD,wBACjB9W,EACA2H,GAHOsM,SAAM0N,QAAK5K,MAKb8K,EAAQ,CAAC5N,EAAM0N,GACfG,EAAS/K,EACbze,MAAM,KACNkZ,KAAI,SAAC7R,EAAGnI,GAAM,OAAI,EAAJmI,EAAQkiB,EAAMrqB,EAAI,MAChC+B,KAAK,KAEP8S,EAAKmR,aAAa,SAAUsE,QAb5BzV,EAAKmR,aAAa,SAAU,IAiB9B,OAAI6D,GACHzsB,KAAKY,IAAIoF,UAAU,oBAAqB,CAACymB,IAClCA,GAED3sB,MAAM4Q,QAAQ3K,WAOtB2gB,2BAAA,SAAe/J,GAAf,WACC3c,KAAKgrB,kBAAoBlrB,MAAMoP,KAAK+W,OAAO,MAAO,CACjDoF,MAAO,2BACPjM,MAAO,UAAUpf,KAAKwnB,KAAK9I,MAAMqM,qBAElC/qB,KAAKwnB,KAAK9I,MAAM4M,aACftrB,KAAKgrB,kBACLhrB,KAAKwnB,KAAK9I,MAAM6M,YAEjBvrB,KAAKmtB,eAAexQ,GAEpB3c,KAAK8mB,GAAG9mB,KAAKY,IAAK,kBAAkB,SAAA+b,GAAU,OAAAtW,EAAK8mB,eAAexQ,OAOnE+J,2BAAA,SAAe/J,GACd,GAAuB,QAAnBA,EAAOjB,SAAwC,SAAnBiB,EAAOjB,QAAoB,CAC1D,IAAIxM,EAAO,GACP0K,EAAO9Z,MAAMuM,KAAKC,KAAKqQ,EAAOvR,OAE9B2H,EAAMjT,MAAMuM,KAAK+gB,SAASzQ,EAAO5J,KAC/B4J,EAAO5J,IAAMA,IAClBA,EAAMjT,MAAMuM,KAAK8O,IAAIpI,GAAM,EAAG,OAAO,IAKtC,IAFA,IAAIsa,EAAa1Q,EAAOvR,MAAMqO,WAEvBG,GAAQ7G,GACV/S,KAAK4hB,MAAM0L,UAAU1T,KACxB1K,GAAQlP,KAAKutB,gBAAgB5Q,EAAQ/C,EAAMyT,IAE5CzT,EAAO9Z,MAAMuM,KAAK8O,IAAIrb,MAAMuM,KAAK+gB,SAASxT,GAAO,EAAG,OAAO,GAC3DyT,EAAavtB,MAAMuM,KAAKiQ,MAAM1C,EAAM7G,GACjC,GAAKsG,KAAKkB,KAAKza,MAAMuM,KAAKmhB,SAAS7Q,EAAO5J,KAAO,GAAK,IACtD,EAGJ/S,KAAKgrB,kBAAkBxc,UAAYU,IAWrCwX,4BAAA,SAAgB/J,EAAQ/C,EAAMyT,GAC7B,IAAMvB,EAASnQ,GAAagB,EAAOjB,QAASiB,EAAOvR,OAInD,MAAO,gDAHGiO,KAAKC,MAAMqD,EAAO5C,KAAKH,EAAMkS,GAAUnP,EAAOgB,yBAEnC,SAAnBhB,EAAOjB,QAAqB,GAAK2R,EAAa,GAAK1Q,EAAOgB,yBAU7D+I,uBAAA,SAAW7kB,EAAK2U,GACf,IAAMiX,EAAS3tB,MAAMsX,KAAKsW,kBACtBC,GAAS9rB,EAAI0M,MAAQiI,EAAE,kCACpBA,EAAE,mBAAkBiX,EAAO5rB,EAAIie,YAMtC,MAJgB,aAAZje,EAAI4M,OACPkf,GAAO,OAAOnX,EAAE,iBAAgBiX,EAAO5rB,EAAIke,yBACrCvJ,EAAE,aAAY3U,EAAIme,cAAYne,EAAIme,SAAW,EAAIxJ,EAAE,QAAUA,EAAE,SAE/DmX,MAngB6BjnB,kBCHtC,4DAuDA,OAvDwCD,OACvCmnB,mBAAA,WACC,MAAO,CAAEvsB,KAAM,WAAYqb,OAAQ,GAAIkB,IAAK,sBAG7CgQ,iBAAA,WAAA,WACOvsB,EAAOrB,KAAK2B,UACZksB,EAAQ7tB,KAAKuB,SAAS,SAAS,GAErCvB,KAAK8mB,GAAG+G,EAAM1C,SAAU,QAAQ,SAAAvY,GAAK,OAAAvR,EAAKue,SAAShN,EAAG,SAEtD5S,KAAK4hB,MAAQ5hB,KAAKY,IAAIihB,WAAW,SACjC,IAAMlF,EAAS3c,KAAK4hB,MAAMc,YAC1B1iB,KAAK8tB,aAAanR,GAElB3c,KAAK8mB,GAAG9mB,KAAKY,IAAK,kBAAkB,SAAA+b,GAAU,OAAAtW,EAAKynB,aAAanR,OAOjEiR,yBAAA,SAAalJ,GAAb,WACOrjB,EAAOrB,KAAK2B,UACZuN,EAAOwV,EAAEtH,KACbR,KAAI,SAAAS,GACJ,IAAM0Q,GACU,SAAd1Q,EAAK5O,MAAiC,QAAd4O,EAAK5O,OAAiC,IAAd4O,EAAKE,KACvD,MACC,qDAAoDF,EAAKX,mBAAkBgI,EAAEjI,aAC7EY,EAAKC,MACHV,KAAI,SAAAoR,GAAQ,OAAA3nB,EAAK4nB,aAAaD,EAAMD,MACpCppB,KAAK,IACP,YAGDA,KAAK,IAEPtD,EAAKtB,OAAO2c,OAASgI,EAAEhI,OACvBrb,EAAK6qB,QAAQhd,GACb7N,EAAKyP,UASN8c,yBAAA,SAAaI,EAAMD,GAClB,MAAO,sCAAsCC,EAAKpQ,KAChDmQ,GAAmB/tB,KAAK4hB,MAAM0L,UAAUU,EAAKpU,MAC3C,4BACA,sBAAqBoU,EAAKvR,cAAauR,EAAKrU,OAAOqU,EAAKpU,mBArDtBlT,kBCGxC,4DAUA,OAVuCD,OACtCynB,mBAAA,WACC,MAAO,CAAE9Q,KAAM,CAAC+Q,GAAWzH,MAE5BwH,iBAAA,WAAA,WACCluB,KAAK8mB,GAAG9mB,KAAKY,IAAK,eAAe,SAAAwtB,GAC5BA,EAAG/nB,EAAK1E,UAAUR,OACjBkF,EAAK1E,UAAU0sB,cAPgB3nB,kBCHvC,4DA2IA,OA3IuCD,OACtC6nB,mBAAA,WAAA,WACO9X,EAAIxW,KAAKY,IAAIihB,WAAW,UAAUrL,EAwFxC,MAAO,CACN4G,KAAM,CAvFQ,CAAE7N,SAAUiH,EAAE,iBAAkB/H,KAAM,WAEvC,CACbpN,KAAM,YACNuc,IAAK,yCACL2Q,QAAQ,EACR5H,YAAY,EACZ7kB,QAAS,QACT0sB,YAAY,EACZC,UAAU,EACVjP,QAAQ,EACRkP,OAAQ,CACPC,OAAQ,CACPC,GAAI,UAGNC,QAAS,CACR,CACC/tB,GAAI,OACJ8c,IAAK,oBACL2Q,OAAQ/X,EAAE,QACVsY,WAAW,EACXvf,SAAU,SAAS1N,GAClB,OAAIA,EAAI8sB,OACA,8BAA8BnY,EACvB,UAAb3U,EAAIktB,MAAoBvY,EAAE,cAAgBA,EAAE,2BAElC3U,EAAI0M,MAAQiI,EAAE,gBAG5B,CACC1V,GAAI,OACJ8c,IAAK,mBACL2Q,OAAQ/X,EAAE,QACViG,MAAO,IACPlN,SAAU,SAAS1N,EAAKmtB,EAAGZ,EAAGa,GAC7B,OAAIptB,EAAI8sB,OAAe,GAETM,EAAKC,WAAW1L,QAAQ4K,GAAGrtB,wDAI1CouB,OAAQ,aACRna,QAAS,CACR,CAAElU,GAAI,IAAKC,MAAOyV,EAAE,iBACpB,CAAE1V,GAAI,IAAKC,MAAOyV,EAAE,mBACpB,CAAE1V,GAAI,IAAKC,MAAOyV,EAAE,eACpB,CAAE1V,GAAI,IAAKC,MAAOyV,EAAE,mBAGtB,CACCiG,MAAO,GACPmB,IAAK,qBACLrO,SAAU,SAAS1N,GAClB,OAAOA,EAAI8sB,OACR,GACA,gDAIN7H,GAAI,CACHsI,kBAAmB,SAAStuB,GAC3B,OAAQd,KAAKwjB,QAAQ1iB,GAAI6tB,QAE1BU,iBAAkB,SAACjB,EAAGe,GACrB,GAAIf,EAAErtB,OAASqtB,EAAE/oB,IAEhB,OADAgB,EAAKipB,WAAWH,EAAOI,IAAK,CAAE9gB,KAAgB,EAAV2f,EAAErtB,SAC/B,GAGTyuB,YAAa,WACZxvB,KAAKyvB,YAGPC,QAAS,CACRC,YAAa,SAACjmB,EAAG5I,GAChBhB,MACEgG,QAAQ,CACR8pB,MAAOpZ,EAAE,eACTjI,KAAMiI,EAAE,yDAERpQ,MAAK,WAAM,OAAAC,EAAKwpB,WAAW/uB,YAUjCwtB,iBAAA,WAAA,WACCtuB,KAAK6iB,MAAQ7iB,KAAKuB,SAAS,SAAS,GACpCvB,KAAK8vB,IAAM9vB,KAAKY,IAAIihB,WAAW,cAC/B7hB,KAAKunB,MAAQvnB,KAAK+I,GAAG,SAErB/I,KAAK8mB,GAAG9mB,KAAK6iB,MAAMsI,SAAU,YAAY,SAAArqB,GACpCA,GAAIuF,EAAK0pB,SAASjvB,OAIxBwtB,qBAAA,SAASxtB,GACR,IAAM2mB,EAAQznB,KAAKY,IAAIihB,WAAW,SAC5BmO,EAAUvI,EACdwI,SAASnvB,EAAI,UACb0E,OAAOiiB,EAAMwI,SAASnvB,EAAI,WAE5Bd,KAAKunB,MAAM2I,WACPF,EAAQntB,QACX7C,KAAKunB,MAAMhkB,MAAMysB,GACjBhwB,KAAKunB,MAAMpmB,QAEXnB,KAAK2B,UAAU0sB,QAIjBC,uBAAA,SAAWxtB,EAAIe,GAAf,WACO4qB,EAAazsB,KAAK8vB,IAAI3P,WAAWrf,EAAIe,GAC3C7B,KAAKY,IAAIoF,UAAU,oBAAqB,CAACymB,IACzCA,EAAWrmB,MAAK,WACfC,EAAKkhB,MAAM4I,aACX9pB,EAAKkhB,MAAM6I,aACX/pB,EAAKkhB,MAAM8I,eAEXhqB,EAAKkhB,MAAM+I,WAAWxvB,EAAIe,OAI5BysB,uBAAA,SAAWxtB,GAAX,WACO2rB,EAAazsB,KAAK8vB,IAAIS,WAAWzvB,GACvCd,KAAKY,IAAIoF,UAAU,oBAAqB,CAACymB,IACzCA,EAAWrmB,MAAK,WACfC,EAAK0pB,SAAS1pB,EAAKwc,MAAMoE,iBAxIWvgB,kBCEvC,4DA2MA,OA3MsCD,OACrC+pB,mBAAA,WAAA,WACCxwB,KAAKywB,QAAUzwB,KAAKuB,SAAS,WAAW,GACxC,IAAMiV,EAAIxW,KAAKY,IAAIihB,WAAW,UAAUrL,EAElCka,EAAQ5wB,MAAMqpB,KAAKwH,QAkFzB,MAAO,CACNtvB,KAAM,QACNoH,KAAM,CACLmoB,OAAQ,EACRC,QAAS,CAAEC,OAAQ,IACnB1T,KAAM,CAtFI,CACX/b,KAAM,UACNuc,IAAK,eACL+I,YAAY,EACZkK,QAAS,CACRxR,KAAMqR,EAAMK,cAAcC,MAAQN,EAAMO,YAAc,IAAM,EAC5DC,MAAOR,EAAMK,cAAcC,MAE5BG,SAAU,CACT,CACC9vB,KAAM,OACN+vB,KAAM,YACNC,MAAO,WAAM,OAAAhrB,EAAKirB,UAEnB,GACA,CACCjwB,KAAM,SACNob,MAAO,IACPmB,IAAK,gBACL7c,MAAOyV,EAAE,QACT6a,MAAO,WAAM,OAAAhrB,EAAKkrB,WAKR,CACZlwB,KAAM,OACNS,QAAS,OACT6kB,YAAY,EACZ6H,YAAY,EACZhP,QAAQ,EACRgS,eAAgB,CACfC,cAAe,OAEhBN,SAAU,CACT,CAAE9vB,KAAM,OAAQW,KAAM,OAAQ0vB,MAAOlb,EAAE,UACvC,CACCnV,KAAM,aACNW,KAAM,OACN0vB,MAAOlb,EAAE,QACTxB,QAAS,CACR,CAAElU,GAAI,OAAQC,MAAOyV,EAAE,SACvB,CAAE1V,GAAI,UAAWC,MAAOyV,EAAE,YAC1B,CAAE1V,GAAI,YAAaC,MAAOyV,EAAE,eAE7BsQ,GAAI,CACH6K,SAAU,SAAAvD,GAAK,OAAA/nB,EAAKurB,eAAexD,MAGrC,CAAE/sB,KAAM,aAAcW,KAAM,aAAc0vB,MAAOlb,EAAE,eACnD,CAAEnV,KAAM,aAAcW,KAAM,WAAY0vB,MAAOlb,EAAE,aACjD,CACCnV,KAAM,UACNW,KAAM,WACN4b,IAAK,2BACLgI,IAAK,EACLC,IAAK,IACL6L,MAAOlb,EAAE,aAEV,CACCnV,KAAM,SACNW,KAAM,WACN4tB,MAAO9vB,MAAMyP,SAAS,YACtBmiB,MAAOlb,EAAE,aAEV8X,GACA,CACCjtB,KAAM,WACNW,KAAM,UACN0vB,MAAOlb,EAAE,SACTkG,OAAQ,MAGVoK,GAAI,CACH6K,SAAU,WACTtrB,EAAKwrB,iBACAxrB,EAAKoqB,SAASpqB,EAAKyrB,oBAe5BtB,iBAAA,WAAA,WACCxwB,KAAK6iB,MAAQ7iB,KAAKuB,SAAS,SAAS,GACpCvB,KAAK8vB,IAAM9vB,KAAKY,IAAIihB,WAAW,cAC/B7hB,KAAK+xB,MAAQ/xB,KAAKY,IAAIihB,WAAW,SAAS+F,QAC1C5nB,KAAKgyB,KAAOhyB,KAAK+I,GAAG,QAGpB/I,KAAK8mB,GAAG9mB,KAAK6iB,MAAMsI,SAAU,YAAY,SAAArqB,GACpCA,GACHuF,EAAK0pB,SAASjvB,MAKhBd,KAAK8mB,GAAG9mB,KAAK+xB,MAAM7jB,KAAM,kBAAkB,SAACpN,EAAIe,EAAK8d,GACxC,UAARA,GAAoB7e,GAAMuF,EAAKwc,MAAMoE,UACxC5gB,EAAK0pB,SAAS1pB,EAAKwc,MAAMoE,cAI5BuJ,qBAAA,SAAS1vB,GACR,IAAM+b,EAAO7c,KAAK+xB,MAAMvO,QAAQ1iB,GAChCd,KAAKgyB,KAAKC,UAAUpV,GACpB7c,KAAKgyB,KAAKE,SAGX1B,2BAAA,WACC,IAAM2B,EAAInyB,KAAKgyB,KAAKI,aAAaryB,OAAOiC,KAClCqwB,EAAOryB,KAAKgyB,KAAKM,YAEd,YAALH,GAAyB,cAALA,GAAkC,WAAbE,EAAK5jB,KACjD4jB,EAAKtS,SAAW,KACH,YAALoS,GAAwB,cAALA,IAAmBE,EAAKrS,SAAW,MAE/DH,GAAmBwS,GAEnBryB,KAAKgyB,KAAK7B,aACVnwB,KAAKgyB,KAAKC,UAAUI,GAAM,GAC1BryB,KAAKgyB,KAAK3B,gBAGXG,uBAAA,WAAA,WACO1vB,EAAKd,KAAK6iB,MAAMoE,SAChBoL,EAAOryB,KAAKgyB,KAAKM,YAUvB,OARAtyB,KAAKuyB,YACG,UAAPzxB,EACGd,KAAK8vB,IAAI0C,aAAaH,GACtBryB,KAAK8vB,IAAIjD,WAAW/rB,EAAIuxB,GAC5BryB,KAAKY,IAAIoF,UAAU,oBAAqB,CAAChG,KAAKuyB,cAE9CvyB,KAAKuyB,YAAYhO,SAAQ,WAAM,OAACle,EAAKksB,YAAc,QAE5CvyB,KAAKuyB,aAGb/B,2BAAA,SAAepC,GAQd,GAPApuB,KAAKgyB,KAAKb,SAASpR,SAAS5e,OAC5BnB,KAAKgyB,KAAKb,SAASnR,SAAS7e,OAC5BnB,KAAKgyB,KAAKb,SAAS/K,SAASjlB,OAC5BnB,KAAKgyB,KAAKb,SAASpR,SAAS0S,SAC5BzyB,KAAKgyB,KAAKb,SAASnR,SAASyS,SAC5BzyB,KAAKgyB,KAAKb,SAAS/K,SAASqM,SAEnB,WAALrE,GAAuB,aAALA,EAAkB,CACvC,IAAM9J,EAAc,WAAL8J,EAAiB,UAAY,OAC5CpuB,KAAKgyB,KAAKb,SAASpR,SAASuE,KAC5BtkB,KAAKgyB,KAAKb,SAASnR,SAASsE,KAC5BtkB,KAAKgyB,KAAKb,SAAS/K,SAAS9B,OAI9BkM,kBAAA,WAAA,WACC,GAAIxwB,KAAKywB,SAAWzwB,KAAKgyB,KAAKU,UAAW,CACxC,IAAMlc,EAAIxW,KAAKY,IAAIihB,WAAW,UAAUrL,EACxC1W,MACEgG,QAAQ,CACRyI,KAAMiI,EAAE,mBAERpQ,MAAK,WAAM,OAAAC,EAAKkrB,MAAK,MAAO,WAAM,OAAAlrB,EAAKssB,MAAK,WAE9C3yB,KAAK2yB,MAAK,IAIZnC,iBAAA,SAAKoC,GACJ,GAAIA,EACH5yB,KAAKY,IAAIoF,UAAU,iBACb,CACN,IAAMf,EAAOjF,KAAKywB,QAAU,cAAgB,MAC5CzwB,KAAKmB,KAAK8D,EAAO,YAAa,CAAEiC,OAAQ,WAI1CspB,iBAAA,SAAKoC,GAAL,WAE0B,UAAxB5yB,KAAK6iB,MAAMoE,UACVjnB,KAAKywB,SAAWzwB,KAAKgyB,KAAKU,UAEvB1yB,KAAKuyB,YACRvyB,KAAKuyB,YAAYnsB,MAAK,WACrBC,EAAKssB,KAAKC,MAEP5yB,KAAK8xB,aAAa1rB,MAAK,WAAM,OAAAC,EAAKssB,KAAKC,MACtC5yB,KAAK2yB,KAAKC,OAzMmBlsB,kBCFtC,4DA8JA,OA9JsCD,OACrCosB,mBAAA,WAAA,WACOrc,EAAIxW,KAAKY,IAAIihB,WAAW,UAAUrL,EAClCqX,EAAQ7tB,KAAKuB,SAAS,SAAS,GAE/BuxB,EAAa,CAClBzxB,KAAM,SACNob,MAAO,IACPiV,MAAOlb,EAAE,QACToH,IAAK,gBACLyT,MAAO,WAAM,OAAAhrB,EAAK0sB,aAGbrC,EAAQ5wB,MAAMqpB,KAAKwH,QACnBqC,EAAM,CACX3xB,KAAM,UACNuc,IAAK,eACL+I,YAAY,EACZkK,QAAS,CACRxR,KAAMqR,EAAMK,cAAcC,MAAQN,EAAMO,YAAc,IAAM,EAC5DC,MAAOR,EAAMK,cAAcC,MAE5BG,SAAU,CACT,CACC9vB,KAAM,OACN+vB,KAAM,YACNC,MAAO,WAAM,OAAAhrB,EAAKirB,UAEnB,GACCzD,EAAM/K,SAAwB,GAAbgQ,IAIdG,EAAO,CACZnxB,QAAS,OACTT,KAAM,WACNuc,IAAK,wBACLrO,SAAU,SAAA1N,GAAO,OAAAwE,EAAK6sB,aAAarxB,IACnC8kB,YAAY,GAGPwM,EAAe,CACpB9xB,KAAM,SACNqwB,MAAOlb,EAAE,eACToH,IAAK,kCACLwV,MAAO,SACPC,WAAY,IACZhC,MAAO,WACNvxB,MACEgG,QAAQ,CACR8pB,MAAOpZ,EAAE,eACTjI,KAAMiI,EAAE,yDAERpQ,MAAK,WAAM,OAAAC,EAAKitB,kBAIpB,MAAO,CACNjyB,KAAM,QACNoH,KAAM,CACLmoB,OAAQ,EACRxT,KAAM,CACL4V,EACA,CACCvkB,KAAM,OACNkY,YAAY,EACZvJ,KAAM,CAAC6V,EAAOpF,EAAM/K,SAA0B,GAAfqQ,QAOpCN,iBAAA,WAAA,WACC7yB,KAAK6iB,MAAQ7iB,KAAKuB,SAAS,SAAS,GACpCvB,KAAK4hB,MAAQ5hB,KAAKY,IAAIihB,WAAW,SACjC7hB,KAAK+xB,MAAQ/xB,KAAK4hB,MAAMgG,QACxB5nB,KAAKuzB,KAAOvzB,KAAK+I,GAAG,QAEpB/I,KAAK8mB,GAAG9mB,KAAK6iB,MAAMsI,SAAU,YAAY,SAAArqB,GACpCA,GAAIuF,EAAKmtB,aAAa1yB,MAE3Bd,KAAK8mB,GAAG9mB,KAAK+xB,MAAM7jB,KAAM,kBAAkB,SAACpN,EAAIe,EAAK8d,GACxC,UAARA,GAAoB7e,GAAMuF,EAAKwc,MAAMoE,UACxC5gB,EAAKmtB,aAAantB,EAAKwc,MAAMoE,cAKhC4L,yBAAA,SAAa/xB,GACZ,IAAM+b,EAAO/c,MAAMwM,KAAKtM,KAAK+xB,MAAMvO,QAAQ1iB,IAC3C+b,EAAK4W,QAAUzzB,KAAK4hB,MAAMqO,SAASnvB,EAAI,UACvC+b,EAAK6W,QAAU1zB,KAAK4hB,MAAMqO,SAASnvB,EAAI,UACvCd,KAAKuzB,KAAKtB,UAAUpV,IAGrBgW,qBAAA,WACC,IACM5tB,EADUjF,KAAKuB,SAAS,WAAW,GAClB,cAAgB,MACvCvB,KAAKmB,KAAK8D,EAAO,YAAa,CAAEiC,OAAQ,UAGzC2rB,uBAAA,WACC,IAAMpG,EAAazsB,KAAKY,IACtBihB,WAAW,cACX8R,WAAW3zB,KAAK6iB,MAAMoE,UACxBjnB,KAAKY,IAAIoF,UAAU,oBAAqB,CAACymB,IACzCzsB,KAAKsxB,SAGNuB,kBAAA,WACC7yB,KAAKY,IAAIoF,UAAU,cAGpB6sB,yBAAA,SAAahxB,GACZ,IAAKA,EAAIie,WAAY,MAAO,GAE5B,IAAMtJ,EAAIxW,KAAKY,IAAIihB,WAAW,UAAUrL,EAClCod,EAAQpd,EAAE,cAEZtH,EAAO,iDAC6BrN,EAAI0M,MAAQqlB,wDACtBpd,EAAE,0BAAyBxW,KAAK6zB,WAC7DhyB,EAAIie,mBAwBL,MArBiB,cAAbje,EAAI4M,OACPS,GAAQ,8BAA8BsH,EACrC,wBACYxW,KAAK6zB,WAAWhyB,EAAIke,oDACJvJ,EAAE,wBAAuB3U,EAAIme,mDAC7BxJ,EAAE,wBAAuB3U,EAAIukB,wBAGvDvkB,EAAI6xB,QAAQ7wB,SACfqM,GAAQlP,KAAK8zB,kBAAkBjyB,EAAI6xB,QAASld,EAAE,gBAAiBod,IAC5D/xB,EAAI4xB,QAAQ5wB,SACfqM,GAAQlP,KAAK8zB,kBAAkBjyB,EAAI4xB,QAASjd,EAAE,cAAeod,IAE1D/xB,EAAIkyB,UACP7kB,GAAQ,+CAA+CsH,EAAE,mEACf3U,EAAIkyB,QAAQzmB,QACpD,kBACA,kBAII4B,GAGR2jB,8BAAA,SAAkBmB,EAAKtC,EAAOkC,GAE7B,MAAO,kCAAkClC,iBAD/BsC,EAAIpX,KAAI,SAAA8H,GAAK,MAAA,QAAOA,EAAEnW,MAAQqlB,cAAcjvB,KAAK,KAI5DkuB,uBAAA,SAAWjZ,GACV,OAAO9Z,MAAMsX,KAAKsW,kBAAkB9T,OA5JAlT,kBCAtC,4DASA,OATuCD,OACtCwtB,mBAAA,WACC,MAAO,CACN5yB,KAAM,SACN6yB,YAAY,EACZC,MAAM,EACN1rB,KAAM,CAAEmD,UAAU,QANkBlF,kBCAvC,4DAmQA,OAnQsCD,OACrC2tB,mBAAA,WAAA,IAyQaxF,SAxQNf,EAAQ7tB,KAAKuB,SAAS,SACtBob,EAAS3c,KAAKY,IAAIihB,WAAW,SAASa,YACtClM,EAAIxW,KAAKY,IAAIihB,WAAW,UAAUrL,EAClC6d,EAAUr0B,KAAKuB,SAAS,WAAW,GAEnC+iB,EAAS,CACdxjB,GAAI,SACJ8c,IAAK,qBACL2Q,OAAQ,CACPhgB,KAAM,wBAAwBiI,EAC7B,8DAEDoH,IAAK,sBAENrO,SAAU,SAAA1N,GACT,MAAe,UAAXA,EAAIf,GAAuB,GACxB,wBAAwB0V,EAC9B,qDAGFiG,MAAO,GACP2F,SAAU,IAGPyM,EAAU,CACb,CACC/tB,GAAI,OACJ8c,IAAK,oBACL2Q,OAAQ/X,EAAE,SACVjH,SAAU,SAAC1N,EAAKyyB,GACf,OAAAA,EAAOC,UAAU1yB,EAAKyyB,IAAWzyB,EAAI0M,MAAQiI,EAAE,gBAChDsY,WAAW,EACXzhB,OAAQgnB,EACRG,MAAO,OACPzX,MAsOU6R,EAtOC,OAuOP,SAAC7jB,EAAGoO,GACV,OAAApO,EAAE6jB,GAAI6F,cAActb,EAAEyV,QAAK3W,EAAW,CACrCyc,mBAAmB,EACnBC,SAAS,MAzORvS,SAAU,KAEX,CACCthB,GAAI,aACJytB,OAAQ/X,EAAE,cACVmD,OAAQ7Z,MAAMsX,KAAKwd,cACnBvnB,OAAQgnB,EACRG,MAAO,OACPzX,KAAM,OACNqF,SAAU,MAIRiS,GACH/P,EAAOiK,OAAOhgB,KAAO,qCACjBsf,EAAM/K,WAAUwB,EAAO/U,SAAW,IACtCsf,EAAQgG,QAAQvQ,IACLuJ,EAAM/K,UAAU+L,EAAQ1sB,KAAKmiB,GAEzC,IAAMwQ,EAAO,CACZzzB,KAAM,YACNuc,IAAK,uCACLmX,WAAW,EACXtY,MAAO4X,EAAU,GAAK,IACtBW,UAAWrY,EAAOkB,WAClBoX,gBAAiBtY,EAAOD,OACxB8C,OAAQ,KACR0V,cAAc,EACdC,OAAQ,MACRpY,KAAM,QACNqY,aAAc,CACbC,YAAY,EACZC,KAAM,IAEPxL,KAAM,QACN+E,UACA3H,QAAS,WAAM,MAAA,IACfwI,QAAS,CACR6F,WAAY,SAACzQ,EAAIhkB,GAAO,OAAAuF,EAAKmvB,YAAY10B,EAAGyuB,MAC5CkG,kBAAmB,WAAM,OAAApvB,EAAKmvB,YAAY,MAC1CE,WAAY,WAAM,OAAArvB,EAAKsvB,kBAExB7O,GAAI,CACH8O,YAAa,SAAA90B,GACZuF,EAAKwvB,eACLxvB,EAAKypB,IAAIjD,WAAW/rB,EAAI,CAAEg1B,OAAQ,KAEnCC,aAAc,SAAAj1B,GACbuF,EAAKwvB,eACLxvB,EAAKypB,IAAIjD,WAAW/rB,EAAI,CAAEg1B,OAAQ,KAEnC/O,YAAa,SAAAjmB,GACZ+sB,EAAM7G,OAAO,CACZ5lB,OAAQ,KACR6lB,SAAUnmB,KAGZk1B,YAAa,SAACpH,EAAIqH,EAAKC,GAAO,OAAA7vB,EAAK8vB,UAAUvH,EAAIqH,EAAKC,IACtDE,eAAgB,SAACt1B,EAAIstB,EAAGiI,EAAGC,GAAS,OAAAjwB,EAAKkwB,iBAAiBz1B,EAAIw1B,IAC9DE,aAAc,SAAAzY,GACb,IAAI0O,EAAa,KAWjB,OATCA,EADiB,UAAd1O,EAAI3S,MACM/E,EAAKypB,IAAI0C,aACrBnsB,EAAK0rB,MAAMvO,QAAQzF,EAAI3S,OACvB2S,EAAI3c,QAAU,EACd2c,EAAIhZ,OAGQsB,EAAKypB,IAAI2G,SAAS1Y,EAAI3S,MAAO2S,EAAI3c,OAAQ2c,EAAIhZ,OAE3DsB,EAAKzF,IAAIoF,UAAU,oBAAqB,CAACymB,KAClC,KAKJhhB,EAAU,WACfoiB,EAAMhf,IAAM7O,KAAKyf,iBAAiBvE,GAMnC,OAJIpb,MAAMuiB,IAAIC,MACbwS,EAAKhO,GAAiB,aAAIgO,EAAKhO,GAAkB,cAAIrb,EAC/CqpB,EAAKhO,GAAc,UAAIrb,EAEvBqpB,GAGRV,iBAAA,SAAK/yB,GAAL,WACCrB,KAAK02B,KAAOr1B,EACZrB,KAAK+xB,MAAQ/xB,KAAKY,IAAIihB,WAAW,SAAS+F,QAC1C5nB,KAAK6iB,MAAQ7iB,KAAKuB,SAAS,SAAS,GACpCvB,KAAK8vB,IAAM9vB,KAAKY,IAAIihB,WAAW,cAE/B7hB,KAAK02B,KAAK3O,KAAK/nB,KAAK+xB,OACpB/xB,KAAK+xB,MAAM4E,SAASvwB,MAAK,WACxBC,EAAKwvB,eAEDxvB,EAAKwc,MAAM9F,OAEd1W,EAAKqwB,KAAKxoB,KAAKiiB,aACf9pB,EAAKqwB,KAAKE,SAAS,CAAE7Z,KAAM1W,EAAKwc,MAAM9F,OACtC1W,EAAKqwB,KAAKxoB,KAAKmiB,mBAIjBrwB,KAAK8mB,GAAG9mB,KAAK6iB,MAAMsI,SAAU,OAAO,SAAAjQ,GAAK,OAAA7U,EAAKqwB,KAAK9W,SAAS,KAAM1E,MAClElb,KAAK8mB,GAAG9mB,KAAK6iB,MAAMsI,SAAU,YAAY,SAACrqB,EAAI+1B,GACjC,UAARA,GAAiBxwB,EAAKywB,gBACtBh2B,EAAIuF,EAAKqwB,KAAKvB,OAAOr0B,GACpBuF,EAAKqwB,KAAKK,cAGhB/2B,KAAK8mB,GAAG9mB,KAAK+xB,MAAM7jB,KAAM,kBAAkB,SAACpN,EAAIe,EAAK8d,GACxC,OAARA,GAAwB,UAAP7e,GAAgBuF,EAAKywB,mBAI3C92B,KAAK8mB,GAAG9mB,KAAKY,IAAK,YAAY,WAAM,OAAAyF,EAAKmvB,YAAY,SAOtDpB,wBAAA,SAAY4C,GACX,GAAIh3B,KAAK6iB,MAAMzhB,SAAW41B,EAAK,CAC9B,IAAMzH,EAAMvvB,KAAK+xB,MAAMvO,QAAQwT,GACzB5rB,EAAQmkB,EACXA,EAAIzP,WACJ9f,KAAKY,IAAIihB,WAAW,SAASa,YAAYtX,MAE5CpL,KAAK82B,gBACL92B,KAAK6iB,MAAMoE,SAAW,KACtB,IAAMnmB,EAAKd,KAAK+xB,MAAM5W,IACrBnb,KAAKi3B,YAAY7rB,GACjBmkB,EAAM,GAAK,EACXA,EAAMyH,EAAM,GAETzH,GACHvvB,KAAK02B,KAAKQ,KAAKF,GAGhBh3B,KAAK6iB,MAAMmE,OAAO,CACjB5lB,OAAQ41B,EACR/P,SAAUnmB,IAGPd,KAAK02B,KAAKS,OAAOH,IAAMh3B,KAAK02B,KAAKU,SAASt2B,GAG/C,OAAO,GAORszB,wBAAA,SAAYhpB,GACX,MAAO,CACNtK,GAAI,QACJgf,WAAY,IAAIzT,KAAKjB,GACrB2U,SAAUjgB,MAAMuM,KAAK8O,IAAI/P,EAAO,EAAG,OAAO,GAC1Cgb,SAAU,EACV7X,KAAM,KAIR6lB,0BAAA,WACKp0B,KAAK+xB,MAAMoF,OAAO,UAAUn3B,KAAK+xB,MAAMvN,OAAO,UAGnD4P,yBAAA,WACCp0B,KAAK+xB,MAAM7jB,KAAKlI,UAAU,iBAAkB,KAQ7CouB,sBAAA,SAAUxF,EAAIqH,EAAKC,GAClB,IAAMmB,EAAav3B,MAAMgM,QAAQ8iB,GAAMA,EAAK,CAAEA,KAAIqH,MAAKC,MACjDoB,EAAYt3B,KAAK02B,KAAKa,WAAWxa,KAGvC/c,KAAK+xB,MAAMhV,KAAKsa,GAEhBr3B,KAAK6iB,MAAM9F,KAAOua,EAEU,UAAxBt3B,KAAK6iB,MAAMoE,UAAsBjnB,KAAKY,IAAIoF,UAAU,cAGzDouB,0BAAA,WACC,IAAMoD,EAAMx3B,KAAK02B,KAAKe,gBAAgB,QACtCz3B,KAAK02B,KAAKgB,gBAAgB,QAASF,GACnCx3B,KAAK02B,KAAK32B,OAAO0c,MAAQ+a,EAAM,GAAK,EACpCx3B,KAAK02B,KAAK5lB,SAEV9Q,KAAKY,IAAIoF,UAAU,cAAe,CAACwxB,KAOpCpD,6BAAA,SAAiBtzB,EAAIw1B,GACpB,GAAKA,EAAL,CACA,IAAMxB,EAAO90B,KAAK02B,KACZ7H,EAAUiG,EAAK/0B,OAAO8uB,QACtBjsB,EAAIkyB,EAAK6C,eAAe72B,GAE1B82B,EAAO/I,EAAQhsB,OAAS,EACH,WAArBgsB,EAAQ+I,GAAM92B,KAAiB82B,GAAQ,GAEjC,IAANh1B,GACHisB,EAAQ+I,GAAM9I,WAAY,EAC1BD,EAAQ+I,GAAMnb,MAAQ,GACZ7Z,IAAMg1B,IAChB/I,EAAQ,GAAGC,WAAY,EACvBD,EAAQ,GAAGpS,MAAQ,GAEpBqY,EAAK+C,sBAjQ+BnxB,GCFtC5G,MAAM2R,QACL,CACCzP,KAAM,WACN81B,qBAAYrb,EAAOhR,EAAS1K,GAC3Bf,KAAK+3B,cAAgBh3B,EACrBf,KAAKg4B,cAAgBvb,EACrBzc,KAAKi4B,gBAAkBxsB,EAEvBzL,KAAKk4B,cAAcl4B,KAAK0e,MAAMjC,MAAO1b,IAEtCm3B,uBAActlB,EAAG7R,GAChB,OAAIf,KAAKg4B,iBAENplB,GAAK5S,KAAKg4B,gBAAkBj3B,GAC5B6R,EAAI5S,KAAKg4B,eAAiBj3B,KAE3Bf,KAAKg4B,cAAgB,KACrBh4B,KAAKi4B,iBAAiBl3B,IACf,IAKVo3B,kBAASvlB,EAAGsI,GACX,GAAIlb,KAAKk4B,cAActlB,EAAG5S,KAAK+3B,eAC9B,OAAOj4B,MAAM6G,GAAG6K,OAAO7F,UAAUwsB,SAAS3lB,KAAKxS,KAAM4S,EAAGsI,KAG3Dpb,MAAM6G,GAAG6K,QCvBV,mBAAA,4DAyHA,OAzHqC/K,OACpC2xB,mBAAA,WAAA,WACCp4B,KAAKq4B,SAAWr4B,KAAKuB,SAAS,qBACD,IAAlBvB,KAAKq4B,UACfr4B,KAAKgH,SAAS,UAAWhH,KAAKq4B,UAC/Br4B,KAAKywB,QAAUzwB,KAAKuB,SAAS,WAC7BvB,KAAK6iB,MAAQ7iB,KAAKuB,SAAS,SAAS,GAEpC,IAAM+2B,EAAOt4B,KAAKywB,QACf,CAAE7kB,UAAU,EAAM5J,KAAM,OAAQU,OAAO,GACvC,CACArB,KAAM,QACNuc,IAAK,sBACL+I,YAAY,EACZlK,MAAO,IACPpP,QAAQ,EACRvL,QAAS,OACT2G,KAAM,CAAEmD,UAAU,EAAM5J,KAAM,SAG3Bu2B,EAAO,CACZnE,GACA,CACC/yB,KAAMrB,KAAKywB,QAAU,SAAW,UAChC7S,IAAK,sBACLnB,MAAO,GAERyR,GACAoK,GAgCD,MA7BW,CACVj3B,KAAM,YACNuc,IAAK,cACLN,MAAO,CACN,CACCjc,KAA0B,oBAAbg3B,SAA2B,WAAa,SACrDv2B,QAAS,OACT6kB,YAAY,EACZC,UAAU,EACVnY,KAAM,QACN8pB,KAAMA,GAEP,CACC3a,IAAK,wBACLvc,KAAM,OACN+vB,KAAM,WACNtvB,QAAS,MACTuL,QAASrN,KAAKywB,SAAWzwB,KAAK6iB,MAAMC,SACpCrG,MAAO,GACPC,OAAQ,GACRwU,MAAO,GACPJ,OAAQ,GACRO,MAAO,WACNhrB,EAAKzF,IAAIoF,UAAU,WAAY,SASpCoyB,iBAAA,SAAK/2B,GAAL,WACMrB,KAAKq4B,UACTr4B,KAAK+I,GAAG,QAAQ+uB,YACf93B,KAAKY,IAAIb,OAAOy4B,cAChB,SAAA7Y,GAAQ,OAAAtZ,EAAKoyB,eAAe9Y,OAC1B3f,KAAKywB,SAGTzwB,KAAK8mB,GAAG9mB,KAAK6iB,MAAMsI,SAAU,YAAY,SAACrqB,EAAI+1B,GACzC/1B,GAAY,SAANA,IAAkBuF,EAAKwc,MAAMzhB,OAAQiF,EAAKqyB,SAAS,QAC5C,UAAR7B,IAAiBxwB,EAAKwc,MAAMzhB,OAAS,SAE/CpB,KAAK8mB,GAAG9mB,KAAK6iB,MAAMsI,SAAU,UAAU,SAAArqB,GAClCA,GAAIuF,EAAKqyB,SAAS,WAEvB14B,KAAK8mB,GAAG9mB,KAAKY,IAAK,aAAa,WAC9ByF,EAAKwc,MAAMoE,SAAW,KACtB5gB,EAAKsyB,cAGN74B,MAAMQ,OAAOe,EAAMvB,MAAM84B,aACzB54B,KAAK8mB,GAAG9mB,KAAKY,IAAK,qBAAqB,SAAA+E,GAClCA,IACHtE,EAAKw3B,aAAa,CAAEpqB,KAAM,MAAOwP,MAAO,MACxCtY,EAAI4e,SAAQ,WACXljB,EAAKy3B,uBAMTV,qBAAA,SAASnzB,GACRA,EAAO,QAAQA,EACXjF,KAAKywB,QACRzwB,KAAKmB,KAAK,cAAc8D,EAAQ,CAC/BiC,OAAQ,UAGTlH,KAAK+I,GAAG,QAAQ5H,OAChBnB,KAAKmB,KAAK8D,EAAM,CACfiC,OAAQ,WAKXkxB,qBAAA,WAECp4B,KAAKmB,KAAK,SAAU,CAAE+F,OAAQ,SACzBlH,KAAKywB,SAASzwB,KAAK+I,GAAG,QAAQslB,QAGpC+J,2BAAA,SAAezY,GAAf,WAEC7f,MAAMme,OAAM,WACX5X,EAAKW,SAAS,UAAW2Y,GACzBtZ,EAAKgC,iBAtH6B3B,GCM/BwG,GAAQ,CAAExG,WAChBwG,GAAM,cAAgB6rB,GACtB7rB,GAAa,MAAI8rB,GACjB9rB,GAAM,eAAiB+rB,GACvB/rB,GAAM,aAAegsB,GACrBhsB,GAAM,aAAeisB,GACrBjsB,GAAM,cAAgBksB,GACtBlsB,GAAM,cAAgBmsB,GACtBnsB,GAAW,IAAIosB,GACfpsB,GAAY,KAAIqsB,qBCNf,WAAY34B,EAAKb,GAChBC,KAAKY,IAAMA,EAEX,IAAMoe,EAASlf,MAAMqpB,KAAKwH,QACpB6I,EAAaz5B,EAAOy5B,YAAc15B,MAAMuM,KAAK+gB,SAAS,IAAI/gB,MAC1DotB,EACL15B,EAAO05B,UAAY35B,MAAMuM,KAAK8O,IAAIqe,EAAY,EAAG,SAAS,GAE3Dx5B,KAAK05B,UACJF,EACAC,EACA15B,EAAO45B,gBACP55B,EAAO65B,gBAAkB,IACzB5a,EAAO6a,UAAiC,EAArB7a,EAAO8a,YAC1B/5B,EAAO4c,QAAU,CAAC,CAAErB,KAAM,MAAOiC,KAAM,EAAG5D,OAAQ,QAGnD3Z,KAAK+5B,eAAiBj6B,MAAMuM,KAAKyN,UAAUha,MAAMsX,KAAK4iB,aAoOxD,OAxNCpY,sBAAA,SAAU4X,EAAYC,EAAUje,EAASiB,EAAOC,EAAQC,GACnDF,GACHzc,KAAKi6B,WAAa,CAAExd,QAAOC,SAAQC,UACnC8c,EAAW35B,MAAMuM,KAAK8O,IAAIse,EAAU,EAAG,SAEvChd,EAAQzc,KAAKi6B,WAAWxd,MACxBC,EAAS1c,KAAKi6B,WAAWvd,OACzBC,EAAS3c,KAAKi6B,WAAWtd,QAG1B3c,KAAKk6B,QAAU1d,GACdgd,EACAC,EACAje,EACAiB,EACAC,EACAC,GAED3c,KAAKqsB,YAAcrsB,KAAKk6B,QAAQrc,WAAa,GAE7C7d,KAAKY,IAAIoF,UAAU,iBAAkB,CAAChG,KAAKk6B,WAM5CtY,sBAAA,WACC,OAAO5hB,KAAKk6B,SAObtY,wBAAA,SAAYxW,EAAO2H,GAClB,IAAM2R,EAAI1kB,KAAK0iB,YAGftX,EAAQwQ,GAAQ8I,EAAEhJ,QAAVE,CAAmBxQ,GAAQ,GACnC2H,EAAM6I,GAAQ8I,EAAEhJ,QAAVE,CAAmB7I,EAAK,IAEzB2R,GAAKA,EAAEtZ,MAAQA,GAAUsZ,EAAE3R,IAAMA,KACrC/S,KAAK05B,UACJhV,EAAEtZ,MAAQA,EAAQA,EAAQsZ,EAAEtZ,MAC5BsZ,EAAE3R,IAAMA,EAAMA,EAAM2R,EAAE3R,IACtB2R,EAAElJ,SAEHxb,KAAK2sB,iBAOP/K,kBAAA,WAAA,WACC,GAAI5hB,KAAKm6B,OAAQ,OAAOn6B,KAAKm6B,OAE7B,IAAMvS,EAAS5nB,KAAKm6B,OAAS,IAAIr6B,MAAMs6B,eAAe,CACrDtT,GAAI,CACHuT,oBAAqB,WACpB,IAAKh0B,EAAKzF,IAAIb,OAAOy5B,WAAY,CAChC,IAAIc,EAAMC,EAAAA,EACNC,GAAOD,EAAAA,EAKX,GAJA3S,EAAM1Z,KAAK8d,MAAK,SAAA/S,GACXA,EAAE6G,WAAawa,IAAKA,EAAMrhB,EAAE6G,YAC5B7G,EAAE8G,SAAWya,IAAKA,EAAMvhB,EAAE8G,aAEZ,iBAARua,EAAkB,CAC5B,IAAM5V,EAAIre,EAAKqc,YACfrc,EAAKqzB,UACJ9d,GAAQ8I,EAAEhJ,QAAVE,CAAmB0e,GAAM,GACzB1e,GAAQ8I,EAAEhJ,QAAVE,CAAmB4e,EAAK,GACxB9V,EAAElJ,YAKNif,uBAAwB,SAAC35B,EAAIe,EAAK8d,GACjC7e,EAAa,UAAR6e,EAAmB7e,EAAK,KAC7BuF,EAAKsmB,aAAa7rB,GAClBuF,EAAKq0B,iBAGPhM,OAAQ,CACPhd,MAAO,SAAA7P,GACNA,EAAIie,WAAahgB,MAAMsX,KAAKujB,gBAAgB94B,EAAIie,YAChDje,EAAIke,SAAWjgB,MAAMsX,KAAKujB,gBAAgB94B,EAAIke,UAC9CF,GAAmBhe,GACnBA,EAAI4M,KAAO5M,EAAI4M,MAAQ,OACvB5M,EAAIq1B,KAAOr1B,EAAIi0B,OAAsB,EAAbj0B,EAAIi0B,OAAa,GAE1C8E,MAAO,CACNhM,GAAI,WACJqH,IAAK,MACLC,GAAI,OAEL2E,WAAY,SAAA3sB,GAAQ,OAAA7H,EAAKy0B,QAAQ5sB,IACjC6sB,QAAS,SAAA7sB,GAAQ,OAAA7H,EAAKy0B,QAAQ5sB,OAUhC,OANA0Z,EAAMrkB,MACLvD,KAAKY,IACHihB,WAAW,WACX+F,QACAxhB,MAAK,SAAA8H,GAAQ,OAkHlB,SAAS8sB,EAAQ9sB,EAAMpN,GACtB,IAAMg0B,EAAO5mB,EAAK+sB,QAAO,SAAAlwB,GAAK,OAAAA,EAAE3J,QAAUN,KAM1C,OALAg0B,EAAKriB,SAAQ,SAAA1H,GACZ,IAAMwf,EAAOyQ,EAAQ9sB,EAAMnD,EAAEjK,IACzBypB,IAAMxf,EAAEmD,KAAOqc,MAGbuK,EAzHUkG,CAAQ9sB,EAAM,OAEvB0Z,GAGRhG,yBAAA,SAAasZ,EAAOt4B,GAApB,WAEMs4B,WdzJoB3kB,EAAG3T,EAAG+Z,EAAQwe,GAChC,IAAA/vB,EAA8DuR,QAAvD5J,EAAuD4J,MAAlDgB,EAAkDhB,YAAvCkB,EAAuClB,aAA3B5C,EAA2B4C,OAArBjB,EAAqBiB,UAAZnB,EAAYmB,UAEhEye,EAAY7kB,EAAEuJ,WAAa1U,EAAQA,EAAQmL,EAAEuJ,WAC7Cub,EAAU9kB,EAAEwJ,SAAWhN,EAAMA,EAAMwD,EAAEwJ,SACrC0J,EAAe,aAAVlT,EAAE9H,KAEPqd,EAASnQ,GAAaD,EAAStQ,GAErCmL,EAAEoT,GAAKwR,EACP5kB,EAAEuK,GACDzH,KAAKC,MAAMS,EAAKqhB,EAAWtP,EAAQtQ,GAAWmC,IAC7C8L,EAAKlT,EAAEoT,GAAK,EAAI,GAClBpT,EAAEwK,GAAK0I,EACJlT,EAAEoT,GACFtQ,KAAKC,MAAMS,EAAKshB,EAASD,EAAW5f,GAAS,GAAQmC,GACxDpH,EAAEyK,GAAKnD,EAAajb,GAAKib,EAAasd,GAAc,EcgJlDtO,CAFU7sB,KAAKm6B,OAAO3W,QAAQ0X,GAC9Bt4B,EAAK9C,MAAM0mB,YAAY5jB,GAAS5C,KAAKm6B,OAAO3O,aAAa0P,GAA7Bt4B,EACX5C,KAAKk6B,QAASl6B,KAAKqsB,aANpCrsB,KAAKm6B,OAAOjsB,KAAK6d,MAAMtZ,SAAQ,SAAC3R,EAAI8B,GACnCyD,EAAKsmB,aAAa7rB,EAAI8B,OAYzBgf,kBAAA,WAAA,WACC,GAAI5hB,KAAKs7B,OAAQ,OAAOt7B,KAAKs7B,OAE7B,IAAMxV,EAAS9lB,KAAKs7B,OAAS,IAAIx7B,MAAMoM,eAAe,CACrD4a,GAAI,CACH2T,uBAAwB,SAAA35B,GAAM,OAAAuF,EAAKq0B,aAAa55B,KAEjD4tB,OAAQ,CACPhd,MAAO,SAAA7P,GACNA,EAAI4M,KAAkB,EAAX5M,EAAI4M,SAMlB,OADAqX,EAAMviB,MAAMvD,KAAKY,IAAIihB,WAAW,WAAWiE,SACpCA,GAGRlE,yBAAA,WAAA,WACK5hB,KAAKs7B,QACRt7B,KAAKs7B,OAAOptB,KAAK8d,MAAK,SAAArI,GACrB,IAAMe,EAAIre,EAAK8zB,OAAO3W,QAAQG,EAAEjM,QAC1BhO,EAAIrD,EAAK8zB,OAAO3W,QAAQG,EAAEzc,QAC3Bwd,GAAMhb,GAAMrD,EAAKk1B,eAAe7W,IAAOre,EAAKk1B,eAAe7xB,GAE3DyW,GAAWwD,EAAGe,EAAGhb,EAAGrD,EAAKgmB,aAD7B1I,EAAEhD,GAAK,OAUXiB,qBAAA,SAAS9gB,EAAI2N,GAIZ,IAHA,IAAM+sB,EAAQx7B,KAAKs7B,OAAOlP,MAAK,SAAArhB,GAAK,OAAAA,EAAE0D,IAAS3N,KACzC6E,EAAM,GAEH/C,EAAI,EAAGA,EAAI44B,EAAM34B,OAAQD,IAAK,CACtC,IAAMmI,EAAIywB,EAAM54B,GACV2T,EAAIvW,KAAKm6B,OAAO3W,QAAQzY,EAAU,UAAR0D,EAAmB,SAAW,WAC1D8H,GACH5Q,EAAIxD,KAAK,CACRrB,GAAIiK,EAAEjK,GACN2N,KAAM1D,EAAE0D,KAAKhN,WACb8M,KAAMgI,EAAEhI,KACRwgB,MAAOtgB,IAGV,OAAO9I,GAQRic,sBAAA,SAAUhI,GACT,IAAMX,EAAIW,EAAKa,SACf,OAAa,IAANxB,GAAiB,IAANA,GAGnB2I,oBAAA,SAAQ1T,GACPA,EAAOpO,MAAMwM,KAAK4B,GAElB,IAAMyL,EAAS3Z,KAAK+5B,eAKpB,IAAK,IAAI0B,KAJLvtB,EAAK4R,aAAY5R,EAAK4R,WAAanG,EAAOzL,EAAK4R,aAC/C5R,EAAK6R,WAAU7R,EAAK6R,SAAWpG,EAAOzL,EAAK6R,WAGjC7R,EACU,IAAnButB,EAAE13B,QAAQ,aAAmBmK,EAAKutB,GAGvC,OAAOvtB,GAQR0T,2BAAA,SAAehP,GACd,KAAOA,EAAE8oB,SAER,KADA9oB,EAAI5S,KAAKm6B,OAAO3W,QAAQ5Q,EAAE8oB,UACnBxE,KAAM,OAAO,EAGrB,OAAO,QCjQT,kBAMC,WAAYt2B,EAAKI,GAChBhB,KAAKY,IAAMA,EACXZ,KAAK27B,KAAO36B,EA8Fd,OAvFC46B,gBAAA,SAAI32B,GACH,OAAOjF,KAAK27B,KAAO12B,GAMpB22B,kBAAA,WACC,OAAO97B,MAAM+7B,KAAK77B,KAAKgB,IAAI,UAAUoF,MAAK,SAAAT,GAAO,OAAAA,EAAIm2B,WAMtDF,kBAAA,WACC,OAAO97B,MAAM+7B,KAAK77B,KAAKgB,IAAI,UAAUoF,MAAK,SAAAT,GAAO,OAAAA,EAAIm2B,WAStDF,oBAAA,SAAQ/5B,EAAKk6B,EAAU36B,GACtB,OAAOtB,MACL+7B,OACAG,KAAKh8B,KAAKgB,IAAI,gBAAea,IAAKk6B,WAAU36B,YAC5CgF,MAAK,SAAAT,GAAO,OAAAA,EAAIm2B,WAOnBF,uBAAA,SAAW96B,GACV,OAAOhB,MACL+7B,OACAI,IAAIj8B,KAAKgB,IAAI,SAAWF,IACxBsF,MAAK,SAAAT,GAAO,OAAAA,EAAIm2B,WAQnBF,uBAAA,SAAW96B,EAAIe,GACd,OAAO/B,MACL+7B,OACA3kB,IAAIlX,KAAKgB,IAAI,SAAWF,GAAKe,GAC7BuE,MAAK,SAAAT,GAAO,OAAAA,EAAIm2B,WAOnBF,oBAAA,SAAQ/5B,GACP,OAAO/B,MACL+7B,OACAG,KAAKh8B,KAAKgB,IAAI,SAAUa,GACxBuE,MAAK,SAAAT,GAAO,OAAAA,EAAIm2B,WAQnBF,uBAAA,SAAW96B,EAAIe,GACd,OAAO/B,MACL+7B,OACA3kB,IAAIlX,KAAKgB,IAAI,SAAWF,GAAKe,GAC7BuE,MAAK,SAAAT,GAAO,OAAAA,EAAIm2B,WAOnBF,uBAAA,SAAW96B,GACV,OAAOhB,MACL+7B,OACAI,IAAIj8B,KAAKgB,IAAI,SAAWF,IACxBsF,MAAK,SAAAT,GAAO,OAAAA,EAAIm2B,8BCzFnB,WAAYI,GACXl8B,KAAKk8B,KAAOA,EACZl8B,KAAKm8B,OAASn8B,KAAKk8B,KAAKra,WAAW,SACnC7hB,KAAKo8B,MAAQp8B,KAAKk8B,KAAKra,WAAW,WAoTpC,OA3SCwa,oBAAA,SAAQx6B,EAAKkD,EAAO3D,GAApB,WACC,OAAOpB,KAAKo8B,MAAME,QAAQz6B,EAAKkD,EAAO3D,GAAQgF,MAAK,SAAAm2B,GAiBlD,OAhBAl2B,EAAK81B,OAAOK,YAAY36B,EAAIie,WAAYje,EAAIke,UAE9B1Z,EAAK81B,OAAOvU,QACpBzM,WACAtZ,IAAKf,GAAIy7B,EAAMz7B,GAAIM,SAAQ26B,SAAUh3B,IAC1CA,EACA3D,GAGGA,GACHiF,EAAKo2B,YAAYr7B,GAIlBiF,EAAKq2B,mBAAmBt7B,EAAQ,CAAEgK,MAAOrG,IAElCw3B,MAUTF,uBAAA,SAAWv7B,EAAIe,EAAK86B,GAApB,WACO/U,EAAQ5nB,KAAKm8B,OAAOvU,QACpB/K,EAAO/c,MAAMwM,KAAKsb,EAAMpE,QAAQ1iB,IAChCsJ,SAAYyS,GAAShb,GAG3B,OAFAge,GAAmBzV,GAER,UAAPtJ,EAAuBd,KAAKwyB,aAAapoB,GAExCuyB,GAAqB,WAAZ96B,EAAI4M,MAAkC,WAAboO,EAAKpO,KAGrCzO,KAAKo8B,MAAMvP,WAAW/rB,EAAIsJ,GAAMhE,MAAK,WAqB3C,OAnBKu2B,GAAOt2B,EAAK81B,OAAOK,YAAYpyB,EAAK0V,WAAY1V,EAAK2V,UAE1D6H,EAAM0I,WAAWxvB,EAAIsJ,GAEhBuyB,GAGF78B,MAAMuM,KAAKiQ,MAAMO,EAAKiD,WAAYje,EAAIke,WACtCjgB,MAAMuM,KAAKiQ,MAAMO,EAAKkD,SAAUle,EAAIke,YAGjClD,EAAK+f,QAAuB,WAAb/f,EAAKpO,KACvBpI,EAAKw2B,UAAU/7B,EAAI+b,EAAKiD,WAAYje,EAAIie,YAAY1Z,MAAK,WACxDC,EAAKo2B,YAAY5f,EAAKzb,WAEnBiF,EAAKo2B,YAAY5f,EAAKzb,SAItBgJ,KAvBApK,KAAKy8B,YAAY37B,EAAIsJ,IAgC9BiyB,sBAAA,SAAUv7B,EAAIuE,EAAKy3B,GAAnB,WACO/iB,EAAO+iB,EAASz3B,EACtB,GAAI0U,EAAM,CACT,IAAMgjB,EAAI,GAWV,OAVA/8B,KAAKm8B,OAAOvU,QAAQ1Z,KAAK8uB,YAAYl8B,GAAI,SAAAuB,GACxC,IAAM46B,SACF56B,IACHyd,WAAY,IAAIzT,KAAKhK,EAAIyd,WAAW9G,UAAYe,GAChDgG,SAAU,OAEXF,GAAmBod,GAEnBF,EAAE56B,KAAKkE,EAAKwmB,WAAWxqB,EAAIvB,GAAIm8B,GAAY,OAErCn9B,MAAM4Q,QAAQ1G,IAAI+yB,GAE1B,OAAOj9B,MAAM4Q,QAAQ3K,WAOtBs2B,wBAAA,SAAYv7B,EAAI+b,GAAhB,WACO+K,EAAQ5nB,KAAKm8B,OAAOvU,QAE1B,IAAK/K,EAEJ,IADAA,EAAO+K,EAAMpE,QAAQ1iB,GACd+b,GAAqB,WAAbA,EAAKpO,MACnB3N,EAAK8mB,EAAMsV,YAAYp8B,GACvB+b,EAAO+K,EAAMpE,QAAQ1iB,GAGvB,GAAI+b,GAAQA,EAAK+f,OAAQ,CACxB,IAAItC,EAAMC,EAAAA,EACTC,EAAM,EACN2C,EAAW,EACXC,EAAW,EACZvgB,EAAKmD,SAAW,KAEhB4H,EAAM1Z,KAAK8uB,YAAYl8B,GAAI,SAAAuB,GAC1Bi4B,EAAMj4B,EAAIyd,WAAawa,EAAMj4B,EAAIyd,WAAawa,EAC9CE,EAAMn4B,EAAI0d,SAAWya,EAAMn4B,EAAI0d,SAAWya,GACtCn4B,EAAI2d,UAA0B,WAAZ3d,EAAIoM,MAAqBpM,EAAIu6B,SAClDO,GAAY96B,EAAI2d,SAAW3d,EAAI+jB,SAC/BgX,GAA2B,EAAf/6B,EAAI2d,aAGblgB,MAAMuM,KAAKiQ,MAAMO,EAAKiD,WAAYwa,KAAMzd,EAAKiD,WAAawa,GAC1Dx6B,MAAMuM,KAAKiQ,MAAMO,EAAKkD,SAAUya,KAAM3d,EAAKkD,SAAWya,GAC3D3d,EAAKuJ,SAAW+W,EAAW9jB,KAAKC,MAAM6jB,EAAWC,GAAYD,EAE9D,GAAItgB,EACH,OAAO7c,KAAK6sB,WAAW/rB,EAAI+b,GAAM,GAAMzW,MAAK,WAE3C,OADAC,EAAKo2B,YAAY5f,EAAKzb,QACfyb,MAUVwf,2BAAA,SAAev7B,EAAI6e,EAAMkF,GACxB,IACM2E,EADQxpB,KAAKm8B,OAAOvU,QACPpE,QAAQ1iB,GAErBe,EAAM,GACN6iB,EAAI1kB,KAAKm8B,OAAOzZ,YAEhBpH,EAAOoJ,EAAElJ,QAAUT,EAAa2J,EAAEhJ,SAAS,GAAKgJ,EAAEhJ,QACxD,GAAa,UAATiE,GAA6B,SAATA,EAAiB,CACxC,IAAM0d,EAAa3Y,EAAElJ,QAClBgO,EAAK1J,WACLnE,GAAaL,EAAMkO,EAAK1J,YAC3Bje,EAAIie,WAAalE,GAAQN,EAARM,CAAcyhB,EAAYxY,GAC9B,UAATlF,GAAoB9d,EAAIie,WAAa0J,EAAKzJ,WAC7Cle,EAAIie,WAAalE,GAAQN,EAARM,CAAc4N,EAAKzJ,UAAW,IAEjD,GAAa,QAATJ,EAAgB,CACb0d,EAAa3Y,EAAElJ,QAClBgO,EAAKzJ,SACLpE,GAAaL,EAAMM,GAAQN,EAARM,CAAc4N,EAAKzJ,SAAU,IACnDle,EAAIke,SAAWnE,GAAQN,EAARM,CAAcyhB,EAAYxY,GACrChjB,EAAIke,SAAWyJ,EAAK1J,aACvBje,EAAIke,SAAWnE,GAAQN,EAARM,CAAc4N,EAAK1J,WAAY,IAMhD,GAHa,SAATH,EAAiB9d,EAAIke,SAAW,KAC/Ble,EAAIme,SAAW,EAET,UAAPlf,EAAgB,CACnB,IAAMw8B,SAAa9T,GAAS3nB,GAE5B,OADAge,GAAmByd,GACZt9B,KAAKwyB,aAAa8K,GAG1B,OAAOt9B,KAAK6sB,WAAW/rB,EAAIe,IAO5Bw6B,uBAAA,SAAWv7B,GAAX,WACO8mB,EAAQ5nB,KAAKm8B,OAAOvU,QACpB9B,EAAQ9lB,KAAKm8B,OAAOrW,QAM1B,OAHiBA,EAAMsG,MAAK,SAAArhB,GAAK,OAAAA,EAAE2M,QAAU5W,GAAMiK,EAAE7D,QAAUpG,KACtD2R,SAAQ,SAAA1H,GAAK,OAAA+a,EAAMtB,OAAOzZ,EAAEjK,OAE9Bd,KAAKo8B,MAAMzI,WAAW7yB,GAAIsF,MAAK,SAAAT,GACrC,IAAMvE,EAASwmB,EAAMpE,QAAQ1iB,GAAIM,OAGjC,OAFAwmB,EAAMpD,OAAO1jB,GACbuF,EAAKo2B,YAAYr7B,GACVuE,MAUT02B,yBAAA,SAAax6B,EAAKm1B,EAAKjyB,GACtB,IAAM8oB,EAAQ7tB,KAAKk8B,KAAK3E,YAEpBz3B,MAAM0mB,YAAYwQ,IAAQl3B,MAAM0mB,YAAYzhB,MAE/CA,EADc/E,KAAKm8B,OAAOvU,QACZ2V,eAAe1P,EAAM5G,UACnC+P,EAAuB,MAAjBnJ,EAAMzsB,OAAiB,EAAIysB,EAAMzsB,QAGxC,OAAOpB,KAAKs8B,QAAQz6B,EAAKkD,EAAOiyB,GAAK5wB,MAAK,SAAAT,GACzC,OAAQkoB,EAAM5G,SAAWthB,EAAI7E,OAQ/Bu7B,oBAAA,SAAQx6B,GAAR,WACC,OAAO7B,KAAKo8B,MAAMtP,QAAQjrB,GAAKuE,MAAK,SAAAm2B,GAGnC,OAFA16B,EAAIf,GAAKy7B,EAAMz7B,GACfuF,EAAK81B,OAAOrW,QAAQ3K,IAAItZ,GACjBA,MASTw6B,uBAAA,SAAWv7B,EAAIe,GAAf,WACC,OAAO7B,KAAKo8B,MAAMjc,WAAWrf,EAAIe,GAAKuE,MAAK,SAAAT,GAE1C,OADAU,EAAK81B,OAAOrW,QAAQwK,WAAWxvB,EAAIe,GAC5B8D,MAQT02B,uBAAA,SAAWv7B,GAAX,WACC,OAAOd,KAAKo8B,MAAM7L,WAAWzvB,GAAIsF,MAAK,SAAAT,GAErC,OADAU,EAAK81B,OAAOrW,QAAQtB,OAAO1jB,GACpB6E,MAUT02B,qBAAA,SAASv7B,EAAIM,EAAQ2D,GAArB,WACC3D,EAASA,GAAU,EAEnB,IAAMwmB,EAAQ5nB,KAAKm8B,OAAOvU,QACpBzkB,EAASykB,EAAM1Z,KAAK/K,OAAO/B,GAC3Bo8B,EAAY5V,EAAMpE,QAAQ1iB,GAAIM,OAC9Bq8B,EAAW7V,EAAM1Z,KAAKqvB,eAAez8B,GAC3C,OACCM,GAAUo8B,IACTz4B,IAAU04B,IAAwB,IAAX14B,GAAgBjE,IAAOqC,EAAOA,EAAON,OAAS,IAE/D,MAER+kB,EAAMzB,KAAKrlB,EAAIiE,EAAO,KAAM,CAAE3D,WAEvBpB,KAAK6sB,WAAW/rB,EAAI,CAAEM,WAAU,GACrCgF,MAAK,WACLC,EAAKq2B,mBAAmBt7B,EAAQ,CAC/BgK,OAAkB,IAAXrG,EAAe5B,EAAON,OAAS,EAAIkC,OAG3CmB,OAAM,WACN0hB,EAAMzB,KAAKrlB,EAAI28B,EAAU,KAAM,CAC9Br8B,OAAQo8B,SAUZnB,+BAAA,SAAmBj7B,EAAQs8B,GAU1B,IATA,IAAM9V,EAAQ5nB,KAAKm8B,OAAOvU,QACpBzkB,EAASykB,EAAM1Z,KAAK/K,OAAO/B,GAE3BgK,EAAQtL,MAAM0mB,YAAYkX,EAAMtyB,OAAS,EAAIiO,KAAKwM,IAAI6X,EAAMtyB,MAAO,GACnE2H,EAAMjT,MAAM0mB,YAAYkX,EAAM3qB,KACjC5P,EAAON,OACPwW,KAAKuM,IAAI8X,EAAM3qB,IAAK5P,EAAON,QAE1B86B,EAAQvyB,EAAQwc,EAAMpE,QAAQrgB,EAAOiI,EAAQ,IAAI2wB,SAAW,EAAI,EAC3Dh3B,EAAQqG,EAAOrG,EAAQgO,EAAKhO,IACpC/E,KAAK6sB,WAAW1pB,EAAO4B,GAAQ,CAAEg3B,SAAU4B,EAAQ54B,EAAQqG,IAAS,wBCnTtE,WAAYrL,GAAZ,WAEO8tB,EAAQjW,EAAY,CACzB/I,IAAK,EACLwQ,KAAM,EACN4H,SAAU,KACV7lB,OAAQ,KACR0hB,SAAU/iB,EAAO+iB,WAAY,EAC7B/F,KAAM,OAGD6gB,EAAW,CAChB7vB,OAAQoE,EACRhH,QAAS,QACTkD,OAAO,EACPjD,MAAO,OACPotB,aAAc,IACd/M,QAAS,CAAC,CAAE7N,IAAK,2BAA4BvO,KAAK,IAClDhP,OAAQ,CAAEwtB,QAAOgQ,aAAc99B,EAAOs0B,WAGvChuB,EAAAE,mBAAWq3B,GAAa79B,WAGfA,OAAOsO,QACfvO,MAAM4F,QAAUwF,OAAOxF,SAGxB,IAAMo4B,EAAU,SAAAj8B,GACf,OAAAwE,EAAKtG,OAAO6N,UAAWvH,EAAKtG,OAAO6N,SAASE,IAAIjM,IAAcA,UAE/DwE,EAAKmR,WAAW,QAAS,IAAKsmB,EAAQlc,IAAb,CAAqBvb,EAAMtG,IACpDsG,EAAKmR,WAAW,UAAW,IAAKsmB,EAAQlC,IAAb,CAAuBv1B,EAAMtG,EAAOiB,MAC/DqF,EAAKmR,WAAW,aAAc,IAAKsmB,EAAQzB,IAAb,CAA0Bh2B,IAExDA,EAAK03B,IACJrnB,EACArQ,EAAKtG,OAAOiU,QAAU,CACrBI,KAAM,KACNtU,MAAO,CACNuU,GAAI,aAiBT,OA1DyB5N,OA+CxBu3B,oBAAA,SAAQvvB,EAAMzM,GACb,MAAa,cAATyM,EAA6BvB,GAAMlL,GACrB,gBAATyM,EAA+BwvB,GAAQj8B,GAEzC,MAIRg8B,qBAAA,WACC,OAAOh+B,KAAKD,OAAOM,OAAOwtB,UAxDH/b,GA4DzBhS,MAAM2R,QACL,CACCzP,KAAM,QACNpB,IAAKo9B,GACLzG,oBACC,OAAOv3B,KAAK2R,KAAK4lB,YAElB1V,oBAAW7f,GACV,OAAOhC,KAAK2R,KAAKkQ,WAAW7f,IAE7B0P,iBACC,IAAMmc,EAAQ7tB,KAAK2R,KAAK4lB,WACxB,IAAK,IAAIn1B,KAAOyrB,EACfpW,EAAKoW,EAAO7tB,KAAKD,OAAQqC,IAG3B87B,YAAa,WACZ,OAAOl+B,KAAK2R,KAAKkQ,WAAW,SAAS+F,UAGvC9nB,MAAM6G,GAAGw3B,YAIJC,GAAW,CAAExc,SAAOga,WAASS,eAC7B4B,GAAU,CAAE5pB,GChGH,CACdgqB,KAAM,OACN9M,KAAM,OACN+M,cAAe,cACfC,cAAe,cACfC,sDACC,sDACDC,sDACC,sDACDC,aAAc,eACdC,WAAY,aAEZC,MAAO,QACPC,aAAc,aACdC,WAAY,WACZC,SAAU,WACVC,SAAU,WACVC,MAAO,QACPC,KAAM,OACNC,QAAS,UACTC,UAAW,YACXC,WAAY,WACZC,cAAe,cACfC,aAAc,aACdC,gBAAiB,gBAEjBC,gBAAiB,gBACjBC,KAAM,OACNC,KAAM,OACNC,eAAgB,eAChBC,iBAAkB,iBAClBC,aAAc,aACdC,eAAgB,eAEhBC,MAAO,QACPrlB,IAAK,MACLslB,KAAM"}